<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Xarray for Multi-dimensional Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">GEOG 288KC</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">🏠 home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Syllabus.html"> 
<span class="menu-text">📋 syllabus</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-weekly-sessions" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">💻 weekly sessions</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-weekly-sessions">    
        <li>
    <a class="dropdown-item" href="../../chapters/c01-geospatial-data-foundations.html">
 <span class="dropdown-text">Week 1 - 🚀 Core Tools and Data Access</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../chapters/c02-spatial-temporal-attention-mechanisms.html">
 <span class="dropdown-text">Week 2 - ⚡ Rapid Remote Sensing Preprocessing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../chapters/c03-complete-gfm-architecture.html">
 <span class="dropdown-text">Week 3 - 🤖 Machine Learning on Remote Sensing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../chapters/c04-pretraining-implementation.html">
 <span class="dropdown-text">Week 4 - 🏗️ Foundation Models in Practice</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../chapters/c05-training-loop-optimization.html">
 <span class="dropdown-text">Week 5 - 🔧 Fine-Tuning &amp; Transfer Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../chapters/c06-model-evaluation-analysis.html">
 <span class="dropdown-text">Week 6 - ⏰ Spatiotemporal Modeling &amp; Projects</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cheatsheets" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">👀 cheatsheets</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-cheatsheets">    
        <li>
    <a class="dropdown-item" href="../../cheatsheets.html">
 <span class="dropdown-text">📋 All Cheatsheets</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">⚡ Quick Starts</li>
        <li>
    <a class="dropdown-item" href="../../extras/cheatsheets/week01_imports.html">
 <span class="dropdown-text">Week 01: Import Guide</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-explainers" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">🧩 explainers</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-explainers">    
        <li class="dropdown-header">1️⃣ Week 1</li>
        <li>
    <a class="dropdown-item" href="../../extras/ai-ml-dl-fm-hierarchy.html">
 <span class="dropdown-text">🤖 AI/ML/DL/FM Hierarchy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../extras/geospatial-foundation-model-predictions-standalone.html">
 <span class="dropdown-text">🎯 GFM Predictions (Standalone)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../extras/geospatial-prediction-hierarchy.html">
 <span class="dropdown-text">✅ Geospatial Task/Prediction Types</span></a>
  </li>  
        <li class="dropdown-header">2️⃣ Week 2</li>
        <li>
    <a class="dropdown-item" href="../../chapters/c00a-foundation_model_architectures.html">
 <span class="dropdown-text">🏗️ Foundation Model Architectures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../chapters/c00b-introduction-to-deeplearning-architecture.html">
 <span class="dropdown-text">🎓 Introduction to Deep Learning Architecture</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-extras" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">📖 extras</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-extras">    
        <li class="dropdown-header">🎯 Practical Examples</li>
        <li>
    <a class="dropdown-item" href="../../extras/examples/normalization_comparison.html">
 <span class="dropdown-text">Normalization Comparison</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../extras/examples/resnet.html">
 <span class="dropdown-text">ResNet Implementation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../extras/examples/text_encoder.html">
 <span class="dropdown-text">Text Encoder</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../extras/examples/tiling-and-patches.html">
 <span class="dropdown-text">Tiling and Patches</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../extras/examples/terratorch_workflows.html">
 <span class="dropdown-text">TerraTorch Workflows</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../extras/resources/course_resources.html">
 <span class="dropdown-text">📚 Reference Materials</span></a>
  </li>  
        <li class="dropdown-header">📁 Project Templates</li>
        <li>
    <a class="dropdown-item" href="../../extras/projects/project-proposal-template.html">
 <span class="dropdown-text">Project Proposal Template</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../extras/projects/mvp-template.html">
 <span class="dropdown-text">Project Results Template</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/gfms-from-scratch/gfms-from-scratch.github.io" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <div class="quarto-title-block"><div><h1 class="title">Xarray for Multi-dimensional Data</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
            <p class="subtitle lead">Handling NetCDF and multi-dimensional arrays</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-to-xarray" id="toc-introduction-to-xarray" class="nav-link active" data-scroll-target="#introduction-to-xarray">Introduction to Xarray</a></li>
  <li><a href="#creating-sample-data" id="toc-creating-sample-data" class="nav-link" data-scroll-target="#creating-sample-data">Creating Sample Data</a>
  <ul class="collapse">
  <li><a href="#creating-dataarrays" id="toc-creating-dataarrays" class="nav-link" data-scroll-target="#creating-dataarrays">Creating DataArrays</a></li>
  <li><a href="#creating-datasets" id="toc-creating-datasets" class="nav-link" data-scroll-target="#creating-datasets">Creating Datasets</a></li>
  </ul></li>
  <li><a href="#basic-data-inspection" id="toc-basic-data-inspection" class="nav-link" data-scroll-target="#basic-data-inspection">Basic Data Inspection</a>
  <ul class="collapse">
  <li><a href="#dataset-overview" id="toc-dataset-overview" class="nav-link" data-scroll-target="#dataset-overview">Dataset overview</a></li>
  <li><a href="#coordinate-inspection" id="toc-coordinate-inspection" class="nav-link" data-scroll-target="#coordinate-inspection">Coordinate inspection</a></li>
  </ul></li>
  <li><a href="#data-selection-and-indexing" id="toc-data-selection-and-indexing" class="nav-link" data-scroll-target="#data-selection-and-indexing">Data Selection and Indexing</a>
  <ul class="collapse">
  <li><a href="#label-based-selection" id="toc-label-based-selection" class="nav-link" data-scroll-target="#label-based-selection">Label-based selection</a></li>
  <li><a href="#integer-based-indexing" id="toc-integer-based-indexing" class="nav-link" data-scroll-target="#integer-based-indexing">Integer-based indexing</a></li>
  <li><a href="#boolean-masking" id="toc-boolean-masking" class="nav-link" data-scroll-target="#boolean-masking">Boolean masking</a></li>
  </ul></li>
  <li><a href="#statistical-operations" id="toc-statistical-operations" class="nav-link" data-scroll-target="#statistical-operations">Statistical Operations</a>
  <ul class="collapse">
  <li><a href="#basic-statistics" id="toc-basic-statistics" class="nav-link" data-scroll-target="#basic-statistics">Basic statistics</a></li>
  <li><a href="#advanced-aggregations" id="toc-advanced-aggregations" class="nav-link" data-scroll-target="#advanced-aggregations">Advanced aggregations</a></li>
  <li><a href="#groupby-operations" id="toc-groupby-operations" class="nav-link" data-scroll-target="#groupby-operations">Groupby operations</a></li>
  </ul></li>
  <li><a href="#data-visualization" id="toc-data-visualization" class="nav-link" data-scroll-target="#data-visualization">Data Visualization</a>
  <ul class="collapse">
  <li><a href="#simple-plots" id="toc-simple-plots" class="nav-link" data-scroll-target="#simple-plots">Simple plots</a></li>
  <li><a href="#spatial-maps" id="toc-spatial-maps" class="nav-link" data-scroll-target="#spatial-maps">Spatial maps</a></li>
  </ul></li>
  <li><a href="#data-manipulation-and-processing" id="toc-data-manipulation-and-processing" class="nav-link" data-scroll-target="#data-manipulation-and-processing">Data Manipulation and Processing</a>
  <ul class="collapse">
  <li><a href="#mathematical-operations" id="toc-mathematical-operations" class="nav-link" data-scroll-target="#mathematical-operations">Mathematical operations</a></li>
  <li><a href="#resampling-and-interpolation" id="toc-resampling-and-interpolation" class="nav-link" data-scroll-target="#resampling-and-interpolation">Resampling and interpolation</a></li>
  <li><a href="#rolling-operations" id="toc-rolling-operations" class="nav-link" data-scroll-target="#rolling-operations">Rolling operations</a></li>
  </ul></li>
  <li><a href="#working-with-real-netcdf-files" id="toc-working-with-real-netcdf-files" class="nav-link" data-scroll-target="#working-with-real-netcdf-files">Working with Real NetCDF Files</a>
  <ul class="collapse">
  <li><a href="#file-io-operations" id="toc-file-io-operations" class="nav-link" data-scroll-target="#file-io-operations">File I/O operations</a></li>
  <li><a href="#chunking-and-dask-integration" id="toc-chunking-and-dask-integration" class="nav-link" data-scroll-target="#chunking-and-dask-integration">Chunking and Dask integration</a></li>
  </ul></li>
  <li><a href="#advanced-operations" id="toc-advanced-operations" class="nav-link" data-scroll-target="#advanced-operations">Advanced Operations</a>
  <ul class="collapse">
  <li><a href="#coordinate-operations" id="toc-coordinate-operations" class="nav-link" data-scroll-target="#coordinate-operations">Coordinate operations</a></li>
  <li><a href="#apply-functions" id="toc-apply-functions" class="nav-link" data-scroll-target="#apply-functions">Apply functions</a></li>
  <li><a href="#merge-and-concatenate" id="toc-merge-and-concatenate" class="nav-link" data-scroll-target="#merge-and-concatenate">Merge and concatenate</a></li>
  </ul></li>
  <li><a href="#performance-tips-and-best-practices" id="toc-performance-tips-and-best-practices" class="nav-link" data-scroll-target="#performance-tips-and-best-practices">Performance Tips and Best Practices</a>
  <ul class="collapse">
  <li><a href="#memory-management" id="toc-memory-management" class="nav-link" data-scroll-target="#memory-management">Memory management</a></li>
  <li><a href="#efficient-operations" id="toc-efficient-operations" class="nav-link" data-scroll-target="#efficient-operations">Efficient operations</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="introduction-to-xarray" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-xarray">Introduction to Xarray</h2>
<p>Xarray is a powerful Python library for working with labeled, multi-dimensional arrays, particularly useful for climate and geospatial data.</p>
<div id="48408882" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Xarray version: </span><span class="sc">{</span>xr<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NumPy version: </span><span class="sc">{</span>np<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Xarray version: 2025.7.1
NumPy version: 1.26.4</code></pre>
</div>
</div>
</section>
<section id="creating-sample-data" class="level2">
<h2 class="anchored" data-anchor-id="creating-sample-data">Creating Sample Data</h2>
<section id="creating-dataarrays" class="level3">
<h3 class="anchored" data-anchor-id="creating-dataarrays">Creating DataArrays</h3>
<div id="6db15727" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample temperature data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinates</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> pd.date_range(<span class="st">'2020-01-01'</span>, periods<span class="op">=</span><span class="dv">365</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>lat <span class="op">=</span> np.linspace(<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">25</span>)  <span class="co"># Latitude</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>lon <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">125</span>, <span class="op">-</span><span class="dv">65</span>, <span class="dv">60</span>)  <span class="co"># Longitude</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create temperature data with seasonal pattern</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>temp_data <span class="op">=</span> np.random.randn(<span class="dv">365</span>, <span class="dv">25</span>, <span class="dv">60</span>) <span class="op">*</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">20</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, t <span class="kw">in</span> <span class="bu">enumerate</span>(time):</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    seasonal <span class="op">=</span> <span class="dv">10</span> <span class="op">*</span> np.sin(<span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> (t.dayofyear <span class="op">-</span> <span class="dv">80</span>) <span class="op">/</span> <span class="dv">365</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    temp_data[i] <span class="op">+=</span> seasonal</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataArray</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>temperature <span class="op">=</span> xr.DataArray(</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    temp_data,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    coords<span class="op">=</span>{</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'time'</span>: time,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'lat'</span>: lat, </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'lon'</span>: lon</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    dims<span class="op">=</span>[<span class="st">'time'</span>, <span class="st">'lat'</span>, <span class="st">'lon'</span>],</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    attrs<span class="op">=</span>{</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'units'</span>: <span class="st">'degrees_Celsius'</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'description'</span>: <span class="st">'Daily temperature'</span>,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'source'</span>: <span class="st">'Simulated data'</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Temperature DataArray shape: </span><span class="sc">{</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Coordinates: </span><span class="sc">{</span><span class="bu">list</span>(temperature.coords.keys())<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temperature DataArray shape: (365, 25, 60)
Coordinates: ['time', 'lat', 'lon']</code></pre>
</div>
</div>
</section>
<section id="creating-datasets" class="level3">
<h3 class="anchored" data-anchor-id="creating-datasets">Creating Datasets</h3>
<div id="0b4f7816" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create precipitation data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>precip_data <span class="op">=</span> np.maximum(<span class="dv">0</span>, np.random.randn(<span class="dv">365</span>, <span class="dv">25</span>, <span class="dv">60</span>) <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>precipitation <span class="op">=</span> xr.DataArray(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    precip_data,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    coords<span class="op">=</span>temperature.coords,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    dims<span class="op">=</span>temperature.dims,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    attrs<span class="op">=</span>{<span class="st">'units'</span>: <span class="st">'mm'</span>, <span class="st">'description'</span>: <span class="st">'Daily precipitation'</span>}</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create humidity data</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>humidity_data <span class="op">=</span> np.random.beta(<span class="fl">0.7</span>, <span class="fl">0.3</span>, (<span class="dv">365</span>, <span class="dv">25</span>, <span class="dv">60</span>)) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>humidity <span class="op">=</span> xr.DataArray(</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    humidity_data,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    coords<span class="op">=</span>temperature.coords,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    dims<span class="op">=</span>temperature.dims,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    attrs<span class="op">=</span>{<span class="st">'units'</span>: <span class="st">'percent'</span>, <span class="st">'description'</span>: <span class="st">'Relative humidity'</span>}</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine into Dataset</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>weather_ds <span class="op">=</span> xr.Dataset({</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'temperature'</span>: temperature,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'precipitation'</span>: precipitation,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'humidity'</span>: humidity</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dataset variables: </span><span class="sc">{</span><span class="bu">list</span>(weather_ds.data_vars)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dataset dimensions: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>sizes<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset variables: ['temperature', 'precipitation', 'humidity']
Dataset dimensions: Frozen({'time': 365, 'lat': 25, 'lon': 60})</code></pre>
</div>
</div>
</section>
</section>
<section id="basic-data-inspection" class="level2">
<h2 class="anchored" data-anchor-id="basic-data-inspection">Basic Data Inspection</h2>
<section id="dataset-overview" class="level3">
<h3 class="anchored" data-anchor-id="dataset-overview">Dataset overview</h3>
<div id="1f2e9bd8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset info</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Dataset structure:"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(weather_ds)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Dataset size in memory: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>nbytes <span class="op">/</span> <span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> MB"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable info</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Temperature statistics:"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>temperature<span class="sc">.</span>mean()<span class="sc">.</span>values<span class="sc">:.2f}</span><span class="ss">°C"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Min:  </span><span class="sc">{</span>weather_ds<span class="sc">.</span>temperature<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>values<span class="sc">:.2f}</span><span class="ss">°C"</span>) </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Max:  </span><span class="sc">{</span>weather_ds<span class="sc">.</span>temperature<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>values<span class="sc">:.2f}</span><span class="ss">°C"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset structure:
&lt;xarray.Dataset&gt; Size: 13MB
Dimensions:        (time: 365, lat: 25, lon: 60)
Coordinates:
  * time           (time) datetime64[ns] 3kB 2020-01-01 ... 2020-12-30
  * lat            (lat) float64 200B 25.0 26.04 27.08 ... 47.92 48.96 50.0
  * lon            (lon) float64 480B -125.0 -124.0 -123.0 ... -66.02 -65.0
Data variables:
    temperature    (time, lat, lon) float64 4MB 12.71 9.53 13.46 ... 9.767 15.39
    precipitation  (time, lat, lon) float64 4MB 5.153 0.0 0.0 ... 1.206 0.0 0.0
    humidity       (time, lat, lon) float64 4MB 23.86 14.75 ... 35.48 69.34

Dataset size in memory: 13.1 MB

Temperature statistics:
  Mean: 19.99°C
  Min:  -10.97°C
  Max:  51.09°C</code></pre>
</div>
</div>
</section>
<section id="coordinate-inspection" class="level3">
<h3 class="anchored" data-anchor-id="coordinate-inspection">Coordinate inspection</h3>
<div id="5f1fc750" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine coordinates</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Time coordinate:"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Start: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>time<span class="sc">.</span>values[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  End: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>time<span class="sc">.</span>values[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Frequency: daily"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Spatial extent:"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Latitude: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>lat<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>values<span class="sc">:.1f}</span><span class="ss">° to </span><span class="sc">{</span>weather_ds<span class="sc">.</span>lat<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>values<span class="sc">:.1f}</span><span class="ss">°"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Longitude: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>lon<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>values<span class="sc">:.1f}</span><span class="ss">° to </span><span class="sc">{</span>weather_ds<span class="sc">.</span>lon<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>values<span class="sc">:.1f}</span><span class="ss">°"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Missing values:"</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Temperature: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>temperature<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Precipitation: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>precipitation<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time coordinate:
  Start: 2020-01-01T00:00:00.000000000
  End: 2020-12-30T00:00:00.000000000
  Frequency: daily

Spatial extent:
  Latitude: 25.0° to 50.0°
  Longitude: -125.0° to -65.0°

Missing values:
  Temperature: 0
  Precipitation: 0</code></pre>
</div>
</div>
</section>
</section>
<section id="data-selection-and-indexing" class="level2">
<h2 class="anchored" data-anchor-id="data-selection-and-indexing">Data Selection and Indexing</h2>
<section id="label-based-selection" class="level3">
<h3 class="anchored" data-anchor-id="label-based-selection">Label-based selection</h3>
<div id="4f9f0d3c" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select by coordinate values</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>summer_data <span class="op">=</span> weather_ds.sel(time<span class="op">=</span><span class="bu">slice</span>(<span class="st">'2020-06-01'</span>, <span class="st">'2020-08-31'</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Summer data shape: </span><span class="sc">{</span>summer_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Select specific coordinates</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>point_data <span class="op">=</span> weather_ds.sel(lat<span class="op">=</span><span class="dv">40</span>, lon<span class="op">=-</span><span class="dv">100</span>, method<span class="op">=</span><span class="st">'nearest'</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Point time series shape: </span><span class="sc">{</span>point_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Select multiple points</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>region_data <span class="op">=</span> weather_ds.sel(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    lat<span class="op">=</span><span class="bu">slice</span>(<span class="dv">30</span>, <span class="dv">45</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    lon<span class="op">=</span><span class="bu">slice</span>(<span class="op">-</span><span class="dv">120</span>, <span class="op">-</span><span class="dv">90</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Regional data shape: </span><span class="sc">{</span>region_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Summer data shape: (92, 25, 60)
Point time series shape: (365,)
Regional data shape: (365, 15, 30)</code></pre>
</div>
</div>
</section>
<section id="integer-based-indexing" class="level3">
<h3 class="anchored" data-anchor-id="integer-based-indexing">Integer-based indexing</h3>
<div id="0a2b1cfd" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Index-based selection</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>first_week <span class="op">=</span> weather_ds.isel(time<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">7</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"First week shape: </span><span class="sc">{</span>first_week<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Select every 10th day</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>monthly_subset <span class="op">=</span> weather_ds.isel(time<span class="op">=</span><span class="bu">slice</span>(<span class="va">None</span>, <span class="va">None</span>, <span class="dv">10</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Monthly subset shape: </span><span class="sc">{</span>monthly_subset<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Select specific grid cells</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>corner_data <span class="op">=</span> weather_ds.isel(lat<span class="op">=</span>[<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>], lon<span class="op">=</span>[<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Corner data shape: </span><span class="sc">{</span>corner_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>First week shape: (7, 25, 60)
Monthly subset shape: (37, 25, 60)
Corner data shape: (365, 2, 2)</code></pre>
</div>
</div>
</section>
<section id="boolean-masking" class="level3">
<h3 class="anchored" data-anchor-id="boolean-masking">Boolean masking</h3>
<div id="c84b57e1" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature-based mask</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>hot_days <span class="op">=</span> weather_ds.where(weather_ds.temperature <span class="op">&gt;</span> <span class="dv">25</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Hot days data points: </span><span class="sc">{</span>hot_days<span class="sc">.</span>temperature<span class="sc">.</span>count()<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple conditions</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>summer_hot <span class="op">=</span> weather_ds.where(</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    (weather_ds.temperature <span class="op">&gt;</span> <span class="dv">25</span>) <span class="op">&amp;</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    (weather_ds.time.dt.season <span class="op">==</span> <span class="st">'JJA'</span>), </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    drop<span class="op">=</span><span class="va">True</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Summer hot days: </span><span class="sc">{</span>summer_hot<span class="sc">.</span>temperature<span class="sc">.</span>count()<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hot days data points: 171081
Summer hot days: 98382</code></pre>
</div>
</div>
</section>
</section>
<section id="statistical-operations" class="level2">
<h2 class="anchored" data-anchor-id="statistical-operations">Statistical Operations</h2>
<section id="basic-statistics" class="level3">
<h3 class="anchored" data-anchor-id="basic-statistics">Basic statistics</h3>
<div id="49636d43" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Global statistics</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>global_stats <span class="op">=</span> weather_ds.mean()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Global mean values:"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> global_stats.data_vars:</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>global_stats[var]<span class="sc">.</span>values<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Temporal statistics</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>monthly_means <span class="op">=</span> weather_ds.groupby(<span class="st">'time.month'</span>).mean()</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Monthly means shape: </span><span class="sc">{</span>monthly_means<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial statistics</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>spatial_mean <span class="op">=</span> weather_ds.mean([<span class="st">'lat'</span>, <span class="st">'lon'</span>])</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Time series of spatial means: </span><span class="sc">{</span>spatial_mean<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Global mean values:
  temperature: 19.99
  precipitation: 1.39
  humidity: 69.99
Monthly means shape: (12, 25, 60)
Time series of spatial means: (365,)</code></pre>
</div>
</div>
</section>
<section id="advanced-aggregations" class="level3">
<h3 class="anchored" data-anchor-id="advanced-aggregations">Advanced aggregations</h3>
<div id="9606e61e" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard deviation</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>temp_std <span class="op">=</span> weather_ds.temperature.std(<span class="st">'time'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Temperature variability shape: </span><span class="sc">{</span>temp_std<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Percentiles</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>temp_p90 <span class="op">=</span> weather_ds.temperature.quantile(<span class="fl">0.9</span>, <span class="st">'time'</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"90th percentile temperature shape: </span><span class="sc">{</span>temp_p90<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative operations</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>cumulative_precip <span class="op">=</span> weather_ds.precipitation.cumsum(<span class="st">'time'</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cumulative precipitation shape: </span><span class="sc">{</span>cumulative_precip<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temperature variability shape: (25, 60)
90th percentile temperature shape: (25, 60)
Cumulative precipitation shape: (365, 25, 60)</code></pre>
</div>
</div>
</section>
<section id="groupby-operations" class="level3">
<h3 class="anchored" data-anchor-id="groupby-operations">Groupby operations</h3>
<div id="7da89432" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by season</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>seasonal_stats <span class="op">=</span> weather_ds.groupby(<span class="st">'time.season'</span>).mean()</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Seasonal statistics dimensions: </span><span class="sc">{</span>seasonal_stats<span class="sc">.</span>dims<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by month</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>monthly_stats <span class="op">=</span> weather_ds.groupby(<span class="st">'time.month'</span>).std()</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Monthly variability shape: </span><span class="sc">{</span>monthly_stats<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom grouping</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_decade(time):</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (time.dt.day <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> <span class="dv">10</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>decade_stats <span class="op">=</span> weather_ds.groupby(get_decade(weather_ds.time)).mean()</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Decade-based statistics created"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Seasonal statistics dimensions: FrozenMappingWarningOnValuesAccess({'season': 4, 'lat': 25, 'lon': 60})
Monthly variability shape: (12, 25, 60)
Decade-based statistics created</code></pre>
</div>
</div>
</section>
</section>
<section id="data-visualization" class="level2">
<h2 class="anchored" data-anchor-id="data-visualization">Data Visualization</h2>
<section id="simple-plots" class="level3">
<h3 class="anchored" data-anchor-id="simple-plots">Simple plots</h3>
<div id="007f7315" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series plot at a specific location</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>location_ts <span class="op">=</span> weather_ds.sel(lat<span class="op">=</span><span class="dv">40</span>, lon<span class="op">=-</span><span class="dv">100</span>, method<span class="op">=</span><span class="st">'nearest'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature time series</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>location_ts.temperature.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Temperature Time Series'</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Temperature (°C)'</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation time series  </span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>location_ts.precipitation.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>], color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Precipitation Time Series'</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Precipitation (mm)'</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="xarray_basics_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="spatial-maps" class="level3">
<h3 class="anchored" data-anchor-id="spatial-maps">Spatial maps</h3>
<div id="1c12c89e" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot spatial maps for specific dates</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Summer and winter temperature maps</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>summer_temp <span class="op">=</span> weather_ds.temperature.sel(time<span class="op">=</span><span class="st">'2020-07-15'</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>winter_temp <span class="op">=</span> weather_ds.temperature.sel(time<span class="op">=</span><span class="st">'2020-01-15'</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>summer_temp.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">0</span>], cmap<span class="op">=</span><span class="st">'Reds'</span>, add_colorbar<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Summer Temperature (July 15)'</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>winter_temp.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">1</span>], cmap<span class="op">=</span><span class="st">'Blues'</span>, add_colorbar<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Winter Temperature (January 15)'</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Annual mean temperature and precipitation</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>annual_temp_mean <span class="op">=</span> weather_ds.temperature.mean(<span class="st">'time'</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>annual_precip_sum <span class="op">=</span> weather_ds.precipitation.<span class="bu">sum</span>(<span class="st">'time'</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>annual_temp_mean.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">0</span>], cmap<span class="op">=</span><span class="st">'RdYlBu_r'</span>, add_colorbar<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'Annual Mean Temperature'</span>)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>annual_precip_sum.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">1</span>], cmap<span class="op">=</span><span class="st">'BuPu'</span>, add_colorbar<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">'Annual Total Precipitation'</span>)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="xarray_basics_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="data-manipulation-and-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-manipulation-and-processing">Data Manipulation and Processing</h2>
<section id="mathematical-operations" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-operations">Mathematical operations</h3>
<div id="edb5b478" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Celsius to Fahrenheit</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>temp_fahrenheit <span class="op">=</span> weather_ds.temperature <span class="op">*</span> <span class="dv">9</span><span class="op">/</span><span class="dv">5</span> <span class="op">+</span> <span class="dv">32</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>temp_fahrenheit.attrs[<span class="st">'units'</span>] <span class="op">=</span> <span class="st">'degrees_Fahrenheit'</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Temperature in F: </span><span class="sc">{</span>temp_fahrenheit<span class="sc">.</span>mean()<span class="sc">.</span>values<span class="sc">:.1f}</span><span class="ss">°F"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate derived variables</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Heat index approximation (simplified)</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>heat_index <span class="op">=</span> (weather_ds.temperature <span class="op">+</span> weather_ds.humidity <span class="op">*</span> <span class="fl">0.1</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>heat_index.attrs[<span class="st">'description'</span>] <span class="op">=</span> <span class="st">'Simplified heat index'</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily temperature range</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>daily_temp_range <span class="op">=</span> weather_ds.temperature.<span class="bu">max</span>([<span class="st">'lat'</span>, <span class="st">'lon'</span>]) <span class="op">-</span> weather_ds.temperature.<span class="bu">min</span>([<span class="st">'lat'</span>, <span class="st">'lon'</span>])</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Daily temperature range shape: </span><span class="sc">{</span>daily_temp_range<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temperature in F: 68.0°F
Daily temperature range shape: (365,)</code></pre>
</div>
</div>
</section>
<section id="resampling-and-interpolation" class="level3">
<h3 class="anchored" data-anchor-id="resampling-and-interpolation">Resampling and interpolation</h3>
<div id="704830b0" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Temporal resampling</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>weekly_data <span class="op">=</span> weather_ds.resample(time<span class="op">=</span><span class="st">'W'</span>).mean()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Weekly data shape: </span><span class="sc">{</span>weekly_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>monthly_data <span class="op">=</span> weather_ds.resample(time<span class="op">=</span><span class="st">'M'</span>).mean()</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Monthly data shape: </span><span class="sc">{</span>monthly_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolation</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create higher resolution coordinates</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>high_res_lat <span class="op">=</span> np.linspace(<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">50</span>)  <span class="co"># Double resolution</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>high_res_lon <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">125</span>, <span class="op">-</span><span class="dv">65</span>, <span class="dv">120</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolate to higher resolution</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>high_res_data <span class="op">=</span> weather_ds.interp(lat<span class="op">=</span>high_res_lat, lon<span class="op">=</span>high_res_lon)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"High resolution shape: </span><span class="sc">{</span>high_res_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Weekly data shape: (53, 25, 60)
Monthly data shape: (12, 25, 60)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/kellycaylor/mambaforge/envs/geoAI/lib/python3.11/site-packages/xarray/groupers.py:509: FutureWarning:

'M' is deprecated and will be removed in a future version, please use 'ME' instead.
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>High resolution shape: (365, 50, 120)</code></pre>
</div>
</div>
</section>
<section id="rolling-operations" class="level3">
<h3 class="anchored" data-anchor-id="rolling-operations">Rolling operations</h3>
<div id="b262b1b8" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rolling mean (7-day moving average)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>rolling_temp <span class="op">=</span> weather_ds.temperature.rolling(time<span class="op">=</span><span class="dv">7</span>, center<span class="op">=</span><span class="va">True</span>).mean()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"7-day rolling mean shape: </span><span class="sc">{</span>rolling_temp<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Rolling sum for precipitation (weekly totals)</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>weekly_precip <span class="op">=</span> weather_ds.precipitation.rolling(time<span class="op">=</span><span class="dv">7</span>).<span class="bu">sum</span>()</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Weekly precipitation totals shape: </span><span class="sc">{</span>weekly_precip<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>7-day rolling mean shape: (365, 25, 60)
Weekly precipitation totals shape: (365, 25, 60)</code></pre>
</div>
</div>
</section>
</section>
<section id="working-with-real-netcdf-files" class="level2">
<h2 class="anchored" data-anchor-id="working-with-real-netcdf-files">Working with Real NetCDF Files</h2>
<section id="file-io-operations" class="level3">
<h3 class="anchored" data-anchor-id="file-io-operations">File I/O operations</h3>
<div id="a1baea25" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save dataset to NetCDF</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>weather_ds.to_netcdf(<span class="st">'sample_weather_data.nc'</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Dataset saved to NetCDF file"</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load dataset from file</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>loaded_ds <span class="op">=</span> xr.open_dataset(<span class="st">'sample_weather_data.nc'</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Loaded dataset variables: </span><span class="sc">{</span><span class="bu">list</span>(loaded_ds.data_vars)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Open multiple files (example pattern)</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># multi_file_ds = xr.open_mfdataset('weather_*.nc', combine='by_coords')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset saved to NetCDF file
Loaded dataset variables: ['temperature', 'precipitation', 'humidity']</code></pre>
</div>
</div>
</section>
<section id="chunking-and-dask-integration" class="level3">
<h3 class="anchored" data-anchor-id="chunking-and-dask-integration">Chunking and Dask integration</h3>
<div id="81fa3667" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create chunked dataset for large data</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>chunked_ds <span class="op">=</span> weather_ds.chunk({<span class="st">'time'</span>: <span class="dv">30</span>, <span class="st">'lat'</span>: <span class="dv">10</span>, <span class="st">'lon'</span>: <span class="dv">20</span>})</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Chunked dataset: </span><span class="sc">{</span>chunked_ds<span class="sc">.</span>temperature<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Lazy operations with chunked data</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>lazy_mean <span class="op">=</span> chunked_ds.temperature.mean()</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Lazy computation created: </span><span class="sc">{</span><span class="bu">type</span>(lazy_mean.data)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute result</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>actual_mean <span class="op">=</span> lazy_mean.compute()</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Computed mean: </span><span class="sc">{</span>actual_mean<span class="sc">.</span>values<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chunked dataset: &lt;xarray.DataArray 'temperature' (time: 365, lat: 25, lon: 60)&gt; Size: 4MB
dask.array&lt;xarray-temperature, shape=(365, 25, 60), dtype=float64, chunksize=(30, 10, 20), chunktype=numpy.ndarray&gt;
Coordinates:
  * time     (time) datetime64[ns] 3kB 2020-01-01 2020-01-02 ... 2020-12-30
  * lat      (lat) float64 200B 25.0 26.04 27.08 28.12 ... 47.92 48.96 50.0
  * lon      (lon) float64 480B -125.0 -124.0 -123.0 ... -67.03 -66.02 -65.0
Attributes:
    units:        degrees_Celsius
    description:  Daily temperature
    source:       Simulated data
Lazy computation created: &lt;class 'dask.array.core.Array'&gt;
Computed mean: 19.99</code></pre>
</div>
</div>
</section>
</section>
<section id="advanced-operations" class="level2">
<h2 class="anchored" data-anchor-id="advanced-operations">Advanced Operations</h2>
<section id="coordinate-operations" class="level3">
<h3 class="anchored" data-anchor-id="coordinate-operations">Coordinate operations</h3>
<div id="4f77021a" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add new coordinates</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>weather_ds_with_doy <span class="op">=</span> weather_ds.assign_coords(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    day_of_year<span class="op">=</span>weather_ds.time.dt.dayofyear</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack/unstack dimensions</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>stacked <span class="op">=</span> weather_ds.stack(location<span class="op">=</span>[<span class="st">'lat'</span>, <span class="st">'lon'</span>])</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Stacked dimensions: </span><span class="sc">{</span>stacked<span class="sc">.</span>temperature<span class="sc">.</span>dims<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>unstacked <span class="op">=</span> stacked.unstack(<span class="st">'location'</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unstacked back to: </span><span class="sc">{</span>unstacked<span class="sc">.</span>temperature<span class="sc">.</span>dims<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Stacked dimensions: ('time', 'location')
Unstacked back to: ('time', 'lat', 'lon')</code></pre>
</div>
</div>
</section>
<section id="apply-functions" class="level3">
<h3 class="anchored" data-anchor-id="apply-functions">Apply functions</h3>
<div id="45e454dd" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply custom function along dimension</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> temp_category(temp_array):</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Categorize temperature"""</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xr.where(temp_array <span class="op">&lt;</span> <span class="dv">0</span>, <span class="st">'cold'</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                   xr.where(temp_array <span class="op">&lt;</span> <span class="dv">20</span>, <span class="st">'mild'</span>, <span class="st">'warm'</span>))</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>temp_categories <span class="op">=</span> xr.apply_ufunc(</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    temp_category,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    weather_ds.temperature,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    dask<span class="op">=</span><span class="st">'allowed'</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    output_dtypes<span class="op">=</span>[<span class="bu">object</span>]</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Temperature categorization applied"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temperature categorization applied</code></pre>
</div>
</div>
</section>
<section id="merge-and-concatenate" class="level3">
<h3 class="anchored" data-anchor-id="merge-and-concatenate">Merge and concatenate</h3>
<div id="2e0d0cae" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split dataset by time</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>first_half <span class="op">=</span> weather_ds.isel(time<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">182</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>second_half <span class="op">=</span> weather_ds.isel(time<span class="op">=</span><span class="bu">slice</span>(<span class="dv">182</span>, <span class="va">None</span>))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate back together</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>full_dataset <span class="op">=</span> xr.concat([first_half, second_half], dim<span class="op">=</span><span class="st">'time'</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Concatenated dataset shape: </span><span class="sc">{</span>full_dataset<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge different datasets</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>elevation_data <span class="op">=</span> xr.DataArray(</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    np.random.randint(<span class="dv">0</span>, <span class="dv">3000</span>, (<span class="dv">25</span>, <span class="dv">60</span>)),</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    coords<span class="op">=</span>{<span class="st">'lat'</span>: lat, <span class="st">'lon'</span>: lon},</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    dims<span class="op">=</span>[<span class="st">'lat'</span>, <span class="st">'lon'</span>],</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    attrs<span class="op">=</span>{<span class="st">'units'</span>: <span class="st">'meters'</span>, <span class="st">'description'</span>: <span class="st">'Elevation'</span>}</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>merged_ds <span class="op">=</span> weather_ds.merge({<span class="st">'elevation'</span>: elevation_data})</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Merged dataset variables: </span><span class="sc">{</span><span class="bu">list</span>(merged_ds.data_vars)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Concatenated dataset shape: (365, 25, 60)
Merged dataset variables: ['temperature', 'precipitation', 'humidity', 'elevation']</code></pre>
</div>
</div>
</section>
</section>
<section id="performance-tips-and-best-practices" class="level2">
<h2 class="anchored" data-anchor-id="performance-tips-and-best-practices">Performance Tips and Best Practices</h2>
<section id="memory-management" class="level3">
<h3 class="anchored" data-anchor-id="memory-management">Memory management</h3>
<div id="8dc458f8" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check memory usage</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dataset memory usage: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>nbytes <span class="op">/</span> <span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> MB"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use lazy loading for large files</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># lazy_ds = xr.open_dataset('large_file.nc', chunks={'time': 100})</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Close files when done</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>loaded_ds.close()</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"File closed to free memory"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset memory usage: 13.1 MB
File closed to free memory</code></pre>
</div>
</div>
</section>
<section id="efficient-operations" class="level3">
<h3 class="anchored" data-anchor-id="efficient-operations">Efficient operations</h3>
<div id="1988d424" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use vectorized operations</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>efficient_calc <span class="op">=</span> weather_ds.temperature <span class="op">-</span> weather_ds.temperature.mean(<span class="st">'time'</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Efficient anomaly calculation completed"</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Avoid loops when possible - use built-in functions</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>monthly_anomalies <span class="op">=</span> weather_ds.groupby(<span class="st">'time.month'</span>) <span class="op">-</span> weather_ds.groupby(<span class="st">'time.month'</span>).mean()</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Monthly anomalies calculated efficiently"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Efficient anomaly calculation completed
Monthly anomalies calculated efficiently</code></pre>
</div>
</div>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Key Xarray concepts: - <strong>DataArrays</strong>: Labeled, multi-dimensional arrays - <strong>Datasets</strong>: Collections of DataArrays with shared coordinates<br>
- <strong>Coordinates</strong>: Labels for array dimensions - <strong>Selection</strong>: Label-based (.sel) and integer-based (.isel) - <strong>GroupBy</strong>: Split-apply-combine operations - <strong>Resampling</strong>: Temporal aggregation and frequency conversion - <strong>I/O</strong>: Reading/writing NetCDF and other formats - <strong>Dask integration</strong>: Lazy evaluation for large datasets</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/kcaylor\.github\.io\/GEOG-288KC-geospatial-foundation-models");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb47" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Xarray for Multi-dimensional Data"</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Handling NetCDF and multi-dimensional arrays"</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> geoai</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction to Xarray</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>Xarray is a powerful Python library for working with labeled, multi-dimensional arrays, particularly useful for climate and geospatial data.</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Xarray version: </span><span class="sc">{</span>xr<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NumPy version: </span><span class="sc">{</span>np<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Creating Sample Data</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating DataArrays</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample temperature data</span></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinates</span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> pd.date_range(<span class="st">'2020-01-01'</span>, periods<span class="op">=</span><span class="dv">365</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>lat <span class="op">=</span> np.linspace(<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">25</span>)  <span class="co"># Latitude</span></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>lon <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">125</span>, <span class="op">-</span><span class="dv">65</span>, <span class="dv">60</span>)  <span class="co"># Longitude</span></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Create temperature data with seasonal pattern</span></span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>temp_data <span class="op">=</span> np.random.randn(<span class="dv">365</span>, <span class="dv">25</span>, <span class="dv">60</span>) <span class="op">*</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">20</span></span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, t <span class="kw">in</span> <span class="bu">enumerate</span>(time):</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>    seasonal <span class="op">=</span> <span class="dv">10</span> <span class="op">*</span> np.sin(<span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> (t.dayofyear <span class="op">-</span> <span class="dv">80</span>) <span class="op">/</span> <span class="dv">365</span>)</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>    temp_data[i] <span class="op">+=</span> seasonal</span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataArray</span></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>temperature <span class="op">=</span> xr.DataArray(</span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>    temp_data,</span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>    coords<span class="op">=</span>{</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">'time'</span>: time,</span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">'lat'</span>: lat, </span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">'lon'</span>: lon</span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>    dims<span class="op">=</span>[<span class="st">'time'</span>, <span class="st">'lat'</span>, <span class="st">'lon'</span>],</span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a>    attrs<span class="op">=</span>{</span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">'units'</span>: <span class="st">'degrees_Celsius'</span>,</span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">'description'</span>: <span class="st">'Daily temperature'</span>,</span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">'source'</span>: <span class="st">'Simulated data'</span></span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Temperature DataArray shape: </span><span class="sc">{</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Coordinates: </span><span class="sc">{</span><span class="bu">list</span>(temperature.coords.keys())<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating Datasets</span></span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Create precipitation data</span></span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a>precip_data <span class="op">=</span> np.maximum(<span class="dv">0</span>, np.random.randn(<span class="dv">365</span>, <span class="dv">25</span>, <span class="dv">60</span>) <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a>precipitation <span class="op">=</span> xr.DataArray(</span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a>    precip_data,</span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>    coords<span class="op">=</span>temperature.coords,</span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a>    dims<span class="op">=</span>temperature.dims,</span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a>    attrs<span class="op">=</span>{<span class="st">'units'</span>: <span class="st">'mm'</span>, <span class="st">'description'</span>: <span class="st">'Daily precipitation'</span>}</span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Create humidity data</span></span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a>humidity_data <span class="op">=</span> np.random.beta(<span class="fl">0.7</span>, <span class="fl">0.3</span>, (<span class="dv">365</span>, <span class="dv">25</span>, <span class="dv">60</span>)) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a>humidity <span class="op">=</span> xr.DataArray(</span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a>    humidity_data,</span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a>    coords<span class="op">=</span>temperature.coords,</span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a>    dims<span class="op">=</span>temperature.dims,</span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a>    attrs<span class="op">=</span>{<span class="st">'units'</span>: <span class="st">'percent'</span>, <span class="st">'description'</span>: <span class="st">'Relative humidity'</span>}</span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine into Dataset</span></span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a>weather_ds <span class="op">=</span> xr.Dataset({</span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a>    <span class="st">'temperature'</span>: temperature,</span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a>    <span class="st">'precipitation'</span>: precipitation,</span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a>    <span class="st">'humidity'</span>: humidity</span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dataset variables: </span><span class="sc">{</span><span class="bu">list</span>(weather_ds.data_vars)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dataset dimensions: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>sizes<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basic Data Inspection</span></span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dataset overview</span></span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset info</span></span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Dataset structure:"</span>)</span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(weather_ds)</span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Dataset size in memory: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>nbytes <span class="op">/</span> <span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> MB"</span>)</span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable info</span></span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Temperature statistics:"</span>)</span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>temperature<span class="sc">.</span>mean()<span class="sc">.</span>values<span class="sc">:.2f}</span><span class="ss">°C"</span>)</span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Min:  </span><span class="sc">{</span>weather_ds<span class="sc">.</span>temperature<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>values<span class="sc">:.2f}</span><span class="ss">°C"</span>) </span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Max:  </span><span class="sc">{</span>weather_ds<span class="sc">.</span>temperature<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>values<span class="sc">:.2f}</span><span class="ss">°C"</span>)</span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true" tabindex="-1"></a><span class="fu">### Coordinate inspection</span></span>
<span id="cb47-121"><a href="#cb47-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-122"><a href="#cb47-122" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine coordinates</span></span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Time coordinate:"</span>)</span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Start: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>time<span class="sc">.</span>values[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  End: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>time<span class="sc">.</span>values[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Frequency: daily"</span>)</span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-128"><a href="#cb47-128" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Spatial extent:"</span>)</span>
<span id="cb47-129"><a href="#cb47-129" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Latitude: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>lat<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>values<span class="sc">:.1f}</span><span class="ss">° to </span><span class="sc">{</span>weather_ds<span class="sc">.</span>lat<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>values<span class="sc">:.1f}</span><span class="ss">°"</span>)</span>
<span id="cb47-130"><a href="#cb47-130" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Longitude: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>lon<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>values<span class="sc">:.1f}</span><span class="ss">° to </span><span class="sc">{</span>weather_ds<span class="sc">.</span>lon<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>values<span class="sc">:.1f}</span><span class="ss">°"</span>)</span>
<span id="cb47-131"><a href="#cb47-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-132"><a href="#cb47-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values</span></span>
<span id="cb47-133"><a href="#cb47-133" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Missing values:"</span>)</span>
<span id="cb47-134"><a href="#cb47-134" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Temperature: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>temperature<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-135"><a href="#cb47-135" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Precipitation: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>precipitation<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-136"><a href="#cb47-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-137"><a href="#cb47-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-138"><a href="#cb47-138" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Selection and Indexing</span></span>
<span id="cb47-139"><a href="#cb47-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-140"><a href="#cb47-140" aria-hidden="true" tabindex="-1"></a><span class="fu">### Label-based selection</span></span>
<span id="cb47-143"><a href="#cb47-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-144"><a href="#cb47-144" aria-hidden="true" tabindex="-1"></a><span class="co"># Select by coordinate values</span></span>
<span id="cb47-145"><a href="#cb47-145" aria-hidden="true" tabindex="-1"></a>summer_data <span class="op">=</span> weather_ds.sel(time<span class="op">=</span><span class="bu">slice</span>(<span class="st">'2020-06-01'</span>, <span class="st">'2020-08-31'</span>))</span>
<span id="cb47-146"><a href="#cb47-146" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Summer data shape: </span><span class="sc">{</span>summer_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-147"><a href="#cb47-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-148"><a href="#cb47-148" aria-hidden="true" tabindex="-1"></a><span class="co"># Select specific coordinates</span></span>
<span id="cb47-149"><a href="#cb47-149" aria-hidden="true" tabindex="-1"></a>point_data <span class="op">=</span> weather_ds.sel(lat<span class="op">=</span><span class="dv">40</span>, lon<span class="op">=-</span><span class="dv">100</span>, method<span class="op">=</span><span class="st">'nearest'</span>)</span>
<span id="cb47-150"><a href="#cb47-150" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Point time series shape: </span><span class="sc">{</span>point_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-151"><a href="#cb47-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-152"><a href="#cb47-152" aria-hidden="true" tabindex="-1"></a><span class="co"># Select multiple points</span></span>
<span id="cb47-153"><a href="#cb47-153" aria-hidden="true" tabindex="-1"></a>region_data <span class="op">=</span> weather_ds.sel(</span>
<span id="cb47-154"><a href="#cb47-154" aria-hidden="true" tabindex="-1"></a>    lat<span class="op">=</span><span class="bu">slice</span>(<span class="dv">30</span>, <span class="dv">45</span>),</span>
<span id="cb47-155"><a href="#cb47-155" aria-hidden="true" tabindex="-1"></a>    lon<span class="op">=</span><span class="bu">slice</span>(<span class="op">-</span><span class="dv">120</span>, <span class="op">-</span><span class="dv">90</span>)</span>
<span id="cb47-156"><a href="#cb47-156" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-157"><a href="#cb47-157" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Regional data shape: </span><span class="sc">{</span>region_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-158"><a href="#cb47-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-159"><a href="#cb47-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-160"><a href="#cb47-160" aria-hidden="true" tabindex="-1"></a><span class="fu">### Integer-based indexing  </span></span>
<span id="cb47-163"><a href="#cb47-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-164"><a href="#cb47-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Index-based selection</span></span>
<span id="cb47-165"><a href="#cb47-165" aria-hidden="true" tabindex="-1"></a>first_week <span class="op">=</span> weather_ds.isel(time<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">7</span>))</span>
<span id="cb47-166"><a href="#cb47-166" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"First week shape: </span><span class="sc">{</span>first_week<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-167"><a href="#cb47-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-168"><a href="#cb47-168" aria-hidden="true" tabindex="-1"></a><span class="co"># Select every 10th day</span></span>
<span id="cb47-169"><a href="#cb47-169" aria-hidden="true" tabindex="-1"></a>monthly_subset <span class="op">=</span> weather_ds.isel(time<span class="op">=</span><span class="bu">slice</span>(<span class="va">None</span>, <span class="va">None</span>, <span class="dv">10</span>))</span>
<span id="cb47-170"><a href="#cb47-170" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Monthly subset shape: </span><span class="sc">{</span>monthly_subset<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-171"><a href="#cb47-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-172"><a href="#cb47-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Select specific grid cells</span></span>
<span id="cb47-173"><a href="#cb47-173" aria-hidden="true" tabindex="-1"></a>corner_data <span class="op">=</span> weather_ds.isel(lat<span class="op">=</span>[<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>], lon<span class="op">=</span>[<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb47-174"><a href="#cb47-174" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Corner data shape: </span><span class="sc">{</span>corner_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-175"><a href="#cb47-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-176"><a href="#cb47-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-177"><a href="#cb47-177" aria-hidden="true" tabindex="-1"></a><span class="fu">### Boolean masking</span></span>
<span id="cb47-180"><a href="#cb47-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-181"><a href="#cb47-181" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature-based mask</span></span>
<span id="cb47-182"><a href="#cb47-182" aria-hidden="true" tabindex="-1"></a>hot_days <span class="op">=</span> weather_ds.where(weather_ds.temperature <span class="op">&gt;</span> <span class="dv">25</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-183"><a href="#cb47-183" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Hot days data points: </span><span class="sc">{</span>hot_days<span class="sc">.</span>temperature<span class="sc">.</span>count()<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-184"><a href="#cb47-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-185"><a href="#cb47-185" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple conditions</span></span>
<span id="cb47-186"><a href="#cb47-186" aria-hidden="true" tabindex="-1"></a>summer_hot <span class="op">=</span> weather_ds.where(</span>
<span id="cb47-187"><a href="#cb47-187" aria-hidden="true" tabindex="-1"></a>    (weather_ds.temperature <span class="op">&gt;</span> <span class="dv">25</span>) <span class="op">&amp;</span> </span>
<span id="cb47-188"><a href="#cb47-188" aria-hidden="true" tabindex="-1"></a>    (weather_ds.time.dt.season <span class="op">==</span> <span class="st">'JJA'</span>), </span>
<span id="cb47-189"><a href="#cb47-189" aria-hidden="true" tabindex="-1"></a>    drop<span class="op">=</span><span class="va">True</span></span>
<span id="cb47-190"><a href="#cb47-190" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-191"><a href="#cb47-191" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Summer hot days: </span><span class="sc">{</span>summer_hot<span class="sc">.</span>temperature<span class="sc">.</span>count()<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-192"><a href="#cb47-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-193"><a href="#cb47-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-194"><a href="#cb47-194" aria-hidden="true" tabindex="-1"></a><span class="fu">## Statistical Operations</span></span>
<span id="cb47-195"><a href="#cb47-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-196"><a href="#cb47-196" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic statistics</span></span>
<span id="cb47-199"><a href="#cb47-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-200"><a href="#cb47-200" aria-hidden="true" tabindex="-1"></a><span class="co"># Global statistics</span></span>
<span id="cb47-201"><a href="#cb47-201" aria-hidden="true" tabindex="-1"></a>global_stats <span class="op">=</span> weather_ds.mean()</span>
<span id="cb47-202"><a href="#cb47-202" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Global mean values:"</span>)</span>
<span id="cb47-203"><a href="#cb47-203" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> global_stats.data_vars:</span>
<span id="cb47-204"><a href="#cb47-204" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>global_stats[var]<span class="sc">.</span>values<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-205"><a href="#cb47-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-206"><a href="#cb47-206" aria-hidden="true" tabindex="-1"></a><span class="co"># Temporal statistics</span></span>
<span id="cb47-207"><a href="#cb47-207" aria-hidden="true" tabindex="-1"></a>monthly_means <span class="op">=</span> weather_ds.groupby(<span class="st">'time.month'</span>).mean()</span>
<span id="cb47-208"><a href="#cb47-208" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Monthly means shape: </span><span class="sc">{</span>monthly_means<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-209"><a href="#cb47-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-210"><a href="#cb47-210" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial statistics</span></span>
<span id="cb47-211"><a href="#cb47-211" aria-hidden="true" tabindex="-1"></a>spatial_mean <span class="op">=</span> weather_ds.mean([<span class="st">'lat'</span>, <span class="st">'lon'</span>])</span>
<span id="cb47-212"><a href="#cb47-212" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Time series of spatial means: </span><span class="sc">{</span>spatial_mean<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-213"><a href="#cb47-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-214"><a href="#cb47-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-215"><a href="#cb47-215" aria-hidden="true" tabindex="-1"></a><span class="fu">### Advanced aggregations</span></span>
<span id="cb47-218"><a href="#cb47-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-219"><a href="#cb47-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard deviation</span></span>
<span id="cb47-220"><a href="#cb47-220" aria-hidden="true" tabindex="-1"></a>temp_std <span class="op">=</span> weather_ds.temperature.std(<span class="st">'time'</span>)</span>
<span id="cb47-221"><a href="#cb47-221" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Temperature variability shape: </span><span class="sc">{</span>temp_std<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-222"><a href="#cb47-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-223"><a href="#cb47-223" aria-hidden="true" tabindex="-1"></a><span class="co"># Percentiles</span></span>
<span id="cb47-224"><a href="#cb47-224" aria-hidden="true" tabindex="-1"></a>temp_p90 <span class="op">=</span> weather_ds.temperature.quantile(<span class="fl">0.9</span>, <span class="st">'time'</span>)</span>
<span id="cb47-225"><a href="#cb47-225" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"90th percentile temperature shape: </span><span class="sc">{</span>temp_p90<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-226"><a href="#cb47-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-227"><a href="#cb47-227" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative operations</span></span>
<span id="cb47-228"><a href="#cb47-228" aria-hidden="true" tabindex="-1"></a>cumulative_precip <span class="op">=</span> weather_ds.precipitation.cumsum(<span class="st">'time'</span>)</span>
<span id="cb47-229"><a href="#cb47-229" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cumulative precipitation shape: </span><span class="sc">{</span>cumulative_precip<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-230"><a href="#cb47-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-231"><a href="#cb47-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-232"><a href="#cb47-232" aria-hidden="true" tabindex="-1"></a><span class="fu">### Groupby operations</span></span>
<span id="cb47-235"><a href="#cb47-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-236"><a href="#cb47-236" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by season</span></span>
<span id="cb47-237"><a href="#cb47-237" aria-hidden="true" tabindex="-1"></a>seasonal_stats <span class="op">=</span> weather_ds.groupby(<span class="st">'time.season'</span>).mean()</span>
<span id="cb47-238"><a href="#cb47-238" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Seasonal statistics dimensions: </span><span class="sc">{</span>seasonal_stats<span class="sc">.</span>dims<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-239"><a href="#cb47-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-240"><a href="#cb47-240" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by month</span></span>
<span id="cb47-241"><a href="#cb47-241" aria-hidden="true" tabindex="-1"></a>monthly_stats <span class="op">=</span> weather_ds.groupby(<span class="st">'time.month'</span>).std()</span>
<span id="cb47-242"><a href="#cb47-242" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Monthly variability shape: </span><span class="sc">{</span>monthly_stats<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-243"><a href="#cb47-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-244"><a href="#cb47-244" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom grouping</span></span>
<span id="cb47-245"><a href="#cb47-245" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_decade(time):</span>
<span id="cb47-246"><a href="#cb47-246" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (time.dt.day <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> <span class="dv">10</span></span>
<span id="cb47-247"><a href="#cb47-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-248"><a href="#cb47-248" aria-hidden="true" tabindex="-1"></a>decade_stats <span class="op">=</span> weather_ds.groupby(get_decade(weather_ds.time)).mean()</span>
<span id="cb47-249"><a href="#cb47-249" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Decade-based statistics created"</span>)</span>
<span id="cb47-250"><a href="#cb47-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-251"><a href="#cb47-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-252"><a href="#cb47-252" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Visualization</span></span>
<span id="cb47-253"><a href="#cb47-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-254"><a href="#cb47-254" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simple plots</span></span>
<span id="cb47-257"><a href="#cb47-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-258"><a href="#cb47-258" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series plot at a specific location</span></span>
<span id="cb47-259"><a href="#cb47-259" aria-hidden="true" tabindex="-1"></a>location_ts <span class="op">=</span> weather_ds.sel(lat<span class="op">=</span><span class="dv">40</span>, lon<span class="op">=-</span><span class="dv">100</span>, method<span class="op">=</span><span class="st">'nearest'</span>)</span>
<span id="cb47-260"><a href="#cb47-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-261"><a href="#cb47-261" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb47-262"><a href="#cb47-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-263"><a href="#cb47-263" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature time series</span></span>
<span id="cb47-264"><a href="#cb47-264" aria-hidden="true" tabindex="-1"></a>location_ts.temperature.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb47-265"><a href="#cb47-265" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Temperature Time Series'</span>)</span>
<span id="cb47-266"><a href="#cb47-266" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Temperature (°C)'</span>)</span>
<span id="cb47-267"><a href="#cb47-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-268"><a href="#cb47-268" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation time series  </span></span>
<span id="cb47-269"><a href="#cb47-269" aria-hidden="true" tabindex="-1"></a>location_ts.precipitation.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>], color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb47-270"><a href="#cb47-270" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Precipitation Time Series'</span>)</span>
<span id="cb47-271"><a href="#cb47-271" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Precipitation (mm)'</span>)</span>
<span id="cb47-272"><a href="#cb47-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-273"><a href="#cb47-273" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-274"><a href="#cb47-274" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-275"><a href="#cb47-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-276"><a href="#cb47-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-277"><a href="#cb47-277" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spatial maps</span></span>
<span id="cb47-280"><a href="#cb47-280" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-281"><a href="#cb47-281" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot spatial maps for specific dates</span></span>
<span id="cb47-282"><a href="#cb47-282" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb47-283"><a href="#cb47-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-284"><a href="#cb47-284" aria-hidden="true" tabindex="-1"></a><span class="co"># Summer and winter temperature maps</span></span>
<span id="cb47-285"><a href="#cb47-285" aria-hidden="true" tabindex="-1"></a>summer_temp <span class="op">=</span> weather_ds.temperature.sel(time<span class="op">=</span><span class="st">'2020-07-15'</span>)</span>
<span id="cb47-286"><a href="#cb47-286" aria-hidden="true" tabindex="-1"></a>winter_temp <span class="op">=</span> weather_ds.temperature.sel(time<span class="op">=</span><span class="st">'2020-01-15'</span>)</span>
<span id="cb47-287"><a href="#cb47-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-288"><a href="#cb47-288" aria-hidden="true" tabindex="-1"></a>summer_temp.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">0</span>], cmap<span class="op">=</span><span class="st">'Reds'</span>, add_colorbar<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-289"><a href="#cb47-289" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Summer Temperature (July 15)'</span>)</span>
<span id="cb47-290"><a href="#cb47-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-291"><a href="#cb47-291" aria-hidden="true" tabindex="-1"></a>winter_temp.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">1</span>], cmap<span class="op">=</span><span class="st">'Blues'</span>, add_colorbar<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-292"><a href="#cb47-292" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Winter Temperature (January 15)'</span>)</span>
<span id="cb47-293"><a href="#cb47-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-294"><a href="#cb47-294" aria-hidden="true" tabindex="-1"></a><span class="co"># Annual mean temperature and precipitation</span></span>
<span id="cb47-295"><a href="#cb47-295" aria-hidden="true" tabindex="-1"></a>annual_temp_mean <span class="op">=</span> weather_ds.temperature.mean(<span class="st">'time'</span>)</span>
<span id="cb47-296"><a href="#cb47-296" aria-hidden="true" tabindex="-1"></a>annual_precip_sum <span class="op">=</span> weather_ds.precipitation.<span class="bu">sum</span>(<span class="st">'time'</span>)</span>
<span id="cb47-297"><a href="#cb47-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-298"><a href="#cb47-298" aria-hidden="true" tabindex="-1"></a>annual_temp_mean.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">0</span>], cmap<span class="op">=</span><span class="st">'RdYlBu_r'</span>, add_colorbar<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-299"><a href="#cb47-299" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'Annual Mean Temperature'</span>)</span>
<span id="cb47-300"><a href="#cb47-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-301"><a href="#cb47-301" aria-hidden="true" tabindex="-1"></a>annual_precip_sum.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">1</span>], cmap<span class="op">=</span><span class="st">'BuPu'</span>, add_colorbar<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-302"><a href="#cb47-302" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">'Annual Total Precipitation'</span>)</span>
<span id="cb47-303"><a href="#cb47-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-304"><a href="#cb47-304" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-305"><a href="#cb47-305" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-306"><a href="#cb47-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-307"><a href="#cb47-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-308"><a href="#cb47-308" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Manipulation and Processing</span></span>
<span id="cb47-309"><a href="#cb47-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-310"><a href="#cb47-310" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mathematical operations</span></span>
<span id="cb47-313"><a href="#cb47-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-314"><a href="#cb47-314" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Celsius to Fahrenheit</span></span>
<span id="cb47-315"><a href="#cb47-315" aria-hidden="true" tabindex="-1"></a>temp_fahrenheit <span class="op">=</span> weather_ds.temperature <span class="op">*</span> <span class="dv">9</span><span class="op">/</span><span class="dv">5</span> <span class="op">+</span> <span class="dv">32</span></span>
<span id="cb47-316"><a href="#cb47-316" aria-hidden="true" tabindex="-1"></a>temp_fahrenheit.attrs[<span class="st">'units'</span>] <span class="op">=</span> <span class="st">'degrees_Fahrenheit'</span></span>
<span id="cb47-317"><a href="#cb47-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-318"><a href="#cb47-318" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Temperature in F: </span><span class="sc">{</span>temp_fahrenheit<span class="sc">.</span>mean()<span class="sc">.</span>values<span class="sc">:.1f}</span><span class="ss">°F"</span>)</span>
<span id="cb47-319"><a href="#cb47-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-320"><a href="#cb47-320" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate derived variables</span></span>
<span id="cb47-321"><a href="#cb47-321" aria-hidden="true" tabindex="-1"></a><span class="co"># Heat index approximation (simplified)</span></span>
<span id="cb47-322"><a href="#cb47-322" aria-hidden="true" tabindex="-1"></a>heat_index <span class="op">=</span> (weather_ds.temperature <span class="op">+</span> weather_ds.humidity <span class="op">*</span> <span class="fl">0.1</span>)</span>
<span id="cb47-323"><a href="#cb47-323" aria-hidden="true" tabindex="-1"></a>heat_index.attrs[<span class="st">'description'</span>] <span class="op">=</span> <span class="st">'Simplified heat index'</span></span>
<span id="cb47-324"><a href="#cb47-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-325"><a href="#cb47-325" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily temperature range</span></span>
<span id="cb47-326"><a href="#cb47-326" aria-hidden="true" tabindex="-1"></a>daily_temp_range <span class="op">=</span> weather_ds.temperature.<span class="bu">max</span>([<span class="st">'lat'</span>, <span class="st">'lon'</span>]) <span class="op">-</span> weather_ds.temperature.<span class="bu">min</span>([<span class="st">'lat'</span>, <span class="st">'lon'</span>])</span>
<span id="cb47-327"><a href="#cb47-327" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Daily temperature range shape: </span><span class="sc">{</span>daily_temp_range<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-328"><a href="#cb47-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-329"><a href="#cb47-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-330"><a href="#cb47-330" aria-hidden="true" tabindex="-1"></a><span class="fu">### Resampling and interpolation</span></span>
<span id="cb47-333"><a href="#cb47-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-334"><a href="#cb47-334" aria-hidden="true" tabindex="-1"></a><span class="co"># Temporal resampling</span></span>
<span id="cb47-335"><a href="#cb47-335" aria-hidden="true" tabindex="-1"></a>weekly_data <span class="op">=</span> weather_ds.resample(time<span class="op">=</span><span class="st">'W'</span>).mean()</span>
<span id="cb47-336"><a href="#cb47-336" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Weekly data shape: </span><span class="sc">{</span>weekly_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-337"><a href="#cb47-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-338"><a href="#cb47-338" aria-hidden="true" tabindex="-1"></a>monthly_data <span class="op">=</span> weather_ds.resample(time<span class="op">=</span><span class="st">'M'</span>).mean()</span>
<span id="cb47-339"><a href="#cb47-339" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Monthly data shape: </span><span class="sc">{</span>monthly_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-340"><a href="#cb47-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-341"><a href="#cb47-341" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolation</span></span>
<span id="cb47-342"><a href="#cb47-342" aria-hidden="true" tabindex="-1"></a><span class="co"># Create higher resolution coordinates</span></span>
<span id="cb47-343"><a href="#cb47-343" aria-hidden="true" tabindex="-1"></a>high_res_lat <span class="op">=</span> np.linspace(<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">50</span>)  <span class="co"># Double resolution</span></span>
<span id="cb47-344"><a href="#cb47-344" aria-hidden="true" tabindex="-1"></a>high_res_lon <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">125</span>, <span class="op">-</span><span class="dv">65</span>, <span class="dv">120</span>)</span>
<span id="cb47-345"><a href="#cb47-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-346"><a href="#cb47-346" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolate to higher resolution</span></span>
<span id="cb47-347"><a href="#cb47-347" aria-hidden="true" tabindex="-1"></a>high_res_data <span class="op">=</span> weather_ds.interp(lat<span class="op">=</span>high_res_lat, lon<span class="op">=</span>high_res_lon)</span>
<span id="cb47-348"><a href="#cb47-348" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"High resolution shape: </span><span class="sc">{</span>high_res_data<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-349"><a href="#cb47-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-350"><a href="#cb47-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-351"><a href="#cb47-351" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rolling operations</span></span>
<span id="cb47-354"><a href="#cb47-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-355"><a href="#cb47-355" aria-hidden="true" tabindex="-1"></a><span class="co"># Rolling mean (7-day moving average)</span></span>
<span id="cb47-356"><a href="#cb47-356" aria-hidden="true" tabindex="-1"></a>rolling_temp <span class="op">=</span> weather_ds.temperature.rolling(time<span class="op">=</span><span class="dv">7</span>, center<span class="op">=</span><span class="va">True</span>).mean()</span>
<span id="cb47-357"><a href="#cb47-357" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"7-day rolling mean shape: </span><span class="sc">{</span>rolling_temp<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-358"><a href="#cb47-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-359"><a href="#cb47-359" aria-hidden="true" tabindex="-1"></a><span class="co"># Rolling sum for precipitation (weekly totals)</span></span>
<span id="cb47-360"><a href="#cb47-360" aria-hidden="true" tabindex="-1"></a>weekly_precip <span class="op">=</span> weather_ds.precipitation.rolling(time<span class="op">=</span><span class="dv">7</span>).<span class="bu">sum</span>()</span>
<span id="cb47-361"><a href="#cb47-361" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Weekly precipitation totals shape: </span><span class="sc">{</span>weekly_precip<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-362"><a href="#cb47-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-363"><a href="#cb47-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-364"><a href="#cb47-364" aria-hidden="true" tabindex="-1"></a><span class="fu">## Working with Real NetCDF Files</span></span>
<span id="cb47-365"><a href="#cb47-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-366"><a href="#cb47-366" aria-hidden="true" tabindex="-1"></a><span class="fu">### File I/O operations</span></span>
<span id="cb47-369"><a href="#cb47-369" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-370"><a href="#cb47-370" aria-hidden="true" tabindex="-1"></a><span class="co"># Save dataset to NetCDF</span></span>
<span id="cb47-371"><a href="#cb47-371" aria-hidden="true" tabindex="-1"></a>weather_ds.to_netcdf(<span class="st">'sample_weather_data.nc'</span>)</span>
<span id="cb47-372"><a href="#cb47-372" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Dataset saved to NetCDF file"</span>)</span>
<span id="cb47-373"><a href="#cb47-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-374"><a href="#cb47-374" aria-hidden="true" tabindex="-1"></a><span class="co"># Load dataset from file</span></span>
<span id="cb47-375"><a href="#cb47-375" aria-hidden="true" tabindex="-1"></a>loaded_ds <span class="op">=</span> xr.open_dataset(<span class="st">'sample_weather_data.nc'</span>)</span>
<span id="cb47-376"><a href="#cb47-376" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Loaded dataset variables: </span><span class="sc">{</span><span class="bu">list</span>(loaded_ds.data_vars)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-377"><a href="#cb47-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-378"><a href="#cb47-378" aria-hidden="true" tabindex="-1"></a><span class="co"># Open multiple files (example pattern)</span></span>
<span id="cb47-379"><a href="#cb47-379" aria-hidden="true" tabindex="-1"></a><span class="co"># multi_file_ds = xr.open_mfdataset('weather_*.nc', combine='by_coords')</span></span>
<span id="cb47-380"><a href="#cb47-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-381"><a href="#cb47-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-382"><a href="#cb47-382" aria-hidden="true" tabindex="-1"></a><span class="fu">### Chunking and Dask integration</span></span>
<span id="cb47-385"><a href="#cb47-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-386"><a href="#cb47-386" aria-hidden="true" tabindex="-1"></a><span class="co"># Create chunked dataset for large data</span></span>
<span id="cb47-387"><a href="#cb47-387" aria-hidden="true" tabindex="-1"></a>chunked_ds <span class="op">=</span> weather_ds.chunk({<span class="st">'time'</span>: <span class="dv">30</span>, <span class="st">'lat'</span>: <span class="dv">10</span>, <span class="st">'lon'</span>: <span class="dv">20</span>})</span>
<span id="cb47-388"><a href="#cb47-388" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Chunked dataset: </span><span class="sc">{</span>chunked_ds<span class="sc">.</span>temperature<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-389"><a href="#cb47-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-390"><a href="#cb47-390" aria-hidden="true" tabindex="-1"></a><span class="co"># Lazy operations with chunked data</span></span>
<span id="cb47-391"><a href="#cb47-391" aria-hidden="true" tabindex="-1"></a>lazy_mean <span class="op">=</span> chunked_ds.temperature.mean()</span>
<span id="cb47-392"><a href="#cb47-392" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Lazy computation created: </span><span class="sc">{</span><span class="bu">type</span>(lazy_mean.data)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-393"><a href="#cb47-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-394"><a href="#cb47-394" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute result</span></span>
<span id="cb47-395"><a href="#cb47-395" aria-hidden="true" tabindex="-1"></a>actual_mean <span class="op">=</span> lazy_mean.compute()</span>
<span id="cb47-396"><a href="#cb47-396" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Computed mean: </span><span class="sc">{</span>actual_mean<span class="sc">.</span>values<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-397"><a href="#cb47-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-398"><a href="#cb47-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-399"><a href="#cb47-399" aria-hidden="true" tabindex="-1"></a><span class="fu">## Advanced Operations</span></span>
<span id="cb47-400"><a href="#cb47-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-401"><a href="#cb47-401" aria-hidden="true" tabindex="-1"></a><span class="fu">### Coordinate operations</span></span>
<span id="cb47-404"><a href="#cb47-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-405"><a href="#cb47-405" aria-hidden="true" tabindex="-1"></a><span class="co"># Add new coordinates</span></span>
<span id="cb47-406"><a href="#cb47-406" aria-hidden="true" tabindex="-1"></a>weather_ds_with_doy <span class="op">=</span> weather_ds.assign_coords(</span>
<span id="cb47-407"><a href="#cb47-407" aria-hidden="true" tabindex="-1"></a>    day_of_year<span class="op">=</span>weather_ds.time.dt.dayofyear</span>
<span id="cb47-408"><a href="#cb47-408" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-409"><a href="#cb47-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-410"><a href="#cb47-410" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack/unstack dimensions</span></span>
<span id="cb47-411"><a href="#cb47-411" aria-hidden="true" tabindex="-1"></a>stacked <span class="op">=</span> weather_ds.stack(location<span class="op">=</span>[<span class="st">'lat'</span>, <span class="st">'lon'</span>])</span>
<span id="cb47-412"><a href="#cb47-412" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Stacked dimensions: </span><span class="sc">{</span>stacked<span class="sc">.</span>temperature<span class="sc">.</span>dims<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-413"><a href="#cb47-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-414"><a href="#cb47-414" aria-hidden="true" tabindex="-1"></a>unstacked <span class="op">=</span> stacked.unstack(<span class="st">'location'</span>)</span>
<span id="cb47-415"><a href="#cb47-415" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unstacked back to: </span><span class="sc">{</span>unstacked<span class="sc">.</span>temperature<span class="sc">.</span>dims<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-416"><a href="#cb47-416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-417"><a href="#cb47-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-418"><a href="#cb47-418" aria-hidden="true" tabindex="-1"></a><span class="fu">### Apply functions</span></span>
<span id="cb47-421"><a href="#cb47-421" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-422"><a href="#cb47-422" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply custom function along dimension</span></span>
<span id="cb47-423"><a href="#cb47-423" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> temp_category(temp_array):</span>
<span id="cb47-424"><a href="#cb47-424" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Categorize temperature"""</span></span>
<span id="cb47-425"><a href="#cb47-425" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xr.where(temp_array <span class="op">&lt;</span> <span class="dv">0</span>, <span class="st">'cold'</span>,</span>
<span id="cb47-426"><a href="#cb47-426" aria-hidden="true" tabindex="-1"></a>                   xr.where(temp_array <span class="op">&lt;</span> <span class="dv">20</span>, <span class="st">'mild'</span>, <span class="st">'warm'</span>))</span>
<span id="cb47-427"><a href="#cb47-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-428"><a href="#cb47-428" aria-hidden="true" tabindex="-1"></a>temp_categories <span class="op">=</span> xr.apply_ufunc(</span>
<span id="cb47-429"><a href="#cb47-429" aria-hidden="true" tabindex="-1"></a>    temp_category,</span>
<span id="cb47-430"><a href="#cb47-430" aria-hidden="true" tabindex="-1"></a>    weather_ds.temperature,</span>
<span id="cb47-431"><a href="#cb47-431" aria-hidden="true" tabindex="-1"></a>    dask<span class="op">=</span><span class="st">'allowed'</span>,</span>
<span id="cb47-432"><a href="#cb47-432" aria-hidden="true" tabindex="-1"></a>    output_dtypes<span class="op">=</span>[<span class="bu">object</span>]</span>
<span id="cb47-433"><a href="#cb47-433" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-434"><a href="#cb47-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-435"><a href="#cb47-435" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Temperature categorization applied"</span>)</span>
<span id="cb47-436"><a href="#cb47-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-437"><a href="#cb47-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-438"><a href="#cb47-438" aria-hidden="true" tabindex="-1"></a><span class="fu">### Merge and concatenate</span></span>
<span id="cb47-441"><a href="#cb47-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-442"><a href="#cb47-442" aria-hidden="true" tabindex="-1"></a><span class="co"># Split dataset by time</span></span>
<span id="cb47-443"><a href="#cb47-443" aria-hidden="true" tabindex="-1"></a>first_half <span class="op">=</span> weather_ds.isel(time<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">182</span>))</span>
<span id="cb47-444"><a href="#cb47-444" aria-hidden="true" tabindex="-1"></a>second_half <span class="op">=</span> weather_ds.isel(time<span class="op">=</span><span class="bu">slice</span>(<span class="dv">182</span>, <span class="va">None</span>))</span>
<span id="cb47-445"><a href="#cb47-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-446"><a href="#cb47-446" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate back together</span></span>
<span id="cb47-447"><a href="#cb47-447" aria-hidden="true" tabindex="-1"></a>full_dataset <span class="op">=</span> xr.concat([first_half, second_half], dim<span class="op">=</span><span class="st">'time'</span>)</span>
<span id="cb47-448"><a href="#cb47-448" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Concatenated dataset shape: </span><span class="sc">{</span>full_dataset<span class="sc">.</span>temperature<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-449"><a href="#cb47-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-450"><a href="#cb47-450" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge different datasets</span></span>
<span id="cb47-451"><a href="#cb47-451" aria-hidden="true" tabindex="-1"></a>elevation_data <span class="op">=</span> xr.DataArray(</span>
<span id="cb47-452"><a href="#cb47-452" aria-hidden="true" tabindex="-1"></a>    np.random.randint(<span class="dv">0</span>, <span class="dv">3000</span>, (<span class="dv">25</span>, <span class="dv">60</span>)),</span>
<span id="cb47-453"><a href="#cb47-453" aria-hidden="true" tabindex="-1"></a>    coords<span class="op">=</span>{<span class="st">'lat'</span>: lat, <span class="st">'lon'</span>: lon},</span>
<span id="cb47-454"><a href="#cb47-454" aria-hidden="true" tabindex="-1"></a>    dims<span class="op">=</span>[<span class="st">'lat'</span>, <span class="st">'lon'</span>],</span>
<span id="cb47-455"><a href="#cb47-455" aria-hidden="true" tabindex="-1"></a>    attrs<span class="op">=</span>{<span class="st">'units'</span>: <span class="st">'meters'</span>, <span class="st">'description'</span>: <span class="st">'Elevation'</span>}</span>
<span id="cb47-456"><a href="#cb47-456" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-457"><a href="#cb47-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-458"><a href="#cb47-458" aria-hidden="true" tabindex="-1"></a>merged_ds <span class="op">=</span> weather_ds.merge({<span class="st">'elevation'</span>: elevation_data})</span>
<span id="cb47-459"><a href="#cb47-459" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Merged dataset variables: </span><span class="sc">{</span><span class="bu">list</span>(merged_ds.data_vars)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-460"><a href="#cb47-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-461"><a href="#cb47-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-462"><a href="#cb47-462" aria-hidden="true" tabindex="-1"></a><span class="fu">## Performance Tips and Best Practices</span></span>
<span id="cb47-463"><a href="#cb47-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-464"><a href="#cb47-464" aria-hidden="true" tabindex="-1"></a><span class="fu">### Memory management</span></span>
<span id="cb47-467"><a href="#cb47-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-468"><a href="#cb47-468" aria-hidden="true" tabindex="-1"></a><span class="co"># Check memory usage</span></span>
<span id="cb47-469"><a href="#cb47-469" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dataset memory usage: </span><span class="sc">{</span>weather_ds<span class="sc">.</span>nbytes <span class="op">/</span> <span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> MB"</span>)</span>
<span id="cb47-470"><a href="#cb47-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-471"><a href="#cb47-471" aria-hidden="true" tabindex="-1"></a><span class="co"># Use lazy loading for large files</span></span>
<span id="cb47-472"><a href="#cb47-472" aria-hidden="true" tabindex="-1"></a><span class="co"># lazy_ds = xr.open_dataset('large_file.nc', chunks={'time': 100})</span></span>
<span id="cb47-473"><a href="#cb47-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-474"><a href="#cb47-474" aria-hidden="true" tabindex="-1"></a><span class="co"># Close files when done</span></span>
<span id="cb47-475"><a href="#cb47-475" aria-hidden="true" tabindex="-1"></a>loaded_ds.close()</span>
<span id="cb47-476"><a href="#cb47-476" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"File closed to free memory"</span>)</span>
<span id="cb47-477"><a href="#cb47-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-478"><a href="#cb47-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-479"><a href="#cb47-479" aria-hidden="true" tabindex="-1"></a><span class="fu">### Efficient operations</span></span>
<span id="cb47-482"><a href="#cb47-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-483"><a href="#cb47-483" aria-hidden="true" tabindex="-1"></a><span class="co"># Use vectorized operations</span></span>
<span id="cb47-484"><a href="#cb47-484" aria-hidden="true" tabindex="-1"></a>efficient_calc <span class="op">=</span> weather_ds.temperature <span class="op">-</span> weather_ds.temperature.mean(<span class="st">'time'</span>)</span>
<span id="cb47-485"><a href="#cb47-485" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Efficient anomaly calculation completed"</span>)</span>
<span id="cb47-486"><a href="#cb47-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-487"><a href="#cb47-487" aria-hidden="true" tabindex="-1"></a><span class="co"># Avoid loops when possible - use built-in functions</span></span>
<span id="cb47-488"><a href="#cb47-488" aria-hidden="true" tabindex="-1"></a>monthly_anomalies <span class="op">=</span> weather_ds.groupby(<span class="st">'time.month'</span>) <span class="op">-</span> weather_ds.groupby(<span class="st">'time.month'</span>).mean()</span>
<span id="cb47-489"><a href="#cb47-489" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Monthly anomalies calculated efficiently"</span>)</span>
<span id="cb47-490"><a href="#cb47-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-491"><a href="#cb47-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-492"><a href="#cb47-492" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb47-493"><a href="#cb47-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-494"><a href="#cb47-494" aria-hidden="true" tabindex="-1"></a>Key Xarray concepts:</span>
<span id="cb47-495"><a href="#cb47-495" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**DataArrays**: Labeled, multi-dimensional arrays</span>
<span id="cb47-496"><a href="#cb47-496" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Datasets**: Collections of DataArrays with shared coordinates  </span>
<span id="cb47-497"><a href="#cb47-497" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Coordinates**: Labels for array dimensions</span>
<span id="cb47-498"><a href="#cb47-498" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Selection**: Label-based (.sel) and integer-based (.isel)</span>
<span id="cb47-499"><a href="#cb47-499" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**GroupBy**: Split-apply-combine operations</span>
<span id="cb47-500"><a href="#cb47-500" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Resampling**: Temporal aggregation and frequency conversion</span>
<span id="cb47-501"><a href="#cb47-501" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**I/O**: Reading/writing NetCDF and other formats</span>
<span id="cb47-502"><a href="#cb47-502" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Dask integration**: Lazy evaluation for large datasets</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/geog-logo.png" class="img-fluid figure-img" width="250"></p>
<figcaption>Department of Geography logo</figcaption>
</figure>
</div>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This website is built with <a href="https://github.com/kcaylor/GEOG-288KC-geospatial-foundation-models"><i class="fa-brands fa-github" title="the github octocat logo" aria-label="github"></i></a> and <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>