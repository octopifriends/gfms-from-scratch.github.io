<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 1: Core Tools and Data Access</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">GEOG 288KC</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">🏠 home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Syllabus.html"> 
<span class="menu-text">📋 syllabus</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-weekly-sessions" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">💻 weekly sessions</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-weekly-sessions">    
        <li>
    <a class="dropdown-item" href="../chapters/c01-geospatial-data-foundations.html">
 <span class="dropdown-text">Week 1 - 🚀 Core Tools and Data Access</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c02-spatial-temporal-attention-mechanisms.html">
 <span class="dropdown-text">Week 2 - ⚡ Rapid Remote Sensing Preprocessing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c03a-terratorch-foundations.html">
 <span class="dropdown-text">Week 3a - 🌍 TerraTorch Foundations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c03-complete-gfm-architecture.html">
 <span class="dropdown-text">Week 3b - 🤖 Machine Learning on Remote Sensing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c04-pretraining-implementation.html">
 <span class="dropdown-text">Week 4 - 🏗️ Foundation Models in Practice</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c05-training-loop-optimization.html">
 <span class="dropdown-text">Week 5 - 🔧 Fine-Tuning &amp; Transfer Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c06-model-evaluation-analysis.html">
 <span class="dropdown-text">Week 6 - ⏰ Spatiotemporal Modeling &amp; Projects</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cheatsheets" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">👀 cheatsheets</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-cheatsheets">    
        <li>
    <a class="dropdown-item" href="../cheatsheets.html">
 <span class="dropdown-text">📋 All Cheatsheets</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">⚡ Quick Starts</li>
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/week01_imports.html">
 <span class="dropdown-text">Week 01: Import Guide</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-explainers" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">🧩 explainers</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-explainers">    
        <li class="dropdown-header">1️⃣ Week 1</li>
        <li>
    <a class="dropdown-item" href="../extras/ai-ml-dl-fm-hierarchy.html">
 <span class="dropdown-text">🤖 AI/ML/DL/FM Hierarchy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/geospatial-foundation-model-predictions-standalone.html">
 <span class="dropdown-text">🎯 GFM Predictions (Standalone)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/geospatial-prediction-hierarchy.html">
 <span class="dropdown-text">✅ Geospatial Task/Prediction Types</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/neural_networks_explainer.html">
 <span class="dropdown-text">🧠 Neural Networks: Neurons to Transformers</span></a>
  </li>  
        <li class="dropdown-header">2️⃣ Week 2</li>
        <li>
    <a class="dropdown-item" href="../chapters/c00a-foundation_model_architectures.html">
 <span class="dropdown-text">🏗️ Foundation Model Architectures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c00b-introduction-to-deeplearning-architecture.html">
 <span class="dropdown-text">🎓 Introduction to Deep Learning Architecture</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-extras" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">📖 extras</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-extras">    
        <li class="dropdown-header">🎯 Practical Examples</li>
        <li>
    <a class="dropdown-item" href="../extras/examples/normalization_comparison.html">
 <span class="dropdown-text">Normalization Comparison</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/examples/resnet.html">
 <span class="dropdown-text">ResNet Implementation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/examples/text_encoder.html">
 <span class="dropdown-text">Text Encoder</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/examples/tiling-and-patches.html">
 <span class="dropdown-text">Tiling and Patches</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/examples/terratorch_workflows.html">
 <span class="dropdown-text">TerraTorch Workflows</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/resources/course_resources.html">
 <span class="dropdown-text">📚 Reference Materials</span></a>
  </li>  
        <li class="dropdown-header">📁 Project Templates</li>
        <li>
    <a class="dropdown-item" href="../extras/projects/project-proposal-template.html">
 <span class="dropdown-text">Project Proposal Template</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/projects/mvp-template.html">
 <span class="dropdown-text">Project Results Template</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/gfms-from-scratch/gfms-from-scratch.github.io" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <div class="quarto-title-block"><div><h1 class="title">Week 1: Core Tools and Data Access</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
            <p class="subtitle lead">Setting up the geospatial AI toolkit and accessing satellite imagery</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1. Introduction</a></li>
  <li><a href="#environment-setup-and-helper-functions" id="toc-environment-setup-and-helper-functions" class="nav-link" data-scroll-target="#environment-setup-and-helper-functions">2. Environment Setup and Helper Functions</a>
  <ul class="collapse">
  <li><a href="#verify-your-environment" id="toc-verify-your-environment" class="nav-link" data-scroll-target="#verify-your-environment">2.1 Verify Your Environment</a></li>
  <li><a href="#import-essential-libraries-and-create-helper-functions" id="toc-import-essential-libraries-and-create-helper-functions" class="nav-link" data-scroll-target="#import-essential-libraries-and-create-helper-functions">2.2 Import Essential Libraries and Create Helper Functions</a></li>
  <li><a href="#setup-logging-for-our-workflow" id="toc-setup-logging-for-our-workflow" class="nav-link" data-scroll-target="#setup-logging-for-our-workflow">2.3 Setup Logging for our workflow</a></li>
  <li><a href="#geospatial-ai-toolkit-comprehensive-helper-functions" id="toc-geospatial-ai-toolkit-comprehensive-helper-functions" class="nav-link" data-scroll-target="#geospatial-ai-toolkit-comprehensive-helper-functions">2.4 Geospatial AI Toolkit: Comprehensive Helper Functions</a></li>
  <li><a href="#why-authentication-matters-in-geospatial-ai" id="toc-why-authentication-matters-in-geospatial-ai" class="nav-link" data-scroll-target="#why-authentication-matters-in-geospatial-ai">Why Authentication Matters in Geospatial AI</a></li>
  <li><a href="#authenticate-to-the-planetary-computer" id="toc-authenticate-to-the-planetary-computer" class="nav-link" data-scroll-target="#authenticate-to-the-planetary-computer">Authenticate to the Planetary Computer</a></li>
  <li><a href="#cloud-native-data-access-architecture" id="toc-cloud-native-data-access-architecture" class="nav-link" data-scroll-target="#cloud-native-data-access-architecture">Cloud-Native Data Access Architecture</a></li>
  <li><a href="#memory-management-in-satellite-data-processing" id="toc-memory-management-in-satellite-data-processing" class="nav-link" data-scroll-target="#memory-management-in-satellite-data-processing">Memory Management in Satellite Data Processing</a></li>
  <li><a href="#spatial-reasoning-in-satellite-data-analysis" id="toc-spatial-reasoning-in-satellite-data-analysis" class="nav-link" data-scroll-target="#spatial-reasoning-in-satellite-data-analysis">Spatial Reasoning in Satellite Data Analysis</a></li>
  <li><a href="#spectral-analysis-fundamentals" id="toc-spectral-analysis-fundamentals" class="nav-link" data-scroll-target="#spectral-analysis-fundamentals">Spectral Analysis Fundamentals</a></li>
  <li><a href="#derived-band-calculations" id="toc-derived-band-calculations" class="nav-link" data-scroll-target="#derived-band-calculations">Derived band calculations</a></li>
  <li><a href="#scientific-visualization-design-principles" id="toc-scientific-visualization-design-principles" class="nav-link" data-scroll-target="#scientific-visualization-design-principles">Scientific Visualization Design Principles</a></li>
  <li><a href="#geospatial-data-standards-and-interoperability" id="toc-geospatial-data-standards-and-interoperability" class="nav-link" data-scroll-target="#geospatial-data-standards-and-interoperability">Geospatial Data Standards and Interoperability</a></li>
  <li><a href="#scalable-geospatial-processing-architectures" id="toc-scalable-geospatial-processing-architectures" class="nav-link" data-scroll-target="#scalable-geospatial-processing-architectures">Scalable Geospatial Processing Architectures</a></li>
  <li><a href="#summary-your-geospatial-ai-toolkit" id="toc-summary-your-geospatial-ai-toolkit" class="nav-link" data-scroll-target="#summary-your-geospatial-ai-toolkit">2.5 Summary: Your Geospatial AI Toolkit</a></li>
  </ul></li>
  <li><a href="#understanding-stac-apis-and-cloud-native-geospatial-architecture" id="toc-understanding-stac-apis-and-cloud-native-geospatial-architecture" class="nav-link" data-scroll-target="#understanding-stac-apis-and-cloud-native-geospatial-architecture">3. Understanding STAC APIs and Cloud-Native Geospatial Architecture</a>
  <ul class="collapse">
  <li><a href="#the-stac-revolution-from-data-downloads-to-cloud-native-discovery" id="toc-the-stac-revolution-from-data-downloads-to-cloud-native-discovery" class="nav-link" data-scroll-target="#the-stac-revolution-from-data-downloads-to-cloud-native-discovery">The STAC Revolution: From Data Downloads to Cloud-Native Discovery</a></li>
  <li><a href="#stac-architecture-components" id="toc-stac-architecture-components" class="nav-link" data-scroll-target="#stac-architecture-components">STAC Architecture Components</a></li>
  <li><a href="#practical-stac-connection-microsoft-planetary-computer" id="toc-practical-stac-connection-microsoft-planetary-computer" class="nav-link" data-scroll-target="#practical-stac-connection-microsoft-planetary-computer">Practical STAC Connection: Microsoft Planetary Computer</a></li>
  </ul></li>
  <li><a href="#connection-troubleshooting" id="toc-connection-troubleshooting" class="nav-link" data-scroll-target="#connection-troubleshooting">Connection Troubleshooting</a>
  <ul class="collapse">
  <li><a href="#understanding-collection-metadata-and-selection-criteria" id="toc-understanding-collection-metadata-and-selection-criteria" class="nav-link" data-scroll-target="#understanding-collection-metadata-and-selection-criteria">Understanding Collection Metadata and Selection Criteria</a></li>
  </ul></li>
  <li><a href="#spatial-analysis-design---defining-areas-of-interest" id="toc-spatial-analysis-design---defining-areas-of-interest" class="nav-link" data-scroll-target="#spatial-analysis-design---defining-areas-of-interest">4. Spatial Analysis Design - Defining Areas of Interest</a>
  <ul class="collapse">
  <li><a href="#the-art-and-science-of-spatial-scope-definition" id="toc-the-art-and-science-of-spatial-scope-definition" class="nav-link" data-scroll-target="#the-art-and-science-of-spatial-scope-definition">The Art and Science of Spatial Scope Definition</a></li>
  <li><a href="#validating-your-aoi-selection" id="toc-validating-your-aoi-selection" class="nav-link" data-scroll-target="#validating-your-aoi-selection">Validating Your AOI Selection</a></li>
  </ul></li>
  <li><a href="#intelligent-satellite-scene-discovery-and-selection" id="toc-intelligent-satellite-scene-discovery-and-selection" class="nav-link" data-scroll-target="#intelligent-satellite-scene-discovery-and-selection">5. Intelligent Satellite Scene Discovery and Selection</a>
  <ul class="collapse">
  <li><a href="#intelligent-satellite-scene-discovery" id="toc-intelligent-satellite-scene-discovery" class="nav-link" data-scroll-target="#intelligent-satellite-scene-discovery">5.1 Intelligent Satellite Scene Discovery</a></li>
  <li><a href="#scene-quality-assessment-and-selection" id="toc-scene-quality-assessment-and-selection" class="nav-link" data-scroll-target="#scene-quality-assessment-and-selection">5.2 Scene Quality Assessment and Selection</a></li>
  </ul></li>
  <li><a href="#sentinel-2-for-ai-applications" id="toc-sentinel-2-for-ai-applications" class="nav-link" data-scroll-target="#sentinel-2-for-ai-applications">Sentinel-2 for AI Applications</a></li>
  <li><a href="#production-grade-satellite-data-loading-and-processing" id="toc-production-grade-satellite-data-loading-and-processing" class="nav-link" data-scroll-target="#production-grade-satellite-data-loading-and-processing">6. Production-Grade Satellite Data Loading and Processing</a>
  <ul class="collapse">
  <li><a href="#the-challenge-of-large-scale-satellite-data-loading" id="toc-the-challenge-of-large-scale-satellite-data-loading" class="nav-link" data-scroll-target="#the-challenge-of-large-scale-satellite-data-loading">6.1 The Challenge of Large-Scale Satellite Data Loading</a></li>
  <li><a href="#intelligent-data-loading-architecture" id="toc-intelligent-data-loading-architecture" class="nav-link" data-scroll-target="#intelligent-data-loading-architecture">6.2 Intelligent Data Loading Architecture</a></li>
  <li><a href="#high-performance-data-loading-implementation" id="toc-high-performance-data-loading-implementation" class="nav-link" data-scroll-target="#high-performance-data-loading-implementation">6.3 High-Performance Data Loading Implementation</a></li>
  <li><a href="#comprehensive-data-validation-and-quality-assessment" id="toc-comprehensive-data-validation-and-quality-assessment" class="nav-link" data-scroll-target="#comprehensive-data-validation-and-quality-assessment">6.4 Comprehensive Data Validation and Quality Assessment</a></li>
  <li><a href="#creating-ai-ready-multi-dimensional-datasets" id="toc-creating-ai-ready-multi-dimensional-datasets" class="nav-link" data-scroll-target="#creating-ai-ready-multi-dimensional-datasets">6.5 Creating AI-Ready Multi-Dimensional Datasets</a></li>
  </ul></li>
  <li><a href="#rasterio-xarray-and-rioxarray" id="toc-rasterio-xarray-and-rioxarray" class="nav-link" data-scroll-target="#rasterio-xarray-and-rioxarray">Rasterio, Xarray, and Rioxarray</a></li>
  <li><a href="#scientific-visualization-and-spectral-analysis" id="toc-scientific-visualization-and-spectral-analysis" class="nav-link" data-scroll-target="#scientific-visualization-and-spectral-analysis">7. Scientific Visualization and Spectral Analysis</a>
  <ul class="collapse">
  <li><a href="#principles-of-scientific-visualization-for-remote-sensing" id="toc-principles-of-scientific-visualization-for-remote-sensing" class="nav-link" data-scroll-target="#principles-of-scientific-visualization-for-remote-sensing">7.1 Principles of Scientific Visualization for Remote Sensing</a></li>
  <li><a href="#advanced-color-composite-creation" id="toc-advanced-color-composite-creation" class="nav-link" data-scroll-target="#advanced-color-composite-creation">7.2 Advanced Color Composite Creation</a></li>
  <li><a href="#calculate-vegetation-indices" id="toc-calculate-vegetation-indices" class="nav-link" data-scroll-target="#calculate-vegetation-indices">7.3 Calculate Vegetation Indices</a></li>
  </ul></li>
  <li><a href="#understanding-ndvi-values" id="toc-understanding-ndvi-values" class="nav-link" data-scroll-target="#understanding-ndvi-values">Understanding NDVI Values</a></li>
  <li><a href="#band-analysis" id="toc-band-analysis" class="nav-link" data-scroll-target="#band-analysis">8. Band Analysis</a>
  <ul class="collapse">
  <li><a href="#comprehensive-multi-band-analysis" id="toc-comprehensive-multi-band-analysis" class="nav-link" data-scroll-target="#comprehensive-multi-band-analysis">8.1 Comprehensive Multi-band Analysis</a></li>
  </ul></li>
  <li><a href="#data-export-and-caching" id="toc-data-export-and-caching" class="nav-link" data-scroll-target="#data-export-and-caching">9. Data Export and Caching</a>
  <ul class="collapse">
  <li><a href="#export-processed-data-using-helper-functions" id="toc-export-processed-data-using-helper-functions" class="nav-link" data-scroll-target="#export-processed-data-using-helper-functions">9.1 Export Processed Data Using Helper Functions</a></li>
  <li><a href="#reloading-data" id="toc-reloading-data" class="nav-link" data-scroll-target="#reloading-data">9.2 Reloading Data</a></li>
  </ul></li>
  <li><a href="#conclusion-from-foundations-to-frontiers" id="toc-conclusion-from-foundations-to-frontiers" class="nav-link" data-scroll-target="#conclusion-from-foundations-to-frontiers">10. Conclusion: From Foundations to Frontiers</a>
  <ul class="collapse">
  <li><a href="#core-competencies-developed" id="toc-core-competencies-developed" class="nav-link" data-scroll-target="#core-competencies-developed">10.1 Core Competencies Developed</a></li>
  <li><a href="#real-world-applications" id="toc-real-world-applications" class="nav-link" data-scroll-target="#real-world-applications">10.2 Real-World Applications</a></li>
  <li><a href="#week-2-preview-rapid-preprocessing-pipelines" id="toc-week-2-preview-rapid-preprocessing-pipelines" class="nav-link" data-scroll-target="#week-2-preview-rapid-preprocessing-pipelines">10.3 Week 2 Preview: Rapid Preprocessing Pipelines</a></li>
  <li><a href="#essential-resources" id="toc-essential-resources" class="nav-link" data-scroll-target="#essential-resources">10.4 Essential Resources</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">1. Introduction</h2>
<p>Welcome to your first hands-on session with geospatial AI! Today we’ll set up the core tools you’ll use throughout this course and get you working with real satellite imagery immediately. No theory-heavy introductions – we’re diving straight into practical data access and exploration.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Goals
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this session, you will:</p>
<ul>
<li>Have a working geospatial AI environment</li>
<li>Pull real Sentinel-2/Landsat imagery via STAC APIs</li>
<li>Load and explore satellite data with rasterio and xarray</li>
<li>Create interactive maps with folium</li>
<li>Understand the basics of multi-spectral satellite imagery</li>
</ul>
</div>
</div>
</section>
<section id="environment-setup-and-helper-functions" class="level2">
<h2 class="anchored" data-anchor-id="environment-setup-and-helper-functions">2. Environment Setup and Helper Functions</h2>
<p>We’ll start by setting up our environment and creating reusable helper functions that you’ll use throughout the course. These functions handle common tasks like data loading, visualization, and processing.</p>
<section id="verify-your-environment" class="level3">
<h3 class="anchored" data-anchor-id="verify-your-environment">2.1 Verify Your Environment</h3>
<p><strong>Environment Verification:</strong></p>
<p>Before we begin, let’s verify that your environment is properly configured. Your environment should include the following packages:</p>
<ul>
<li><strong>rasterio, xarray, rioxarray</strong>: Core geospatial data handling</li>
<li><strong>torch, transformers</strong>: Deep learning and foundation models</li>
<li><strong>folium</strong>: Interactive mapping</li>
<li><strong>matplotlib, numpy, pandas</strong>: Data analysis and visualization</li>
<li><strong>pystac-client, planetary-computer</strong>: STAC API access</li>
<li><strong>geopandas</strong>: Vector geospatial data</li>
</ul>
<div id="3dc95eb6" class="cell" data-tangle="geogfm/c01.py" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Week 1: Core Tools and Data Access functions for geospatial AI."""</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> importlib.metadata</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Tuple, Optional, Union</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Core geospatial libraries</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.windows <span class="im">import</span> from_bounds</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> transform_bounds</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> planetary_computer <span class="im">as</span> pc</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure logging</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">'</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> configure_gdal_environment() <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Configure GDAL/PROJ environment variables for HPC and local systems.</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">    This function addresses common GDAL/PROJ configuration issues, particularly</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">    on HPC systems where proj.db may not be found or version mismatches exist.</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co">    dict</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co">        Dictionary with configuration status and detected paths</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    config_status <span class="op">=</span> {</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">'gdal_configured'</span>: <span class="va">False</span>,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">'proj_configured'</span>: <span class="va">False</span>,</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">'gdal_data_path'</span>: <span class="va">None</span>,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">'proj_lib_path'</span>: <span class="va">None</span>,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">'warnings'</span>: []</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> osgeo</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> osgeo <span class="im">import</span> gdal, osr</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Enable GDAL exceptions for better error handling</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        gdal.UseExceptions()</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try to find PROJ data directory</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        proj_lib_candidates <span class="op">=</span> [</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>            os.environ.get(<span class="st">'PROJ_LIB'</span>),</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>            os.environ.get(<span class="st">'PROJ_DATA'</span>),</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>            os.path.join(sys.prefix, <span class="st">'share'</span>, <span class="st">'proj'</span>),</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>            os.path.join(sys.prefix, <span class="st">'Library'</span>, <span class="st">'share'</span>, <span class="st">'proj'</span>),  <span class="co"># Windows</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>            <span class="st">'/usr/share/proj'</span>,  <span class="co"># Linux system</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>            os.path.expanduser(<span class="st">'~/mambaforge/share/proj'</span>),</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>            os.path.expanduser(<span class="st">'~/miniconda3/share/proj'</span>),</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>            os.path.expanduser(<span class="st">'~/anaconda3/share/proj'</span>),</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find valid PROJ directory</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>        proj_lib_path <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> candidate <span class="kw">in</span> proj_lib_candidates:</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> candidate <span class="kw">and</span> os.path.isdir(candidate):</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>                proj_db <span class="op">=</span> os.path.join(candidate, <span class="st">'proj.db'</span>)</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> os.path.isfile(proj_db):</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>                    proj_lib_path <span class="op">=</span> candidate</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> proj_lib_path:</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>            os.environ[<span class="st">'PROJ_LIB'</span>] <span class="op">=</span> proj_lib_path</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>            os.environ[<span class="st">'PROJ_DATA'</span>] <span class="op">=</span> proj_lib_path</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'proj_lib_path'</span>] <span class="op">=</span> proj_lib_path</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'proj_configured'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"✅ PROJ configured: </span><span class="sc">{</span>proj_lib_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'warnings'</span>].append(<span class="st">"⚠️ Could not locate proj.db - coordinate transformations may fail"</span>)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try to find GDAL data directory</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>        gdal_data_candidates <span class="op">=</span> [</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>            os.environ.get(<span class="st">'GDAL_DATA'</span>),</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>            gdal.GetConfigOption(<span class="st">'GDAL_DATA'</span>),</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>            os.path.join(sys.prefix, <span class="st">'share'</span>, <span class="st">'gdal'</span>),</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>            os.path.join(sys.prefix, <span class="st">'Library'</span>, <span class="st">'share'</span>, <span class="st">'gdal'</span>),  <span class="co"># Windows</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>            <span class="st">'/usr/share/gdal'</span>,  <span class="co"># Linux system</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>        gdal_data_path <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> candidate <span class="kw">in</span> gdal_data_candidates:</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> candidate <span class="kw">and</span> os.path.isdir(candidate):</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>                gdal_data_path <span class="op">=</span> candidate</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> gdal_data_path:</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>            os.environ[<span class="st">'GDAL_DATA'</span>] <span class="op">=</span> gdal_data_path</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>            gdal.SetConfigOption(<span class="st">'GDAL_DATA'</span>, gdal_data_path)</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'gdal_data_path'</span>] <span class="op">=</span> gdal_data_path</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'gdal_configured'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"✅ GDAL_DATA configured: </span><span class="sc">{</span>gdal_data_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Additional GDAL configuration for network access</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        gdal.SetConfigOption(<span class="st">'GDAL_DISABLE_READDIR_ON_OPEN'</span>, <span class="st">'EMPTY_DIR'</span>)</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>        gdal.SetConfigOption(<span class="st">'CPL_VSIL_CURL_ALLOWED_EXTENSIONS'</span>, <span class="st">'.tif,.tiff,.vrt'</span>)</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>        gdal.SetConfigOption(<span class="st">'GDAL_HTTP_TIMEOUT'</span>, <span class="st">'300'</span>)</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>        gdal.SetConfigOption(<span class="st">'GDAL_HTTP_MAX_RETRY'</span>, <span class="st">'5'</span>)</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test PROJ functionality</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>            srs <span class="op">=</span> osr.SpatialReference()</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>            srs.ImportFromEPSG(<span class="dv">4326</span>)</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'proj_test_passed'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'warnings'</span>].append(<span class="ss">f"⚠️ PROJ test failed: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'proj_test_passed'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> config_status</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="ss">f"Error configuring GDAL environment: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>        config_status[<span class="st">'warnings'</span>].append(<span class="ss">f"Configuration error: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> config_status</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> verify_environment(required_packages: <span class="bu">list</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="co">    Verify that all required packages are installed.</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a><span class="co">    required_packages : list</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a><span class="co">        List of package names to verify</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a><span class="co">    dict</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a><span class="co">        Dictionary with package names as keys and versions as values</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> {}</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    missing_packages <span class="op">=</span> []</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> package <span class="kw">in</span> required_packages:</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>            version <span class="op">=</span> importlib.metadata.version(package)</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>            results[package] <span class="op">=</span> version</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> importlib.metadata.PackageNotFoundError:</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>            missing_packages.append(package)</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>            results[package] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Report results</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> missing_packages:</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="ss">f"❌ Missing packages: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(missing_packages)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> results</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"✅ All </span><span class="sc">{</span><span class="bu">len</span>(required_packages)<span class="sc">}</span><span class="ss"> packages verified"</span>)</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="verify-that-we-have-all-the-packages-we-need-in-our-environment" class="level4">
<h4 class="anchored" data-anchor-id="verify-that-we-have-all-the-packages-we-need-in-our-environment">Verify that we have all the packages we need in our environment</h4>
<div id="39530d56" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify core geospatial AI environment</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>required_packages <span class="op">=</span> [</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rasterio'</span>, <span class="st">'xarray'</span>, <span class="st">'torch'</span>, <span class="st">'transformers'</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'folium'</span>, <span class="st">'matplotlib'</span>, <span class="st">'numpy'</span>, <span class="st">'pandas'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pystac-client'</span>, <span class="st">'geopandas'</span>, <span class="st">'rioxarray'</span>, <span class="st">'planetary-computer'</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>package_status <span class="op">=</span> verify_environment(required_packages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:03:18,009 - INFO - ✅ All 12 packages verified</code></pre>
</div>
</div>
</section>
<section id="configure-gdalproj-environment-critical-for-hpc-systems" class="level4">
<h4 class="anchored" data-anchor-id="configure-gdalproj-environment-critical-for-hpc-systems">Configure GDAL/PROJ Environment (Critical for HPC Systems)</h4>
<p>Before we proceed with geospatial operations, we need to ensure GDAL and PROJ are properly configured. This is especially important on HPC systems where environment variables may not be automatically set.</p>
<div id="e1846078" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure GDAL/PROJ environment</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>gdal_config <span class="op">=</span> configure_gdal_environment()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Report configuration status</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> gdal_config[<span class="st">'proj_configured'</span>] <span class="kw">and</span> gdal_config[<span class="st">'gdal_configured'</span>]:</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"✅ GDAL/PROJ fully configured and ready"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> gdal_config[<span class="st">'proj_configured'</span>] <span class="kw">or</span> gdal_config[<span class="st">'gdal_configured'</span>]:</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"⚠️ Partial GDAL/PROJ configuration - some operations may fail"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> warning <span class="kw">in</span> gdal_config[<span class="st">'warnings'</span>]:</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        logger.warning(warning)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    logger.error(<span class="st">"❌ GDAL/PROJ configuration incomplete"</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    logger.error(<span class="st">"This may cause issues with coordinate transformations"</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> warning <span class="kw">in</span> gdal_config[<span class="st">'warnings'</span>]:</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        logger.error(warning)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:03:18,058 - INFO - ✅ PROJ configured: /Users/kellycaylor/mambaforge/share/proj
2025-10-09 11:03:18,058 - INFO - ✅ GDAL_DATA configured: /Users/kellycaylor/mambaforge/share/gdal
2025-10-09 11:03:18,065 - INFO - ✅ GDAL/PROJ fully configured and ready</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Troubleshooting GDAL/PROJ Issues on HPC Systems
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you encounter GDAL/PROJ warnings or errors (especially “proj.db not found” or version mismatch warnings), try these solutions in order:</p>
<p><strong>1. Manual Environment Variable Setup (Recommended for HPC)</strong></p>
<p>Before running your Python script, set these environment variables in your shell:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find your conda environment path</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> info <span class="at">--envs</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set PROJ_LIB and GDAL_DATA (adjust path to your environment)</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PROJ_LIB</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/proj</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PROJ_DATA</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/proj</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">GDAL_DATA</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/gdal</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify the files exist</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="va">$PROJ_LIB</span>/proj.db</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="va">$GDAL_DATA</span>/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>2. Add to Your Job Script (SLURM/PBS)</strong></p>
<p>For HPC batch jobs, add these lines to your job script:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --job-name=geoai</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=01:00:00</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Activate your conda environment</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate geoAI</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set GDAL/PROJ paths</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PROJ_LIB</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/proj</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PROJ_DATA</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/proj</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">GDAL_DATA</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/gdal</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Run your Python script</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> your_script.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>3. Permanently Set in Your Environment</strong></p>
<p>Add to your <code>~/.bashrc</code> or <code>~/.bash_profile</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GDAL/PROJ configuration for geoAI environment</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="va">$CONDA_DEFAULT_ENV</span> <span class="ot">==</span> <span class="st">"geoAI"</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">export</span> <span class="va">PROJ_LIB</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/proj</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">export</span> <span class="va">PROJ_DATA</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/proj</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">export</span> <span class="va">GDAL_DATA</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/gdal</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>4. Verify PROJ Installation</strong></p>
<p>If problems persist, check your PROJ installation:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyproj</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"PROJ version: </span><span class="sc">{</span>pyproj<span class="sc">.</span>proj_version_str<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"PROJ data dir: </span><span class="sc">{</span>pyproj<span class="sc">.</span>datadir<span class="sc">.</span>get_data_dir()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if proj.db exists</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>proj_dir <span class="op">=</span> pyproj.datadir.get_data_dir()</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>proj_db <span class="op">=</span> os.path.join(proj_dir, <span class="st">'proj.db'</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"proj.db exists: </span><span class="sc">{</span>os<span class="sc">.</span>path<span class="sc">.</span>exists(proj_db)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>5. Reinstall GDAL/PROJ (Last Resort)</strong></p>
<p>If all else fails, reinstall with compatible versions:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate geoAI</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> install <span class="at">-c</span> conda-forge gdal=3.10 pyproj=3.7 rasterio=1.4 <span class="at">--force-reinstall</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Common Error Messages and Solutions:</strong></p>
<ul>
<li><strong>“proj.db not found”</strong>: Set <code>PROJ_LIB</code> environment variable</li>
<li><strong>“DATABASE.LAYOUT.VERSION mismatch”</strong>: Multiple PROJ installations; ensure you’re using the one from your conda environment</li>
<li><strong>“CPLE_AppDefined in PROJ”</strong>: GDAL is finding wrong PROJ installation; set environment variables explicitly</li>
<li><strong>Slow performance</strong>: Network timeout issues; the <code>configure_gdal_environment()</code> function sets appropriate timeouts</li>
</ul>
</div>
</div>
</section>
</section>
<section id="import-essential-libraries-and-create-helper-functions" class="level3">
<h3 class="anchored" data-anchor-id="import-essential-libraries-and-create-helper-functions">2.2 Import Essential Libraries and Create Helper Functions</h3>
<p>Before diving into geospatial data analysis and AI workflows, it’s important to import the essential Python libraries that form the backbone of this toolkit. The following code block brings together core geospatial libraries such as <a href="https://rasterio.readthedocs.io/">rasterio</a> for raster data handling, <a href="https://docs.xarray.dev/">xarray</a> and <a href="https://corteva.github.io/rioxarray/stable/">rioxarray</a> for multi-dimensional array operations, <a href="https://geopandas.org/">geopandas</a> for vector data, and <a href="https://pystac-client.readthedocs.io/">pystac-client</a> for accessing spatiotemporal asset catalogs.</p>
<p>Visualization is supported by <a href="https://matplotlib.org/">matplotlib</a> and <a href="https://python-visualization.github.io/folium/">folium</a>, while <a href="https://pytorch.org/">torch</a> enables deep learning workflows. Additional utilities for data handling, logging, and reproducibility are also included. These libraries collectively provide a robust foundation for geospatial AI projects.</p>
<div id="442896b1" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Core geospatial libraries</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> calculate_default_transform, reproject, Resampling</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray  <span class="co"># Extends xarray with rasterio functionality</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Data access and processing</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> planetary_computer <span class="im">as</span> pc  <span class="co"># For signing asset URLs</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium <span class="im">import</span> plugins</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilities</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Tuple, Optional, Union</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Deep learning libraries</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Set up some standard plot configuration options.</p>
<div id="a91e28f5" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure matplotlib for publication-quality plots</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.figsize'</span>: (<span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.dpi'</span>: <span class="dv">100</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'font.size'</span>: <span class="dv">10</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.titlesize'</span>: <span class="dv">12</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.labelsize'</span>: <span class="dv">10</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'xtick.labelsize'</span>: <span class="dv">9</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ytick.labelsize'</span>: <span class="dv">9</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'legend.fontsize'</span>: <span class="dv">9</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="setup-logging-for-our-workflow" class="level3">
<h3 class="anchored" data-anchor-id="setup-logging-for-our-workflow">2.3 Setup Logging for our workflow</h3>
<p>Logging is a crucial practice in data science and geospatial workflows, enabling you to track code execution, monitor data processing steps, and quickly diagnose issues. By setting up logging, you ensure that your analyses are reproducible and errors are easier to trace—especially important in production or collaborative environments. For more on logging in data science, see <a href="https://towardsdatascience.com/5-easy-and-effective-ways-to-use-python-logging-a9564bd17ccd/">Effective Logging for Data Science</a> and the <a href="https://docs.python.org/3/howto/logging.html">Python logging HOWTO</a>.</p>
<div id="9c21182a" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="6">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure logging for production-ready code</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">"</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">"</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="geospatial-ai-toolkit-comprehensive-helper-functions" class="level3">
<h3 class="anchored" data-anchor-id="geospatial-ai-toolkit-comprehensive-helper-functions">2.4 Geospatial AI Toolkit: Comprehensive Helper Functions</h3>
<p>This chapter is organized to guide you through the essential foundations of geospatial data science and AI. The file is structured into clear sections, each focusing on a key aspect of the geospatial workflow:</p>
<ul>
<li><strong>Library Imports and Setup</strong>: All necessary Python packages are imported and configured for geospatial analysis and visualization.</li>
<li><strong>Helper Functions</strong>: Modular utility functions are introduced to streamline common geospatial tasks.</li>
<li><strong>Sectioned Capabilities</strong>: Each major capability (such as authentication, data access, and processing) is presented in its own section, with explanations of the underlying design patterns and best practices.</li>
<li><strong>Progressive Complexity</strong>: Concepts and code build on each other, moving from foundational tools to more advanced techniques.</li>
</ul>
<p>This structure is designed to help you understand not just how to use the tools, but also why certain architectural and security decisions are made—preparing you for both practical work and deeper learning as you progress through the course.</p>
<section id="stac-authentication-and-security" class="level4">
<h4 class="anchored" data-anchor-id="stac-authentication-and-security">2.4.1 STAC Authentication and Security 🔐</h4>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Understand API authentication patterns for production systems</li>
<li>Implement secure credential management for cloud services</li>
<li>Design robust authentication with fallback mechanisms</li>
<li>Apply enterprise security best practices to geospatial workflows</li>
</ul>
</div>
</div>
</section>
</section>
<section id="why-authentication-matters-in-geospatial-ai" class="level3">
<h3 class="anchored" data-anchor-id="why-authentication-matters-in-geospatial-ai">Why Authentication Matters in Geospatial AI</h3>
<p>Modern satellite data access relies on cloud-native APIs that require proper authentication for:</p>
<ul>
<li><strong>Rate Limit Management</strong>: Authenticated users get higher request quotas</li>
<li><strong>Access Control</strong>: Some datasets require institutional or commercial access</li>
<li><strong>Usage Tracking</strong>: Providers need to monitor and bill for data access</li>
<li><strong>Security</strong>: Prevents abuse and ensures sustainable data sharing</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How to Obtain a Microsoft Planetary Computer API Key
</div>
</div>
<div class="callout-body-container callout-body">
<p>To access premium datasets and higher request quotas on the Microsoft Planetary Computer, you need to obtain a free API key. Follow these steps:</p>
<ol type="1">
<li><strong>Sign in with a Microsoft Account</strong>
<ul>
<li>Visit the <a href="https://planetarycomputer.microsoft.com/account">Planetary Computer sign-in page</a>.</li>
<li>Click <strong>Sign in</strong> and log in using your Microsoft, GitHub, or LinkedIn account.</li>
</ul></li>
<li><strong>Request an API Key</strong>
<ul>
<li>After signing in, navigate to the <a href="https://planetarycomputer.microsoft.com/account/keys">API Keys section</a>.</li>
<li>Click <strong>Request API Key</strong>.</li>
<li>Fill out the brief form describing your intended use (e.g., “For coursework in geospatial data science”).</li>
<li>Submit the request. Approval is usually instant for academic and research use.</li>
</ul></li>
<li><strong>Copy Your API Key</strong>
<ul>
<li>Once approved, your API key will be displayed on the page.</li>
<li><strong>Copy</strong> the key and keep it secure. Do not share it publicly.</li>
</ul></li>
<li><strong>Set the API Key for Your Code</strong>
<ul>
<li><p><strong>Recommended (for local development):</strong><br>
Create a file named <code>.env</code> in your project directory and add the following line:</p>
<pre><code>PC_SDK_SUBSCRIPTION_KEY=your_api_key_here</code></pre></li>
<li><p><strong>Alternatively (for temporary use):</strong><br>
Set the environment variable in your terminal before running your code:</p>
<pre><code>export PC_SDK_SUBSCRIPTION_KEY=your_api_key_here</code></pre></li>
</ul></li>
<li><strong>Verify Authentication</strong>
<ul>
<li>When you run the code in this chapter, it will automatically detect your API key and authenticate you with the Planetary Computer.</li>
</ul></li>
</ol>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Tip:</strong> If you lose your API key, you can always return to the <a href="https://planetarycomputer.microsoft.com/account/keys">API Keys page</a> to view or regenerate it.</p>
</blockquote>
<div id="44adbc25" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="7">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> setup_planetary_computer_auth() <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Configure authentication for Microsoft Planetary Computer.</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Uses environment variables and .env files for credential discovery,</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">    with graceful degradation to anonymous access.</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">    bool</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">        True if authenticated, False for anonymous access</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Try environment variables first (production)</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    auth_key <span class="op">=</span> os.getenv(<span class="st">'PC_SDK_SUBSCRIPTION_KEY'</span>) <span class="kw">or</span> os.getenv(<span class="st">'PLANETARY_COMPUTER_API_KEY'</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback to .env file (development)</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> auth_key:</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        env_file <span class="op">=</span> Path(<span class="st">'.env'</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> env_file.exists():</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(env_file) <span class="im">as</span> f:</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> line <span class="kw">in</span> f:</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>                        line <span class="op">=</span> line.strip()</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> line.startswith((<span class="st">'PC_SDK_SUBSCRIPTION_KEY='</span>, <span class="st">'PLANETARY_COMPUTER_API_KEY='</span>)):</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                            auth_key <span class="op">=</span> line.split(<span class="st">'='</span>, <span class="dv">1</span>)[<span class="dv">1</span>].strip().strip(<span class="st">'"</span><span class="ch">\'</span><span class="st">'</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">break</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">pass</span>  <span class="co"># Continue with anonymous access</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Configure authentication</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> auth_key <span class="kw">and</span> <span class="bu">len</span>(auth_key) <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>            pc.set_subscription_key(auth_key)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="st">"Planetary Computer authentication successful"</span>)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>            logger.warning(<span class="ss">f"Authentication failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Using anonymous access (basic rate limits)"</span>)</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="authenticate-to-the-planetary-computer" class="level3">
<h3 class="anchored" data-anchor-id="authenticate-to-the-planetary-computer">Authenticate to the Planetary Computer</h3>
<div id="5cf5aa54" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize authentication</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>auth_status <span class="op">=</span> setup_planetary_computer_auth()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Planetary Computer authentication status: </span><span class="sc">{</span><span class="st">'Authenticated'</span> <span class="cf">if</span> auth_status <span class="cf">else</span> <span class="st">'Anonymous'</span><span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:03:19,931 - INFO - Using anonymous access (basic rate limits)
2025-10-09 11:03:19,931 - INFO - Planetary Computer authentication status: Anonymous</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Security Best Practices
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Never hardcode credentials</strong> in source code or notebooks</li>
<li><strong>Use environment variables</strong> for production deployments</li>
</ul>
</div>
</div>
<hr>
<section id="stac-data-discovery" class="level4">
<h4 class="anchored" data-anchor-id="stac-data-discovery">2.4.2 STAC Data Discovery 🔍</h4>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Master cloud-native data discovery patterns</li>
<li>Understand STAC query optimization strategies</li>
<li>Implement robust search with intelligent filtering</li>
<li>Design scalable data discovery for large-scale analysis</li>
</ul>
</div>
</div>
</section>
</section>
<section id="cloud-native-data-access-architecture" class="level3">
<h3 class="anchored" data-anchor-id="cloud-native-data-access-architecture">Cloud-Native Data Access Architecture</h3>
<p>STAC APIs represent a paradigm shift from traditional data distribution:</p>
<ul>
<li><strong>Federated Catalogs</strong>: Multiple providers, unified interface</li>
<li><strong>On-Demand Access</strong>: No need to download entire datasets</li>
<li><strong>Rich Metadata</strong>: Searchable properties for precise discovery</li>
<li><strong>Cloud Optimization</strong>: Direct access to cloud-optimized formats</li>
</ul>
<p>The code block below defines a function, <code>search_sentinel2_scenes</code>, which enables us to programmatically search for Sentinel-2 Level 2A satellite imagery using the Microsoft Planetary Computer (MPC) STAC API.</p>
<p>Here’s how it works:</p>
<ul>
<li><strong>Inputs</strong>: You provide a bounding box (<code>bbox</code>), a date range (<code>date_range</code>), a maximum allowed cloud cover (<code>cloud_cover_max</code>), and a limit on the number of results.</li>
<li><strong>STAC Search</strong>: The function connects to the MPC’s STAC API endpoint and performs a search for Sentinel-2 scenes that match your criteria.</li>
<li><strong>Filtering</strong>: It filters results by cloud cover and sorts them so that the clearest images (lowest cloud cover) come first.</li>
<li><strong>Output</strong>: The function returns a list of STAC items (scenes) that you can further analyze or download.</li>
</ul>
<div id="8067ab18" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="9">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search_sentinel2_scenes(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    bbox: List[<span class="bu">float</span>],</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    date_range: <span class="bu">str</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    cloud_cover_max: <span class="bu">float</span> <span class="op">=</span> <span class="dv">20</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    limit: <span class="bu">int</span> <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> List:</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Search Sentinel-2 Level 2A scenes using STAC API.</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">    bbox : List[float]</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Bounding box as [west, south, east, north] in WGS84</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">    date_range : str</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">        ISO date range: "YYYY-MM-DD/YYYY-MM-DD"</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">    cloud_cover_max : float</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Maximum cloud cover percentage</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">    limit : int</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co">        Maximum scenes to return</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co">    List[pystac.Item]</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="co">        List of STAC items sorted by cloud cover (ascending)</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    catalog <span class="op">=</span> Client.<span class="bu">open</span>(</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://planetarycomputer.microsoft.com/api/stac/v1"</span>,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>        modifier<span class="op">=</span>pc.sign_inplace</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    search_params <span class="op">=</span> {</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"collections"</span>: [<span class="st">"sentinel-2-l2a"</span>],</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: bbox,</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">"datetime"</span>: date_range,</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">"query"</span>: {<span class="st">"eo:cloud_cover"</span>: {<span class="st">"lt"</span>: cloud_cover_max}},</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"limit"</span>: limit</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>    search_results <span class="op">=</span> catalog.search(<span class="op">**</span>search_params)</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    items <span class="op">=</span> <span class="bu">list</span>(search_results.items())</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by cloud cover (best quality first)</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>    items.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x.properties.get(<span class="st">'eo:cloud_cover'</span>, <span class="dv">100</span>))</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(items)<span class="sc">}</span><span class="ss"> Sentinel-2 scenes (cloud cover &lt; </span><span class="sc">{</span>cloud_cover_max<span class="sc">}</span><span class="ss">%)"</span>)</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> items</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While the <code>search_sentinel2_scenes</code> function is currently tailored for Sentinel-2 imagery from the Microsoft Planetary Computer (MPC) STAC, it can be easily adapted to access other types of imagery or even different STAC endpoints.</p>
<p>To search for other datasets—such as Landsat, NAIP, or commercial imagery—you can modify the <code>"collections"</code> parameter in the <code>search_params</code> dictionary to reference the desired collection (e.g., <code>"landsat-8-c2-l2"</code> for Landsat 8). Additionally, to query a different STAC API (such as a local STAC server or another cloud provider), simply change the <code>Client.open()</code> URL to the appropriate endpoint. You may also adjust the search filters (e.g., properties like spatial resolution, acquisition mode, or custom metadata fields) to suit the requirements of other imagery types.</p>
<p>The <code>search_STAC_scenes</code> function generalizes our <code>search_sentinel2_scenes</code> by allowing keyword parameters that define the collection and the URL to use to access the STAC. This flexibility allows you to leverage the same search pattern for a wide variety of geospatial datasets across multiple STAC-compliant catalogs.</p>
<div id="85da29b0" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="10">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search_STAC_scenes(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    bbox: <span class="bu">list</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    date_range: <span class="bu">str</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    cloud_cover_max: <span class="bu">float</span> <span class="op">=</span> <span class="fl">100.0</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    limit: <span class="bu">int</span> <span class="op">=</span> <span class="dv">10</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    collection: <span class="bu">str</span> <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    stac_url: <span class="bu">str</span> <span class="op">=</span> <span class="st">"https://planetarycomputer.microsoft.com/api/stac/v1"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    client_modifier<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    extra_query: <span class="bu">dict</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">list</span>:</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">    General-purpose function to search STAC scenes using a STAC API.</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">    bbox : List[float]</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Bounding box as [west, south, east, north] in WGS84</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">    date_range : str</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co">        ISO date range: "YYYY-MM-DD/YYYY-MM-DD"</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co">    cloud_cover_max : float, optional</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co">        Maximum cloud cover percentage (default: 100.0)</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co">    limit : int, optional</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="co">        Maximum scenes to return (default: 10)</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co">    collection : str, optional</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC collection name (default: "sentinel-2-l2a")</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co">    stac_url : str, optional</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC API endpoint URL (default: MPC STAC)</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co">    client_modifier : callable, optional</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co">        Optional function to modify the STAC client (e.g., for auth)</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="co">    extra_query : dict, optional</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="co">        Additional query parameters for the search</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="co">    List[pystac.Item]</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="co">        List of STAC items sorted by cloud cover (ascending, if available).</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="co">    Examples</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="co">    &gt;&gt;&gt; # Search for Sentinel-2 scenes (default) on the Microsoft Planetary Computer (default) </span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="co">    &gt;&gt;&gt; # over a bounding box in Oregon in January 2022</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="co">    &gt;&gt;&gt; bbox = [-123.5, 45.0, -122.5, 46.0]</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="co">    &gt;&gt;&gt; date_range = "2022-01-01/2022-01-31"</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="co">    &gt;&gt;&gt; items = search_STAC_scenes(bbox, date_range, cloud_cover_max=10, limit=5)</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="co">    &gt;&gt;&gt; # Search for Landsat 8 scenes from a different STAC endpoint</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="co">    &gt;&gt;&gt; landsat_url = "https://earth-search.aws.element84.com/v1"</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="co">    &gt;&gt;&gt; items = search_STAC_scenes(</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="co">    ...     bbox,</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="co">    ...     "2021-06-01/2021-06-30",</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a><span class="co">    ...     collection="landsat-8-c2-l2",</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="co">    ...     stac_url=landsat_url,</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="co">    ...     cloud_cover_max=20,</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="co">    ...     limit=3</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="co">    ... )</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="co">    &gt;&gt;&gt; # Add an extra query to filter by platform</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="co">    &gt;&gt;&gt; items = search_STAC_scenes(</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="co">    ...     bbox,</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="co">    ...     date_range,</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a><span class="co">    ...     extra_query={"platform": {"eq": "sentinel-2b"}}</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a><span class="co">    ... )</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Open the STAC client, with optional modifier (e.g., for MPC auth)</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> client_modifier <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>        catalog <span class="op">=</span> Client.<span class="bu">open</span>(stac_url, modifier<span class="op">=</span>client_modifier)</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>        catalog <span class="op">=</span> Client.<span class="bu">open</span>(stac_url)</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build query parameters</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>    search_params <span class="op">=</span> {</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>        <span class="st">"collections"</span>: [collection],</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: bbox,</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">"datetime"</span>: date_range,</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">"limit"</span>: limit</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add cloud cover filter if present</span></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cloud_cover_max <span class="op">&lt;</span> <span class="fl">100.0</span>:</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>        search_params[<span class="st">"query"</span>] <span class="op">=</span> {<span class="st">"eo:cloud_cover"</span>: {<span class="st">"lt"</span>: cloud_cover_max}}</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> extra_query:</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Merge extra_query into search_params['query']</span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"query"</span> <span class="kw">not</span> <span class="kw">in</span> search_params:</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>            search_params[<span class="st">"query"</span>] <span class="op">=</span> {}</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>        search_params[<span class="st">"query"</span>].update(extra_query)</span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>    search_results <span class="op">=</span> catalog.search(<span class="op">**</span>search_params)</span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>    items <span class="op">=</span> <span class="bu">list</span>(search_results.items())</span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by cloud cover if available</span></span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>    items.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x.properties.get(<span class="st">'eo:cloud_cover'</span>, <span class="dv">100</span>))</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>    logger.info(</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(items)<span class="sc">}</span><span class="ss"> scenes in collection '</span><span class="sc">{</span>collection<span class="sc">}</span><span class="ss">' (cloud cover &lt; </span><span class="sc">{</span>cloud_cover_max<span class="sc">}</span><span class="ss">%)"</span></span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> items</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Query Optimization Strategies
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Spatial Indexing</strong>: STAC APIs use spatial indices for fast geographic queries</li>
<li><strong>Temporal Partitioning</strong>: Date-based organization enables efficient time series queries</li>
<li><strong>Property Filtering</strong>: Server-side filtering reduces network transfer</li>
<li><strong>Result Ranking</strong>: Sort by quality metrics (cloud cover, viewing angle) for best-first selection</li>
</ul>
</div>
</div>
<hr>
<section id="intelligent-data-loading" class="level4">
<h4 class="anchored" data-anchor-id="intelligent-data-loading">2.4.3 Intelligent Data Loading 📥</h4>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Implement memory-efficient satellite data loading</li>
<li>Master coordinate reference system (CRS) transformations</li>
<li>Design robust error handling for network operations</li>
<li>Optimize data transfer with intelligent subsetting</li>
</ul>
</div>
</div>
</section>
</section>
<section id="memory-management-in-satellite-data-processing" class="level3">
<h3 class="anchored" data-anchor-id="memory-management-in-satellite-data-processing">Memory Management in Satellite Data Processing</h3>
<p>Satellite scenes can be massive (&gt;1GB per scene), requiring intelligent loading strategies. The next block of code demonstrates how to efficiently load satellite data by implementing several optimization strategies:</p>
<ul>
<li><strong>Lazy Loading</strong>: Data is only read from disk or over the network when explicitly requested, rather than preloading entire scenes. This conserves memory and speeds up initial operations.</li>
<li><strong>Subset Loading</strong>: By allowing a <code>subset_bbox</code> parameter, only the region of interest is loaded into memory, reducing both data transfer and RAM usage.</li>
<li><strong>Retry Logic</strong>: Network interruptions are handled gracefully with automatic retries, improving robustness for large or remote datasets.</li>
<li><strong>Progressive Loading</strong>: The function is designed to handle multi-band and multi-resolution data, enabling users to load only the bands they need.</li>
</ul>
<p>Together, these techniques ensure that satellite data processing is both memory- and network-efficient, making it practical to work with large geospatial datasets on typical hardware.</p>
<div id="93a8b755" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="11">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_sentinel2_bands(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    item,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    bands: List[<span class="bu">str</span>] <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>, <span class="st">'B08'</span>],</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    subset_bbox: Optional[List[<span class="bu">float</span>]] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    max_retries: <span class="bu">int</span> <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Union[np.ndarray, <span class="bu">str</span>]]:</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Load Sentinel-2 bands with optional spatial subsetting.</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item representing the satellite scene</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">    bands : List[str]</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Spectral bands to load</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">    subset_bbox : Optional[List[float]]</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Spatial subset as [west, south, east, north] in WGS84</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">    max_retries : int</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">        Number of retry attempts per band</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Dict[str, Union[np.ndarray, str]]</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co">        Band arrays plus georeferencing metadata</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> rasterio.windows <span class="im">import</span> from_bounds</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> rasterio.warp <span class="im">import</span> transform_bounds</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    band_data <span class="op">=</span> {}</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    successful_bands <span class="op">=</span> []</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    failed_bands <span class="op">=</span> []</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_name <span class="kw">in</span> bands:</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> band_name <span class="kw">not</span> <span class="kw">in</span> item.assets:</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>            failed_bands.append(band_name)</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>        asset_url <span class="op">=</span> item.assets[band_name].href</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Retry logic with exponential backoff</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> attempt <span class="kw">in</span> <span class="bu">range</span>(max_retries):</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>                <span class="co"># URL signing for authenticated access</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>                signed_url <span class="op">=</span> pc.sign(asset_url)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Memory-efficient loading with rasterio</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> rasterio.<span class="bu">open</span>(signed_url) <span class="im">as</span> src:</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Validate data source</span></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> src.width <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> src.height <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Invalid raster dimensions: </span><span class="sc">{</span>src<span class="sc">.</span>width<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>src<span class="sc">.</span>height<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> subset_bbox:</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Intelligent subsetting with CRS transformation</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">try</span>:</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Transform bbox to source CRS if needed</span></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> src.crs <span class="op">!=</span> rasterio.crs.CRS.from_epsg(<span class="dv">4326</span>):</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>                                subset_bbox_src_crs <span class="op">=</span> transform_bounds(</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>                                    rasterio.crs.CRS.from_epsg(<span class="dv">4326</span>), src.crs, <span class="op">*</span>subset_bbox</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>                                subset_bbox_src_crs <span class="op">=</span> subset_bbox</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Calculate reading window</span></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>                            window <span class="op">=</span> from_bounds(<span class="op">*</span>subset_bbox_src_crs, src.transform)</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Ensure window is within raster bounds</span></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>                            window <span class="op">=</span> window.intersection(</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>                                rasterio.windows.Window(<span class="dv">0</span>, <span class="dv">0</span>, src.width, src.height)</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> window.width <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> window.height <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>                                data <span class="op">=</span> src.read(<span class="dv">1</span>, window<span class="op">=</span>window)</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>                                transform <span class="op">=</span> src.window_transform(window)</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>                                bounds <span class="op">=</span> rasterio.windows.bounds(window, src.transform)</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> src.crs <span class="op">!=</span> rasterio.crs.CRS.from_epsg(<span class="dv">4326</span>):</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>                                    bounds <span class="op">=</span> transform_bounds(src.crs, rasterio.crs.CRS.from_epsg(<span class="dv">4326</span>), <span class="op">*</span>bounds)</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>                                <span class="co"># Fall back to full scene</span></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>                                data <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>                                transform <span class="op">=</span> src.transform</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>                                bounds <span class="op">=</span> src.bounds</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Fall back to full scene on subset error</span></span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>                            data <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>                            transform <span class="op">=</span> src.transform</span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>                            bounds <span class="op">=</span> src.bounds</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Load full scene</span></span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>                        data <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>                        transform <span class="op">=</span> src.transform</span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>                        bounds <span class="op">=</span> src.bounds</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> data.size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Loaded data has zero size"</span>)</span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Store band data and metadata</span></span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>                    band_data[band_name] <span class="op">=</span> data</span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="st">'transform'</span> <span class="kw">not</span> <span class="kw">in</span> band_data:</span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a>                        band_data.update({</span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'transform'</span>: transform,</span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'crs'</span>: src.crs,</span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'bounds'</span>: bounds,</span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'scene_id'</span>: item.<span class="bu">id</span>,</span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'date'</span>: item.properties[<span class="st">'datetime'</span>].split(<span class="st">'T'</span>)[<span class="dv">0</span>]</span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a>                        })</span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>                    successful_bands.append(band_name)</span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> attempt <span class="op">&lt;</span> max_retries <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a>                    time.sleep(<span class="dv">2</span> <span class="op">**</span> attempt)  <span class="co"># Exponential backoff</span></span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a>                    failed_bands.append(band_name)</span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a>                    logger.warning(<span class="ss">f"Failed to load band </span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)[:<span class="dv">50</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate results</span></span>
<span id="cb21-120"><a href="#cb21-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(successful_bands) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb21-121"><a href="#cb21-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="ss">f"Failed to load any bands from scene </span><span class="sc">{</span>item<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-122"><a href="#cb21-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-123"><a href="#cb21-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> failed_bands:</span>
<span id="cb21-124"><a href="#cb21-124" aria-hidden="true" tabindex="-1"></a>        logger.warning(<span class="ss">f"Failed to load </span><span class="sc">{</span><span class="bu">len</span>(failed_bands)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span>failed_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-125"><a href="#cb21-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-126"><a href="#cb21-126" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Successfully loaded </span><span class="sc">{</span><span class="bu">len</span>(successful_bands)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span>successful_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-127"><a href="#cb21-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> band_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Memory Management Best Practices
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Use windowed reading</strong> for large rasters to control memory usage</li>
<li><strong>Load bands on-demand</strong> rather than all at once</li>
<li><strong>Implement progress monitoring</strong> for user feedback during long operations</li>
<li><strong>Handle CRS transformations</strong> automatically to ensure spatial consistency</li>
<li><strong>Cache georeferencing metadata</strong> to avoid redundant I/O operations</li>
</ul>
</div>
</div>
<hr>
<section id="scene-processing-and-subsetting" class="level4">
<h4 class="anchored" data-anchor-id="scene-processing-and-subsetting">2.4.4 Scene Processing and Subsetting 📐</h4>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Master percentage-based spatial subsetting for reproducible analysis</li>
<li>Understand scene geometry and coordinate system implications</li>
<li>Design scalable spatial partitioning strategies</li>
<li>Implement adaptive processing based on scene characteristics</li>
</ul>
</div>
</div>
</section>
</section>
<section id="spatial-reasoning-in-satellite-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="spatial-reasoning-in-satellite-data-analysis">Spatial Reasoning in Satellite Data Analysis</h3>
<p>Satellite scenes come in various sizes and projections, requiring intelligent spatial handling:</p>
<ul>
<li><strong>Percentage-Based Subsetting</strong>: Resolution-independent spatial cropping</li>
<li><strong>Adaptive Processing</strong>: Adjust strategies based on scene characteristics</li>
<li><strong>Spatial Metadata</strong>: Consistent georeferencing across operations</li>
<li><strong>Tiling Strategies</strong>: Partition large scenes for parallel processing</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What does the next block of code do, and why is it useful for GeoAI workflows?
</div>
</div>
<div class="callout-body-container callout-body">
<p>The next block of code defines a function for <strong>percentage-based spatial subsetting</strong> of satellite scenes. Instead of specifying exact coordinates or pixel indices, you provide percentage ranges (e.g., 25% to 75%) for both the x (longitude) and y (latitude) axes. The function then calculates the corresponding bounding box in geographic coordinates.</p>
<p><strong>How does this help in GeoAI workflows?</strong> - <strong>Resolution Independence:</strong> The same percentage-based subset works for any scene, regardless of its pixel size or spatial resolution. - <strong>Reproducibility:</strong> Analyses can be repeated on different scenes or at different times, always extracting the same relative region. - <strong>Scalability:</strong> Enables systematic tiling or grid-based sampling for large-scale or distributed processing. - <strong>Adaptability:</strong> Easily adjust the subset size or location based on scene characteristics or model requirements. - <strong>Abstraction:</strong> Hides the complexity of coordinate systems and scene geometry, making spatial operations more accessible and less error-prone.</p>
<p>This approach is especially valuable in GeoAI, where consistent, automated, and scalable spatial sampling is critical for training, validating, and deploying machine learning models on geospatial data.</p>
</div>
</div>
<div id="df48014a" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="12">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_subset_from_scene(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    item,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    x_range: Tuple[<span class="bu">float</span>, <span class="bu">float</span>] <span class="op">=</span> (<span class="dv">25</span>, <span class="dv">75</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    y_range: Tuple[<span class="bu">float</span>, <span class="bu">float</span>] <span class="op">=</span> (<span class="dv">25</span>, <span class="dv">75</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> List[<span class="bu">float</span>]:</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Intelligent spatial subsetting using percentage-based coordinates.</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">    This approach provides several advantages:</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Resolution Independence: Works regardless of scene size or pixel resolution</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Reproducibility: Same percentage always gives same relative location</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Scalability: Easy to create systematic grids for batch processing</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Adaptability: Can adjust subset size based on scene characteristics</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item containing scene geometry</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co">    x_range : Tuple[float, float]</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Longitude percentage range (0-100)</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">    y_range : Tuple[float, float]</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co">        Latitude percentage range (0-100)</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co">    List[float]</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="co">        Subset bounding box [west, south, east, north] in WGS84</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Template Method with Spatial Reasoning</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides consistent interface for varied spatial operations</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="co">    - Encapsulates coordinate system complexity</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables systematic spatial sampling strategies</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract scene geometry from STAC metadata</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    scene_bbox <span class="op">=</span> item.bbox  <span class="co"># [west, south, east, north]</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Input validation for percentage ranges</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">0</span> <span class="op">&lt;=</span> x_range[<span class="dv">0</span>] <span class="op">&lt;</span> x_range[<span class="dv">1</span>] <span class="op">&lt;=</span> <span class="dv">100</span>):</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Invalid x_range: </span><span class="sc">{</span>x_range<span class="sc">}</span><span class="ss">. Must be (min, max) with 0 &lt;= min &lt; max &lt;= 100"</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">0</span> <span class="op">&lt;=</span> y_range[<span class="dv">0</span>] <span class="op">&lt;</span> y_range[<span class="dv">1</span>] <span class="op">&lt;=</span> <span class="dv">100</span>):</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Invalid y_range: </span><span class="sc">{</span>y_range<span class="sc">}</span><span class="ss">. Must be (min, max) with 0 &lt;= min &lt; max &lt;= 100"</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate scene dimensions in geographic coordinates</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>    scene_width <span class="op">=</span> scene_bbox[<span class="dv">2</span>] <span class="op">-</span> scene_bbox[<span class="dv">0</span>]  <span class="co"># east - west</span></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>    scene_height <span class="op">=</span> scene_bbox[<span class="dv">3</span>] <span class="op">-</span> scene_bbox[<span class="dv">1</span>]  <span class="co"># north - south</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert percentages to geographic coordinates</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>    west <span class="op">=</span> scene_bbox[<span class="dv">0</span>] <span class="op">+</span> (x_range[<span class="dv">0</span>] <span class="op">/</span> <span class="fl">100.0</span>) <span class="op">*</span> scene_width</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>    east <span class="op">=</span> scene_bbox[<span class="dv">0</span>] <span class="op">+</span> (x_range[<span class="dv">1</span>] <span class="op">/</span> <span class="fl">100.0</span>) <span class="op">*</span> scene_width</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>    south <span class="op">=</span> scene_bbox[<span class="dv">1</span>] <span class="op">+</span> (y_range[<span class="dv">0</span>] <span class="op">/</span> <span class="fl">100.0</span>) <span class="op">*</span> scene_height</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>    north <span class="op">=</span> scene_bbox[<span class="dv">1</span>] <span class="op">+</span> (y_range[<span class="dv">1</span>] <span class="op">/</span> <span class="fl">100.0</span>) <span class="op">*</span> scene_height</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>    subset_bbox <span class="op">=</span> [west, south, east, north]</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate subset metrics for reporting</span></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>    subset_area_percent <span class="op">=</span> (</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>        (x_range[<span class="dv">1</span>] <span class="op">-</span> x_range[<span class="dv">0</span>]) <span class="op">*</span> (y_range[<span class="dv">1</span>] <span class="op">-</span> y_range[<span class="dv">0</span>])</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">/</span> <span class="fl">100.0</span></span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"📐 Calculated subset from scene bounds:"</span>)</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>    logger.info(</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>        <span class="st">"   Scene bbox: [</span><span class="sc">%.4f</span><span class="st">, </span><span class="sc">%.4f</span><span class="st">, </span><span class="sc">%.4f</span><span class="st">, </span><span class="sc">%.4f</span><span class="st">]"</span>,</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>        scene_bbox[<span class="dv">0</span>], scene_bbox[<span class="dv">1</span>], scene_bbox[<span class="dv">2</span>], scene_bbox[<span class="dv">3</span>]</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>    logger.info(</span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>        <span class="st">"   Subset bbox: [</span><span class="sc">%.4f</span><span class="st">, </span><span class="sc">%.4f</span><span class="st">, </span><span class="sc">%.4f</span><span class="st">, </span><span class="sc">%.4f</span><span class="st">]"</span>,</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>        west, south, east, north</span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>    logger.info(</span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">"   X range: </span><span class="sc">%s%%</span><span class="st">-</span><span class="sc">%s%%</span><span class="st">, Y range: </span><span class="sc">%s%%</span><span class="st">-</span><span class="sc">%s%%</span><span class="st">"</span>,</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>        x_range[<span class="dv">0</span>], x_range[<span class="dv">1</span>], y_range[<span class="dv">0</span>], y_range[<span class="dv">1</span>]</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>    logger.info(</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">"   Subset area: </span><span class="sc">%.1f%%</span><span class="st"> of original scene"</span>,</span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>        subset_area_percent</span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> subset_bbox</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b168c9ac" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="13">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_scene_info(item):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Extract comprehensive scene characteristics for adaptive processing.</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item to analyze</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Dict</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Scene characteristics including dimensions and geographic metrics</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Information Expert</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">    - Centralizes scene analysis logic</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides basis for adaptive processing decisions</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables consistent scene characterization across workflows</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    bbox <span class="op">=</span> item.bbox</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    width_deg <span class="op">=</span> bbox[<span class="dv">2</span>] <span class="op">-</span> bbox[<span class="dv">0</span>]</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    height_deg <span class="op">=</span> bbox[<span class="dv">3</span>] <span class="op">-</span> bbox[<span class="dv">1</span>]</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Approximate conversion to kilometers (suitable for most latitudes)</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    center_lat <span class="op">=</span> (bbox[<span class="dv">1</span>] <span class="op">+</span> bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    width_km <span class="op">=</span> width_deg <span class="op">*</span> <span class="dv">111</span> <span class="op">*</span> np.cos(np.radians(center_lat))</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    height_km <span class="op">=</span> height_deg <span class="op">*</span> <span class="dv">111</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    info <span class="op">=</span> {</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"scene_id"</span>: item.<span class="bu">id</span>,</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>: item.properties[<span class="st">"datetime"</span>].split(<span class="st">"T"</span>)[<span class="dv">0</span>],</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: bbox,</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"width_deg"</span>: width_deg,</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">"height_deg"</span>: height_deg,</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">"width_km"</span>: width_km,</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"height_km"</span>: height_km,</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"area_km2"</span>: width_km <span class="op">*</span> height_km,</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">"center_lat"</span>: center_lat,</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"center_lon"</span>: (bbox[<span class="dv">0</span>] <span class="op">+</span> bbox[<span class="dv">2</span>]) <span class="op">/</span> <span class="dv">2</span>,</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> info</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Spatial Processing Design Patterns
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Percentage-based coordinates</strong> provide resolution independence</li>
<li><strong>Adaptive processing</strong> adjusts strategies based on scene size</li>
<li><strong>Systematic spatial sampling</strong> enables reproducible analysis</li>
<li><strong>Geographic metrics</strong> support intelligent subset sizing decisions</li>
</ul>
</div>
</div>
<hr>
<section id="data-processing-pipelines" class="level4">
<h4 class="anchored" data-anchor-id="data-processing-pipelines">2.4.5 Data Processing Pipelines 🔬</h4>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Master spectral analysis and vegetation index calculations</li>
<li>Implement robust statistical analysis with error handling</li>
<li>Design composable processing functions for workflow flexibility</li>
<li>Understand radiometric enhancement techniques for visualization</li>
</ul>
</div>
</div>
</section>
</section>
<section id="spectral-analysis-fundamentals" class="level3">
<h3 class="anchored" data-anchor-id="spectral-analysis-fundamentals">Spectral Analysis Fundamentals</h3>
<p>Satellite sensors capture electromagnetic radiation across multiple spectral bands, enabling sophisticated analysis:</p>
<ul>
<li><strong>Radiometric Enhancement</strong>: Optimize visual representation of spectral data</li>
<li><strong>Vegetation Indices</strong>: Combine bands to highlight biological activity</li>
<li><strong>Statistical Analysis</strong>: Characterize data distributions and quality</li>
<li><strong>Composable Functions</strong>: Build complex workflows from simple operations</li>
</ul>
<section id="band-normalization" class="level4">
<h4 class="anchored" data-anchor-id="band-normalization">Band Normalization</h4>
<p>The <code>normalize_band</code> function performs percentile-based normalization of a satellite image band (a 2D NumPy array of pixel values). Its main purpose is to enhance the visual contrast of the data for display or further analysis, while being robust to outliers and invalid values.</p>
<p><strong>How it works:</strong> - <strong>Input:</strong> The function takes a NumPy array (<code>band</code>) representing the raw values of a spectral band, a tuple of percentiles (defaulting to the 2nd and 98th), and a <code>clip</code> flag. - <strong>Robustness:</strong> It first creates a mask to identify valid (finite) values, ignoring NaNs and infinities. - <strong>Percentile Stretch:</strong> It computes the lower and upper percentile values (<code>p_low</code>, <code>p_high</code>) from the valid data. These percentiles define the range for stretching, which helps ignore extreme outliers. - <strong>Normalization:</strong> The band is linearly scaled so that <code>p_low</code> maps to 0 and <code>p_high</code> maps to 1. Values outside this range can be optionally clipped. - <strong>Edge Cases:</strong> If all values are invalid or the percentiles are equal (no variation), it returns an array of zeros.</p>
<p><strong>Why use this?</strong> - It improves image contrast for visualization. - It is robust to outliers and missing data. - It preserves the relative relationships between pixel values.</p>
<p>This function exemplifies the “Strategy Pattern” by encapsulating a normalization approach that can be swapped or extended for other enhancement strategies.</p>
<div id="4cf2c8b9" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="14">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_band(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    band: np.ndarray, percentiles: Tuple[<span class="bu">float</span>, <span class="bu">float</span>] <span class="op">=</span> (<span class="dv">2</span>, <span class="dv">98</span>), clip: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Percentile-based radiometric enhancement for optimal visualization.</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">    This normalization approach addresses several challenges:</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Dynamic Range: Raw satellite data often has poor contrast</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Outlier Robustness: Percentiles ignore extreme values</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Visual Optimization: Results in pleasing, interpretable images</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Statistical Validity: Preserves relative data relationships</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co">    band : np.ndarray</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">        Raw satellite band values</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co">    percentiles : Tuple[float, float]</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co">        Lower and upper percentiles for stretching</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co">    clip : bool</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Whether to clip values to [0, 1] range</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="co">    np.ndarray</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="co">        Normalized band values optimized for visualization</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Strategy Pattern for Enhancement</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="co">    - Encapsulates different enhancement algorithms</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides consistent interface for various normalization strategies</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="co">    - Handles edge cases (NaN, infinite values) robustly</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle NaN and infinite values robustly</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    valid_mask <span class="op">=</span> np.isfinite(band)</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> np.<span class="bu">any</span>(valid_mask):</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.zeros_like(band)</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate percentiles on valid data only</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    p_low, p_high <span class="op">=</span> np.percentile(band[valid_mask], percentiles)</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Avoid division by zero</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> p_high <span class="op">==</span> p_low:</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.zeros_like(band)</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Linear stretch based on percentiles</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>    normalized <span class="op">=</span> (band <span class="op">-</span> p_low) <span class="op">/</span> (p_high <span class="op">-</span> p_low)</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optional clipping to [0, 1] range</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> clip:</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>        normalized <span class="op">=</span> np.clip(normalized, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> normalized</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rgb-composite" class="level4">
<h4 class="anchored" data-anchor-id="rgb-composite">RGB Composite</h4>
<p>The next code block introduces the function <code>create_rgb_composite</code>, which is designed to generate publication-quality RGB composite images from individual spectral bands (red, green, and blue). This function optionally applies automatic contrast enhancement to each band using the previously defined <code>normalize_band</code> function, ensuring that the resulting composite is visually optimized and suitable for analysis or presentation. The function demonstrates the Composite design pattern by combining multiple bands into a unified RGB representation, applying consistent processing across all channels, and producing an output format compatible with standard visualization libraries.</p>
<div id="51524fe5" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_rgb_composite(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    red: np.ndarray, green: np.ndarray, blue: np.ndarray, enhance: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Create publication-quality RGB composite images.</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">    red, green, blue : np.ndarray</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Individual spectral bands</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">    enhance : bool</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">        Apply automatic contrast enhancement</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">    np.ndarray</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">        RGB composite with shape (height, width, 3)</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Composite Pattern for Multi-band Operations</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">    - Combines multiple bands into unified representation</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co">    - Applies consistent enhancement across all channels</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">    - Produces standard format for visualization libraries</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply enhancement to each channel</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> enhance:</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>        red_norm <span class="op">=</span> normalize_band(red)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>        green_norm <span class="op">=</span> normalize_band(green)</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>        blue_norm <span class="op">=</span> normalize_band(blue)</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simple linear scaling</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>        red_norm <span class="op">=</span> red <span class="op">/</span> np.<span class="bu">max</span>(red) <span class="cf">if</span> np.<span class="bu">max</span>(red) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> red</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>        green_norm <span class="op">=</span> green <span class="op">/</span> np.<span class="bu">max</span>(green) <span class="cf">if</span> np.<span class="bu">max</span>(green) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> green</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        blue_norm <span class="op">=</span> blue <span class="op">/</span> np.<span class="bu">max</span>(blue) <span class="cf">if</span> np.<span class="bu">max</span>(blue) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> blue</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Stack into RGB composite</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    rgb_composite <span class="op">=</span> np.dstack([red_norm, green_norm, blue_norm])</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rgb_composite</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="derived-band-calculations" class="level3">
<h3 class="anchored" data-anchor-id="derived-band-calculations">Derived band calculations</h3>
<p>The following code block introduces the function <code>calculate_ndvi</code>, which computes the Normalized Difference Vegetation Index (NDVI) from near-infrared (NIR) and red spectral bands. NDVI is a widely used vegetation index in remote sensing, defined as (NIR - Red) / (NIR + Red). This index leverages the fact that healthy vegetation strongly reflects NIR light while absorbing red light due to chlorophyll, making NDVI a robust indicator of plant health, biomass, and vegetation cover. The function includes robust error handling for numerical stability and edge cases, ensuring reliable results even when input values are near zero or contain invalid data.</p>
<div id="6d42c399" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_ndvi(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    nir: np.ndarray, red: np.ndarray, epsilon: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1e-8</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate Normalized Difference Vegetation Index with robust error handling.</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">    NDVI = (NIR - Red) / (NIR + Red)</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">    NDVI is fundamental to vegetation monitoring because:</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Physical Basis: Reflects chlorophyll absorption and cellular structure</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Standardization: Normalized to [-1, 1] range for comparison</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Temporal Stability: Enables change detection across seasons/years</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Ecological Meaning: Strong correlation with biomass and health</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co">    nir : np.ndarray</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co">        Near-infrared reflectance (Band 8: 842nm)</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co">    red : np.ndarray</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Red reflectance (Band 4: 665nm)</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co">    epsilon : float</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co">        Numerical stability constant</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co">    np.ndarray</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="co">        NDVI values in range [-1, 1]</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Domain-Specific Language for Spectral Indices</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="co">    - Encapsulates spectral physics knowledge</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides numerical stability for edge cases</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables consistent index calculation across projects</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to float for numerical precision</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>    nir_float <span class="op">=</span> nir.astype(np.float32)</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>    red_float <span class="op">=</span> red.astype(np.float32)</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate NDVI with numerical stability</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>    numerator <span class="op">=</span> nir_float <span class="op">-</span> red_float</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>    denominator <span class="op">=</span> nir_float <span class="op">+</span> red_float <span class="op">+</span> epsilon</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> numerator <span class="op">/</span> denominator</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle edge cases (both bands zero, etc.)</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> np.where(np.isfinite(ndvi), ndvi, <span class="dv">0</span>)</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ndvi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="band-statistics" class="level4">
<h4 class="anchored" data-anchor-id="band-statistics">Band statistics</h4>
<p>The next function, <code>calculate_band_statistics</code>, provides a comprehensive statistical summary of a satellite image band. It computes key statistics such as minimum, maximum, mean, standard deviation, median, and percentiles, as well as counts of valid and total pixels. This function is essential in GeoAI workflows for several reasons:</p>
<ul>
<li><strong>Data Quality Assessment:</strong> By summarizing the distribution and quality of pixel values, it helps identify anomalies, outliers, or missing data before further analysis.</li>
<li><strong>Feature Engineering:</strong> Statistical summaries can be used as features in machine learning models for land cover classification, anomaly detection, or change detection.</li>
<li><strong>Automated Validation:</strong> Integrating this function into data pipelines enables automated quality control, ensuring only reliable data is used for downstream tasks.</li>
<li><strong>Reporting and Visualization:</strong> The output can be used to generate reports or visualizations that communicate data characteristics to stakeholders.</li>
</ul>
<p>In practice, <code>calculate_band_statistics</code> can be called on each band of a satellite image to quickly assess data readiness and inform preprocessing or modeling decisions in GeoAI projects.</p>
<div id="c0d5ee03" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_band_statistics(band: np.ndarray, name: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Band"</span>) <span class="op">-&gt;</span> Dict:</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Comprehensive statistical characterization of satellite bands.</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">    band : np.ndarray</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Input band array</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">    name : str</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Descriptive name for reporting</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Dict</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Complete statistical summary including percentiles and counts</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Observer Pattern for Data Quality Assessment</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides standardized quality metrics</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables data validation and quality control</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co">    - Supports automated quality assessment workflows</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    valid_mask <span class="op">=</span> np.isfinite(band)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    valid_data <span class="op">=</span> band[valid_mask]</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(valid_data) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">"name"</span>: name,</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">"min"</span>: np.nan,</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">"max"</span>: np.nan,</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mean"</span>: np.nan,</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">"std"</span>: np.nan,</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">"median"</span>: np.nan,</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">"valid_pixels"</span>: <span class="dv">0</span>,</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">"total_pixels"</span>: band.size,</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> {</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: name,</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"min"</span>: <span class="bu">float</span>(np.<span class="bu">min</span>(valid_data)),</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">"max"</span>: <span class="bu">float</span>(np.<span class="bu">max</span>(valid_data)),</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"mean"</span>: <span class="bu">float</span>(np.mean(valid_data)),</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">"std"</span>: <span class="bu">float</span>(np.std(valid_data)),</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">"median"</span>: <span class="bu">float</span>(np.median(valid_data)),</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">"valid_pixels"</span>: <span class="bu">int</span>(np.<span class="bu">sum</span>(valid_mask)),</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">"total_pixels"</span>: <span class="bu">int</span>(band.size),</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">"percentiles"</span>: {</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">"p25"</span>: <span class="bu">float</span>(np.percentile(valid_data, <span class="dv">25</span>)),</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">"p75"</span>: <span class="bu">float</span>(np.percentile(valid_data, <span class="dv">75</span>)),</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">"p95"</span>: <span class="bu">float</span>(np.percentile(valid_data, <span class="dv">95</span>)),</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Spectral Analysis Best Practices
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Percentile normalization</strong> provides robust enhancement against outliers</li>
<li><strong>Numerical stability constants</strong> prevent division by zero in index calculations</li>
<li><strong>Type conversion to float32</strong> ensures adequate precision for calculations</li>
<li><strong>Comprehensive statistics</strong> enable quality assessment and validation</li>
</ul>
</div>
</div>
<hr>
</section>
<section id="visualization-functions" class="level4">
<h4 class="anchored" data-anchor-id="visualization-functions">2.4.6 Visualization Functions 📊</h4>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Design publication-quality visualization systems</li>
<li>Implement adaptive layout algorithms for multi-panel displays</li>
<li>Master colormap selection for scientific data representation</li>
<li>Create interactive and informative visual narratives</li>
</ul>
</div>
</div>
</section>
</section>
<section id="scientific-visualization-design-principles" class="level3">
<h3 class="anchored" data-anchor-id="scientific-visualization-design-principles">Scientific Visualization Design Principles</h3>
<p>Effective satellite data visualization requires careful consideration of:</p>
<ul>
<li><strong>Perceptual Uniformity</strong>: Colormaps that accurately represent data relationships</li>
<li><strong>Information Density</strong>: Maximum insight per pixel</li>
<li><strong>Adaptive Layout</strong>: Accommodate variable numbers of data layers</li>
<li><strong>Context Preservation</strong>: Maintain spatial and temporal reference information</li>
</ul>
<div id="3878154d" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="18">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_band_comparison(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    bands: Dict[<span class="bu">str</span>, np.ndarray],</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    rgb: Optional[np.ndarray] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    ndvi: Optional[np.ndarray] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    title: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Multi-band Analysis"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Create comprehensive multi-panel visualization for satellite analysis.</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">    This function demonstrates several visualization principles:</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Adaptive Layout: Automatically adjusts grid based on available data</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Consistent Scaling: Uniform treatment of individual bands</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Specialized Colormaps: Scientific colormaps for different data types</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Context Information: Titles, colorbars, and interpretive text</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">    bands : Dict[str, np.ndarray]</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">        Individual spectral bands to visualize</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co">    rgb : Optional[np.ndarray]</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co">        True color composite for context</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co">    ndvi : Optional[np.ndarray]</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co">        Vegetation index with specialized colormap</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co">    title : str</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co">        Overall figure title</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Facade Pattern for Complex Visualizations</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="co">    - Simplifies complex matplotlib operations</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides consistent visualization interface</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="co">    - Handles layout complexity automatically</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate layout</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    n_panels <span class="op">=</span> (</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">len</span>(bands) <span class="op">+</span> (<span class="dv">1</span> <span class="cf">if</span> rgb <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span>) <span class="op">+</span> (<span class="dv">1</span> <span class="cf">if</span> ndvi <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    n_cols <span class="op">=</span> <span class="bu">min</span>(<span class="dv">3</span>, n_panels)</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>    n_rows <span class="op">=</span> (n_panels <span class="op">+</span> n_cols <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> n_cols</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(n_rows, n_cols, figsize<span class="op">=</span>(<span class="dv">5</span> <span class="op">*</span> n_cols, <span class="dv">4</span> <span class="op">*</span> n_rows))</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_panels <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>        axes <span class="op">=</span> [axes]</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> n_rows <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>        axes <span class="op">=</span> axes.flatten()</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>    panel_idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RGB composite</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rgb <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].imshow(rgb)</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].set_title(<span class="st">"RGB Composite"</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].axis(<span class="st">"off"</span>)</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>        panel_idx <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Individual bands</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_name, band_data <span class="kw">in</span> bands.items():</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> panel_idx <span class="op">&lt;</span> <span class="bu">len</span>(axes):</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>            normalized <span class="op">=</span> normalize_band(band_data)</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>            axes[panel_idx].imshow(normalized, cmap<span class="op">=</span><span class="st">"gray"</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>            axes[panel_idx].set_title(<span class="ss">f"Band: </span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss">"</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>            axes[panel_idx].axis(<span class="st">"off"</span>)</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>            panel_idx <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI with colorbar</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ndvi <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> panel_idx <span class="op">&lt;</span> <span class="bu">len</span>(axes):</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> axes[panel_idx].imshow(ndvi, cmap<span class="op">=</span><span class="st">"RdYlGn"</span>, vmin<span class="op">=-</span><span class="fl">0.5</span>, vmax<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].set_title(<span class="st">"NDVI"</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].axis(<span class="st">"off"</span>)</span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>        cbar <span class="op">=</span> plt.colorbar(im, ax<span class="op">=</span>axes[panel_idx], shrink<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>        cbar.set_label(<span class="st">"NDVI Value"</span>, rotation<span class="op">=</span><span class="dv">270</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>        panel_idx <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hide unused panels</span></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(panel_idx, <span class="bu">len</span>(axes)):</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>        axes[idx].axis(<span class="st">"off"</span>)</span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(title, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Visualization Design Principles
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Adaptive layouts</strong> accommodate varying numbers of data layers</li>
<li><strong>Perceptually uniform colormaps</strong> (like RdYlGn for NDVI) accurately represent data relationships</li>
<li><strong>Consistent normalization</strong> enables fair comparison between bands</li>
<li><strong>Interpretive elements</strong> (colorbars, labels) provide context for non-experts</li>
</ul>
</div>
</div>
<hr>
<section id="data-export-and-interoperability" class="level4">
<h4 class="anchored" data-anchor-id="data-export-and-interoperability">2.4.7 Data Export and Interoperability 💾</h4>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Master geospatial data standards (GeoTIFF, CRS, metadata)</li>
<li>Implement cloud-optimized data formats for scalable access</li>
<li>Design interoperable workflows for multi-platform analysis</li>
<li>Ensure data provenance and reproducibility through metadata</li>
</ul>
</div>
</div>
</section>
</section>
<section id="geospatial-data-standards-and-interoperability" class="level3">
<h3 class="anchored" data-anchor-id="geospatial-data-standards-and-interoperability">Geospatial Data Standards and Interoperability</h3>
<p>Modern geospatial workflows require adherence to established standards:</p>
<ul>
<li><strong>GeoTIFF</strong>: Industry standard for georeferenced raster data</li>
<li><strong>CRS Preservation</strong>: Maintain spatial reference throughout processing</li>
<li><strong>Metadata Standards</strong>: Ensure data provenance and reproducibility</li>
<li><strong>Cloud Optimization</strong>: Structure data for efficient cloud-native access</li>
</ul>
<div id="e92a99b2" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="19">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_geotiff(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    data: np.ndarray,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    output_path: Union[<span class="bu">str</span>, Path],</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    transform,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    crs,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    band_names: Optional[List[<span class="bu">str</span>]] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Export georeferenced data using industry-standard GeoTIFF format.</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">    This function embodies several geospatial best practices:</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Standards Compliance: Uses OGC-compliant GeoTIFF format</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Metadata Preservation: Maintains CRS and transform information</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Compression: Applies lossless compression for efficiency</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Band Description: Documents spectral band information</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co">    data : np.ndarray</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Data array (2D for single band, 3D for multi-band)</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">    output_path : Union[str, Path]</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co">        Output file path</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co">    transform : rasterio.transform.Affine</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co">        Geospatial transform matrix</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="co">    crs : rasterio.crs.CRS</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co">        Coordinate reference system</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="co">    band_names : Optional[List[str]]</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="co">        Descriptive names for each band</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Builder Pattern for Geospatial Data Export</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="co">    - Constructs complex geospatial files incrementally</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="co">    - Ensures all required metadata is preserved</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides extensible framework for additional metadata</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> Path(output_path)</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>    output_path.parent.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle both 2D and 3D arrays</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data.ndim <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>        height, width <span class="op">=</span> data.shape</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>        count, height, width <span class="op">=</span> data.shape</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Write GeoTIFF with comprehensive metadata</span></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rasterio.<span class="bu">open</span>(</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>        output_path,</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"w"</span>,</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>        driver<span class="op">=</span><span class="st">"GTiff"</span>,</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span>height,</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span>width,</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>        count<span class="op">=</span>count,</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>        dtype<span class="op">=</span>data.dtype,</span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>        crs<span class="op">=</span>crs,</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>transform,</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>        compress<span class="op">=</span><span class="st">"deflate"</span>,  <span class="co"># Lossless compression</span></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>        tiled<span class="op">=</span><span class="va">True</span>,  <span class="co"># Cloud-optimized structure</span></span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>        blockxsize<span class="op">=</span><span class="dv">512</span>,  <span class="co"># Optimize for cloud access</span></span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>        blockysize<span class="op">=</span><span class="dv">512</span>,</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>    ) <span class="im">as</span> dst:</span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> data.ndim <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>            dst.write(data, <span class="dv">1</span>)</span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> band_names:</span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>                dst.set_band_description(<span class="dv">1</span>, band_names[<span class="dv">0</span>])</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(count):</span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>                dst.write(data[i], i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> band_names <span class="kw">and</span> i <span class="op">&lt;</span> <span class="bu">len</span>(band_names):</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a>                    dst.set_band_description(i <span class="op">+</span> <span class="dv">1</span>, band_names[i])</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>    logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"💾 Saved GeoTIFF: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"   Shape: </span><span class="sc">{</span>data<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"   CRS: </span><span class="sc">{</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"   Compression: deflate, tiled"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Geospatial Data Standards
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>GeoTIFF with COG optimization</strong> ensures cloud-native accessibility</li>
<li><strong>CRS preservation</strong> maintains spatial accuracy across platforms</li>
<li><strong>Lossless compression</strong> reduces storage costs without data loss</li>
<li><strong>Band descriptions</strong> provide metadata for analysis reproducibility</li>
</ul>
</div>
</div>
<hr>
<section id="advanced-workflow-patterns" class="level4">
<h4 class="anchored" data-anchor-id="advanced-workflow-patterns">2.4.8 Advanced Workflow Patterns 🚀</h4>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Design scalable spatial partitioning strategies for large-scale analysis</li>
<li>Implement testing frameworks for geospatial data pipelines</li>
<li>Master parallel processing patterns for satellite data workflows</li>
<li>Create adaptive processing strategies based on scene characteristics</li>
</ul>
</div>
</div>
</section>
</section>
<section id="scalable-geospatial-processing-architectures" class="level3">
<h3 class="anchored" data-anchor-id="scalable-geospatial-processing-architectures">Scalable Geospatial Processing Architectures</h3>
<p>Large-scale satellite analysis requires sophisticated workflow patterns:</p>
<ul>
<li><strong>Spatial Partitioning</strong>: Divide scenes into manageable processing units</li>
<li><strong>Adaptive Strategies</strong>: Adjust processing based on data characteristics</li>
<li><strong>Quality Assurance</strong>: Automated testing of processing pipelines</li>
<li><strong>Parallel Execution</strong>: Leverage multiple cores/nodes for efficiency</li>
</ul>
<p>The <code>create_scene_tiles</code> function systematically partitions a geospatial scene (represented by a STAC item) into a grid of smaller tiles for scalable and parallel processing. It takes as input a STAC item and a desired grid size (e.g., 3×3), then:</p>
<ul>
<li>Retrieves scene metadata (such as bounding box and area).</li>
<li>Iterates over the grid dimensions to compute the spatial extent of each tile as a percentage of the scene.</li>
<li>For each tile, calculates its bounding box and relevant metadata.</li>
<li>Returns a list of dictionaries, each describing a tile’s spatial boundaries and processing information.</li>
</ul>
<p>This approach enables efficient parallelization, memory management, and quality control by allowing independent processing and testing of each tile, and is designed to be flexible for different partitioning strategies.</p>
<div id="ae7cc443" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="20">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_scene_tiles(item, tile_size: Tuple[<span class="bu">int</span>, <span class="bu">int</span>] <span class="op">=</span> (<span class="dv">3</span>, <span class="dv">3</span>)):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Create systematic spatial partitioning for parallel processing workflows.</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">    This tiling approach enables several advanced patterns:</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Parallel Processing: Independent tiles can be processed simultaneously</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Memory Management: Process large scenes without loading entirely</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Quality Control: Test processing on representative tiles first</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Scalability: Extend to arbitrary scene sizes and processing resources</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item to partition</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co">    tile_size : Tuple[int, int]</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co">        Grid dimensions (nx, ny)</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co">    List[Dict]</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co">        Tile metadata with bounding boxes and processing information</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Strategy Pattern for Spatial Partitioning</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides flexible tiling strategies for different use cases</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="co">    - Encapsulates spatial mathematics complexity</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables systematic quality control and testing</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    tiles <span class="op">=</span> []</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    nx, ny <span class="op">=</span> tile_size</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>    scene_info <span class="op">=</span> get_scene_info(item)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"🔲 Creating </span><span class="sc">{</span>nx<span class="sc">}</span><span class="ss">×</span><span class="sc">{</span>ny<span class="sc">}</span><span class="ss"> tile grid from scene..."</span>)</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"   Total tiles: </span><span class="sc">{</span>nx <span class="op">*</span> ny<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"   Scene area: </span><span class="sc">{</span>scene_info[<span class="st">'area_km2'</span>]<span class="sc">:.0f}</span><span class="ss"> km²"</span>)</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(nx):</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(ny):</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate percentage ranges for this tile</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>            x_start <span class="op">=</span> (i <span class="op">/</span> nx) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>            x_end <span class="op">=</span> ((i <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> nx) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>            y_start <span class="op">=</span> (j <span class="op">/</span> ny) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>            y_end <span class="op">=</span> ((j <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> ny) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generate tile bounding box</span></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>            tile_bbox <span class="op">=</span> get_subset_from_scene(</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>                item, x_range<span class="op">=</span>(x_start, x_end), y_range<span class="op">=</span>(y_start, y_end)</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Package tile metadata for processing</span></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>            tile_info <span class="op">=</span> {</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">"tile_id"</span>: <span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>                <span class="st">"row"</span>: j,</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>                <span class="st">"col"</span>: i,</span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">"bbox"</span>: tile_bbox,</span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">"x_range"</span>: (x_start, x_end),</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">"y_range"</span>: (y_start, y_end),</span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>                <span class="st">"area_percent"</span>: ((x_end <span class="op">-</span> x_start) <span class="op">*</span> (y_end <span class="op">-</span> y_start)) <span class="op">/</span> <span class="fl">100.0</span>,</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>                <span class="st">"processing_priority"</span>: <span class="st">"high"</span></span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (i <span class="op">==</span> nx <span class="op">//</span> <span class="dv">2</span> <span class="kw">and</span> j <span class="op">==</span> ny <span class="op">//</span> <span class="dv">2</span>)</span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> <span class="st">"normal"</span>,  <span class="co"># Center tile first</span></span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>            tiles.append(tile_info)</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>    logger.info(</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"   ✅ Created </span><span class="sc">{</span><span class="bu">len</span>(tiles)<span class="sc">}</span><span class="ss"> tiles, each covering </span><span class="sc">{</span>tiles[<span class="dv">0</span>][<span class="st">'area_percent'</span>]<span class="sc">:.1f}</span><span class="ss">% of scene"</span></span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tiles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="testing-functionality" class="level4">
<h4 class="anchored" data-anchor-id="testing-functionality">Testing functionality</h4>
<p>The next code block introduces a function called <code>test_subset_functionality</code>. This function is designed to perform automated quality assurance on geospatial data loading pipelines. It does so by running a series of tests on a small, central subset of a geospatial scene, using a STAC item as input. The function checks that the subset extraction and band loading processes work correctly, verifies that data is actually loaded, and provides informative print statements about the test results. This approach helps catch errors early, ensures that the core data loading functionality is operational before processing larger datasets, and validates performance on a manageable data sample.</p>
<div id="9c7f07f6" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="21">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_subset_functionality(item):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Automated quality assurance for data loading pipelines.</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">    This testing approach demonstrates:</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Smoke Testing: Verify basic functionality before full processing</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Representative Sampling: Test with manageable data subset</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Error Detection: Identify issues early in processing pipeline</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Performance Validation: Ensure acceptable loading performance</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item to test</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co">    bool</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co">        True if subset functionality is working correctly</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Chain of Responsibility for Quality Assurance</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co">    - Implements systematic testing hierarchy</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides early failure detection</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="co">    - Validates core functionality before expensive operations</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"🧪 Testing subset functionality..."</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test with small central area (minimal data transfer)</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>        test_bbox <span class="op">=</span> get_subset_from_scene(item, x_range<span class="op">=</span>(<span class="dv">40</span>, <span class="dv">60</span>), y_range<span class="op">=</span>(<span class="dv">40</span>, <span class="dv">60</span>))</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load minimal data for testing</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>        test_data <span class="op">=</span> load_sentinel2_bands(</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>            item,</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>            bands<span class="op">=</span>[<span class="st">"B04"</span>],  <span class="co"># Single band reduces test time</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>            subset_bbox<span class="op">=</span>test_bbox,</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>            max_retries<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"B04"</span> <span class="kw">in</span> test_data:</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>            shape <span class="op">=</span> test_data[<span class="st">"B04"</span>].shape</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>            has_data <span class="op">=</span> test_data[<span class="st">"B04"</span>].size <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>            logger.info(</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f"   ✅ Subset test successful: </span><span class="sc">{</span>shape<span class="sc">}</span><span class="ss"> pixels, </span><span class="sc">{</span>test_data[<span class="st">'B04'</span>]<span class="sc">.</span>size<span class="sc">}</span><span class="ss"> total"</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>            logger.error(<span class="ss">f"   ❌ Subset test failed: no data returned"</span>)</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="ss">f"   ❌ Subset test failed: </span><span class="sc">{</span><span class="bu">str</span>(e)[:<span class="dv">50</span>]<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="summary-your-geospatial-ai-toolkit" class="level3">
<h3 class="anchored" data-anchor-id="summary-your-geospatial-ai-toolkit">2.5 Summary: Your Geospatial AI Toolkit</h3>
<p>You now have a comprehensive, production-ready toolkit with:</p>
<p><strong>Core Capabilities:</strong></p>
<ol type="1">
<li><strong>🔐 Enterprise Authentication</strong>: Secure, scalable API access patterns</li>
<li><strong>🔍 Intelligent Data Discovery</strong>: Cloud-native search with optimization</li>
<li><strong>📥 Memory-Efficient Loading</strong>: Robust data access with subsetting</li>
<li><strong>📐 Spatial Processing</strong>: Percentage-based, reproducible operations</li>
<li><strong>🔬 Spectral Analysis</strong>: Publication-quality processing pipelines</li>
<li><strong>📊 Scientific Visualization</strong>: Adaptive, informative displays</li>
<li><strong>💾 Standards-Compliant Export</strong>: Interoperable data formats</li>
<li><strong>🚀 Scalable Workflows</strong>: Parallel processing and quality assurance</li>
</ol>
<p><strong>Design Philosophy:</strong></p>
<p>Each function embodies software engineering best practices:</p>
<ul>
<li><strong>Error Handling</strong>: Graceful degradation and informative error messages</li>
<li><strong>Composability</strong>: Functions work together in complex workflows</li>
<li><strong>Extensibility</strong>: Easy to modify and extend for new requirements</li>
<li><strong>Documentation</strong>: Clear examples and architectural reasoning</li>
</ul>
<p><strong>Ready for Production:</strong></p>
<p>These functions are designed for real-world deployment:</p>
<ul>
<li><strong>Scalability</strong>: Handle datasets from small studies to global analysis</li>
<li><strong>Reliability</strong>: Robust error handling and recovery mechanisms</li>
<li><strong>Performance</strong>: Memory-efficient algorithms and cloud optimization</li>
<li><strong>Maintainability</strong>: Clear code structure and comprehensive documentation</li>
</ul>
<p><strong>Troubleshooting:</strong></p>
<ul>
<li><strong>Systematic tiling</strong> enables parallel processing of large datasets</li>
<li><strong>Quality assurance testing</strong> prevents failures in production workflows</li>
<li><strong>Adaptive processing priorities</strong> optimize resource utilization</li>
<li><strong>Metadata packaging</strong> supports complex workflow orchestration</li>
</ul>
<hr>
</section>
</section>
<section id="understanding-stac-apis-and-cloud-native-geospatial-architecture" class="level2">
<h2 class="anchored" data-anchor-id="understanding-stac-apis-and-cloud-native-geospatial-architecture">3. Understanding STAC APIs and Cloud-Native Geospatial Architecture</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you will:</p>
<p>Understand the STAC specification and its role in modern geospatial architecture Connect to cloud-native data catalogs with proper authentication Explore available satellite datasets and their characteristics Design robust data discovery workflows for production systems</p>
</div>
</div>
<section id="the-stac-revolution-from-data-downloads-to-cloud-native-discovery" class="level3">
<h3 class="anchored" data-anchor-id="the-stac-revolution-from-data-downloads-to-cloud-native-discovery">The STAC Revolution: From Data Downloads to Cloud-Native Discovery</h3>
<p><strong>STAC (SpatioTemporal Asset Catalog)</strong> represents a fundamental shift in how we access geospatial data. Instead of downloading entire datasets (often terabytes), STAC enables intelligent, on-demand access to exactly the data you need.</p>
<section id="why-stac-matters-for-geospatial-ai" class="level4">
<h4 class="anchored" data-anchor-id="why-stac-matters-for-geospatial-ai">Why STAC Matters for Geospatial AI</h4>
<p>Traditional satellite data distribution faced several challenges. Users were required to download and store massive datasets locally, leading to significant storage bottlenecks. There was no standardized way to search across different providers, making data discovery difficult. Before analysis could begin, heavy preprocessing was often necessary, creating additional barriers. Furthermore, tracking data lineage and updates was challenging, complicating version control.</p>
<p>STAC addresses these issues by enabling federated discovery, allowing users to search across multiple data providers through a unified interface. It supports lazy loading, so only the necessary spatial and temporal subsets are accessed. The use of rich, standardized metadata enables intelligent filtering of data. Additionally, STAC is optimized for the cloud, providing direct access to analysis-ready data stored remotely.</p>
</section>
</section>
<section id="stac-architecture-components" class="level3">
<h3 class="anchored" data-anchor-id="stac-architecture-components">STAC Architecture Components</h3>
<p>The STAC architecture is composed of several key elements. STAC Items represent individual scenes or data granules, each described with standardized metadata. These items are grouped into STAC Collections, which organize related items, such as all Sentinel-2 data. Collections and items are further structured within STAC Catalogs, creating a hierarchical organization that enables efficient navigation and discovery. Access to these resources is provided through STAC APIs, which are RESTful interfaces designed for searching and retrieving geospatial data.</p>
</section>
<section id="practical-stac-connection-microsoft-planetary-computer" class="level3">
<h3 class="anchored" data-anchor-id="practical-stac-connection-microsoft-planetary-computer">Practical STAC Connection: Microsoft Planetary Computer</h3>
<p>Microsoft Planetary Computer hosts one of the world’s largest STAC catalogs, providing free access to petabytes of environmental data. Let’s establish a robust connection and explore available datasets.</p>
<section id="testing-stac-connectivity-and-catalog-discovery" class="level4">
<h4 class="anchored" data-anchor-id="testing-stac-connectivity-and-catalog-discovery">Testing STAC Connectivity and Catalog Discovery</h4>
<p>This connection test demonstrates several important concepts for production geospatial systems:</p>
<div id="09ac3a39" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to STAC catalog</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    catalog <span class="op">=</span> Client.<span class="bu">open</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://planetarycomputer.microsoft.com/api/stac/v1"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        modifier<span class="op">=</span>pc.sign_inplace</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Connected to Planetary Computer STAC API"</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get catalog information</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        catalog_info <span class="op">=</span> catalog.get_self()</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Catalog: </span><span class="sc">{</span>catalog_info<span class="sc">.</span>title<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="st">"Basic connection successful"</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Explore key satellite datasets</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    satellite_collections <span class="op">=</span> {</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sentinel-2-l2a'</span>: <span class="st">'Sentinel-2 Level 2A (10m optical)'</span>,</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'landsat-c2-l2'</span>: <span class="st">'Landsat Collection 2 Level 2 (30m optical)'</span>,</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sentinel-1-grd'</span>: <span class="st">'Sentinel-1 SAR (radar)'</span>,</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'naip'</span>: <span class="st">'NAIP (1m aerial imagery)'</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    available_collections <span class="op">=</span> []</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> collection_id, description <span class="kw">in</span> satellite_collections.items():</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>            collection <span class="op">=</span> catalog.get_collection(collection_id)</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>            available_collections.append(collection_id)</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"Available: </span><span class="sc">{</span>description<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>            logger.warning(<span class="ss">f"Not accessible: </span><span class="sc">{</span>description<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Accessible collections: </span><span class="sc">{</span><span class="bu">len</span>(available_collections)<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(satellite_collections)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>    logger.error(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">❌ STAC connection failed: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🔧 Troubleshooting steps:"</span>)</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"   1. Verify internet connectivity"</span>)</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"   2. Check Planetary Computer API status: https://planetarycomputer.microsoft.com/"</span>)</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"   3. Ensure pystac-client is installed: pip install pystac-client"</span>)</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"   4. Verify planetary-computer package: pip install planetary-computer"</span>)</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"   5. Try again in a few minutes (temporary API issues)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:03:20,688 - INFO - Connected to Planetary Computer STAC API
2025-10-09 11:03:20,690 - INFO - Basic connection successful
2025-10-09 11:03:21,929 - INFO - Available: Sentinel-2 Level 2A (10m optical)
2025-10-09 11:03:22,137 - INFO - Available: Landsat Collection 2 Level 2 (30m optical)
2025-10-09 11:03:22,456 - INFO - Available: Sentinel-1 SAR (radar)
2025-10-09 11:03:22,667 - INFO - Available: NAIP (1m aerial imagery)
2025-10-09 11:03:22,669 - INFO - Accessible collections: 4/4</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="connection-troubleshooting" class="level2">
<h2 class="anchored" data-anchor-id="connection-troubleshooting">Connection Troubleshooting</h2>
<p>If you encounter connection issues, first verify your internet connectivity and check your firewall settings. Keep in mind that anonymous users have lower API rate limits than authenticated users, which can also cause problems. You should also check the <a href="https://planetarycomputer.microsoft.com/">Planetary Computer status page</a> to see if there are any ongoing outages. Finally, make sure you have the latest versions of both the <code>pystac-client</code> and <code>planetary-computer</code> packages installed.</p>
<p>The connection process demonstrates real-world challenges in building production geospatial systems.</p>
<section id="understanding-collection-metadata-and-selection-criteria" class="level3">
<h3 class="anchored" data-anchor-id="understanding-collection-metadata-and-selection-criteria">Understanding Collection Metadata and Selection Criteria</h3>
<p>Each STAC collection contains rich metadata that helps you choose the right dataset for your analysis. Let’s explore how to make informed decisions about which satellite data to use:</p>
<hr>
</section>
</section>
<section id="spatial-analysis-design---defining-areas-of-interest" class="level2">
<h2 class="anchored" data-anchor-id="spatial-analysis-design---defining-areas-of-interest">4. Spatial Analysis Design - Defining Areas of Interest</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you will be able to understand coordinate systems and bounding box conventions in geospatial analysis, design effective study areas based on analysis objectives and data characteristics, create interactive maps for spatial context and validation, and apply best practices for reproducible spatial analysis workflows.</p>
</div>
</div>
<section id="the-art-and-science-of-spatial-scope-definition" class="level3">
<h3 class="anchored" data-anchor-id="the-art-and-science-of-spatial-scope-definition">The Art and Science of Spatial Scope Definition</h3>
<p>Defining your Area of Interest (AOI) is a critical design decision that influences several aspects of your analysis. The size of the area determines the amount of data you need to process and store. The validity of your analysis depends on how well your study boundaries align with relevant ecological or administrative regions. The location of your AOI affects satellite revisit patterns and data availability, and the way you define your area can impact processing efficiency, such as the choice of optimal tile sizes for your workflow.</p>
<section id="coordinate-systems-and-bounding-box-conventions" class="level4">
<h4 class="anchored" data-anchor-id="coordinate-systems-and-bounding-box-conventions">Coordinate Systems and Bounding Box Conventions</h4>
<p>For our AOI definition, we will use the WGS84 geographic coordinate system (EPSG:4326). In this system, longitude (X) represents the east-west position and ranges from -180° to +180°, with negative values indicating west. Latitude (Y) represents the north-south position and ranges from -90° to +90°, with negative values indicating south. Bounding boxes are formatted as [west, south, east, north], corresponding to (min_x, min_y, max_x, max_y).</p>
</section>
<section id="study-area-selection-santa-barbara-region" class="level4">
<h4 class="anchored" data-anchor-id="study-area-selection-santa-barbara-region">Study Area Selection: Santa Barbara Region</h4>
<p>We’ll use the Santa Barbara region as our exemplar study region because it features a diverse mix of coastal, urban, mountainous, and agricultural environments. The region is characterized by dynamic processes such as coastal dynamics, wildfire activity, vegetation changes, and urban-wildland interface transitions. It also benefits from frequent satellite coverage and presents geographic complexity, including the Santa Ynez Mountains, Channel Islands, agricultural valleys, and varied coastal ecosystems.</p>
<p><strong>Designing Area of Interest (AOI) for Geospatial Analysis</strong></p>
<p>This demonstrates spatial scope definition for satellite-based studies. We’ll work with the Santa Barbara region as our primary study area.</p>
<div id="11af8eda" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3A: Define Area of Interest with Geographic Reasoning</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Primary study area: Santa Barbara Region</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinates chosen to encompass the greater Santa Barbara County coastal region</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>santa_barbara_bbox <span class="op">=</span> [<span class="op">-</span><span class="fl">120.5</span>, <span class="fl">34.3</span>, <span class="op">-</span><span class="fl">119.5</span>, <span class="fl">34.7</span>]  <span class="co"># [west, south, east, north]</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Import required libraries for spatial calculations</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create geometry object for area calculations</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>aoi_geom <span class="op">=</span> box(<span class="op">*</span>santa_barbara_bbox)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate basic spatial metrics</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>area_degrees <span class="op">=</span> aoi_geom.area</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Approximate conversion to kilometers (valid for mid-latitudes)</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>center_lat <span class="op">=</span> (santa_barbara_bbox[<span class="dv">1</span>] <span class="op">+</span> santa_barbara_bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>lat_correction <span class="op">=</span> np.cos(np.radians(center_lat))</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>area_km2 <span class="op">=</span> area_degrees <span class="op">*</span> (<span class="fl">111.32</span> <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> lat_correction  <span class="co"># 1 degree ≈ 111.32 km</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">📊 AOI Spatial Characteristics:"</span>)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"   📍 Region: Santa Barbara County Coastal Region"</span>)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"   🗺️ Bounding box: </span><span class="sc">{</span>santa_barbara_bbox<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"   📐 Dimensions: </span><span class="sc">{</span>(santa_barbara_bbox[<span class="dv">2</span>] <span class="op">-</span> santa_barbara_bbox[<span class="dv">0</span>])<span class="sc">:.2f}</span><span class="ss">° × </span><span class="sc">{</span>(santa_barbara_bbox[<span class="dv">3</span>] <span class="op">-</span> santa_barbara_bbox[<span class="dv">1</span>])<span class="sc">:.2f}</span><span class="ss">°"</span>)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"   📏 Approximate area: </span><span class="sc">{</span>area_km2<span class="sc">:.0f}</span><span class="ss"> km²"</span>)</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"   🏙️ Population: ~450,000 (Santa Barbara County)"</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Provide alternative study areas for different research interests</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🌐 Alternative AOI Options for Different Study Objectives:"</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>alternative_aois <span class="op">=</span> {</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"San Francisco Bay Area"</span>: {</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: [<span class="op">-</span><span class="fl">122.5</span>, <span class="fl">37.3</span>, <span class="op">-</span><span class="fl">121.8</span>, <span class="fl">38.0</span>],</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"focus"</span>: <span class="st">"Urban growth, water dynamics, mixed land use"</span>,</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"challenges"</span>: <span class="st">"Fog and cloud cover in summer"</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Los Angeles Basin"</span>: {</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: [<span class="op">-</span><span class="fl">118.7</span>, <span class="fl">33.7</span>, <span class="op">-</span><span class="fl">118.1</span>, <span class="fl">34.3</span>],</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"focus"</span>: <span class="st">"Urban heat islands, air quality, sprawl patterns"</span>,</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">"challenges"</span>: <span class="st">"Frequent clouds, complex topography"</span></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Central Valley Agriculture"</span>: {</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: [<span class="op">-</span><span class="fl">121.5</span>, <span class="fl">36.0</span>, <span class="op">-</span><span class="fl">120.0</span>, <span class="fl">37.5</span>],</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">"focus"</span>: <span class="st">"Crop monitoring, irrigation patterns, drought"</span>,</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">"challenges"</span>: <span class="st">"Seasonal variations, haze"</span></span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Channel Islands"</span>: {</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: [<span class="op">-</span><span class="fl">120.5</span>, <span class="fl">33.9</span>, <span class="op">-</span><span class="fl">119.0</span>, <span class="fl">34.1</span>],</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">"focus"</span>: <span class="st">"Island ecology, marine-terrestrial interface, conservation"</span>,</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"challenges"</span>: <span class="st">"Marine layer, limited ground truth"</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region, info <span class="kw">in</span> alternative_aois.items():</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>    bbox <span class="op">=</span> info[<span class="st">"bbox"</span>]</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>    area_alt <span class="op">=</span> ((bbox[<span class="dv">2</span>] <span class="op">-</span> bbox[<span class="dv">0</span>]) <span class="op">*</span> (bbox[<span class="dv">3</span>] <span class="op">-</span> bbox[<span class="dv">1</span>]) <span class="op">*</span></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>                (<span class="fl">111.32</span> <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> np.cos(np.radians((bbox[<span class="dv">1</span>] <span class="op">+</span> bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span>)))</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"   🗺️ </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>info[<span class="st">'bbox'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>area_alt<span class="sc">:.0f}</span><span class="ss"> km²)"</span>)</span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"      🎯 Research focus: </span><span class="sc">{</span>info[<span class="st">'focus'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"      ⚠️ Considerations: </span><span class="sc">{</span>info[<span class="st">'challenges'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">💡 Pro Tip: Choose AOI based on:"</span>)</span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"   1. Research objectives and required spatial resolution"</span>)</span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"   2. Data availability and typical cloud cover patterns"</span>)</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"   3. Computational resources and processing time constraints"</span>)</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"   4. Ecological or administrative boundary alignment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:03:22,688 - INFO - 
📊 AOI Spatial Characteristics:
2025-10-09 11:03:22,689 - INFO -    📍 Region: Santa Barbara County Coastal Region
2025-10-09 11:03:22,689 - INFO -    🗺️ Bounding box: [-120.5, 34.3, -119.5, 34.7]
2025-10-09 11:03:22,690 - INFO -    📐 Dimensions: 1.00° × 0.40°
2025-10-09 11:03:22,690 - INFO -    📏 Approximate area: 4085 km²
2025-10-09 11:03:22,691 - INFO -    🏙️ Population: ~450,000 (Santa Barbara County)
2025-10-09 11:03:22,692 - INFO - 
🌐 Alternative AOI Options for Different Study Objectives:
2025-10-09 11:03:22,692 - INFO -    🗺️ San Francisco Bay Area: [-122.5, 37.3, -121.8, 38.0] (4808 km²)
2025-10-09 11:03:22,693 - INFO -       🎯 Research focus: Urban growth, water dynamics, mixed land use
2025-10-09 11:03:22,694 - INFO -       ⚠️ Considerations: Fog and cloud cover in summer
2025-10-09 11:03:22,694 - INFO -    🗺️ Los Angeles Basin: [-118.7, 33.7, -118.1, 34.3] (3698 km²)
2025-10-09 11:03:22,695 - INFO -       🎯 Research focus: Urban heat islands, air quality, sprawl patterns
2025-10-09 11:03:22,695 - INFO -       ⚠️ Considerations: Frequent clouds, complex topography
2025-10-09 11:03:22,695 - INFO -    🗺️ Central Valley Agriculture: [-121.5, 36.0, -120.0, 37.5] (22341 km²)
2025-10-09 11:03:22,696 - INFO -       🎯 Research focus: Crop monitoring, irrigation patterns, drought
2025-10-09 11:03:22,696 - INFO -       ⚠️ Considerations: Seasonal variations, haze
2025-10-09 11:03:22,696 - INFO -    🗺️ Channel Islands: [-120.5, 33.9, -119.0, 34.1] (3082 km²)
2025-10-09 11:03:22,697 - INFO -       🎯 Research focus: Island ecology, marine-terrestrial interface, conservation
2025-10-09 11:03:22,697 - INFO -       ⚠️ Considerations: Marine layer, limited ground truth
2025-10-09 11:03:22,698 - INFO - 
💡 Pro Tip: Choose AOI based on:
2025-10-09 11:03:22,698 - INFO -    1. Research objectives and required spatial resolution
2025-10-09 11:03:22,699 - INFO -    2. Data availability and typical cloud cover patterns
2025-10-09 11:03:22,699 - INFO -    3. Computational resources and processing time constraints
2025-10-09 11:03:22,699 - INFO -    4. Ecological or administrative boundary alignment</code></pre>
</div>
</div>
</section>
<section id="interactive-mapping-for-spatial-context-and-validation" class="level4">
<h4 class="anchored" data-anchor-id="interactive-mapping-for-spatial-context-and-validation">Interactive Mapping for Spatial Context and Validation</h4>
<p>Creating interactive maps serves several important purposes in geospatial analysis, such as providing spatial context to understand the geographic setting and features, validating that the area of interest (AOI) encompasses the intended study features, supporting stakeholder communication through visual representation for project discussions, and enabling quality assurance by helping to detect coordinate errors or unrealistic extents.</p>
<p><strong>Creating Interactive Map for Spatial Context:</strong></p>
<p>This demonstrates best practices for geospatial visualization with multiple basemap options.</p>
<div id="f357fc4a" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3B: Create Interactive Map with Multiple Basemap Options</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate map center for optimal display</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>center_lat <span class="op">=</span> (santa_barbara_bbox[<span class="dv">1</span>] <span class="op">+</span> santa_barbara_bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>center_lon <span class="op">=</span> (santa_barbara_bbox[<span class="dv">0</span>] <span class="op">+</span> santa_barbara_bbox[<span class="dv">2</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize folium map with appropriate zoom level</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Zoom level chosen to show entire AOI while maintaining detail</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    location<span class="op">=</span>[center_lat, center_lon],</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    zoom_start<span class="op">=</span><span class="dv">9</span>,  <span class="co"># Optimal for metropolitan area viewing</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    tiles<span class="op">=</span><span class="st">'OpenStreetMap'</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add diverse basemap options for different analysis contexts</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>basemap_options <span class="op">=</span> {</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CartoDB positron'</span>: {</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'layer'</span>: folium.TileLayer(<span class="st">'CartoDB positron'</span>, name<span class="op">=</span><span class="st">'Clean Basemap'</span>),</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'use_case'</span>: <span class="st">'Data overlay visualization, presentations'</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CartoDB dark_matter'</span>: {</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'layer'</span>: folium.TileLayer(<span class="st">'CartoDB dark_matter'</span>, name<span class="op">=</span><span class="st">'Dark Theme'</span>),</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'use_case'</span>: <span class="st">'Night mode, reducing eye strain'</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Esri World Imagery'</span>: {</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'layer'</span>: folium.TileLayer(</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>            tiles<span class="op">=</span><span class="st">'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">'</span>,</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>            attr<span class="op">=</span><span class="st">'Esri'</span>, name<span class="op">=</span><span class="st">'Satellite Imagery'</span>, overlay<span class="op">=</span><span class="va">False</span>, control<span class="op">=</span><span class="va">True</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'use_case'</span>: <span class="st">'Ground truth validation, visual interpretation'</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'OpenTopoMap'</span>: {</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">'layer'</span>: folium.TileLayer(</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>            tiles<span class="op">=</span><span class="st">'https://</span><span class="sc">{s}</span><span class="st">.tile.opentopomap.org/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">.png'</span>,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">'Topographic (OpenTopoMap)'</span>,</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>            attr<span class="op">=</span><span class="st">'Map data: © OpenStreetMap contributors, SRTM | Map style: © OpenTopoMap (CC-BY-SA)'</span>,</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>            overlay<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>            control<span class="op">=</span><span class="va">True</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">'use_case'</span>: <span class="st">'Elevation context, watershed analysis'</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"   📚 Adding </span><span class="sc">{</span><span class="bu">len</span>(basemap_options)<span class="sc">}</span><span class="ss"> basemap options:"</span>)</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, info <span class="kw">in</span> basemap_options.items():</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>    info[<span class="st">'layer'</span>].add_to(m)</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"     • </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>info[<span class="st">'use_case'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Add AOI boundary with informative styling</span></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>aoi_bounds <span class="op">=</span> [[santa_barbara_bbox[<span class="dv">1</span>], santa_barbara_bbox[<span class="dv">0</span>]],  <span class="co"># southwest corner</span></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>              [santa_barbara_bbox[<span class="dv">3</span>], santa_barbara_bbox[<span class="dv">2</span>]]]  <span class="co"># northeast corner</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>folium.Rectangle(</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>    bounds<span class="op">=</span>aoi_bounds,</span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>    weight<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>    fillOpacity<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>    popup<span class="op">=</span>folium.Popup(</span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"""</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div style="font-family: Arial; width: 300px;"&gt;</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;h4&gt;📊 Study Area Details&lt;/h4&gt;</span></span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Region:&lt;/b&gt; Santa Barbara County Coastal Region&lt;br&gt;</span></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Coordinates:&lt;/b&gt; </span><span class="sc">{</span>santa_barbara_bbox<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Area:&lt;/b&gt; </span><span class="sc">{</span>area_km2<span class="sc">:.0f}</span><span class="ss"> km²&lt;br&gt;</span></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Purpose:&lt;/b&gt; Geospatial AI Training&lt;br&gt;</span></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Data Type:&lt;/b&gt; Sentinel-2 Optical&lt;br&gt;</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a><span class="ss">        """</span>,</span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>        max_width<span class="op">=</span><span class="dv">350</span></span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span><span class="st">"Study Area Boundary - Click for details"</span></span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a>).add_to(m)</span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Add geographic reference points with contextual information</span></span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>reference_locations <span class="op">=</span> [</span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Santa Barbara"</span>,</span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">"coords"</span>: [<span class="fl">34.4208</span>, <span class="op">-</span><span class="fl">119.6982</span>],</span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Coastal city, urban-wildland interface"</span>,</span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">"icon"</span>: <span class="st">"building"</span>,</span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"blue"</span></span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"UCSB"</span>,</span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">"coords"</span>: [<span class="fl">34.4140</span>, <span class="op">-</span><span class="fl">119.8489</span>],</span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"University campus, research facilities"</span>,</span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a>        <span class="st">"icon"</span>: <span class="st">"graduation-cap"</span>,</span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"green"</span></span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Goleta"</span>,</span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a>        <span class="st">"coords"</span>: [<span class="fl">34.4358</span>, <span class="op">-</span><span class="fl">119.8276</span>],</span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Tech corridor, agricultural transition zone"</span>,</span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">"icon"</span>: <span class="st">"microchip"</span>,</span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"purple"</span></span>
<span id="cb36-96"><a href="#cb36-96" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Montecito"</span>,</span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">"coords"</span>: [<span class="fl">34.4358</span>, <span class="op">-</span><span class="fl">119.6376</span>],</span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Wildfire-prone, high-value urban area"</span>,</span>
<span id="cb36-101"><a href="#cb36-101" aria-hidden="true" tabindex="-1"></a>        <span class="st">"icon"</span>: <span class="st">"fire"</span>,</span>
<span id="cb36-102"><a href="#cb36-102" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"red"</span></span>
<span id="cb36-103"><a href="#cb36-103" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-104"><a href="#cb36-104" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb36-105"><a href="#cb36-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-106"><a href="#cb36-106" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Adding </span><span class="sc">{</span><span class="bu">len</span>(reference_locations)<span class="sc">}</span><span class="ss"> geographic reference points"</span>)</span>
<span id="cb36-107"><a href="#cb36-107" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> location <span class="kw">in</span> reference_locations:</span>
<span id="cb36-108"><a href="#cb36-108" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"</span><span class="sc">{</span>location[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>location[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-109"><a href="#cb36-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-110"><a href="#cb36-110" aria-hidden="true" tabindex="-1"></a>    folium.Marker(</span>
<span id="cb36-111"><a href="#cb36-111" aria-hidden="true" tabindex="-1"></a>        location<span class="op">=</span>location[<span class="st">"coords"</span>],</span>
<span id="cb36-112"><a href="#cb36-112" aria-hidden="true" tabindex="-1"></a>        popup<span class="op">=</span>folium.Popup(</span>
<span id="cb36-113"><a href="#cb36-113" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"""</span></span>
<span id="cb36-114"><a href="#cb36-114" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div style="font-family: Arial;"&gt;</span></span>
<span id="cb36-115"><a href="#cb36-115" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;h4&gt;</span><span class="sc">{</span>location[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">&lt;/h4&gt;</span></span>
<span id="cb36-116"><a href="#cb36-116" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;b&gt;Coordinates:&lt;/b&gt; </span><span class="sc">{</span>location[<span class="st">'coords'</span>][<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>location[<span class="st">'coords'</span>][<span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb36-117"><a href="#cb36-117" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;b&gt;Context:&lt;/b&gt; </span><span class="sc">{</span>location[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb36-118"><a href="#cb36-118" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;b&gt;Role in Analysis:&lt;/b&gt; Geographic reference point</span></span>
<span id="cb36-119"><a href="#cb36-119" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb36-120"><a href="#cb36-120" aria-hidden="true" tabindex="-1"></a><span class="ss">            """</span>,</span>
<span id="cb36-121"><a href="#cb36-121" aria-hidden="true" tabindex="-1"></a>            max_width<span class="op">=</span><span class="dv">250</span></span>
<span id="cb36-122"><a href="#cb36-122" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb36-123"><a href="#cb36-123" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>location[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>location[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb36-124"><a href="#cb36-124" aria-hidden="true" tabindex="-1"></a>        icon<span class="op">=</span>folium.Icon(</span>
<span id="cb36-125"><a href="#cb36-125" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span>location[<span class="st">'color'</span>],</span>
<span id="cb36-126"><a href="#cb36-126" aria-hidden="true" tabindex="-1"></a>            icon<span class="op">=</span>location[<span class="st">'icon'</span>],</span>
<span id="cb36-127"><a href="#cb36-127" aria-hidden="true" tabindex="-1"></a>            prefix<span class="op">=</span><span class="st">'fa'</span></span>
<span id="cb36-128"><a href="#cb36-128" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb36-129"><a href="#cb36-129" aria-hidden="true" tabindex="-1"></a>    ).add_to(m)</span>
<span id="cb36-130"><a href="#cb36-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-131"><a href="#cb36-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Add measurement and interaction tools for analysis</span></span>
<span id="cb36-132"><a href="#cb36-132" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Adding interactive analysis tools"</span>)</span>
<span id="cb36-133"><a href="#cb36-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-134"><a href="#cb36-134" aria-hidden="true" tabindex="-1"></a><span class="co"># Measurement tool for distance/area calculations</span></span>
<span id="cb36-135"><a href="#cb36-135" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium.plugins <span class="im">import</span> MeasureControl</span>
<span id="cb36-136"><a href="#cb36-136" aria-hidden="true" tabindex="-1"></a>measure_control <span class="op">=</span> MeasureControl(</span>
<span id="cb36-137"><a href="#cb36-137" aria-hidden="true" tabindex="-1"></a>    primary_length_unit<span class="op">=</span><span class="st">'kilometers'</span>,</span>
<span id="cb36-138"><a href="#cb36-138" aria-hidden="true" tabindex="-1"></a>    primary_area_unit<span class="op">=</span><span class="st">'sqkilometers'</span>,</span>
<span id="cb36-139"><a href="#cb36-139" aria-hidden="true" tabindex="-1"></a>    secondary_length_unit<span class="op">=</span><span class="st">'miles'</span>,</span>
<span id="cb36-140"><a href="#cb36-140" aria-hidden="true" tabindex="-1"></a>    secondary_area_unit<span class="op">=</span><span class="st">'sqmiles'</span></span>
<span id="cb36-141"><a href="#cb36-141" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-142"><a href="#cb36-142" aria-hidden="true" tabindex="-1"></a>m.add_child(measure_control)</span>
<span id="cb36-143"><a href="#cb36-143" aria-hidden="true" tabindex="-1"></a>logger.debug(<span class="st">"Added measurement tool for distance/area calculations"</span>)</span>
<span id="cb36-144"><a href="#cb36-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-145"><a href="#cb36-145" aria-hidden="true" tabindex="-1"></a><span class="co"># Fullscreen capability for detailed examination</span></span>
<span id="cb36-146"><a href="#cb36-146" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium.plugins <span class="im">import</span> Fullscreen</span>
<span id="cb36-147"><a href="#cb36-147" aria-hidden="true" tabindex="-1"></a>Fullscreen(</span>
<span id="cb36-148"><a href="#cb36-148" aria-hidden="true" tabindex="-1"></a>    position<span class="op">=</span><span class="st">'topright'</span>,</span>
<span id="cb36-149"><a href="#cb36-149" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Full Screen Mode'</span>,</span>
<span id="cb36-150"><a href="#cb36-150" aria-hidden="true" tabindex="-1"></a>    title_cancel<span class="op">=</span><span class="st">'Exit Full Screen'</span>,</span>
<span id="cb36-151"><a href="#cb36-151" aria-hidden="true" tabindex="-1"></a>    force_separate_button<span class="op">=</span><span class="va">True</span></span>
<span id="cb36-152"><a href="#cb36-152" aria-hidden="true" tabindex="-1"></a>).add_to(m)</span>
<span id="cb36-153"><a href="#cb36-153" aria-hidden="true" tabindex="-1"></a>logger.debug(<span class="st">"Added fullscreen mode capability"</span>)</span>
<span id="cb36-154"><a href="#cb36-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-155"><a href="#cb36-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Layer control for basemap switching</span></span>
<span id="cb36-156"><a href="#cb36-156" aria-hidden="true" tabindex="-1"></a>layer_control <span class="op">=</span> folium.LayerControl(</span>
<span id="cb36-157"><a href="#cb36-157" aria-hidden="true" tabindex="-1"></a>    position<span class="op">=</span><span class="st">'topright'</span>,</span>
<span id="cb36-158"><a href="#cb36-158" aria-hidden="true" tabindex="-1"></a>    collapsed<span class="op">=</span><span class="va">False</span></span>
<span id="cb36-159"><a href="#cb36-159" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-160"><a href="#cb36-160" aria-hidden="true" tabindex="-1"></a>layer_control.add_to(m)</span>
<span id="cb36-161"><a href="#cb36-161" aria-hidden="true" tabindex="-1"></a>logger.debug(<span class="st">"Added layer control for basemap switching"</span>)</span>
<span id="cb36-162"><a href="#cb36-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-163"><a href="#cb36-163" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Interactive map created with comprehensive spatial context"</span>)</span>
<span id="cb36-164"><a href="#cb36-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-165"><a href="#cb36-165" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the map</span></span>
<span id="cb36-166"><a href="#cb36-166" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:03:22,729 - INFO -    📚 Adding 4 basemap options:
2025-10-09 11:03:22,730 - INFO -      • CartoDB positron: Data overlay visualization, presentations
2025-10-09 11:03:22,730 - INFO -      • CartoDB dark_matter: Night mode, reducing eye strain
2025-10-09 11:03:22,730 - INFO -      • Esri World Imagery: Ground truth validation, visual interpretation
2025-10-09 11:03:22,731 - INFO -      • OpenTopoMap: Elevation context, watershed analysis
2025-10-09 11:03:22,731 - INFO - Adding 4 geographic reference points
2025-10-09 11:03:22,732 - INFO - Adding interactive analysis tools
2025-10-09 11:03:22,733 - INFO - Interactive map created with comprehensive spatial context</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div style="width:100%;"><div style="position:relative;width:100%;height:0;padding-bottom:60%;"><span style="color:#565656">Make this Notebook Trusted to load map: File -&gt; Trust Notebook</span><iframe srcdoc="<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; />
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;></script>
    <script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;></script>
    <script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;></script>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/>
    
            <meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; />
            <style>
                #map_e13b6e6874759c95c9fb242b7ff6e952 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>

            <style>html, body {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            </style>

            <style>#map {
                position:absolute;
                top:0;
                bottom:0;
                right:0;
                left:0;
                }
            </style>

            <script>
                L_NO_TOUCH = false;
                L_DISABLE_3D = false;
            </script>

        
    <script src=&quot;https://cdn.jsdelivr.net/gh/ljagis/leaflet-measure@2.1.7/dist/leaflet-measure.min.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/ljagis/leaflet-measure@2.1.7/dist/leaflet-measure.min.css&quot;/>
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.min.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.css&quot;/>
</head>
<body>
    
    
            <div class=&quot;folium-map&quot; id=&quot;map_e13b6e6874759c95c9fb242b7ff6e952&quot; ></div>
        
</body>
<script>
    
    
            var map_e13b6e6874759c95c9fb242b7ff6e952 = L.map(
                &quot;map_e13b6e6874759c95c9fb242b7ff6e952&quot;,
                {
                    center: [34.5, -120.0],
                    crs: L.CRS.EPSG3857,
                    ...{
  &quot;zoom&quot;: 9,
  &quot;zoomControl&quot;: true,
  &quot;preferCanvas&quot;: false,
}

                }
            );

            

        
    
            var tile_layer_8e1d81440cee40b238cda6af49d0bdf8 = L.tileLayer(
                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {
  &quot;minZoom&quot;: 0,
  &quot;maxZoom&quot;: 19,
  &quot;maxNativeZoom&quot;: 19,
  &quot;noWrap&quot;: false,
  &quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors&quot;,
  &quot;subdomains&quot;: &quot;abc&quot;,
  &quot;detectRetina&quot;: false,
  &quot;tms&quot;: false,
  &quot;opacity&quot;: 1,
}

            );
        
    
            tile_layer_8e1d81440cee40b238cda6af49d0bdf8.addTo(map_e13b6e6874759c95c9fb242b7ff6e952);
        
    
            var tile_layer_7746e86648feee38c0cffc7eec9ea228 = L.tileLayer(
                &quot;https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png&quot;,
                {
  &quot;minZoom&quot;: 0,
  &quot;maxZoom&quot;: 20,
  &quot;maxNativeZoom&quot;: 20,
  &quot;noWrap&quot;: false,
  &quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors \u0026copy; \u003ca href=\&quot;https://carto.com/attributions\&quot;\u003eCARTO\u003c/a\u003e&quot;,
  &quot;subdomains&quot;: &quot;abcd&quot;,
  &quot;detectRetina&quot;: false,
  &quot;tms&quot;: false,
  &quot;opacity&quot;: 1,
}

            );
        
    
            tile_layer_7746e86648feee38c0cffc7eec9ea228.addTo(map_e13b6e6874759c95c9fb242b7ff6e952);
        
    
            var tile_layer_f73e9195a00a11114006b92dc07d9745 = L.tileLayer(
                &quot;https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png&quot;,
                {
  &quot;minZoom&quot;: 0,
  &quot;maxZoom&quot;: 20,
  &quot;maxNativeZoom&quot;: 20,
  &quot;noWrap&quot;: false,
  &quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors \u0026copy; \u003ca href=\&quot;https://carto.com/attributions\&quot;\u003eCARTO\u003c/a\u003e&quot;,
  &quot;subdomains&quot;: &quot;abcd&quot;,
  &quot;detectRetina&quot;: false,
  &quot;tms&quot;: false,
  &quot;opacity&quot;: 1,
}

            );
        
    
            tile_layer_f73e9195a00a11114006b92dc07d9745.addTo(map_e13b6e6874759c95c9fb242b7ff6e952);
        
    
            var tile_layer_cec0b863a8382f8d3a1f1bdb67e2c261 = L.tileLayer(
                &quot;https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}&quot;,
                {
  &quot;minZoom&quot;: 0,
  &quot;maxZoom&quot;: 18,
  &quot;maxNativeZoom&quot;: 18,
  &quot;noWrap&quot;: false,
  &quot;attribution&quot;: &quot;Esri&quot;,
  &quot;subdomains&quot;: &quot;abc&quot;,
  &quot;detectRetina&quot;: false,
  &quot;tms&quot;: false,
  &quot;opacity&quot;: 1,
}

            );
        
    
            tile_layer_cec0b863a8382f8d3a1f1bdb67e2c261.addTo(map_e13b6e6874759c95c9fb242b7ff6e952);
        
    
            var tile_layer_0b72e93d4c40290c8ffdebc39bb0d575 = L.tileLayer(
                &quot;https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png&quot;,
                {
  &quot;minZoom&quot;: 0,
  &quot;maxZoom&quot;: 18,
  &quot;maxNativeZoom&quot;: 18,
  &quot;noWrap&quot;: false,
  &quot;attribution&quot;: &quot;Map data: \u00a9 OpenStreetMap contributors, SRTM | Map style: \u00a9 OpenTopoMap (CC-BY-SA)&quot;,
  &quot;subdomains&quot;: &quot;abc&quot;,
  &quot;detectRetina&quot;: false,
  &quot;tms&quot;: false,
  &quot;opacity&quot;: 1,
}

            );
        
    
            tile_layer_0b72e93d4c40290c8ffdebc39bb0d575.addTo(map_e13b6e6874759c95c9fb242b7ff6e952);
        
    
            var rectangle_7c9901f69081f7801ff14b3c906e4207 = L.rectangle(
                [[34.3, -120.5], [34.7, -119.5]],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;red&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;red&quot;, &quot;fillOpacity&quot;: 0.1, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;noClip&quot;: false, &quot;opacity&quot;: 1.0, &quot;smoothFactor&quot;: 1.0, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_e13b6e6874759c95c9fb242b7ff6e952);
        
    
        var popup_5f9fb566418a743cd0f944cd0232f5e0 = L.popup({
  &quot;maxWidth&quot;: 350,
});

        
            
                var html_f24b3c73796565e8c0ee44451e1799c3 = $(`<div id=&quot;html_f24b3c73796565e8c0ee44451e1799c3&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>         <div style=&quot;font-family: Arial; width: 300px;&quot;>         <h4>📊 Study Area Details</h4>         <b>Region:</b> Santa Barbara County Coastal Region<br>         <b>Coordinates:</b> [-120.5, 34.3, -119.5, 34.7]<br>         <b>Area:</b> 4085 km²<br>         <b>Purpose:</b> Geospatial AI Training<br>         <b>Data Type:</b> Sentinel-2 Optical<br>         </div>         </div>`)[0];
                popup_5f9fb566418a743cd0f944cd0232f5e0.setContent(html_f24b3c73796565e8c0ee44451e1799c3);
            
        

        rectangle_7c9901f69081f7801ff14b3c906e4207.bindPopup(popup_5f9fb566418a743cd0f944cd0232f5e0)
        ;

        
    
    
            rectangle_7c9901f69081f7801ff14b3c906e4207.bindTooltip(
                `<div>
                     Study Area Boundary - Click for details
                 </div>`,
                {
  &quot;sticky&quot;: true,
}
            );
        
    
            var marker_8e309ae471ec813e73a3c2ef4898bfff = L.marker(
                [34.4208, -119.6982],
                {
}
            ).addTo(map_e13b6e6874759c95c9fb242b7ff6e952);
        
    
            var icon_ce384a755929f43213921f8f02efddc3 = L.AwesomeMarkers.icon(
                {
  &quot;markerColor&quot;: &quot;blue&quot;,
  &quot;iconColor&quot;: &quot;white&quot;,
  &quot;icon&quot;: &quot;building&quot;,
  &quot;prefix&quot;: &quot;fa&quot;,
  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,
}
            );
        
    
        var popup_c1e85447bb3fba743993463bf42b4018 = L.popup({
  &quot;maxWidth&quot;: 250,
});

        
            
                var html_389492ab6c462692df46934c26c7ab95 = $(`<div id=&quot;html_389492ab6c462692df46934c26c7ab95&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>             <div style=&quot;font-family: Arial;&quot;>             <h4>Santa Barbara</h4>             <b>Coordinates:</b> 34.4208, -119.6982<br>             <b>Context:</b> Coastal city, urban-wildland interface<br>             <b>Role in Analysis:</b> Geographic reference point             </div>             </div>`)[0];
                popup_c1e85447bb3fba743993463bf42b4018.setContent(html_389492ab6c462692df46934c26c7ab95);
            
        

        marker_8e309ae471ec813e73a3c2ef4898bfff.bindPopup(popup_c1e85447bb3fba743993463bf42b4018)
        ;

        
    
    
            marker_8e309ae471ec813e73a3c2ef4898bfff.bindTooltip(
                `<div>
                     Santa Barbara - Coastal city, urban-wildland interface
                 </div>`,
                {
  &quot;sticky&quot;: true,
}
            );
        
    
                marker_8e309ae471ec813e73a3c2ef4898bfff.setIcon(icon_ce384a755929f43213921f8f02efddc3);
            
    
            var marker_5cfacc8d5b1142ee66bfff0cd34d2d60 = L.marker(
                [34.414, -119.8489],
                {
}
            ).addTo(map_e13b6e6874759c95c9fb242b7ff6e952);
        
    
            var icon_e737ec495a561bcc0fa429413bd3e6df = L.AwesomeMarkers.icon(
                {
  &quot;markerColor&quot;: &quot;green&quot;,
  &quot;iconColor&quot;: &quot;white&quot;,
  &quot;icon&quot;: &quot;graduation-cap&quot;,
  &quot;prefix&quot;: &quot;fa&quot;,
  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,
}
            );
        
    
        var popup_cd74560a7282a5c3d2318cd65a693924 = L.popup({
  &quot;maxWidth&quot;: 250,
});

        
            
                var html_dc37b7d8702ac85d78f204755498fad3 = $(`<div id=&quot;html_dc37b7d8702ac85d78f204755498fad3&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>             <div style=&quot;font-family: Arial;&quot;>             <h4>UCSB</h4>             <b>Coordinates:</b> 34.4140, -119.8489<br>             <b>Context:</b> University campus, research facilities<br>             <b>Role in Analysis:</b> Geographic reference point             </div>             </div>`)[0];
                popup_cd74560a7282a5c3d2318cd65a693924.setContent(html_dc37b7d8702ac85d78f204755498fad3);
            
        

        marker_5cfacc8d5b1142ee66bfff0cd34d2d60.bindPopup(popup_cd74560a7282a5c3d2318cd65a693924)
        ;

        
    
    
            marker_5cfacc8d5b1142ee66bfff0cd34d2d60.bindTooltip(
                `<div>
                     UCSB - University campus, research facilities
                 </div>`,
                {
  &quot;sticky&quot;: true,
}
            );
        
    
                marker_5cfacc8d5b1142ee66bfff0cd34d2d60.setIcon(icon_e737ec495a561bcc0fa429413bd3e6df);
            
    
            var marker_79eeb64117282214cbcbdfeec1b334d8 = L.marker(
                [34.4358, -119.8276],
                {
}
            ).addTo(map_e13b6e6874759c95c9fb242b7ff6e952);
        
    
            var icon_80bbdaf05412634ba1e6a66f392dcd48 = L.AwesomeMarkers.icon(
                {
  &quot;markerColor&quot;: &quot;purple&quot;,
  &quot;iconColor&quot;: &quot;white&quot;,
  &quot;icon&quot;: &quot;microchip&quot;,
  &quot;prefix&quot;: &quot;fa&quot;,
  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,
}
            );
        
    
        var popup_ce661e656d4d740f956162fb21bd747d = L.popup({
  &quot;maxWidth&quot;: 250,
});

        
            
                var html_87372f27dad181284ac01b44b4795ecd = $(`<div id=&quot;html_87372f27dad181284ac01b44b4795ecd&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>             <div style=&quot;font-family: Arial;&quot;>             <h4>Goleta</h4>             <b>Coordinates:</b> 34.4358, -119.8276<br>             <b>Context:</b> Tech corridor, agricultural transition zone<br>             <b>Role in Analysis:</b> Geographic reference point             </div>             </div>`)[0];
                popup_ce661e656d4d740f956162fb21bd747d.setContent(html_87372f27dad181284ac01b44b4795ecd);
            
        

        marker_79eeb64117282214cbcbdfeec1b334d8.bindPopup(popup_ce661e656d4d740f956162fb21bd747d)
        ;

        
    
    
            marker_79eeb64117282214cbcbdfeec1b334d8.bindTooltip(
                `<div>
                     Goleta - Tech corridor, agricultural transition zone
                 </div>`,
                {
  &quot;sticky&quot;: true,
}
            );
        
    
                marker_79eeb64117282214cbcbdfeec1b334d8.setIcon(icon_80bbdaf05412634ba1e6a66f392dcd48);
            
    
            var marker_cf8e951c8bdff34d12cfe563e8193907 = L.marker(
                [34.4358, -119.6376],
                {
}
            ).addTo(map_e13b6e6874759c95c9fb242b7ff6e952);
        
    
            var icon_ccc44613698043d7f632cced2dc3cf3f = L.AwesomeMarkers.icon(
                {
  &quot;markerColor&quot;: &quot;red&quot;,
  &quot;iconColor&quot;: &quot;white&quot;,
  &quot;icon&quot;: &quot;fire&quot;,
  &quot;prefix&quot;: &quot;fa&quot;,
  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,
}
            );
        
    
        var popup_6ac62389df987c840ce2c1408801b251 = L.popup({
  &quot;maxWidth&quot;: 250,
});

        
            
                var html_e48ebb4c3e6e4bf17f192aab98a1606f = $(`<div id=&quot;html_e48ebb4c3e6e4bf17f192aab98a1606f&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>             <div style=&quot;font-family: Arial;&quot;>             <h4>Montecito</h4>             <b>Coordinates:</b> 34.4358, -119.6376<br>             <b>Context:</b> Wildfire-prone, high-value urban area<br>             <b>Role in Analysis:</b> Geographic reference point             </div>             </div>`)[0];
                popup_6ac62389df987c840ce2c1408801b251.setContent(html_e48ebb4c3e6e4bf17f192aab98a1606f);
            
        

        marker_cf8e951c8bdff34d12cfe563e8193907.bindPopup(popup_6ac62389df987c840ce2c1408801b251)
        ;

        
    
    
            marker_cf8e951c8bdff34d12cfe563e8193907.bindTooltip(
                `<div>
                     Montecito - Wildfire-prone, high-value urban area
                 </div>`,
                {
  &quot;sticky&quot;: true,
}
            );
        
    
                marker_cf8e951c8bdff34d12cfe563e8193907.setIcon(icon_ccc44613698043d7f632cced2dc3cf3f);
            
    
            var measure_control_110f2b54cb75b8d3c0cb959ae6b8fb05 = new L.Control.Measure(
                {
  &quot;position&quot;: &quot;topright&quot;,
  &quot;primaryLengthUnit&quot;: &quot;kilometers&quot;,
  &quot;secondaryLengthUnit&quot;: &quot;miles&quot;,
  &quot;primaryAreaUnit&quot;: &quot;sqkilometers&quot;,
  &quot;secondaryAreaUnit&quot;: &quot;sqmiles&quot;,
});
            map_e13b6e6874759c95c9fb242b7ff6e952.addControl(measure_control_110f2b54cb75b8d3c0cb959ae6b8fb05);

            // Workaround for using this plugin with Leaflet>=1.8.0
            // https://github.com/ljagis/leaflet-measure/issues/171
            L.Control.Measure.include({
                _setCaptureMarkerIcon: function () {
                    // disable autopan
                    this._captureMarker.options.autoPanOnFocus = false;
                    // default function
                    this._captureMarker.setIcon(
                        L.divIcon({
                            iconSize: this._map.getSize().multiplyBy(2)
                        })
                    );
                },
            });

        
    
            L.control.fullscreen(
                {
  &quot;position&quot;: &quot;topright&quot;,
  &quot;title&quot;: &quot;Full Screen Mode&quot;,
  &quot;titleCancel&quot;: &quot;Exit Full Screen&quot;,
  &quot;forceSeparateButton&quot;: true,
}
            ).addTo(map_e13b6e6874759c95c9fb242b7ff6e952);
        
    
            var layer_control_638a9683ae1e28ce365761da07855158_layers = {
                base_layers : {
                    &quot;openstreetmap&quot; : tile_layer_8e1d81440cee40b238cda6af49d0bdf8,
                    &quot;Clean Basemap&quot; : tile_layer_7746e86648feee38c0cffc7eec9ea228,
                    &quot;Dark Theme&quot; : tile_layer_f73e9195a00a11114006b92dc07d9745,
                    &quot;Satellite Imagery&quot; : tile_layer_cec0b863a8382f8d3a1f1bdb67e2c261,
                    &quot;Topographic (OpenTopoMap)&quot; : tile_layer_0b72e93d4c40290c8ffdebc39bb0d575,
                },
                overlays :  {
                },
            };
            let layer_control_638a9683ae1e28ce365761da07855158 = L.control.layers(
                layer_control_638a9683ae1e28ce365761da07855158_layers.base_layers,
                layer_control_638a9683ae1e28ce365761da07855158_layers.overlays,
                {
  &quot;position&quot;: &quot;topright&quot;,
  &quot;collapsed&quot;: false,
  &quot;autoZIndex&quot;: true,
}
            ).addTo(map_e13b6e6874759c95c9fb242b7ff6e952);

        
</script>
</html>" style="position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen=""></iframe></div></div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
AOI Design Best Practices
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Size Considerations:</strong><br>
When defining your Area of Interest (AOI), consider that an area too small may miss important spatial patterns or edge effects, while an area too large can increase processing time and may include irrelevant regions. Aim for a balance that ensures computational efficiency without sacrificing analytical completeness.</p>
<p><strong>Boundary Alignment:</strong><br>
AOI boundaries can be aligned with ecological features such as watersheds, ecoregions, or habitat boundaries; with administrative units like counties, states, or protected areas; or with sensor-based divisions such as satellite tile boundaries and processing units. Choose the alignment that best fits your study objectives.</p>
<p><strong>Temporal Considerations:</strong><br>
Ensure your AOI captures relevant seasonal dynamics and accounts for both historical and projected changes in the study area. Also, verify that data coverage is consistent across your intended temporal study period.</p>
</div>
</div>
</section>
</section>
<section id="validating-your-aoi-selection" class="level3">
<h3 class="anchored" data-anchor-id="validating-your-aoi-selection">Validating Your AOI Selection</h3>
<p>Before proceeding with data acquisition, confirm that your AOI is well-matched to your analysis objectives.</p>
</section>
</section>
<section id="intelligent-satellite-scene-discovery-and-selection" class="level2">
<h2 class="anchored" data-anchor-id="intelligent-satellite-scene-discovery-and-selection">5. Intelligent Satellite Scene Discovery and Selection</h2>
<section id="intelligent-satellite-scene-discovery" class="level3">
<h3 class="anchored" data-anchor-id="intelligent-satellite-scene-discovery">5.1 Intelligent Satellite Scene Discovery</h3>
<p>Selecting appropriate satellite imagery is a multi-faceted challenge that requires balancing several key factors: temporal coverage (recent vs.&nbsp;historical data), data quality (cloud cover, sensor conditions, processing artifacts), spatial coverage (ensuring your AOI is fully captured), and the processing level of the data (raw vs.&nbsp;analysis-ready products). Relying on a single search strategy often leads to missed opportunities or suboptimal results, especially when data availability is limited by weather or acquisition schedules.</p>
<p>To address these challenges, a robust approach involves designing and implementing multi-strategy search patterns. This means systematically applying a sequence of search strategies, each with progressively relaxed criteria—such as expanding the temporal window or increasing the allowable cloud cover. By doing so, you maximize the chances of finding suitable imagery while still prioritizing the highest quality data available. This method is widely used in operational geospatial systems to ensure reliable and efficient satellite scene discovery, even under less-than-ideal conditions.</p>
<p>By the end of this section, you will be able to design robust, multi-strategy search workflows for satellite data discovery, understand how quality filters and temporal windows affect data availability, implement fallback mechanisms to guarantee reliable data access, and evaluate scene metadata to select the most appropriate imagery for your analysis.</p>
<div id="2add71c6" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4A: Implement Robust Multi-Strategy Scene Discovery</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Strategy 1: Dynamic temporal window based on current date</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>current_date <span class="op">=</span> datetime.now()</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Calculating optimal temporal search windows (current date: </span><span class="sc">{</span>current_date<span class="sc">.</span>strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define multiple search strategies with different trade-offs</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Each strategy balances data quality against data availability</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>search_strategies <span class="op">=</span> [</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Optimal Quality"</span>,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_range"</span>: <span class="st">"2024-06-01/2024-09-30"</span>,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_max"</span>: <span class="dv">20</span>,</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Recent summer data with excellent atmospheric conditions"</span>,</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span>: <span class="st">"Best for analysis quality"</span>,</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"trade_offs"</span>: <span class="st">"May have limited availability"</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Good Quality"</span>,</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_range"</span>: <span class="st">"2024-03-01/2024-08-31"</span>,</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_max"</span>: <span class="dv">35</span>,</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Extended seasonal window with good conditions"</span>,</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span>: <span class="st">"Balance of quality and availability"</span>,</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"trade_offs"</span>: <span class="st">"Some atmospheric interference"</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Acceptable Quality"</span>,</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_range"</span>: <span class="st">"2023-09-01/2024-11-30"</span>,</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_max"</span>: <span class="dv">50</span>,</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Broader temporal and quality window"</span>,</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span>: <span class="st">"Reliable data availability"</span>,</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"trade_offs"</span>: <span class="st">"May require additional preprocessing"</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Fallback Option"</span>,</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_range"</span>: <span class="st">"2023-01-01/2024-12-31"</span>,</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_max"</span>: <span class="dv">75</span>,</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Maximum temporal window, relaxed quality constraints"</span>,</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span>: <span class="st">"Guaranteed data access"</span>,</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"trade_offs"</span>: <span class="st">"Significant cloud contamination possible"</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Defined </span><span class="sc">{</span><span class="bu">len</span>(search_strategies)<span class="sc">}</span><span class="ss"> search strategies"</span>)</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, strategy <span class="kw">in</span> <span class="bu">enumerate</span>(search_strategies, <span class="dv">1</span>):</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"Strategy </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>strategy[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute search strategies in order of preference</span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>scenes <span class="op">=</span> []</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>successful_strategy <span class="op">=</span> <span class="va">None</span></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, strategy <span class="kw">in</span> <span class="bu">enumerate</span>(search_strategies, <span class="dv">1</span>):</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Executing Strategy </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> (dates: </span><span class="sc">{</span>strategy[<span class="st">'date_range'</span>]<span class="sc">}</span><span class="ss">, cloud &lt; </span><span class="sc">{</span>strategy[<span class="st">'cloud_max'</span>]<span class="sc">}</span><span class="ss">%)"</span>)</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use our optimized search function with current strategy parameters</span></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>        temp_scenes <span class="op">=</span> search_sentinel2_scenes(</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>            bbox<span class="op">=</span>santa_barbara_bbox,</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>            date_range<span class="op">=</span>strategy[<span class="st">"date_range"</span>],</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>            cloud_cover_max<span class="op">=</span>strategy[<span class="st">"cloud_max"</span>],</span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>            limit<span class="op">=</span><span class="dv">100</span>  <span class="co"># Generous limit for selection flexibility</span></span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temp_scenes:</span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>            scenes <span class="op">=</span> temp_scenes</span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>            successful_strategy <span class="op">=</span> strategy</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"SUCCESS! Found </span><span class="sc">{</span><span class="bu">len</span>(scenes)<span class="sc">}</span><span class="ss"> qualifying scenes with </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> strategy"</span>)</span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a>            logger.warning(<span class="ss">f"No scenes found with </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> strategy, proceeding to next"</span>)</span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>        logger.warning(<span class="ss">f"Search execution failed for </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)[:<span class="dv">80</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate search results and provide detailed feedback</span></span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> scenes:</span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a>    logger.error(<span class="ss">f"Scene discovery failed after trying all </span><span class="sc">{</span><span class="bu">len</span>(search_strategies)<span class="sc">}</span><span class="ss"> strategies"</span>)</span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Diagnostic steps: 1) Check network connectivity, 2) Verify API status, 3) Confirm AOI coverage, 4) Try broader date ranges, 5) Check authentication"</span>)</span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"Critical failure in scene discovery. Review diagnostic steps and retry."</span>)</span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Scene discovery completed: </span><span class="sc">{</span>successful_strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> strategy found </span><span class="sc">{</span><span class="bu">len</span>(scenes)<span class="sc">}</span><span class="ss"> scenes (attempt </span><span class="sc">{</span>search_strategies<span class="sc">.</span>index(successful_strategy) <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(search_strategies)<span class="sc">}</span><span class="ss">)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:03:22,751 - INFO - Calculating optimal temporal search windows (current date: 2025-10-09)
2025-10-09 11:03:22,752 - INFO - Defined 4 search strategies
2025-10-09 11:03:22,752 - INFO - Executing Strategy 1: Optimal Quality (dates: 2024-06-01/2024-09-30, cloud &lt; 20%)
2025-10-09 11:03:24,992 - INFO - Found 40 Sentinel-2 scenes (cloud cover &lt; 20%)
2025-10-09 11:03:24,992 - INFO - SUCCESS! Found 40 qualifying scenes with Optimal Quality strategy
2025-10-09 11:03:24,992 - INFO - Scene discovery completed: Optimal Quality strategy found 40 scenes (attempt 1/4)</code></pre>
</div>
</div>
</section>
<section id="scene-quality-assessment-and-selection" class="level3">
<h3 class="anchored" data-anchor-id="scene-quality-assessment-and-selection">5.2 Scene Quality Assessment and Selection</h3>
<p>Once we have candidate scenes, we need to systematically evaluate and select the best option:</p>
<p><strong>Performing Comprehensive Scene Quality Assessment:</strong></p>
<p>This demonstrates multi-criteria decision making for satellite data selection using cloud cover, acquisition date, and other quality metrics.</p>
<div id="52e4a21f" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4B: Intelligent Scene Selection Based on Multiple Quality Criteria</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort scenes by multiple quality criteria</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Primary: cloud cover (lower is better)</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Secondary: date (more recent is better)</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>scenes_with_scores <span class="op">=</span> []</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Evaluating </span><span class="sc">{</span><span class="bu">len</span>(scenes)<span class="sc">}</span><span class="ss"> candidate scenes for quality assessment"</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> scene <span class="kw">in</span> scenes:</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    props <span class="op">=</span> scene.properties</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract key quality metrics</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    cloud_cover <span class="op">=</span> props.get(<span class="st">'eo:cloud_cover'</span>, <span class="dv">100</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    date_str <span class="op">=</span> props.get(<span class="st">'datetime'</span>, <span class="st">''</span>).split(<span class="st">'T'</span>)[<span class="dv">0</span>]</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    scene_date <span class="op">=</span> datetime.strptime(date_str, <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    days_old <span class="op">=</span> (current_date <span class="op">-</span> scene_date).days</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate composite quality score (lower is better)</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weight factors: cloud cover (70%), recency (30%)</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    cloud_score <span class="op">=</span> cloud_cover  <span class="co"># 0-100 scale</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    recency_score <span class="op">=</span> <span class="bu">min</span>(days_old <span class="op">/</span> <span class="dv">30</span>, <span class="dv">100</span>)  <span class="co"># Normalize to 0-100, cap at 100</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    quality_score <span class="op">=</span> (<span class="fl">0.7</span> <span class="op">*</span> cloud_score) <span class="op">+</span> (<span class="fl">0.3</span> <span class="op">*</span> recency_score)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    scene_info <span class="op">=</span> {</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'scene'</span>: scene,</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span>: date_str,</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'cloud_cover'</span>: cloud_cover,</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'days_old'</span>: days_old,</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'quality_score'</span>: quality_score,</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'tile_id'</span>: props.get(<span class="st">'sentinel:grid_square'</span>, <span class="st">'Unknown'</span>),</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'platform'</span>: props.get(<span class="st">'platform'</span>, <span class="st">'Sentinel-2'</span>)</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>    scenes_with_scores.append(scene_info)</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by quality score (best first)</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>scenes_with_scores.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'quality_score'</span>])</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Display top candidates for educational purposes</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Top 5 Scene Candidates (ranked by quality score):"</span>)</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, scene_info <span class="kw">in</span> <span class="bu">enumerate</span>(scenes_with_scores[:<span class="dv">5</span>], <span class="dv">1</span>):</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>scene_info[<span class="st">'date'</span>]<span class="sc">}</span><span class="ss"> - Cloud: </span><span class="sc">{</span>scene_info[<span class="st">'cloud_cover'</span>]<span class="sc">:.1f}</span><span class="ss">%, Age: </span><span class="sc">{</span>scene_info[<span class="st">'days_old'</span>]<span class="sc">}</span><span class="ss"> days, Score: </span><span class="sc">{</span>scene_info[<span class="st">'quality_score'</span>]<span class="sc">:.1f}</span><span class="ss">"</span>)</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Selected optimal scene: </span><span class="sc">{</span>scene_info[<span class="st">'date'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the best scene</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>best_scene_info <span class="op">=</span> scenes_with_scores[<span class="dv">0</span>]</span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>best_scene <span class="op">=</span> best_scene_info[<span class="st">'scene'</span>]</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Optimal scene selected: </span><span class="sc">{</span>best_scene_info[<span class="st">'date'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>best_scene_info[<span class="st">'cloud_cover'</span>]<span class="sc">:.1f}</span><span class="ss">% cloud cover, </span><span class="sc">{</span>best_scene_info[<span class="st">'platform'</span>]<span class="sc">}</span><span class="ss">, Tile: </span><span class="sc">{</span>best_scene_info[<span class="st">'tile_id'</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate scene completeness for required analysis</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Validating scene data completeness"</span>)</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>required_bands <span class="op">=</span> [<span class="st">'B02'</span>, <span class="st">'B03'</span>, <span class="st">'B04'</span>, <span class="st">'B08'</span>]  <span class="co"># Blue, Green, Red, NIR</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>available_bands <span class="op">=</span> <span class="bu">list</span>(best_scene.assets.keys())</span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>spectral_bands <span class="op">=</span> [b <span class="cf">for</span> b <span class="kw">in</span> available_bands <span class="cf">if</span> b.startswith(<span class="st">'B'</span>) <span class="kw">and</span> <span class="bu">len</span>(b) <span class="op">&lt;=</span> <span class="dv">3</span>]</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>logger.debug(<span class="ss">f"Available spectral bands: </span><span class="sc">{</span><span class="bu">len</span>(spectral_bands)<span class="sc">}</span><span class="ss">, Required: </span><span class="sc">{</span>required_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>missing_bands <span class="op">=</span> [b <span class="cf">for</span> b <span class="kw">in</span> required_bands <span class="cf">if</span> b <span class="kw">not</span> <span class="kw">in</span> available_bands]</span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> missing_bands:</span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="ss">f"Missing critical bands: </span><span class="sc">{</span>missing_bands<span class="sc">}</span><span class="ss"> - this may limit analysis capabilities"</span>)</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for alternative bands</span></span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>    alternative_mapping <span class="op">=</span> {<span class="st">'B02'</span>: <span class="st">'blue'</span>, <span class="st">'B03'</span>: <span class="st">'green'</span>, <span class="st">'B04'</span>: <span class="st">'red'</span>, <span class="st">'B08'</span>: <span class="st">'nir'</span>}</span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>    alternatives_found <span class="op">=</span> []</span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> missing <span class="kw">in</span> missing_bands:</span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>        alt_name <span class="op">=</span> alternative_mapping.get(missing, missing.lower())</span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> alt_name <span class="kw">in</span> available_bands:</span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>            alternatives_found.append((missing, alt_name))</span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> alternatives_found:</span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Found alternative band names: </span><span class="sc">{</span>alternatives_found<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"All required bands available"</span>)</span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional quality checks</span></span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a>extra_bands <span class="op">=</span> [b <span class="cf">for</span> b <span class="kw">in</span> spectral_bands <span class="cf">if</span> b <span class="kw">not</span> <span class="kw">in</span> required_bands]</span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> extra_bands:</span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"Bonus bands available: </span><span class="sc">{</span>extra_bands[:<span class="dv">5</span>]<span class="sc">}{</span><span class="st">'...'</span> <span class="cf">if</span> <span class="bu">len</span>(extra_bands) <span class="op">&gt;</span> <span class="dv">5</span> <span class="cf">else</span> <span class="st">''</span><span class="sc">}</span><span class="ss"> (enable advanced spectral analysis)"</span>)</span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Scene validation complete - ready for data loading"</span>)</span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick connectivity test using our helper function</span></span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Performing pre-flight connectivity test"</span>)</span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true" tabindex="-1"></a>connectivity_test <span class="op">=</span> test_subset_functionality(best_scene)</span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> connectivity_test:</span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Data access confirmed - all systems ready"</span>)</span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"Connectivity issues detected - will attempt full download with fallback mechanisms"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:03:25,001 - INFO - Evaluating 40 candidate scenes for quality assessment
2025-10-09 11:03:25,002 - INFO - Top 5 Scene Candidates (ranked by quality score):
2025-10-09 11:03:25,003 - INFO - Selected optimal scene: 2024-08-13
2025-10-09 11:03:25,003 - INFO - Optimal scene selected: 2024-08-13 (0.0% cloud cover, Sentinel-2B, Tile: Unknown)
2025-10-09 11:03:25,004 - INFO - Validating scene data completeness
2025-10-09 11:03:25,004 - INFO - All required bands available
2025-10-09 11:03:25,004 - INFO - Scene validation complete - ready for data loading
2025-10-09 11:03:25,005 - INFO - Performing pre-flight connectivity test
2025-10-09 11:03:25,005 - INFO - 🧪 Testing subset functionality...
2025-10-09 11:03:25,005 - INFO - 📐 Calculated subset from scene bounds:
2025-10-09 11:03:25,005 - INFO -    Scene bbox: [-120.2952, 34.2097, -119.0654, 35.2250]
2025-10-09 11:03:25,006 - INFO -    Subset bbox: [-119.8033, 34.6158, -119.5573, 34.8189]
2025-10-09 11:03:25,006 - INFO -    X range: 40%-60%, Y range: 40%-60%
2025-10-09 11:03:25,006 - INFO -    Subset area: 4.0% of original scene
2025-10-09 11:03:26,067 - WARNING - CPLE_AppDefined in PROJ: proj_create_from_database: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.
2025-10-09 11:03:26,068 - WARNING - CPLE_AppDefined in The definition of projected CRS EPSG:32611 got from GeoTIFF keys is not the same as the one from the EPSG registry, which may cause issues during reprojection operations. Set GTIFF_SRS_SOURCE configuration option to EPSG to use official parameters (overriding the ones from GeoTIFF keys), or to GEOKEYS to use custom values from GeoTIFF keys and drop the EPSG code.
2025-10-09 11:03:26,082 - INFO - GDAL signalled an error: err_no=1, msg='PROJ: proj_create_from_database: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.'
2025-10-09 11:05:48,990 - INFO - Successfully loaded 1 bands: ['B04']
2025-10-09 11:05:48,990 - INFO -    ✅ Subset test successful: (10980, 10980) pixels, 120560400 total
2025-10-09 11:05:48,990 - INFO - Data access confirmed - all systems ready</code></pre>
</div>
</div>
<p>Scene selection for geospatial analysis should prioritize several key quality criteria. Cloud cover is the most important factor, as it directly affects data usability. Temporal relevance is also critical; more recent data better reflects current conditions. The processing level matters as well—Level 2A data, for example, provides atmospheric correction, which is often preferred. Finally, consider spatial coverage, ensuring that the selected scene fully covers the area of interest rather than only partially.</p>
<p>In production workflows, it is important to have fallback strategies in place, such as using multiple search approaches to ensure data availability. Automated selection can be improved by applying standardized quality scoring metrics. Always validate metadata to confirm that all required bands and assets are present, and test connectivity to the data source before starting major processing tasks.</p>
<p>Before loading data, it is helpful to examine the characteristics of the selected Sentinel-2 scene. For example, you can use the <code>eo:cloud_cover</code> property to filter scenes by cloud coverage. Sentinel-2 satellites revisit the same location every five days, so multiple scenes are usually available for a given area. Level 2A data is already atmospherically corrected, which simplifies preprocessing. Be aware that different satellites may use different naming conventions and have varying properties.</p>
<p>A thorough analysis of scene metadata is essential for designing effective workflows. By systematically inventorying available assets and understanding sensor characteristics, you can take full advantage of the rich metadata provided in STAC items and ensure your analysis is both robust and reliable.</p>
<div id="63fc9b2d" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4C: Comprehensive Scene and Sensor Characterization</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'best_scene'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    scene_props <span class="op">=</span> best_scene.properties</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    scene_assets <span class="op">=</span> best_scene.assets</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sentinel-2 spectral band specifications with AI applications</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    sentinel2_bands <span class="op">=</span> {</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B01'</span>: {</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Coastal/Aerosol'</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'443 nm'</span>,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'60m'</span>,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Atmospheric correction, aerosol detection'</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B02'</span>: {</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Blue'</span>,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'490 nm'</span>,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'10m'</span>,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Water body detection, urban classification'</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B03'</span>: {</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Green'</span>,</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'560 nm'</span>,</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'10m'</span>,</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Vegetation health, true color composites'</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B04'</span>: {</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Red'</span>,</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'665 nm'</span>,</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'10m'</span>,</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Vegetation stress, NDVI calculation'</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B05'</span>: {</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Red Edge 1'</span>,</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'705 nm'</span>,</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Vegetation analysis, crop type classification'</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B06'</span>: {</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Red Edge 2'</span>,</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'740 nm'</span>,</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Advanced vegetation indices, stress detection'</span></span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B07'</span>: {</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Red Edge 3'</span>,</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'783 nm'</span>,</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Vegetation biophysical parameters'</span></span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B08'</span>: {</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'NIR (Near Infrared)'</span>,</span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'842 nm'</span>,</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'10m'</span>,</span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Biomass estimation, water/land separation'</span></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B8A'</span>: {</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'NIR Narrow'</span>,</span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'865 nm'</span>,</span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Refined vegetation analysis'</span></span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B09'</span>: {</span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Water Vapor'</span>,</span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'945 nm'</span>,</span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'60m'</span>,</span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Atmospheric water vapor correction'</span></span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B11'</span>: {</span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'SWIR 1'</span>,</span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'1610 nm'</span>,</span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Fire detection, soil moisture, geology'</span></span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B12'</span>: {</span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'SWIR 2'</span>,</span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'2190 nm'</span>,</span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Burn area mapping, mineral detection'</span></span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional data products available in Level 2A</span></span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a>    additional_products <span class="op">=</span> {</span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">'SCL'</span>: {</span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Scene Classification Layer'</span>,</span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'Pixel-level land cover classification'</span>,</span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Cloud masking, quality assessment'</span></span>
<span id="cb42-88"><a href="#cb42-88" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-89"><a href="#cb42-89" aria-hidden="true" tabindex="-1"></a>        <span class="st">'AOT'</span>: {</span>
<span id="cb42-90"><a href="#cb42-90" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Aerosol Optical Thickness'</span>,</span>
<span id="cb42-91"><a href="#cb42-91" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'Atmospheric aerosol content'</span>,</span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Atmospheric correction validation'</span></span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">'WVP'</span>: {</span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Water Vapor Pressure'</span>,</span>
<span id="cb42-96"><a href="#cb42-96" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'Columnar water vapor content'</span>,</span>
<span id="cb42-97"><a href="#cb42-97" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Atmospheric correction, weather analysis'</span></span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-99"><a href="#cb42-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">'visual'</span>: {</span>
<span id="cb42-100"><a href="#cb42-100" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'True Color Preview'</span>,</span>
<span id="cb42-101"><a href="#cb42-101" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'RGB composite for visualization'</span>,</span>
<span id="cb42-102"><a href="#cb42-102" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Quick visual assessment, presentation'</span></span>
<span id="cb42-103"><a href="#cb42-103" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb42-104"><a href="#cb42-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">'thumbnail'</span>: {</span>
<span id="cb42-105"><a href="#cb42-105" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Scene Thumbnail'</span>,</span>
<span id="cb42-106"><a href="#cb42-106" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'Low-resolution preview image'</span>,</span>
<span id="cb42-107"><a href="#cb42-107" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Rapid quality screening'</span></span>
<span id="cb42-108"><a href="#cb42-108" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb42-109"><a href="#cb42-109" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-110"><a href="#cb42-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-111"><a href="#cb42-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scene technical specifications</span></span>
<span id="cb42-112"><a href="#cb42-112" aria-hidden="true" tabindex="-1"></a>    acquisition_date <span class="op">=</span> scene_props.get(<span class="st">'datetime'</span>, <span class="st">'Unknown'</span>).split(<span class="st">'T'</span>)[<span class="dv">0</span>]</span>
<span id="cb42-113"><a href="#cb42-113" aria-hidden="true" tabindex="-1"></a>    platform <span class="op">=</span> scene_props.get(<span class="st">'platform'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb42-114"><a href="#cb42-114" aria-hidden="true" tabindex="-1"></a>    cloud_cover <span class="op">=</span> scene_props.get(<span class="st">'eo:cloud_cover'</span>, <span class="dv">0</span>)</span>
<span id="cb42-115"><a href="#cb42-115" aria-hidden="true" tabindex="-1"></a>    tile_id <span class="op">=</span> scene_props.get(<span class="st">'sentinel:grid_square'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb42-116"><a href="#cb42-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-117"><a href="#cb42-117" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Scene: </span><span class="sc">{</span>platform<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>acquisition_date<span class="sc">}</span><span class="ss">, Cloud: </span><span class="sc">{</span>cloud_cover<span class="sc">:.1f}</span><span class="ss">%, Tile: </span><span class="sc">{</span>tile_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-118"><a href="#cb42-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-119"><a href="#cb42-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inventory available spectral bands</span></span>
<span id="cb42-120"><a href="#cb42-120" aria-hidden="true" tabindex="-1"></a>    available_spectral <span class="op">=</span> []</span>
<span id="cb42-121"><a href="#cb42-121" aria-hidden="true" tabindex="-1"></a>    available_products <span class="op">=</span> []</span>
<span id="cb42-122"><a href="#cb42-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-123"><a href="#cb42-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_id, info <span class="kw">in</span> sentinel2_bands.items():</span>
<span id="cb42-124"><a href="#cb42-124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> band_id <span class="kw">in</span> scene_assets:</span>
<span id="cb42-125"><a href="#cb42-125" aria-hidden="true" tabindex="-1"></a>            available_spectral.append(band_id)</span>
<span id="cb42-126"><a href="#cb42-126" aria-hidden="true" tabindex="-1"></a>            logger.debug(<span class="ss">f"Available: </span><span class="sc">{</span>band_id<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>info[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>info[<span class="st">'resolution'</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb42-127"><a href="#cb42-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-128"><a href="#cb42-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> product_id, info <span class="kw">in</span> additional_products.items():</span>
<span id="cb42-129"><a href="#cb42-129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> product_id <span class="kw">in</span> scene_assets:</span>
<span id="cb42-130"><a href="#cb42-130" aria-hidden="true" tabindex="-1"></a>            available_products.append(product_id)</span>
<span id="cb42-131"><a href="#cb42-131" aria-hidden="true" tabindex="-1"></a>            logger.debug(<span class="ss">f"Available product: </span><span class="sc">{</span>product_id<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>info[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-132"><a href="#cb42-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-133"><a href="#cb42-133" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Analysis readiness assessment</span></span>
<span id="cb42-134"><a href="#cb42-134" aria-hidden="true" tabindex="-1"></a>    core_bands <span class="op">=</span> [<span class="st">'B02'</span>, <span class="st">'B03'</span>, <span class="st">'B04'</span>, <span class="st">'B08'</span>]  <span class="co"># Essential for basic analysis</span></span>
<span id="cb42-135"><a href="#cb42-135" aria-hidden="true" tabindex="-1"></a>    advanced_bands <span class="op">=</span> [<span class="st">'B05'</span>, <span class="st">'B06'</span>, <span class="st">'B07'</span>, <span class="st">'B8A'</span>, <span class="st">'B11'</span>, <span class="st">'B12'</span>]  <span class="co"># For advanced analysis</span></span>
<span id="cb42-136"><a href="#cb42-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-137"><a href="#cb42-137" aria-hidden="true" tabindex="-1"></a>    core_available <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> band <span class="kw">in</span> core_bands <span class="cf">if</span> band <span class="kw">in</span> available_spectral)</span>
<span id="cb42-138"><a href="#cb42-138" aria-hidden="true" tabindex="-1"></a>    advanced_available <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> band <span class="kw">in</span> advanced_bands <span class="cf">if</span> band <span class="kw">in</span> available_spectral)</span>
<span id="cb42-139"><a href="#cb42-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-140"><a href="#cb42-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Analysis readiness assessment</span></span>
<span id="cb42-141"><a href="#cb42-141" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Bands available: </span><span class="sc">{</span>core_available<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(core_bands)<span class="sc">}</span><span class="ss"> core, </span><span class="sc">{</span>advanced_available<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(advanced_bands)<span class="sc">}</span><span class="ss"> advanced"</span>)</span>
<span id="cb42-142"><a href="#cb42-142" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Additional products: </span><span class="sc">{</span><span class="bu">len</span>(available_products)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-143"><a href="#cb42-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-144"><a href="#cb42-144" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determine analysis capabilities</span></span>
<span id="cb42-145"><a href="#cb42-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> core_available <span class="op">==</span> <span class="bu">len</span>(core_bands):</span>
<span id="cb42-146"><a href="#cb42-146" aria-hidden="true" tabindex="-1"></a>        analysis_capabilities <span class="op">=</span> [<span class="st">"NDVI calculation"</span>, <span class="st">"True color visualization"</span>, <span class="st">"Basic land cover classification"</span>]</span>
<span id="cb42-147"><a href="#cb42-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-148"><a href="#cb42-148" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'B11'</span> <span class="kw">in</span> available_spectral <span class="kw">and</span> <span class="st">'B12'</span> <span class="kw">in</span> available_spectral:</span>
<span id="cb42-149"><a href="#cb42-149" aria-hidden="true" tabindex="-1"></a>            analysis_capabilities.extend([<span class="st">"Fire detection"</span>, <span class="st">"Soil moisture analysis"</span>])</span>
<span id="cb42-150"><a href="#cb42-150" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> advanced_available <span class="op">&gt;=</span> <span class="dv">4</span>:</span>
<span id="cb42-151"><a href="#cb42-151" aria-hidden="true" tabindex="-1"></a>            analysis_capabilities.extend([<span class="st">"Advanced vegetation indices"</span>, <span class="st">"Crop type classification"</span>])</span>
<span id="cb42-152"><a href="#cb42-152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'SCL'</span> <span class="kw">in</span> available_products:</span>
<span id="cb42-153"><a href="#cb42-153" aria-hidden="true" tabindex="-1"></a>            analysis_capabilities.append(<span class="st">"Automated cloud masking"</span>)</span>
<span id="cb42-154"><a href="#cb42-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-155"><a href="#cb42-155" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Analysis ready: </span><span class="sc">{</span><span class="bu">len</span>(analysis_capabilities)<span class="sc">}</span><span class="ss"> capabilities enabled"</span>)</span>
<span id="cb42-156"><a href="#cb42-156" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb42-157"><a href="#cb42-157" aria-hidden="true" tabindex="-1"></a>        missing_core <span class="op">=</span> [band <span class="cf">for</span> band <span class="kw">in</span> core_bands <span class="cf">if</span> band <span class="kw">not</span> <span class="kw">in</span> available_spectral]</span>
<span id="cb42-158"><a href="#cb42-158" aria-hidden="true" tabindex="-1"></a>        logger.warning(<span class="ss">f"Limited analysis: missing core bands </span><span class="sc">{</span>missing_core<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-159"><a href="#cb42-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-160"><a href="#cb42-160" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store technical metadata</span></span>
<span id="cb42-161"><a href="#cb42-161" aria-hidden="true" tabindex="-1"></a>    crs_info <span class="op">=</span> <span class="ss">f"EPSG:</span><span class="sc">{</span>scene_props[<span class="st">'proj:epsg'</span>]<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> <span class="st">'proj:epsg'</span> <span class="kw">in</span> scene_props <span class="cf">else</span> <span class="st">"UTM"</span></span>
<span id="cb42-162"><a href="#cb42-162" aria-hidden="true" tabindex="-1"></a>    utm_zone <span class="op">=</span> scene_props.get(<span class="st">'sentinel:utm_zone'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb42-163"><a href="#cb42-163" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Metadata: </span><span class="sc">{</span>crs_info<span class="sc">}</span><span class="ss">, UTM zone </span><span class="sc">{</span>utm_zone<span class="sc">}</span><span class="ss">, 16-bit COG format"</span>)</span>
<span id="cb42-164"><a href="#cb42-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-165"><a href="#cb42-165" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb42-166"><a href="#cb42-166" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"No optimal scene selected - cannot perform metadata analysis"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:05:49,001 - INFO - Scene: Sentinel-2B 2024-08-13, Cloud: 0.0%, Tile: Unknown
2025-10-09 11:05:49,001 - INFO - Bands available: 4/4 core, 6/6 advanced
2025-10-09 11:05:49,001 - INFO - Additional products: 4
2025-10-09 11:05:49,002 - INFO - Analysis ready: 8 capabilities enabled
2025-10-09 11:05:49,002 - INFO - Metadata: UTM, UTM zone Unknown, 16-bit COG format</code></pre>
</div>
</div>
</section>
</section>
<section id="sentinel-2-for-ai-applications" class="level2">
<h2 class="anchored" data-anchor-id="sentinel-2-for-ai-applications">Sentinel-2 for AI Applications</h2>
<p>Sentinel-2 is well-suited for geospatial AI due to its 13 multi-spectral bands spanning the visible to shortwave infrared range. The satellite offers a high revisit frequency of every 5 days, enabling temporal analysis. Its moderate spatial resolution of 10 to 20 meters is optimal for landscape-scale AI tasks. Sentinel-2 data is freely accessible under an open data policy, which supports large-scale model training. The standardized Level 2A processing ensures consistent data quality, and global coverage provides uniform data characteristics worldwide.</p>
<p>For AI applications, Sentinel-2 offers several advantages. The large data volume supports robust model development and training. The scene classification layer can be used as ground truth for validation. Time series data enables the development of sequence models, and the availability of multiple spatial resolutions allows for hierarchical learning approaches.</p>
<p>Now let’s examine the scene’s geographic characteristics and proceed to data loading.</p>
<hr>
</section>
<section id="production-grade-satellite-data-loading-and-processing" class="level2">
<h2 class="anchored" data-anchor-id="production-grade-satellite-data-loading-and-processing">6. Production-Grade Satellite Data Loading and Processing</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you will be able to implement memory-efficient satellite data loading with intelligent subsetting, design adaptive processing strategies based on scene characteristics, create robust error handling for network-dependent data workflows, and build multi-dimensional datasets suitable for AI and machine learning applications.</p>
</div>
</div>
<section id="the-challenge-of-large-scale-satellite-data-loading" class="level3">
<h3 class="anchored" data-anchor-id="the-challenge-of-large-scale-satellite-data-loading">6.1 The Challenge of Large-Scale Satellite Data Loading</h3>
<p>Modern satellite scenes can exceed 1GB in size, which requires careful planning for data loading and processing. Efficient memory management is necessary to avoid loading unnecessary data into RAM. Network efficiency is also important to minimize data transfer while maintaining analysis quality. Processing strategies should be adaptive, adjusting to the size and characteristics of each scene. Additionally, workflows must be resilient to network interruptions and data access failures.</p>
</section>
<section id="intelligent-data-loading-architecture" class="level3">
<h3 class="anchored" data-anchor-id="intelligent-data-loading-architecture">6.2 Intelligent Data Loading Architecture</h3>
<p>The following approach demonstrates production-ready patterns used in operational systems. It implements an intelligent satellite data loading pipeline that adapts processing based on scene characteristics, selecting optimal loading strategies according to the scene size and analysis requirements.</p>
<div id="fbbbdce4" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5A: Scene Analysis and Adaptive Subset Strategy Selection</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'best_scene'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Comprehensive scene analysis for optimal loading strategy</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    scene_info <span class="op">=</span> get_scene_info(best_scene)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Scene extent: </span><span class="sc">{</span>scene_info[<span class="st">'width_km'</span>]<span class="sc">:.1f}</span><span class="ss">×</span><span class="sc">{</span>scene_info[<span class="st">'height_km'</span>]<span class="sc">:.1f}</span><span class="ss"> km (</span><span class="sc">{</span>scene_info[<span class="st">'area_km2'</span>]<span class="sc">:.0f}</span><span class="ss"> km²)"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adaptive subset strategy based on scene characteristics</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decision matrix for subset sizing</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    subset_strategies <span class="op">=</span> {</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"large_scene"</span>: {</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"condition"</span>: scene_info[<span class="st">'area_km2'</span>] <span class="op">&gt;</span> <span class="dv">5000</span>,</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x_range"</span>: (<span class="dv">30</span>, <span class="dv">70</span>),</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y_range"</span>: (<span class="dv">30</span>, <span class="dv">70</span>),</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"coverage"</span>: <span class="dv">16</span>,  <span class="co"># 40% × 40%</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rationale"</span>: <span class="st">"Conservative subset for large scenes to manage memory usage"</span>,</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"middle 40% (large scene optimization)"</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"medium_scene"</span>: {</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"condition"</span>: scene_info[<span class="st">'area_km2'</span>] <span class="op">&gt;</span> <span class="dv">1000</span>,</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x_range"</span>: (<span class="dv">20</span>, <span class="dv">80</span>),</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y_range"</span>: (<span class="dv">20</span>, <span class="dv">80</span>),</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">"coverage"</span>: <span class="dv">36</span>,  <span class="co"># 60% × 60%</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rationale"</span>: <span class="st">"Balanced subset for medium scenes"</span>,</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"middle 60% (balanced approach)"</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"small_scene"</span>: {</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">"condition"</span>: scene_info[<span class="st">'area_km2'</span>] <span class="op">&lt;=</span> <span class="dv">1000</span>,</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x_range"</span>: (<span class="dv">10</span>, <span class="dv">90</span>),</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y_range"</span>: (<span class="dv">10</span>, <span class="dv">90</span>),</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">"coverage"</span>: <span class="dv">64</span>,  <span class="co"># 80% × 80%</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rationale"</span>: <span class="st">"Maximum coverage for small scenes"</span>,</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"most of scene (small scene - maximize coverage)"</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select optimal strategy</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>    selected_strategy <span class="op">=</span> <span class="va">None</span></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> strategy_name, strategy <span class="kw">in</span> subset_strategies.items():</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> strategy[<span class="st">"condition"</span>]:</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>            selected_strategy <span class="op">=</span> strategy</span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>            strategy_name_selected <span class="op">=</span> strategy_name</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"Selected strategy: </span><span class="sc">{</span>strategy_name<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>strategy[<span class="st">'coverage'</span>]<span class="sc">}</span><span class="ss">% coverage)"</span>)</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply selected subset strategy</span></span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>    x_range, y_range <span class="op">=</span> selected_strategy[<span class="st">"x_range"</span>], selected_strategy[<span class="st">"y_range"</span>]</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>    subset_bbox <span class="op">=</span> get_subset_from_scene(best_scene, x_range<span class="op">=</span>x_range, y_range<span class="op">=</span>y_range)</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate expected data characteristics</span></span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a>    subset_area_km2 <span class="op">=</span> scene_info[<span class="st">'area_km2'</span>] <span class="op">*</span> (selected_strategy[<span class="st">'coverage'</span>] <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>    estimated_pixels_10m <span class="op">=</span> subset_area_km2 <span class="op">*</span> <span class="fl">1e6</span> <span class="op">/</span> (<span class="dv">10</span> <span class="op">*</span> <span class="dv">10</span>)  <span class="co"># 10m pixel size</span></span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log subset characteristics</span></span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Subset: </span><span class="sc">{</span>subset_area_km2<span class="sc">:.0f}</span><span class="ss"> km², </span><span class="sc">{</span>estimated_pixels_10m<span class="sc">:,.0f}</span><span class="ss"> pixels, ~</span><span class="sc">{</span>estimated_pixels_10m <span class="op">*</span> <span class="dv">4</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">/</span> <span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> MB"</span>)</span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Alternative subset strategies available for experimentation</span></span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Core bands for essential analysis</span></span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a>    core_bands <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>, <span class="st">'B08'</span>]  <span class="co"># Red, Green, Blue, NIR</span></span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Selected </span><span class="sc">{</span><span class="bu">len</span>(core_bands)<span class="sc">}</span><span class="ss"> core bands for RGB and NDVI analysis"</span>)</span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"No optimal scene available - using default configuration"</span>)</span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a>    core_bands <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>, <span class="st">'B08'</span>]  <span class="co"># Default selection</span></span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a>    subset_bbox <span class="op">=</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:05:49,009 - INFO - Scene extent: 112.2×112.7 km (12646 km²)
2025-10-09 11:05:49,010 - INFO - Selected strategy: large_scene (16% coverage)
2025-10-09 11:05:49,010 - INFO - 📐 Calculated subset from scene bounds:
2025-10-09 11:05:49,010 - INFO -    Scene bbox: [-120.2952, 34.2097, -119.0654, 35.2250]
2025-10-09 11:05:49,010 - INFO -    Subset bbox: [-119.9262, 34.5143, -119.4343, 34.9204]
2025-10-09 11:05:49,010 - INFO -    X range: 30%-70%, Y range: 30%-70%
2025-10-09 11:05:49,011 - INFO -    Subset area: 16.0% of original scene
2025-10-09 11:05:49,011 - INFO - Subset: 2023 km², 20,233,972 pixels, ~161.9 MB
2025-10-09 11:05:49,011 - INFO - Selected 4 core bands for RGB and NDVI analysis</code></pre>
</div>
</div>
</section>
<section id="high-performance-data-loading-implementation" class="level3">
<h3 class="anchored" data-anchor-id="high-performance-data-loading-implementation">6.3 High-Performance Data Loading Implementation</h3>
<p>Now we’ll implement the actual data loading with comprehensive error handling and performance monitoring:</p>
<p><strong>Executing Production-Grade Data Loading:</strong></p>
<p>This demonstrates enterprise-level error handling and performance optimization with comprehensive pre-loading validation.</p>
<div id="e9d79728" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5B: Execute Robust Data Loading with Performance Monitoring</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'best_scene'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> <span class="st">'subset_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pre-loading validation and preparation</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Loading scene </span><span class="sc">{</span>best_scene<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(core_bands)<span class="sc">}</span><span class="ss"> bands, ~</span><span class="sc">{</span>estimated_pixels_10m <span class="op">*</span> <span class="bu">len</span>(core_bands) <span class="op">*</span> <span class="dv">2</span> <span class="op">/</span> <span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> MB"</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enhanced loading with comprehensive monitoring</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    loading_start_time <span class="op">=</span> time.time()</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>        band_data <span class="op">=</span> load_sentinel2_bands(</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>            best_scene,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>            bands<span class="op">=</span>core_bands,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>            subset_bbox<span class="op">=</span>subset_bbox,</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>            max_retries<span class="op">=</span><span class="dv">5</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>        loading_duration <span class="op">=</span> time.time() <span class="op">-</span> loading_start_time</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>        transfer_rate <span class="op">=</span> (estimated_pixels_10m <span class="op">*</span> <span class="bu">len</span>(core_bands) <span class="op">*</span> <span class="dv">2</span> <span class="op">/</span> <span class="fl">1e6</span>) <span class="op">/</span> loading_duration</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Data loading successful: </span><span class="sc">{</span>loading_duration<span class="sc">:.1f}</span><span class="ss">s, </span><span class="sc">{</span>transfer_rate<span class="sc">:.1f}</span><span class="ss"> MB/s"</span>)</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> loading_error:</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>        loading_duration <span class="op">=</span> time.time() <span class="op">-</span> loading_start_time</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="ss">f"Data loading failed after </span><span class="sc">{</span>loading_duration<span class="sc">:.1f}</span><span class="ss">s: </span><span class="sc">{</span><span class="bu">str</span>(loading_error)[:<span class="dv">80</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fallback 1: Try without subset</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>            band_data <span class="op">=</span> load_sentinel2_bands(</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>                best_scene,</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>                bands<span class="op">=</span>core_bands,</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>                subset_bbox<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>                max_retries<span class="op">=</span><span class="dv">3</span></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="st">"Full scene loading successful"</span>)</span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>            subset_bbox <span class="op">=</span> <span class="va">None</span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> full_scene_error:</span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>            logger.warning(<span class="ss">f"Full scene loading failed: </span><span class="sc">{</span><span class="bu">str</span>(full_scene_error)[:<span class="dv">80</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Fallback 2: Reduce band count</span></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>                essential_bands <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B08'</span>]  <span class="co"># Minimum for NDVI</span></span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>                band_data <span class="op">=</span> load_sentinel2_bands(</span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>                    best_scene,</span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a>                    bands<span class="op">=</span>essential_bands,</span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a>                    subset_bbox<span class="op">=</span>subset_bbox,</span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a>                    max_retries<span class="op">=</span><span class="dv">3</span></span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a>                core_bands <span class="op">=</span> essential_bands</span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a>                logger.info(<span class="ss">f"Reduced band loading successful (</span><span class="sc">{</span><span class="bu">len</span>(essential_bands)<span class="sc">}</span><span class="ss"> bands)"</span>)</span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> reduced_error:</span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a>                logger.error(<span class="st">"All loading strategies failed - creating synthetic data"</span>)</span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Create realistic synthetic data for educational continuity</span></span>
<span id="cb46-53"><a href="#cb46-53" aria-hidden="true" tabindex="-1"></a>                synthetic_size <span class="op">=</span> (<span class="dv">1000</span>, <span class="dv">1000</span>)</span>
<span id="cb46-54"><a href="#cb46-54" aria-hidden="true" tabindex="-1"></a>                band_data <span class="op">=</span> {</span>
<span id="cb46-55"><a href="#cb46-55" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B04'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb46-56"><a href="#cb46-56" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B03'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb46-57"><a href="#cb46-57" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B02'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb46-58"><a href="#cb46-58" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B08'</span>: np.random.randint(<span class="dv">2000</span>, <span class="dv">6000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb46-59"><a href="#cb46-59" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'transform'</span>: <span class="va">None</span>,</span>
<span id="cb46-60"><a href="#cb46-60" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'crs'</span>: <span class="va">None</span>,</span>
<span id="cb46-61"><a href="#cb46-61" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'bounds'</span>: subset_bbox <span class="cf">if</span> subset_bbox <span class="cf">else</span> santa_barbara_bbox,</span>
<span id="cb46-62"><a href="#cb46-62" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'scene_id'</span>: <span class="st">'SYNTHETIC_DEMO'</span>,</span>
<span id="cb46-63"><a href="#cb46-63" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'date'</span>: <span class="st">'2024-01-01'</span></span>
<span id="cb46-64"><a href="#cb46-64" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb46-65"><a href="#cb46-65" aria-hidden="true" tabindex="-1"></a>                logger.info(<span class="ss">f"Synthetic data created: </span><span class="sc">{</span>synthetic_size[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">×</span><span class="sc">{</span>synthetic_size[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb46-66"><a href="#cb46-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-67"><a href="#cb46-67" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb46-68"><a href="#cb46-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback for educational purposes</span></span>
<span id="cb46-69"><a href="#cb46-69" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"No scene available - creating educational synthetic dataset"</span>)</span>
<span id="cb46-70"><a href="#cb46-70" aria-hidden="true" tabindex="-1"></a>    synthetic_size <span class="op">=</span> (<span class="dv">800</span>, <span class="dv">800</span>)</span>
<span id="cb46-71"><a href="#cb46-71" aria-hidden="true" tabindex="-1"></a>    band_data <span class="op">=</span> {</span>
<span id="cb46-72"><a href="#cb46-72" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B04'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb46-73"><a href="#cb46-73" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B03'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb46-74"><a href="#cb46-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B02'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb46-75"><a href="#cb46-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B08'</span>: np.random.randint(<span class="dv">2000</span>, <span class="dv">6000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb46-76"><a href="#cb46-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">'transform'</span>: <span class="va">None</span>,</span>
<span id="cb46-77"><a href="#cb46-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">'crs'</span>: <span class="va">None</span>,</span>
<span id="cb46-78"><a href="#cb46-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bounds'</span>: [<span class="op">-</span><span class="fl">122.5</span>, <span class="fl">37.7</span>, <span class="op">-</span><span class="fl">122.35</span>, <span class="fl">37.85</span>],</span>
<span id="cb46-79"><a href="#cb46-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">'scene_id'</span>: <span class="st">'EDUCATIONAL_DEMO'</span>,</span>
<span id="cb46-80"><a href="#cb46-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span>: <span class="st">'2024-01-01'</span></span>
<span id="cb46-81"><a href="#cb46-81" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb46-82"><a href="#cb46-82" aria-hidden="true" tabindex="-1"></a>    core_bands <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>, <span class="st">'B08'</span>]</span>
<span id="cb46-83"><a href="#cb46-83" aria-hidden="true" tabindex="-1"></a>    subset_bbox <span class="op">=</span> <span class="va">None</span></span>
<span id="cb46-84"><a href="#cb46-84" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Educational dataset ready: </span><span class="sc">{</span>synthetic_size[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">×</span><span class="sc">{</span>synthetic_size[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> pixels"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:05:49,020 - INFO - Loading scene S2B_MSIL2A_20240813T183919_R070_T11SKU_20240813T224159: 4 bands, ~161.9 MB
2025-10-09 11:05:49,279 - WARNING - CPLE_AppDefined in PROJ: proj_create_from_database: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.
2025-10-09 11:05:49,280 - WARNING - CPLE_AppDefined in The definition of projected CRS EPSG:32611 got from GeoTIFF keys is not the same as the one from the EPSG registry, which may cause issues during reprojection operations. Set GTIFF_SRS_SOURCE configuration option to EPSG to use official parameters (overriding the ones from GeoTIFF keys), or to GEOKEYS to use custom values from GeoTIFF keys and drop the EPSG code.
2025-10-09 11:05:49,289 - INFO - GDAL signalled an error: err_no=1, msg='PROJ: proj_create_from_database: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.'
2025-10-09 11:08:58,351 - WARNING - CPLE_AppDefined in PROJ: proj_create_from_database: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.
2025-10-09 11:08:58,352 - WARNING - CPLE_AppDefined in The definition of projected CRS EPSG:32611 got from GeoTIFF keys is not the same as the one from the EPSG registry, which may cause issues during reprojection operations. Set GTIFF_SRS_SOURCE configuration option to EPSG to use official parameters (overriding the ones from GeoTIFF keys), or to GEOKEYS to use custom values from GeoTIFF keys and drop the EPSG code.
2025-10-09 11:08:58,361 - INFO - GDAL signalled an error: err_no=1, msg='PROJ: proj_create_from_database: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.'
2025-10-09 11:12:29,905 - WARNING - CPLE_AppDefined in PROJ: proj_create_from_database: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.
2025-10-09 11:12:29,906 - WARNING - CPLE_AppDefined in The definition of projected CRS EPSG:32611 got from GeoTIFF keys is not the same as the one from the EPSG registry, which may cause issues during reprojection operations. Set GTIFF_SRS_SOURCE configuration option to EPSG to use official parameters (overriding the ones from GeoTIFF keys), or to GEOKEYS to use custom values from GeoTIFF keys and drop the EPSG code.
2025-10-09 11:12:29,915 - INFO - GDAL signalled an error: err_no=1, msg='PROJ: proj_create_from_database: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.'
2025-10-09 11:15:30,267 - WARNING - CPLE_AppDefined in PROJ: proj_create_from_database: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.
2025-10-09 11:15:30,268 - WARNING - CPLE_AppDefined in The definition of projected CRS EPSG:32611 got from GeoTIFF keys is not the same as the one from the EPSG registry, which may cause issues during reprojection operations. Set GTIFF_SRS_SOURCE configuration option to EPSG to use official parameters (overriding the ones from GeoTIFF keys), or to GEOKEYS to use custom values from GeoTIFF keys and drop the EPSG code.
2025-10-09 11:15:30,278 - INFO - GDAL signalled an error: err_no=1, msg='PROJ: proj_create_from_database: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.'
2025-10-09 11:18:17,142 - INFO - Successfully loaded 4 bands: ['B04', 'B03', 'B02', 'B08']
2025-10-09 11:18:17,144 - INFO - Data loading successful: 748.1s, 0.2 MB/s</code></pre>
</div>
</div>
</section>
<section id="comprehensive-data-validation-and-quality-assessment" class="level3">
<h3 class="anchored" data-anchor-id="comprehensive-data-validation-and-quality-assessment">6.4 Comprehensive Data Validation and Quality Assessment</h3>
<p>After loading, we must validate data quality and completeness before proceeding with analysis:</p>
<p><strong>Performing Comprehensive Data Validation:</strong></p>
<p>This demonstrates production-level quality assurance for satellite data including validation of data loading success and quality metrics.</p>
<div id="d24d3432" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5C: Comprehensive Data Validation and Quality Assessment</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate successful data loading</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'band_data'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> band_data:</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract loaded bands and metadata</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    available_bands <span class="op">=</span> [b <span class="cf">for</span> b <span class="kw">in</span> core_bands <span class="cf">if</span> b <span class="kw">in</span> band_data <span class="kw">and</span> <span class="bu">isinstance</span>(band_data[b], np.ndarray)]</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract georeferencing information</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    transform <span class="op">=</span> band_data.get(<span class="st">'transform'</span>, <span class="va">None</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    crs <span class="op">=</span> band_data.get(<span class="st">'crs'</span>, <span class="va">None</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    bounds <span class="op">=</span> band_data.get(<span class="st">'bounds'</span>, subset_bbox <span class="cf">if</span> <span class="st">'subset_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> santa_barbara_bbox)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    scene_id <span class="op">=</span> band_data.get(<span class="st">'scene_id'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    acquisition_date <span class="op">=</span> band_data.get(<span class="st">'date'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Loaded </span><span class="sc">{</span><span class="bu">len</span>(available_bands)<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(core_bands)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span>available_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Scene: </span><span class="sc">{</span>scene_id<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>acquisition_date<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Quality assessment</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    band_stats_summary <span class="op">=</span> {}</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_name <span class="kw">in</span> available_bands:</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> band_name <span class="kw">in</span> band_data:</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>            stats <span class="op">=</span> calculate_band_statistics(band_data[band_name], band_name)</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>            band_stats_summary[band_name] <span class="op">=</span> stats</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Quality flags</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>            quality_flags <span class="op">=</span> []</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> stats[<span class="st">'valid_pixels'</span>] <span class="op">&lt;</span> stats[<span class="st">'total_pixels'</span>] <span class="op">*</span> <span class="fl">0.95</span>:</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>                quality_flags.append(<span class="st">"invalid pixels"</span>)</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> stats[<span class="st">'std'</span>] <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>                quality_flags.append(<span class="st">"low variance"</span>)</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> stats[<span class="st">'max'</span>] <span class="op">&gt;</span> <span class="dv">10000</span>:</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>                quality_flags.append(<span class="st">"possible saturation"</span>)</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>            quality_status <span class="op">=</span> <span class="st">"; "</span>.join(quality_flags) <span class="cf">if</span> quality_flags <span class="cf">else</span> <span class="st">"normal"</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"</span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss">: range [</span><span class="sc">{</span>stats[<span class="st">'min'</span>]<span class="sc">:.0f}</span><span class="ss">, </span><span class="sc">{</span>stats[<span class="st">'max'</span>]<span class="sc">:.0f}</span><span class="ss">], quality: </span><span class="sc">{</span>quality_status<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cross-band validation</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(available_bands) <span class="op">&gt;=</span> <span class="dv">2</span>:</span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>        shapes <span class="op">=</span> [band_data[band].shape <span class="cf">for</span> band <span class="kw">in</span> available_bands]</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>        consistent_shape <span class="op">=</span> <span class="bu">all</span>(shape <span class="op">==</span> shapes[<span class="dv">0</span>] <span class="cf">for</span> shape <span class="kw">in</span> shapes)</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Spatial consistency: </span><span class="sc">{</span><span class="st">'✓'</span> <span class="cf">if</span> consistent_shape <span class="cf">else</span> <span class="st">'⚠'</span><span class="sc">}</span><span class="ss"> shape </span><span class="sc">{</span>shapes[<span class="dv">0</span>] <span class="cf">if</span> consistent_shape <span class="cf">else</span> <span class="st">'mixed'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check for reasonable spectral relationships</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'B04'</span> <span class="kw">in</span> available_bands <span class="kw">and</span> <span class="st">'B08'</span> <span class="kw">in</span> available_bands:</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>            ndvi_sample <span class="op">=</span> calculate_ndvi(band_data[<span class="st">'B08'</span>][:<span class="dv">100</span>, :<span class="dv">100</span>], band_data[<span class="st">'B04'</span>][:<span class="dv">100</span>, :<span class="dv">100</span>])</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>            ndvi_mean <span class="op">=</span> np.nanmean(ndvi_sample)</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>            <span class="co"># NDVI sanity check</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">-</span><span class="dv">1</span> <span class="op">&lt;=</span> ndvi_mean <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>                logger.info(<span class="ss">f"NDVI validation passed: mean = </span><span class="sc">{</span>ndvi_mean<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>                logger.warning(<span class="ss">f"NDVI anomaly detected: mean = </span><span class="sc">{</span>ndvi_mean<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overall data readiness assessment</span></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>    readiness_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>    readiness_criteria <span class="op">=</span> {</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bands_available'</span>: <span class="bu">len</span>(available_bands) <span class="op">&gt;=</span> <span class="dv">3</span>,  <span class="co"># Minimum for RGB</span></span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">'spatial_consistency'</span>: <span class="st">'consistent_shape'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> consistent_shape,</span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">'valid_pixels'</span>: <span class="bu">all</span>(stats[<span class="st">'valid_pixels'</span>] <span class="op">&gt;</span> stats[<span class="st">'total_pixels'</span>] <span class="op">*</span> <span class="fl">0.9</span> <span class="cf">for</span> stats <span class="kw">in</span> band_stats_summary.values()),</span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">'spectral_sanity'</span>: <span class="st">'ndvi_mean'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> <span class="op">-</span><span class="dv">1</span> <span class="op">&lt;=</span> ndvi_mean <span class="op">&lt;=</span> <span class="dv">1</span></span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a>    readiness_score <span class="op">=</span> <span class="bu">sum</span>(readiness_criteria.values())</span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a>    max_score <span class="op">=</span> <span class="bu">len</span>(readiness_criteria)</span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overall data readiness assessment</span></span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Data readiness: </span><span class="sc">{</span>readiness_score<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>max_score<span class="sc">}</span><span class="ss"> criteria passed"</span>)</span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> readiness_score <span class="op">&gt;=</span> max_score <span class="op">*</span> <span class="fl">0.75</span>:</span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="st">"STATUS: READY for analysis - High quality data confirmed"</span>)</span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> readiness_score <span class="op">&gt;=</span> max_score <span class="op">*</span> <span class="fl">0.5</span>:</span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a>        logger.warning(<span class="st">"STATUS: PROCEED WITH CAUTION - Some quality issues detected"</span>)</span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="st">"STATUS: QUALITY ISSUES - Consider alternative data sources"</span>)</span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a>    logger.error(<span class="st">"Data validation failed - no valid satellite data available"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:18:17,160 - INFO - Loaded 4/4 bands: ['B04', 'B03', 'B02', 'B08']
2025-10-09 11:18:17,160 - INFO - Scene: S2B_MSIL2A_20240813T183919_R070_T11SKU_20240813T224159 (2024-08-13)
2025-10-09 11:18:20,102 - INFO - B04: range [0, 17888], quality: possible saturation
2025-10-09 11:18:22,958 - INFO - B03: range [0, 18720], quality: possible saturation
2025-10-09 11:18:26,099 - INFO - B02: range [0, 19840], quality: possible saturation
2025-10-09 11:18:28,682 - INFO - B08: range [0, 17104], quality: possible saturation
2025-10-09 11:18:28,683 - INFO - Spatial consistency: ✓ shape (10980, 10980)
2025-10-09 11:18:28,684 - INFO - NDVI validation passed: mean = 0.276
2025-10-09 11:18:28,684 - INFO - Data readiness: 4/4 criteria passed
2025-10-09 11:18:28,685 - INFO - STATUS: READY for analysis - High quality data confirmed</code></pre>
</div>
</div>
</section>
<section id="creating-ai-ready-multi-dimensional-datasets" class="level3">
<h3 class="anchored" data-anchor-id="creating-ai-ready-multi-dimensional-datasets">6.5 Creating AI-Ready Multi-Dimensional Datasets</h3>
<p>Transform loaded bands into analysis-ready xarray datasets optimized for AI/ML workflows:</p>
<p><strong>Creating AI-Ready Multi-Dimensional Dataset:</strong></p>
<p>This demonstrates data structuring for machine learning applications, transforming raw satellite bands into analysis-ready xarray datasets.</p>
<div id="d1bf63a6" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5D: Build AI-Ready Multi-Dimensional Dataset</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'band_data'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> band_data <span class="kw">and</span> available_bands:</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get spatial dimensions from first available band</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    sample_band <span class="op">=</span> band_data[available_bands[<span class="dv">0</span>]]</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    height, width <span class="op">=</span> sample_band.shape</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dataset characteristics</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    total_elements <span class="op">=</span> height <span class="op">*</span> width <span class="op">*</span> <span class="bu">len</span>(available_bands)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Dataset: </span><span class="sc">{</span>height<span class="sc">}</span><span class="ss">×</span><span class="sc">{</span>width<span class="sc">}</span><span class="ss"> pixels, </span><span class="sc">{</span><span class="bu">len</span>(available_bands)<span class="sc">}</span><span class="ss"> bands, </span><span class="sc">{</span>total_elements<span class="sc">:,}</span><span class="ss"> elements"</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create sophisticated coordinate system</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bounds <span class="kw">and</span> <span class="bu">len</span>(bounds) <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Geographic coordinates (WGS84)</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>        x_coords <span class="op">=</span> np.linspace(bounds[<span class="dv">0</span>], bounds[<span class="dv">2</span>], width)   <span class="co"># Longitude</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>        y_coords <span class="op">=</span> np.linspace(bounds[<span class="dv">3</span>], bounds[<span class="dv">1</span>], height)  <span class="co"># Latitude (north to south)</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>        coord_system <span class="op">=</span> <span class="st">"geographic"</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pixel coordinates</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>        x_coords <span class="op">=</span> np.arange(width)</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>        y_coords <span class="op">=</span> np.arange(height)</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>        coord_system <span class="op">=</span> <span class="st">"pixel"</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"Coordinates: </span><span class="sc">{</span>coord_system<span class="sc">}</span><span class="ss">, X: </span><span class="sc">{</span>x_coords[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss"> to </span><span class="sc">{</span>x_coords[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">, Y: </span><span class="sc">{</span>y_coords[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss"> to </span><span class="sc">{</span>y_coords[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build xarray DataArrays with comprehensive metadata</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>    data_arrays <span class="op">=</span> {}</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    band_metadata <span class="op">=</span> {</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B02'</span>: {<span class="st">'name'</span>: <span class="st">'blue'</span>, <span class="st">'wavelength'</span>: <span class="dv">490</span>, <span class="st">'description'</span>: <span class="st">'Blue band (coastal/aerosol)'</span>},</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B03'</span>: {<span class="st">'name'</span>: <span class="st">'green'</span>, <span class="st">'wavelength'</span>: <span class="dv">560</span>, <span class="st">'description'</span>: <span class="st">'Green band (vegetation)'</span>},</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B04'</span>: {<span class="st">'name'</span>: <span class="st">'red'</span>, <span class="st">'wavelength'</span>: <span class="dv">665</span>, <span class="st">'description'</span>: <span class="st">'Red band (chlorophyll absorption)'</span>},</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B08'</span>: {<span class="st">'name'</span>: <span class="st">'nir'</span>, <span class="st">'wavelength'</span>: <span class="dv">842</span>, <span class="st">'description'</span>: <span class="st">'Near-infrared (biomass/structure)'</span>}</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build spectral data arrays</span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_id <span class="kw">in</span> available_bands:</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> band_id <span class="kw">in</span> band_metadata:</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>            metadata <span class="op">=</span> band_metadata[band_id]</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>            band_name <span class="op">=</span> metadata[<span class="st">'name'</span>]</span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create DataArray with rich metadata</span></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>            data_arrays[band_name] <span class="op">=</span> xr.DataArray(</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>                band_data[band_id],</span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>                dims<span class="op">=</span>[<span class="st">'y'</span>, <span class="st">'x'</span>],</span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>                coords<span class="op">=</span>{</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'y'</span>: (<span class="st">'y'</span>, y_coords, {<span class="st">'long_name'</span>: <span class="st">'Latitude'</span> <span class="cf">if</span> coord_system <span class="op">==</span> <span class="st">'geographic'</span> <span class="cf">else</span> <span class="st">'Y coordinate'</span>,</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'units'</span>: <span class="st">'degrees_north'</span> <span class="cf">if</span> coord_system <span class="op">==</span> <span class="st">'geographic'</span> <span class="cf">else</span> <span class="st">'pixels'</span>}),</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'x'</span>: (<span class="st">'x'</span>, x_coords, {<span class="st">'long_name'</span>: <span class="st">'Longitude'</span> <span class="cf">if</span> coord_system <span class="op">==</span> <span class="st">'geographic'</span> <span class="cf">else</span> <span class="st">'X coordinate'</span>,</span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'units'</span>: <span class="st">'degrees_east'</span> <span class="cf">if</span> coord_system <span class="op">==</span> <span class="st">'geographic'</span> <span class="cf">else</span> <span class="st">'pixels'</span>})</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a>                attrs<span class="op">=</span>{</span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'band_id'</span>: band_id,</span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'long_name'</span>: metadata[<span class="st">'description'</span>],</span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'wavelength'</span>: metadata[<span class="st">'wavelength'</span>],</span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'wavelength_units'</span>: <span class="st">'nanometers'</span>,</span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'units'</span>: <span class="st">'DN'</span>,</span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'valid_range'</span>: [<span class="dv">0</span>, <span class="dv">10000</span>],</span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'scale_factor'</span>: <span class="fl">1.0</span>,</span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'add_offset'</span>: <span class="fl">0.0</span></span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a>            logger.debug(<span class="ss">f"Created DataArray: </span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>metadata[<span class="st">'wavelength'</span>]<span class="sc">}</span><span class="ss">nm)"</span>)</span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create comprehensive Dataset</span></span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a>    satellite_ds <span class="op">=</span> xr.Dataset(</span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a>        data_arrays,</span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true" tabindex="-1"></a>        attrs<span class="op">=</span>{</span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true" tabindex="-1"></a>            <span class="st">'title'</span>: <span class="st">'Sentinel-2 Level 2A Surface Reflectance'</span>,</span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true" tabindex="-1"></a>            <span class="st">'source'</span>: <span class="ss">f'Scene: </span><span class="sc">{</span>scene_id<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true" tabindex="-1"></a>            <span class="st">'acquisition_date'</span>: acquisition_date,</span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true" tabindex="-1"></a>            <span class="st">'processing_level'</span>: <span class="st">'L2A'</span>,</span>
<span id="cb50-72"><a href="#cb50-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">'crs'</span>: <span class="bu">str</span>(crs) <span class="cf">if</span> crs <span class="cf">else</span> <span class="st">'WGS84 (assumed)'</span>,</span>
<span id="cb50-73"><a href="#cb50-73" aria-hidden="true" tabindex="-1"></a>            <span class="st">'spatial_resolution'</span>: <span class="st">'10 meters'</span>,</span>
<span id="cb50-74"><a href="#cb50-74" aria-hidden="true" tabindex="-1"></a>            <span class="st">'coordinate_system'</span>: coord_system,</span>
<span id="cb50-75"><a href="#cb50-75" aria-hidden="true" tabindex="-1"></a>            <span class="st">'creation_date'</span>: pd.Timestamp.now().isoformat(),</span>
<span id="cb50-76"><a href="#cb50-76" aria-hidden="true" tabindex="-1"></a>            <span class="st">'processing_software'</span>: <span class="st">'Geospatial AI Toolkit'</span>,</span>
<span id="cb50-77"><a href="#cb50-77" aria-hidden="true" tabindex="-1"></a>            <span class="st">'data_access'</span>: <span class="st">'Microsoft Planetary Computer via STAC'</span></span>
<span id="cb50-78"><a href="#cb50-78" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb50-79"><a href="#cb50-79" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-80"><a href="#cb50-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-81"><a href="#cb50-81" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Created xarray Dataset with </span><span class="sc">{</span><span class="bu">len</span>(data_arrays)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span><span class="bu">list</span>(satellite_ds.data_vars)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb50-82"><a href="#cb50-82" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(satellite_ds)  <span class="co"># Display dataset structure</span></span>
<span id="cb50-83"><a href="#cb50-83" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb50-84"><a href="#cb50-84" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"No band data available for xarray Dataset creation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:18:28,695 - INFO - Dataset: 10980×10980 pixels, 4 bands, 482,241,600 elements
ERROR 1: PROJ: proj_identify: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.
2025-10-09 11:18:28,720 - INFO - Created xarray Dataset with 4 bands: ['red', 'green', 'blue', 'nir']</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;xarray.Dataset&gt; Size: 965MB
Dimensions:  (y: 10980, x: 10980)
Coordinates:
  * y        (y) float64 88kB 3.9e+06 3.9e+06 3.9e+06 ... 3.79e+06 3.79e+06
  * x        (x) float64 88kB 2e+05 2e+05 2e+05 ... 3.098e+05 3.098e+05
Data variables:
    red      (y, x) uint16 241MB 1664 1718 1734 1662 ... 2146 2600 1943 2122
    green    (y, x) uint16 241MB 1534 1594 1581 1542 ... 2116 2584 1994 1936
    blue     (y, x) uint16 241MB 1406 1418 1400 1421 ... 1942 2332 1737 1664
    nir      (y, x) uint16 241MB 2712 2744 2798 2894 ... 2968 3464 3182 2982
Attributes:
    title:                Sentinel-2 Level 2A Surface Reflectance
    source:               Scene: S2B_MSIL2A_20240813T183919_R070_T11SKU_20240...
    acquisition_date:     2024-08-13
    processing_level:     L2A
    crs:                  PROJCS["WGS 84 / UTM zone 11N",GEOGCS["WGS 84",DATU...
    spatial_resolution:   10 meters
    coordinate_system:    geographic
    creation_date:        2025-10-09T11:18:28.717391
    processing_software:  Geospatial AI Toolkit
    data_access:          Microsoft Planetary Computer via STAC</code></pre>
</div>
</div>
</section>
</section>
<section id="rasterio-xarray-and-rioxarray" class="level2">
<h2 class="anchored" data-anchor-id="rasterio-xarray-and-rioxarray">Rasterio, Xarray, and Rioxarray</h2>
<p>Rasterio provides lower-level, direct file access and is well-suited for basic geospatial raster operations. Xarray offers a higher-level interface, making it easier to handle metadata and perform advanced analysis. Rioxarray extends xarray by adding geospatial capabilities, effectively bridging the gap between the two approaches.</p>
<hr>
</section>
<section id="scientific-visualization-and-spectral-analysis" class="level2">
<h2 class="anchored" data-anchor-id="scientific-visualization-and-spectral-analysis">7. Scientific Visualization and Spectral Analysis</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you will be able to design publication-quality visualizations for satellite data analysis, understand the importance of perceptually uniform colormaps in scientific visualization, create informative multi-panel displays with appropriate context and interpretation, and calculate as well as visualize spectral indices for environmental monitoring.</p>
</div>
</div>
<section id="principles-of-scientific-visualization-for-remote-sensing" class="level3">
<h3 class="anchored" data-anchor-id="principles-of-scientific-visualization-for-remote-sensing">7.1 Principles of Scientific Visualization for Remote Sensing</h3>
<p>Effective satellite data visualization requires attention to perceptual accuracy, ensuring that colors accurately represent data relationships. It is important to maximize information density to provide insight with minimal cognitive load, while also preserving spatial and temporal context. Additionally, visualizations should be accessible and interpretable by a wide range of audiences.</p>
</section>
<section id="advanced-color-composite-creation" class="level3">
<h3 class="anchored" data-anchor-id="advanced-color-composite-creation">7.2 Advanced Color Composite Creation</h3>
<div id="92f6ddfb" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> band_data <span class="kw">and</span> <span class="bu">all</span>(k <span class="kw">in</span> band_data <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>]):</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create true color RGB composite using our helper function</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    rgb_composite <span class="op">=</span> create_rgb_composite(</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>        red<span class="op">=</span>band_data[<span class="st">'B04'</span>],</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>        green<span class="op">=</span>band_data[<span class="st">'B03'</span>],</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>        blue<span class="op">=</span>band_data[<span class="st">'B02'</span>],</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        enhance<span class="op">=</span><span class="va">True</span>  <span class="co"># Apply contrast enhancement</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"   RGB composite shape: </span><span class="sc">{</span>rgb_composite<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create false color composite if NIR band is available</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    false_color_composite <span class="op">=</span> <span class="va">None</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'B08'</span> <span class="kw">in</span> band_data:</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>        false_color_composite <span class="op">=</span> create_rgb_composite(</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>            red<span class="op">=</span>band_data[<span class="st">'B08'</span>],   <span class="co"># NIR in red channel</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>            green<span class="op">=</span>band_data[<span class="st">'B04'</span>],  <span class="co"># Red in green channel</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>            blue<span class="op">=</span>band_data[<span class="st">'B03'</span>],   <span class="co"># Green in blue channel</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>            enhance<span class="op">=</span><span class="va">True</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"   False color composite created"</span>)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualize the composites</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'B08'</span> <span class="kw">in</span> band_data:</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>        fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>        fig, ax1 <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>        ax2 <span class="op">=</span> <span class="va">None</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># True color</span></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>    ax1.imshow(rgb_composite)</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'True Color (RGB)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>    ax1.axis(<span class="st">'off'</span>)</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add scale bar</span></span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'transform'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> transform:</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate pixel size in meters (approximate)</span></span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>        pixel_size <span class="op">=</span> <span class="bu">abs</span>(transform.a)  <span class="co"># Assuming square pixels</span></span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>        scalebar_pixels <span class="op">=</span> <span class="bu">int</span>(<span class="dv">1000</span> <span class="op">/</span> pixel_size)  <span class="co"># 1km scale bar</span></span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> scalebar_pixels <span class="op">&lt;</span> rgb_composite.shape[<span class="dv">1</span>] <span class="op">/</span> <span class="dv">4</span>:</span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>            ax1.plot([<span class="dv">10</span>, <span class="dv">10</span> <span class="op">+</span> scalebar_pixels],</span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>                    [rgb_composite.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">20</span>, rgb_composite.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">20</span>],</span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'w-'</span>, linewidth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>            ax1.text(<span class="dv">10</span> <span class="op">+</span> scalebar_pixels<span class="op">/</span><span class="dv">2</span>, rgb_composite.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">30</span>,</span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'1 km'</span>, color<span class="op">=</span><span class="st">'white'</span>, ha<span class="op">=</span><span class="st">'center'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># False color if available</span></span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax2 <span class="kw">and</span> false_color_composite <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a>        ax2.imshow(false_color_composite)</span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>        ax2.set_title(<span class="st">'False Color (NIR-R-G)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>        ax2.axis(<span class="st">'off'</span>)</span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a>        ax2.text(<span class="fl">0.02</span>, <span class="fl">0.98</span>, <span class="st">'Vegetation appears red'</span>,</span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a>                transform<span class="op">=</span>ax2.transAxes, color<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">10</span>, va<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a>                bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'round'</span>, facecolor<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="st">'Sentinel-2 Composites'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb53-59"><a href="#cb53-59" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb53-60"><a href="#cb53-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-61"><a href="#cb53-61" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"RGB composites created successfully"</span>)</span>
<span id="cb53-62"><a href="#cb53-62" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb53-63"><a href="#cb53-63" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"Insufficient bands for RGB composite"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:18:33,433 - INFO -    RGB composite shape: (10980, 10980, 3)
2025-10-09 11:18:37,983 - INFO -    False color composite created</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="c01-geospatial-data-foundations-OLD_files/figure-html/cell-33-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:18:48,267 - INFO - RGB composites created successfully</code></pre>
</div>
</div>
</section>
<section id="calculate-vegetation-indices" class="level3">
<h3 class="anchored" data-anchor-id="calculate-vegetation-indices">7.3 Calculate Vegetation Indices</h3>
<div id="7b2a0ceb" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> band_data <span class="kw">and</span> <span class="st">'B08'</span> <span class="kw">in</span> band_data <span class="kw">and</span> <span class="st">'B04'</span> <span class="kw">in</span> band_data:</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate NDVI using our helper function</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> calculate_ndvi(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>        nir<span class="op">=</span>band_data[<span class="st">'B08'</span>],</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>        red<span class="op">=</span>band_data[<span class="st">'B04'</span>]</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get NDVI statistics</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    ndvi_stats <span class="op">=</span> calculate_band_statistics(ndvi, <span class="st">"NDVI"</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI statistics</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"NDVI stats - Range: [</span><span class="sc">{</span>ndvi_stats[<span class="st">'min'</span>]<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>ndvi_stats[<span class="st">'max'</span>]<span class="sc">:.3f}</span><span class="ss">], Mean: </span><span class="sc">{</span>ndvi_stats[<span class="st">'mean'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Interpret NDVI values</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    vegetation_pixels <span class="op">=</span> np.<span class="bu">sum</span>(ndvi <span class="op">&gt;</span> <span class="fl">0.3</span>)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    water_pixels <span class="op">=</span> np.<span class="bu">sum</span>(ndvi <span class="op">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    urban_pixels <span class="op">=</span> np.<span class="bu">sum</span>((ndvi <span class="op">&gt;=</span> <span class="dv">0</span>) <span class="op">&amp;</span> (ndvi <span class="op">&lt;=</span> <span class="fl">0.2</span>))</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    total_valid <span class="op">=</span> ndvi_stats[<span class="st">'valid_pixels'</span>]</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Land cover interpretation</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    veg_pct <span class="op">=</span> vegetation_pixels<span class="op">/</span>total_valid<span class="op">*</span><span class="dv">100</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    urban_pct <span class="op">=</span> urban_pixels<span class="op">/</span>total_valid<span class="op">*</span><span class="dv">100</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    water_pct <span class="op">=</span> water_pixels<span class="op">/</span>total_valid<span class="op">*</span><span class="dv">100</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Land cover - Vegetation: </span><span class="sc">{</span>veg_pct<span class="sc">:.1f}</span><span class="ss">%, Urban: </span><span class="sc">{</span>urban_pct<span class="sc">:.1f}</span><span class="ss">%, Water: </span><span class="sc">{</span>water_pct<span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a detailed NDVI visualization</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI map</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> ax1.imshow(ndvi, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, vmin<span class="op">=-</span><span class="fl">0.5</span>, vmax<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'NDVI (Normalized Difference Vegetation Index)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>    ax1.axis(<span class="st">'off'</span>)</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add colorbar</span></span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>    cbar <span class="op">=</span> plt.colorbar(im, ax<span class="op">=</span>ax1, shrink<span class="op">=</span><span class="fl">0.8</span>, pad<span class="op">=</span><span class="fl">0.02</span>)</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>    cbar.set_label(<span class="st">'NDVI Value'</span>, rotation<span class="op">=</span><span class="dv">270</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add interpretation labels to colorbar</span></span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>    cbar.ax.text(<span class="fl">1.3</span>, <span class="fl">0.8</span>, <span class="st">'Dense vegetation'</span>, transform<span class="op">=</span>cbar.ax.transAxes, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>    cbar.ax.text(<span class="fl">1.3</span>, <span class="fl">0.5</span>, <span class="st">'Sparse vegetation'</span>, transform<span class="op">=</span>cbar.ax.transAxes, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>    cbar.ax.text(<span class="fl">1.3</span>, <span class="fl">0.2</span>, <span class="st">'Bare soil/Urban'</span>, transform<span class="op">=</span>cbar.ax.transAxes, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>    cbar.ax.text(<span class="fl">1.3</span>, <span class="fl">0.0</span>, <span class="st">'Water/Clouds'</span>, transform<span class="op">=</span>cbar.ax.transAxes, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI histogram</span></span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>    ax2.hist(ndvi.flatten(), bins<span class="op">=</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">'green'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>    ax2.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'blue'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Water threshold'</span>)</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>    ax2.axvline(<span class="fl">0.3</span>, color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Vegetation threshold'</span>)</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'NDVI Value'</span>)</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Pixel Count'</span>)</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'NDVI Distribution'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>    ax2.legend()</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>    ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"NDVI analysis complete"</span>)</span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"NIR and Red bands required for NDVI calculation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:18:51,475 - INFO - NDVI stats - Range: [-1.000, 1.000], Mean: 0.199
2025-10-09 11:18:51,623 - INFO - Land cover - Vegetation: 24.6%, Urban: 44.7%, Water: 10.4%</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="c01-geospatial-data-foundations-OLD_files/figure-html/cell-34-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:19:01,149 - INFO - NDVI analysis complete</code></pre>
</div>
</div>
</section>
</section>
<section id="understanding-ndvi-values" class="level2">
<h2 class="anchored" data-anchor-id="understanding-ndvi-values">Understanding NDVI Values</h2>
<p>NDVI values range from -1 to 1, and different intervals correspond to various land cover types. Values from -1 to 0 typically indicate water bodies, clouds, snow, or shadows. Values between 0 and 0.2 are characteristic of bare soil, rock, urban areas, or beaches. NDVI values from 0.2 to 0.4 suggest sparse vegetation, such as grasslands or agricultural areas. Moderate vegetation, including shrublands and crops, is usually found in the 0.4 to 0.6 range. Dense vegetation, such as forests and healthy crops, is represented by NDVI values between 0.6 and 1.0.</p>
<p>A common practice in environmental studies is to use NDVI values greater than 0.3 as a mask to identify vegetated areas.</p>
<hr>
</section>
<section id="band-analysis" class="level2">
<h2 class="anchored" data-anchor-id="band-analysis">8. Band Analysis</h2>
<section id="comprehensive-multi-band-analysis" class="level3">
<h3 class="anchored" data-anchor-id="comprehensive-multi-band-analysis">8.1 Comprehensive Multi-band Analysis</h3>
<div id="865bddb2" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> band_data <span class="kw">and</span> <span class="st">'rgb_composite'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use our helper function for visualization</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out None values from bands dictionary</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    valid_bands <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> {<span class="st">'B04'</span>: band_data.get(<span class="st">'B04'</span>), <span class="st">'B08'</span>: band_data.get(<span class="st">'B08'</span>)}.items() <span class="cf">if</span> v <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> <span class="bu">isinstance</span>(v, np.ndarray)}</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    plot_band_comparison(</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>        bands<span class="op">=</span>valid_bands,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>        rgb<span class="op">=</span>rgb_composite <span class="cf">if</span> <span class="st">'rgb_composite'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>        ndvi<span class="op">=</span>ndvi <span class="cf">if</span> <span class="st">'ndvi'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Sentinel-2 Multi-band Analysis"</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Multi-band comparison complete"</span>)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional analysis: Band correlations</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> band_data <span class="kw">and</span> <span class="bu">len</span>(band_data) <span class="op">&gt;</span> <span class="dv">2</span>:</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate band correlations</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create correlation matrix</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    band_names <span class="op">=</span> [k <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">'B02'</span>, <span class="st">'B03'</span>, <span class="st">'B04'</span>, <span class="st">'B08'</span>] <span class="cf">if</span> k <span class="kw">in</span> band_data]</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(band_names) <span class="op">&gt;=</span> <span class="dv">2</span>:</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Flatten bands and create DataFrame</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>        band_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> band_name <span class="kw">in</span> band_names:</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>            band_df[band_name] <span class="op">=</span> band_data[band_name].flatten()</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate correlations</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>        correlations <span class="op">=</span> band_df.corr()</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot correlation matrix</span></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> plt.imshow(correlations, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>        plt.colorbar(im, label<span class="op">=</span><span class="st">'Correlation'</span>)</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add labels</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>        plt.xticks(<span class="bu">range</span>(<span class="bu">len</span>(band_names)), band_names)</span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>        plt.yticks(<span class="bu">range</span>(<span class="bu">len</span>(band_names)), band_names)</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add correlation values</span></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(band_names)):</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(band_names)):</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>                plt.text(j, i, <span class="ss">f'</span><span class="sc">{</span>correlations<span class="sc">.</span>iloc[i, j]<span class="sc">:.2f}</span><span class="ss">'</span>,</span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>                        ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>                        color<span class="op">=</span><span class="st">'white'</span> <span class="cf">if</span> <span class="bu">abs</span>(correlations.iloc[i, j]) <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="cf">else</span> <span class="st">'black'</span>)</span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Band Correlation Matrix'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="st">"Band correlation analysis complete"</span>)</span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'B03'</span> <span class="kw">in</span> band_names <span class="kw">and</span> <span class="st">'B04'</span> <span class="kw">in</span> band_names:</span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"Highest correlation: B03-B04 = </span><span class="sc">{</span>correlations<span class="sc">.</span>loc[<span class="st">'B03'</span>, <span class="st">'B04'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="c01-geospatial-data-foundations-OLD_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:19:35,734 - INFO - Multi-band comparison complete</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="c01-geospatial-data-foundations-OLD_files/figure-html/cell-35-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:19:41,387 - INFO - Band correlation analysis complete
2025-10-09 11:19:41,387 - INFO - Highest correlation: B03-B04 = 0.969</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="data-export-and-caching" class="level2">
<h2 class="anchored" data-anchor-id="data-export-and-caching">9. Data Export and Caching</h2>
<p>Let’s save our processed data for future use and create a reusable cache.</p>
<section id="export-processed-data-using-helper-functions" class="level3">
<h3 class="anchored" data-anchor-id="export-processed-data-using-helper-functions">9.1 Export Processed Data Using Helper Functions</h3>
<p>The next function in the code block is <code>export_analysis_results</code>. This function is designed to export the results of geospatial data analysis to a structured output directory. It takes several optional parameters, including arrays for NDVI and RGB composites, a dictionary of band data, geospatial transform and CRS information, scene metadata, NDVI statistics, and bounding boxes for the area of interest and any subset. The function creates the necessary output and cache directories, and then (as seen in the partial code) proceeds to export the NDVI data as a GeoTIFF file if the relevant data and metadata are provided. The function is intended to help organize and cache analysis outputs for future use or reproducibility.</p>
<div id="b03f84ed" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="35">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Any</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> export_analysis_results(</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">"week1_output"</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    ndvi: Optional[np.ndarray] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    rgb_composite: Optional[np.ndarray] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    band_data: Optional[Dict[<span class="bu">str</span>, np.ndarray]] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    transform: Optional[Any] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    crs: Optional[Any] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    scene_metadata: Optional[Dict] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    ndvi_stats: Optional[Dict] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    aoi_bbox: Optional[List[<span class="bu">float</span>]] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    subset_bbox: Optional[List[<span class="bu">float</span>]] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Path:</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Export analysis results to structured output directory.</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="co">        output_dir: Output directory path</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="co">        ndvi: NDVI array to export</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a><span class="co">        rgb_composite: RGB composite array to export</span></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a><span class="co">        band_data: Dictionary of band arrays to cache</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="co">        transform: Geospatial transform</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a><span class="co">        crs: Coordinate reference system</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a><span class="co">        scene_metadata: Scene metadata dictionary</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a><span class="co">        ndvi_stats: NDVI statistics dictionary</span></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="co">        aoi_bbox: Area of interest bounding box</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a><span class="co">        subset_bbox: Subset bounding box</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a><span class="co">        Path to output directory</span></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> json</span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> Path(output_dir)</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>    output_path.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>    cache_dir <span class="op">=</span> output_path <span class="op">/</span> <span class="st">"cache"</span></span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>    cache_dir.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Export NDVI if available</span></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ndvi <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> transform <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> crs <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>        ndvi_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">"ndvi.tif"</span></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>        save_geotiff(</span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>ndvi,</span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>            output_path<span class="op">=</span>ndvi_path,</span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>            transform<span class="op">=</span>transform,</span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a>            crs<span class="op">=</span>crs,</span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>            band_names<span class="op">=</span>[<span class="st">"NDVI"</span>],</span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a>        logger.debug(<span class="ss">f"Exported NDVI to </span><span class="sc">{</span>ndvi_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Export RGB composite if available</span></span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rgb_composite <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> transform <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> crs <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a>        rgb_bands <span class="op">=</span> np.transpose(rgb_composite, (<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>))  <span class="co"># HWC to CHW</span></span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a>        rgb_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">"rgb_composite.tif"</span></span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a>        save_geotiff(</span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>rgb_bands,</span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a>            output_path<span class="op">=</span>rgb_path,</span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a>            transform<span class="op">=</span>transform,</span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a>            crs<span class="op">=</span>crs,</span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a>            band_names<span class="op">=</span>[<span class="st">"Red"</span>, <span class="st">"Green"</span>, <span class="st">"Blue"</span>],</span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a>        logger.debug(<span class="ss">f"Exported RGB composite to </span><span class="sc">{</span>rgb_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cache individual bands</span></span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> band_data:</span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true" tabindex="-1"></a>        cached_bands <span class="op">=</span> []</span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> band_name, band_array <span class="kw">in</span> band_data.items():</span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> band_name.startswith(<span class="st">"B"</span>) <span class="kw">and</span> <span class="bu">isinstance</span>(band_array, np.ndarray):</span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true" tabindex="-1"></a>                band_path <span class="op">=</span> cache_dir <span class="op">/</span> <span class="ss">f"</span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss">.npy"</span></span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true" tabindex="-1"></a>                np.save(band_path, band_array)</span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true" tabindex="-1"></a>                cached_bands.append(band_name)</span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true" tabindex="-1"></a>        logger.debug(<span class="ss">f"Cached </span><span class="sc">{</span><span class="bu">len</span>(cached_bands)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span>cached_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb62-76"><a href="#cb62-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-77"><a href="#cb62-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create metadata</span></span>
<span id="cb62-78"><a href="#cb62-78" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> {</span>
<span id="cb62-79"><a href="#cb62-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">"processing_date"</span>: datetime.now().isoformat(),</span>
<span id="cb62-80"><a href="#cb62-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">"aoi_bbox"</span>: aoi_bbox,</span>
<span id="cb62-81"><a href="#cb62-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">"subset_bbox"</span>: subset_bbox,</span>
<span id="cb62-82"><a href="#cb62-82" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-83"><a href="#cb62-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-84"><a href="#cb62-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> scene_metadata:</span>
<span id="cb62-85"><a href="#cb62-85" aria-hidden="true" tabindex="-1"></a>        metadata[<span class="st">"scene"</span>] <span class="op">=</span> scene_metadata</span>
<span id="cb62-86"><a href="#cb62-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ndvi_stats:</span>
<span id="cb62-87"><a href="#cb62-87" aria-hidden="true" tabindex="-1"></a>        metadata[<span class="st">"ndvi_statistics"</span>] <span class="op">=</span> ndvi_stats</span>
<span id="cb62-88"><a href="#cb62-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-89"><a href="#cb62-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save metadata</span></span>
<span id="cb62-90"><a href="#cb62-90" aria-hidden="true" tabindex="-1"></a>    metadata_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">"metadata.json"</span></span>
<span id="cb62-91"><a href="#cb62-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(metadata_path, <span class="st">"w"</span>) <span class="im">as</span> f:</span>
<span id="cb62-92"><a href="#cb62-92" aria-hidden="true" tabindex="-1"></a>        json.dump(metadata, f, indent<span class="op">=</span><span class="dv">2</span>, default<span class="op">=</span><span class="bu">str</span>)</span>
<span id="cb62-93"><a href="#cb62-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-94"><a href="#cb62-94" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Analysis results exported to: </span><span class="sc">{</span>output_path<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb62-95"><a href="#cb62-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_path</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reloading-data" class="level3">
<h3 class="anchored" data-anchor-id="reloading-data">9.2 Reloading Data</h3>
<p>To reload your processed data, you can use the <code>load_week1_data</code> function provided below. This function reads the exported metadata, NDVI raster, and any cached bands from the specified output directory. Here’s how you can use it:</p>
<div id="d9b4443c" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="36">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_week1_data(output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">"week1_output"</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Load processed data from Week 1."""</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> json</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> rasterio</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> Path(output_dir)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> output_path.exists():</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="ss">f"Directory not found: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {}</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load metadata</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    metadata_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">"metadata.json"</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> metadata_path.exists():</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(metadata_path) <span class="im">as</span> f:</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"metadata"</span>] <span class="op">=</span> json.load(f)</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load NDVI</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>    ndvi_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">"ndvi.tif"</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ndvi_path.exists():</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> rasterio.<span class="bu">open</span>(ndvi_path) <span class="im">as</span> src:</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"ndvi"</span>] <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"transform"</span>] <span class="op">=</span> src.transform</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"crs"</span>] <span class="op">=</span> src.crs</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load cached bands</span></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>    cache_dir <span class="op">=</span> output_path <span class="op">/</span> <span class="st">"cache"</span></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cache_dir.exists():</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"bands"</span>] <span class="op">=</span> {}</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> band_file <span class="kw">in</span> cache_dir.glob(<span class="st">"*.npy"</span>):</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>            band_name <span class="op">=</span> band_file.stem</span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"bands"</span>][band_name] <span class="op">=</span> np.load(band_file)</span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the analysis results</span></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>scene_meta <span class="op">=</span> <span class="va">None</span></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"best_scene"</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>    scene_meta <span class="op">=</span> {</span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">"id"</span>: best_scene.<span class="bu">id</span>,</span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>: best_scene.properties[<span class="st">"datetime"</span>],</span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_cover"</span>: best_scene.properties[<span class="st">"eo:cloud_cover"</span>],</span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">"platform"</span>: best_scene.properties.get(<span class="st">"platform"</span>, <span class="st">"Unknown"</span>),</span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> export_analysis_results(</span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a>    ndvi<span class="op">=</span>ndvi <span class="cf">if</span> <span class="st">"ndvi"</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a>    rgb_composite<span class="op">=</span>rgb_composite <span class="cf">if</span> <span class="st">"rgb_composite"</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a>    band_data<span class="op">=</span>band_data <span class="cf">if</span> <span class="st">"band_data"</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>transform <span class="cf">if</span> <span class="st">"transform"</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span>crs <span class="cf">if</span> <span class="st">"crs"</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a>    scene_metadata<span class="op">=</span>scene_meta,</span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a>    ndvi_stats<span class="op">=</span>ndvi_stats <span class="cf">if</span> <span class="st">"ndvi_stats"</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a>    aoi_bbox<span class="op">=</span>santa_barbara_bbox <span class="cf">if</span> <span class="st">"santa_barbara_bbox"</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a>    subset_bbox<span class="op">=</span>subset_bbox <span class="cf">if</span> <span class="st">"subset_bbox"</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Data exported - use load_week1_data() to reload"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-10-09 11:19:41,484 - INFO - GDAL signalled an error: err_no=1, msg='PROJ: proj_create_from_name: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.'
2025-10-09 11:19:46,663 - INFO - 💾 Saved GeoTIFF: week1_output/ndvi.tif
2025-10-09 11:19:46,663 - INFO -    Shape: (10980, 10980)
ERROR 1: PROJ: proj_identify: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.
2025-10-09 11:19:46,672 - INFO -    CRS: PROJCS["WGS 84 / UTM zone 11N",GEOGCS["WGS 84",DATUM["World Geodetic System 1984",SPHEROID["WGS 84",6378137,298.257223563]],PRIMEM["Greenwich",0],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-117],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH]]
2025-10-09 11:19:46,673 - INFO -    Compression: deflate, tiled
2025-10-09 11:19:48,184 - INFO - GDAL signalled an error: err_no=1, msg='PROJ: proj_create_from_name: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.'
2025-10-09 11:20:16,214 - INFO - 💾 Saved GeoTIFF: week1_output/rgb_composite.tif
2025-10-09 11:20:16,215 - INFO -    Shape: (3, 10980, 10980)
ERROR 1: PROJ: proj_identify: /Users/kellycaylor/mambaforge/share/proj/proj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.
2025-10-09 11:20:16,224 - INFO -    CRS: PROJCS["WGS 84 / UTM zone 11N",GEOGCS["WGS 84",DATUM["World Geodetic System 1984",SPHEROID["WGS 84",6378137,298.257223563]],PRIMEM["Greenwich",0],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-117],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH]]
2025-10-09 11:20:16,224 - INFO -    Compression: deflate, tiled
2025-10-09 11:20:16,441 - INFO - Analysis results exported to: /Users/kellycaylor/dev/geoAI/book/chapters/week1_output
2025-10-09 11:20:16,442 - INFO - Data exported - use load_week1_data() to reload</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="conclusion-from-foundations-to-frontiers" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-from-foundations-to-frontiers">10. Conclusion: From Foundations to Frontiers</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What You’ve Accomplished
</div>
</div>
<div class="callout-body-container callout-body">
<p>You’ve successfully built a <strong>production-ready geospatial AI toolkit</strong> that demonstrates both technical excellence and software engineering best practices. This foundation will serve you throughout your career in geospatial AI.</p>
</div>
</div>
<p>🎉 <strong>Outstanding Achievement!</strong> You’ve progressed from basic satellite data access to building a sophisticated, enterprise-grade geospatial analysis system.</p>
<section id="core-competencies-developed" class="level3">
<h3 class="anchored" data-anchor-id="core-competencies-developed">10.1 Core Competencies Developed</h3>
<p><strong>Technical Mastery:</strong></p>
<ol type="1">
<li><strong>🛠️ Enterprise-Grade Toolkit</strong>: Built 13+ production-ready functions for geospatial AI workflows</li>
<li><strong>🔐 Security-First Architecture</strong>: Implemented robust authentication and error handling patterns</li>
<li><strong>🌍 Mastered STAC APIs</strong>: Connected to planetary-scale satellite data with proper authentication</li>
<li><strong>📡 Loaded Real Satellite Data</strong>: Worked with actual Sentinel-2 imagery, not just sample data</li>
<li><strong>🎨 Created Publication-Quality Visuals</strong>: RGB composites, NDVI maps, and interactive visualizations</li>
<li><strong>📊 Performed Multi-band Analysis</strong>: Calculated vegetation indices and band correlations</li>
<li><strong>🗺️ Built Interactive Maps</strong>: Folium maps with measurement tools and multiple basemaps</li>
<li><strong>💾 Established Data Workflows</strong>: Export functions and caching for reproducible analysis</li>
</ol>
<p><strong>Key Technical Skills Gained:</strong></p>
<ul>
<li><strong>Authentication</strong>: Planetary Computer API tokens for enterprise-level data access</li>
<li><strong>Error Handling</strong>: Robust functions with retry logic and fallback options</li>
<li><strong>Memory Management</strong>: Subsetting and efficient loading of large raster datasets</li>
<li><strong>Geospatial Standards</strong>: Working with CRS transformations and GeoTIFF exports</li>
<li><strong>Code Documentation</strong>: Well-documented functions with examples and type hints</li>
</ul>
</section>
<section id="real-world-applications" class="level3">
<h3 class="anchored" data-anchor-id="real-world-applications">10.2 Real-World Applications</h3>
<p>Your helper functions are now ready for:</p>
<ul>
<li>🌱 <strong>Environmental Monitoring</strong>: Track deforestation, urban growth, crop health</li>
<li>🌊 <strong>Disaster Response</strong>: Flood mapping, wildfire damage assessment</li>
<li>📊 <strong>Research Projects</strong>: Time series analysis, change detection studies</li>
<li>🏢 <strong>Commercial Applications</strong>: Agricultural monitoring, real estate analysis</li>
</ul>
</section>
<section id="week-2-preview-rapid-preprocessing-pipelines" class="level3">
<h3 class="anchored" data-anchor-id="week-2-preview-rapid-preprocessing-pipelines">10.3 Week 2 Preview: Rapid Preprocessing Pipelines</h3>
<p>Next week, we’ll scale up using your new toolkit:</p>
<ul>
<li><strong>Batch Processing</strong>: Handle multiple scenes and time series</li>
<li><strong>Cloud Masking</strong>: Automatically filter cloudy pixels</li>
<li><strong>Mosaicking</strong>: Combine scenes into seamless regional datasets</li>
<li><strong>Analysis-Ready Data</strong>: Create standardized data cubes for ML</li>
<li><strong>Performance Optimization</strong>: Parallel processing and dask integration</li>
</ul>
<p><strong>Steps to try</strong>:</p>
<ol type="1">
<li>Modify the <code>santa_barbara_bbox</code> to your area of interest</li>
<li>Use <code>search_sentinel2_scenes()</code> to find recent imagery</li>
<li>Run the complete analysis pipeline</li>
<li>Export your results and compare seasonal changes</li>
</ol>
</section>
<section id="essential-resources" class="level3">
<h3 class="anchored" data-anchor-id="essential-resources">10.4 Essential Resources</h3>
<p><strong>Data Sources:</strong></p>
<ul>
<li><a href="https://planetarycomputer.microsoft.com/catalog">Microsoft Planetary Computer Catalog</a> - Free satellite data</li>
<li><a href="https://radiantearth.github.io/stac-browser/">STAC Browser</a> - Explore STAC catalogs</li>
<li><a href="https://developers.google.com/earth-engine/datasets">Earth Engine Data Catalog</a> - Alternative data source</li>
</ul>
<p><strong>Technical Documentation:</strong></p>
<ul>
<li><a href="https://rasterio.readthedocs.io/">Rasterio Documentation</a> - Geospatial I/O</li>
<li><a href="https://docs.xarray.dev/en/stable/tutorials-and-videos.html">Xarray Tutorial</a> - Multi-dimensional arrays</li>
<li><a href="https://stacspec.org/">STAC Specification</a> - Metadata standards</li>
<li><a href="https://python-visualization.github.io/folium/">Folium Examples</a> - Interactive mapping</li>
</ul>
<p><strong>Community:</strong></p>
<ul>
<li><a href="https://pangeo.io/">Pangeo Community</a> - Open source geoscience</li>
<li><a href="https://discord.gg/stac">STAC Discord</a> - STAC community support</li>
<li><a href="https://github.com/pydata/pydata-book">PyData Geospatial</a> - Python geospatial ecosystem</li>
</ul>
<p><strong>Remember</strong>: Your helper functions are now your superpower! 🦸 Use them to explore any area on Earth with just a few lines of code.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/kcaylor\.github\.io\/GEOG-288KC-geospatial-foundation-models");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb65" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Week 1: Core Tools and Data Access"</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Setting up the geospatial AI toolkit and accessing satellite imagery"</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> geoai</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1. Introduction</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>Welcome to your first hands-on session with geospatial AI! Today we'll set up the core tools you'll use throughout this course and get you working with real satellite imagery immediately. No theory-heavy introductions – we're diving straight into practical data access and exploration.</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Learning Goals</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>By the end of this session, you will:</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Have a working geospatial AI environment</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pull real Sentinel-2/Landsat imagery via STAC APIs</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Load and explore satellite data with rasterio and xarray</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create interactive maps with folium</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understand the basics of multi-spectral satellite imagery</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2. Environment Setup and Helper Functions</span></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>We'll start by setting up our environment and creating reusable helper functions that you'll use throughout the course. These functions handle common tasks like data loading, visualization, and processing.</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2.1 Verify Your Environment</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>**Environment Verification:**</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>Before we begin, let's verify that your environment is properly configured. Your environment should include the following packages:</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**rasterio, xarray, rioxarray**: Core geospatial data handling</span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**torch, transformers**: Deep learning and foundation models</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**folium**: Interactive mapping</span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**matplotlib, numpy, pandas**: Data analysis and visualization</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**pystac-client, planetary-computer**: STAC API access</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**geopandas**: Vector geospatial data</span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a><span class="co">#| tangle: geogfm/c01.py</span></span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a><span class="co">"""Week 1: Core Tools and Data Access functions for geospatial AI."""</span></span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> importlib.metadata</span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb65-56"><a href="#cb65-56" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb65-57"><a href="#cb65-57" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Tuple, Optional, Union</span>
<span id="cb65-58"><a href="#cb65-58" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb65-59"><a href="#cb65-59" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb65-60"><a href="#cb65-60" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb65-61"><a href="#cb65-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-62"><a href="#cb65-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Core geospatial libraries</span></span>
<span id="cb65-63"><a href="#cb65-63" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb65-64"><a href="#cb65-64" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.windows <span class="im">import</span> from_bounds</span>
<span id="cb65-65"><a href="#cb65-65" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> transform_bounds</span>
<span id="cb65-66"><a href="#cb65-66" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb65-67"><a href="#cb65-67" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb65-68"><a href="#cb65-68" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb65-69"><a href="#cb65-69" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> planetary_computer <span class="im">as</span> pc</span>
<span id="cb65-70"><a href="#cb65-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-71"><a href="#cb65-71" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb65-72"><a href="#cb65-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-73"><a href="#cb65-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure logging</span></span>
<span id="cb65-74"><a href="#cb65-74" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">'</span>)</span>
<span id="cb65-75"><a href="#cb65-75" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb65-76"><a href="#cb65-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-77"><a href="#cb65-77" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> configure_gdal_environment() <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb65-78"><a href="#cb65-78" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb65-79"><a href="#cb65-79" aria-hidden="true" tabindex="-1"></a><span class="co">    Configure GDAL/PROJ environment variables for HPC and local systems.</span></span>
<span id="cb65-80"><a href="#cb65-80" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb65-81"><a href="#cb65-81" aria-hidden="true" tabindex="-1"></a><span class="co">    This function addresses common GDAL/PROJ configuration issues, particularly</span></span>
<span id="cb65-82"><a href="#cb65-82" aria-hidden="true" tabindex="-1"></a><span class="co">    on HPC systems where proj.db may not be found or version mismatches exist.</span></span>
<span id="cb65-83"><a href="#cb65-83" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb65-84"><a href="#cb65-84" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb65-85"><a href="#cb65-85" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb65-86"><a href="#cb65-86" aria-hidden="true" tabindex="-1"></a><span class="co">    dict</span></span>
<span id="cb65-87"><a href="#cb65-87" aria-hidden="true" tabindex="-1"></a><span class="co">        Dictionary with configuration status and detected paths</span></span>
<span id="cb65-88"><a href="#cb65-88" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb65-89"><a href="#cb65-89" aria-hidden="true" tabindex="-1"></a>    config_status <span class="op">=</span> {</span>
<span id="cb65-90"><a href="#cb65-90" aria-hidden="true" tabindex="-1"></a>        <span class="st">'gdal_configured'</span>: <span class="va">False</span>,</span>
<span id="cb65-91"><a href="#cb65-91" aria-hidden="true" tabindex="-1"></a>        <span class="st">'proj_configured'</span>: <span class="va">False</span>,</span>
<span id="cb65-92"><a href="#cb65-92" aria-hidden="true" tabindex="-1"></a>        <span class="st">'gdal_data_path'</span>: <span class="va">None</span>,</span>
<span id="cb65-93"><a href="#cb65-93" aria-hidden="true" tabindex="-1"></a>        <span class="st">'proj_lib_path'</span>: <span class="va">None</span>,</span>
<span id="cb65-94"><a href="#cb65-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">'warnings'</span>: []</span>
<span id="cb65-95"><a href="#cb65-95" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb65-96"><a href="#cb65-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-97"><a href="#cb65-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb65-98"><a href="#cb65-98" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> osgeo</span>
<span id="cb65-99"><a href="#cb65-99" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> osgeo <span class="im">import</span> gdal, osr</span>
<span id="cb65-100"><a href="#cb65-100" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-101"><a href="#cb65-101" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Enable GDAL exceptions for better error handling</span></span>
<span id="cb65-102"><a href="#cb65-102" aria-hidden="true" tabindex="-1"></a>        gdal.UseExceptions()</span>
<span id="cb65-103"><a href="#cb65-103" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-104"><a href="#cb65-104" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try to find PROJ data directory</span></span>
<span id="cb65-105"><a href="#cb65-105" aria-hidden="true" tabindex="-1"></a>        proj_lib_candidates <span class="op">=</span> [</span>
<span id="cb65-106"><a href="#cb65-106" aria-hidden="true" tabindex="-1"></a>            os.environ.get(<span class="st">'PROJ_LIB'</span>),</span>
<span id="cb65-107"><a href="#cb65-107" aria-hidden="true" tabindex="-1"></a>            os.environ.get(<span class="st">'PROJ_DATA'</span>),</span>
<span id="cb65-108"><a href="#cb65-108" aria-hidden="true" tabindex="-1"></a>            os.path.join(sys.prefix, <span class="st">'share'</span>, <span class="st">'proj'</span>),</span>
<span id="cb65-109"><a href="#cb65-109" aria-hidden="true" tabindex="-1"></a>            os.path.join(sys.prefix, <span class="st">'Library'</span>, <span class="st">'share'</span>, <span class="st">'proj'</span>),  <span class="co"># Windows</span></span>
<span id="cb65-110"><a href="#cb65-110" aria-hidden="true" tabindex="-1"></a>            <span class="st">'/usr/share/proj'</span>,  <span class="co"># Linux system</span></span>
<span id="cb65-111"><a href="#cb65-111" aria-hidden="true" tabindex="-1"></a>            os.path.expanduser(<span class="st">'~/mambaforge/share/proj'</span>),</span>
<span id="cb65-112"><a href="#cb65-112" aria-hidden="true" tabindex="-1"></a>            os.path.expanduser(<span class="st">'~/miniconda3/share/proj'</span>),</span>
<span id="cb65-113"><a href="#cb65-113" aria-hidden="true" tabindex="-1"></a>            os.path.expanduser(<span class="st">'~/anaconda3/share/proj'</span>),</span>
<span id="cb65-114"><a href="#cb65-114" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb65-115"><a href="#cb65-115" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-116"><a href="#cb65-116" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find valid PROJ directory</span></span>
<span id="cb65-117"><a href="#cb65-117" aria-hidden="true" tabindex="-1"></a>        proj_lib_path <span class="op">=</span> <span class="va">None</span></span>
<span id="cb65-118"><a href="#cb65-118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> candidate <span class="kw">in</span> proj_lib_candidates:</span>
<span id="cb65-119"><a href="#cb65-119" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> candidate <span class="kw">and</span> os.path.isdir(candidate):</span>
<span id="cb65-120"><a href="#cb65-120" aria-hidden="true" tabindex="-1"></a>                proj_db <span class="op">=</span> os.path.join(candidate, <span class="st">'proj.db'</span>)</span>
<span id="cb65-121"><a href="#cb65-121" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> os.path.isfile(proj_db):</span>
<span id="cb65-122"><a href="#cb65-122" aria-hidden="true" tabindex="-1"></a>                    proj_lib_path <span class="op">=</span> candidate</span>
<span id="cb65-123"><a href="#cb65-123" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb65-124"><a href="#cb65-124" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-125"><a href="#cb65-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> proj_lib_path:</span>
<span id="cb65-126"><a href="#cb65-126" aria-hidden="true" tabindex="-1"></a>            os.environ[<span class="st">'PROJ_LIB'</span>] <span class="op">=</span> proj_lib_path</span>
<span id="cb65-127"><a href="#cb65-127" aria-hidden="true" tabindex="-1"></a>            os.environ[<span class="st">'PROJ_DATA'</span>] <span class="op">=</span> proj_lib_path</span>
<span id="cb65-128"><a href="#cb65-128" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'proj_lib_path'</span>] <span class="op">=</span> proj_lib_path</span>
<span id="cb65-129"><a href="#cb65-129" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'proj_configured'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb65-130"><a href="#cb65-130" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"✅ PROJ configured: </span><span class="sc">{</span>proj_lib_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb65-131"><a href="#cb65-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb65-132"><a href="#cb65-132" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'warnings'</span>].append(<span class="st">"⚠️ Could not locate proj.db - coordinate transformations may fail"</span>)</span>
<span id="cb65-133"><a href="#cb65-133" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-134"><a href="#cb65-134" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try to find GDAL data directory</span></span>
<span id="cb65-135"><a href="#cb65-135" aria-hidden="true" tabindex="-1"></a>        gdal_data_candidates <span class="op">=</span> [</span>
<span id="cb65-136"><a href="#cb65-136" aria-hidden="true" tabindex="-1"></a>            os.environ.get(<span class="st">'GDAL_DATA'</span>),</span>
<span id="cb65-137"><a href="#cb65-137" aria-hidden="true" tabindex="-1"></a>            gdal.GetConfigOption(<span class="st">'GDAL_DATA'</span>),</span>
<span id="cb65-138"><a href="#cb65-138" aria-hidden="true" tabindex="-1"></a>            os.path.join(sys.prefix, <span class="st">'share'</span>, <span class="st">'gdal'</span>),</span>
<span id="cb65-139"><a href="#cb65-139" aria-hidden="true" tabindex="-1"></a>            os.path.join(sys.prefix, <span class="st">'Library'</span>, <span class="st">'share'</span>, <span class="st">'gdal'</span>),  <span class="co"># Windows</span></span>
<span id="cb65-140"><a href="#cb65-140" aria-hidden="true" tabindex="-1"></a>            <span class="st">'/usr/share/gdal'</span>,  <span class="co"># Linux system</span></span>
<span id="cb65-141"><a href="#cb65-141" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb65-142"><a href="#cb65-142" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-143"><a href="#cb65-143" aria-hidden="true" tabindex="-1"></a>        gdal_data_path <span class="op">=</span> <span class="va">None</span></span>
<span id="cb65-144"><a href="#cb65-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> candidate <span class="kw">in</span> gdal_data_candidates:</span>
<span id="cb65-145"><a href="#cb65-145" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> candidate <span class="kw">and</span> os.path.isdir(candidate):</span>
<span id="cb65-146"><a href="#cb65-146" aria-hidden="true" tabindex="-1"></a>                gdal_data_path <span class="op">=</span> candidate</span>
<span id="cb65-147"><a href="#cb65-147" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb65-148"><a href="#cb65-148" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-149"><a href="#cb65-149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> gdal_data_path:</span>
<span id="cb65-150"><a href="#cb65-150" aria-hidden="true" tabindex="-1"></a>            os.environ[<span class="st">'GDAL_DATA'</span>] <span class="op">=</span> gdal_data_path</span>
<span id="cb65-151"><a href="#cb65-151" aria-hidden="true" tabindex="-1"></a>            gdal.SetConfigOption(<span class="st">'GDAL_DATA'</span>, gdal_data_path)</span>
<span id="cb65-152"><a href="#cb65-152" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'gdal_data_path'</span>] <span class="op">=</span> gdal_data_path</span>
<span id="cb65-153"><a href="#cb65-153" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'gdal_configured'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb65-154"><a href="#cb65-154" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"✅ GDAL_DATA configured: </span><span class="sc">{</span>gdal_data_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb65-155"><a href="#cb65-155" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-156"><a href="#cb65-156" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Additional GDAL configuration for network access</span></span>
<span id="cb65-157"><a href="#cb65-157" aria-hidden="true" tabindex="-1"></a>        gdal.SetConfigOption(<span class="st">'GDAL_DISABLE_READDIR_ON_OPEN'</span>, <span class="st">'EMPTY_DIR'</span>)</span>
<span id="cb65-158"><a href="#cb65-158" aria-hidden="true" tabindex="-1"></a>        gdal.SetConfigOption(<span class="st">'CPL_VSIL_CURL_ALLOWED_EXTENSIONS'</span>, <span class="st">'.tif,.tiff,.vrt'</span>)</span>
<span id="cb65-159"><a href="#cb65-159" aria-hidden="true" tabindex="-1"></a>        gdal.SetConfigOption(<span class="st">'GDAL_HTTP_TIMEOUT'</span>, <span class="st">'300'</span>)</span>
<span id="cb65-160"><a href="#cb65-160" aria-hidden="true" tabindex="-1"></a>        gdal.SetConfigOption(<span class="st">'GDAL_HTTP_MAX_RETRY'</span>, <span class="st">'5'</span>)</span>
<span id="cb65-161"><a href="#cb65-161" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-162"><a href="#cb65-162" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test PROJ functionality</span></span>
<span id="cb65-163"><a href="#cb65-163" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb65-164"><a href="#cb65-164" aria-hidden="true" tabindex="-1"></a>            srs <span class="op">=</span> osr.SpatialReference()</span>
<span id="cb65-165"><a href="#cb65-165" aria-hidden="true" tabindex="-1"></a>            srs.ImportFromEPSG(<span class="dv">4326</span>)</span>
<span id="cb65-166"><a href="#cb65-166" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'proj_test_passed'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb65-167"><a href="#cb65-167" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb65-168"><a href="#cb65-168" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'warnings'</span>].append(<span class="ss">f"⚠️ PROJ test failed: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb65-169"><a href="#cb65-169" aria-hidden="true" tabindex="-1"></a>            config_status[<span class="st">'proj_test_passed'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb65-170"><a href="#cb65-170" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-171"><a href="#cb65-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> config_status</span>
<span id="cb65-172"><a href="#cb65-172" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-173"><a href="#cb65-173" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb65-174"><a href="#cb65-174" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="ss">f"Error configuring GDAL environment: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb65-175"><a href="#cb65-175" aria-hidden="true" tabindex="-1"></a>        config_status[<span class="st">'warnings'</span>].append(<span class="ss">f"Configuration error: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb65-176"><a href="#cb65-176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> config_status</span>
<span id="cb65-177"><a href="#cb65-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-178"><a href="#cb65-178" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> verify_environment(required_packages: <span class="bu">list</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb65-179"><a href="#cb65-179" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb65-180"><a href="#cb65-180" aria-hidden="true" tabindex="-1"></a><span class="co">    Verify that all required packages are installed.</span></span>
<span id="cb65-181"><a href="#cb65-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-182"><a href="#cb65-182" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb65-183"><a href="#cb65-183" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb65-184"><a href="#cb65-184" aria-hidden="true" tabindex="-1"></a><span class="co">    required_packages : list</span></span>
<span id="cb65-185"><a href="#cb65-185" aria-hidden="true" tabindex="-1"></a><span class="co">        List of package names to verify</span></span>
<span id="cb65-186"><a href="#cb65-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-187"><a href="#cb65-187" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb65-188"><a href="#cb65-188" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb65-189"><a href="#cb65-189" aria-hidden="true" tabindex="-1"></a><span class="co">    dict</span></span>
<span id="cb65-190"><a href="#cb65-190" aria-hidden="true" tabindex="-1"></a><span class="co">        Dictionary with package names as keys and versions as values</span></span>
<span id="cb65-191"><a href="#cb65-191" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb65-192"><a href="#cb65-192" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> {}</span>
<span id="cb65-193"><a href="#cb65-193" aria-hidden="true" tabindex="-1"></a>    missing_packages <span class="op">=</span> []</span>
<span id="cb65-194"><a href="#cb65-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-195"><a href="#cb65-195" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> package <span class="kw">in</span> required_packages:</span>
<span id="cb65-196"><a href="#cb65-196" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb65-197"><a href="#cb65-197" aria-hidden="true" tabindex="-1"></a>            version <span class="op">=</span> importlib.metadata.version(package)</span>
<span id="cb65-198"><a href="#cb65-198" aria-hidden="true" tabindex="-1"></a>            results[package] <span class="op">=</span> version</span>
<span id="cb65-199"><a href="#cb65-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> importlib.metadata.PackageNotFoundError:</span>
<span id="cb65-200"><a href="#cb65-200" aria-hidden="true" tabindex="-1"></a>            missing_packages.append(package)</span>
<span id="cb65-201"><a href="#cb65-201" aria-hidden="true" tabindex="-1"></a>            results[package] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb65-202"><a href="#cb65-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-203"><a href="#cb65-203" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Report results</span></span>
<span id="cb65-204"><a href="#cb65-204" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> missing_packages:</span>
<span id="cb65-205"><a href="#cb65-205" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="ss">f"❌ Missing packages: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(missing_packages)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb65-206"><a href="#cb65-206" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> results</span>
<span id="cb65-207"><a href="#cb65-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-208"><a href="#cb65-208" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"✅ All </span><span class="sc">{</span><span class="bu">len</span>(required_packages)<span class="sc">}</span><span class="ss"> packages verified"</span>)</span>
<span id="cb65-209"><a href="#cb65-209" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results</span>
<span id="cb65-210"><a href="#cb65-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-211"><a href="#cb65-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-212"><a href="#cb65-212" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Verify that we have all the packages we need in our environment</span></span>
<span id="cb65-213"><a href="#cb65-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-216"><a href="#cb65-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-217"><a href="#cb65-217" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify core geospatial AI environment</span></span>
<span id="cb65-218"><a href="#cb65-218" aria-hidden="true" tabindex="-1"></a>required_packages <span class="op">=</span> [</span>
<span id="cb65-219"><a href="#cb65-219" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rasterio'</span>, <span class="st">'xarray'</span>, <span class="st">'torch'</span>, <span class="st">'transformers'</span>,</span>
<span id="cb65-220"><a href="#cb65-220" aria-hidden="true" tabindex="-1"></a>    <span class="st">'folium'</span>, <span class="st">'matplotlib'</span>, <span class="st">'numpy'</span>, <span class="st">'pandas'</span>,</span>
<span id="cb65-221"><a href="#cb65-221" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pystac-client'</span>, <span class="st">'geopandas'</span>, <span class="st">'rioxarray'</span>, <span class="st">'planetary-computer'</span></span>
<span id="cb65-222"><a href="#cb65-222" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb65-223"><a href="#cb65-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-224"><a href="#cb65-224" aria-hidden="true" tabindex="-1"></a>package_status <span class="op">=</span> verify_environment(required_packages)</span>
<span id="cb65-225"><a href="#cb65-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-226"><a href="#cb65-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-227"><a href="#cb65-227" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Configure GDAL/PROJ Environment (Critical for HPC Systems)</span></span>
<span id="cb65-228"><a href="#cb65-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-229"><a href="#cb65-229" aria-hidden="true" tabindex="-1"></a>Before we proceed with geospatial operations, we need to ensure GDAL and PROJ are properly configured. This is especially important on HPC systems where environment variables may not be automatically set.</span>
<span id="cb65-230"><a href="#cb65-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-233"><a href="#cb65-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-234"><a href="#cb65-234" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure GDAL/PROJ environment</span></span>
<span id="cb65-235"><a href="#cb65-235" aria-hidden="true" tabindex="-1"></a>gdal_config <span class="op">=</span> configure_gdal_environment()</span>
<span id="cb65-236"><a href="#cb65-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-237"><a href="#cb65-237" aria-hidden="true" tabindex="-1"></a><span class="co"># Report configuration status</span></span>
<span id="cb65-238"><a href="#cb65-238" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> gdal_config[<span class="st">'proj_configured'</span>] <span class="kw">and</span> gdal_config[<span class="st">'gdal_configured'</span>]:</span>
<span id="cb65-239"><a href="#cb65-239" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"✅ GDAL/PROJ fully configured and ready"</span>)</span>
<span id="cb65-240"><a href="#cb65-240" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> gdal_config[<span class="st">'proj_configured'</span>] <span class="kw">or</span> gdal_config[<span class="st">'gdal_configured'</span>]:</span>
<span id="cb65-241"><a href="#cb65-241" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"⚠️ Partial GDAL/PROJ configuration - some operations may fail"</span>)</span>
<span id="cb65-242"><a href="#cb65-242" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> warning <span class="kw">in</span> gdal_config[<span class="st">'warnings'</span>]:</span>
<span id="cb65-243"><a href="#cb65-243" aria-hidden="true" tabindex="-1"></a>        logger.warning(warning)</span>
<span id="cb65-244"><a href="#cb65-244" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb65-245"><a href="#cb65-245" aria-hidden="true" tabindex="-1"></a>    logger.error(<span class="st">"❌ GDAL/PROJ configuration incomplete"</span>)</span>
<span id="cb65-246"><a href="#cb65-246" aria-hidden="true" tabindex="-1"></a>    logger.error(<span class="st">"This may cause issues with coordinate transformations"</span>)</span>
<span id="cb65-247"><a href="#cb65-247" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> warning <span class="kw">in</span> gdal_config[<span class="st">'warnings'</span>]:</span>
<span id="cb65-248"><a href="#cb65-248" aria-hidden="true" tabindex="-1"></a>        logger.error(warning)</span>
<span id="cb65-249"><a href="#cb65-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-250"><a href="#cb65-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-251"><a href="#cb65-251" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb65-252"><a href="#cb65-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-253"><a href="#cb65-253" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Troubleshooting GDAL/PROJ Issues on HPC Systems</span></span>
<span id="cb65-254"><a href="#cb65-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-255"><a href="#cb65-255" aria-hidden="true" tabindex="-1"></a>If you encounter GDAL/PROJ warnings or errors (especially "proj.db not found" or version mismatch warnings), try these solutions in order:</span>
<span id="cb65-256"><a href="#cb65-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-257"><a href="#cb65-257" aria-hidden="true" tabindex="-1"></a>**1. Manual Environment Variable Setup (Recommended for HPC)**</span>
<span id="cb65-258"><a href="#cb65-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-259"><a href="#cb65-259" aria-hidden="true" tabindex="-1"></a>Before running your Python script, set these environment variables in your shell:</span>
<span id="cb65-260"><a href="#cb65-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-261"><a href="#cb65-261" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb65-262"><a href="#cb65-262" aria-hidden="true" tabindex="-1"></a><span class="co"># Find your conda environment path</span></span>
<span id="cb65-263"><a href="#cb65-263" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> info <span class="at">--envs</span></span>
<span id="cb65-264"><a href="#cb65-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-265"><a href="#cb65-265" aria-hidden="true" tabindex="-1"></a><span class="co"># Set PROJ_LIB and GDAL_DATA (adjust path to your environment)</span></span>
<span id="cb65-266"><a href="#cb65-266" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PROJ_LIB</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/proj</span>
<span id="cb65-267"><a href="#cb65-267" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PROJ_DATA</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/proj</span>
<span id="cb65-268"><a href="#cb65-268" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">GDAL_DATA</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/gdal</span>
<span id="cb65-269"><a href="#cb65-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-270"><a href="#cb65-270" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify the files exist</span></span>
<span id="cb65-271"><a href="#cb65-271" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="va">$PROJ_LIB</span>/proj.db</span>
<span id="cb65-272"><a href="#cb65-272" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="va">$GDAL_DATA</span>/</span>
<span id="cb65-273"><a href="#cb65-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-274"><a href="#cb65-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-275"><a href="#cb65-275" aria-hidden="true" tabindex="-1"></a>**2. Add to Your Job Script (SLURM/PBS)**</span>
<span id="cb65-276"><a href="#cb65-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-277"><a href="#cb65-277" aria-hidden="true" tabindex="-1"></a>For HPC batch jobs, add these lines to your job script:</span>
<span id="cb65-278"><a href="#cb65-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-279"><a href="#cb65-279" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb65-280"><a href="#cb65-280" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb65-281"><a href="#cb65-281" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --job-name=geoai</span></span>
<span id="cb65-282"><a href="#cb65-282" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=01:00:00</span></span>
<span id="cb65-283"><a href="#cb65-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-284"><a href="#cb65-284" aria-hidden="true" tabindex="-1"></a><span class="co"># Activate your conda environment</span></span>
<span id="cb65-285"><a href="#cb65-285" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate geoAI</span>
<span id="cb65-286"><a href="#cb65-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-287"><a href="#cb65-287" aria-hidden="true" tabindex="-1"></a><span class="co"># Set GDAL/PROJ paths</span></span>
<span id="cb65-288"><a href="#cb65-288" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PROJ_LIB</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/proj</span>
<span id="cb65-289"><a href="#cb65-289" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PROJ_DATA</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/proj</span>
<span id="cb65-290"><a href="#cb65-290" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">GDAL_DATA</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/gdal</span>
<span id="cb65-291"><a href="#cb65-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-292"><a href="#cb65-292" aria-hidden="true" tabindex="-1"></a><span class="co"># Run your Python script</span></span>
<span id="cb65-293"><a href="#cb65-293" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> your_script.py</span>
<span id="cb65-294"><a href="#cb65-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-295"><a href="#cb65-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-296"><a href="#cb65-296" aria-hidden="true" tabindex="-1"></a>**3. Permanently Set in Your Environment**</span>
<span id="cb65-297"><a href="#cb65-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-298"><a href="#cb65-298" aria-hidden="true" tabindex="-1"></a>Add to your <span class="in">`~/.bashrc`</span> or <span class="in">`~/.bash_profile`</span>:</span>
<span id="cb65-299"><a href="#cb65-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-300"><a href="#cb65-300" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb65-301"><a href="#cb65-301" aria-hidden="true" tabindex="-1"></a><span class="co"># GDAL/PROJ configuration for geoAI environment</span></span>
<span id="cb65-302"><a href="#cb65-302" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="va">$CONDA_DEFAULT_ENV</span> <span class="ot">==</span> <span class="st">"geoAI"</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb65-303"><a href="#cb65-303" aria-hidden="true" tabindex="-1"></a>    <span class="bu">export</span> <span class="va">PROJ_LIB</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/proj</span>
<span id="cb65-304"><a href="#cb65-304" aria-hidden="true" tabindex="-1"></a>    <span class="bu">export</span> <span class="va">PROJ_DATA</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/proj</span>
<span id="cb65-305"><a href="#cb65-305" aria-hidden="true" tabindex="-1"></a>    <span class="bu">export</span> <span class="va">GDAL_DATA</span><span class="op">=</span><span class="va">$CONDA_PREFIX</span>/share/gdal</span>
<span id="cb65-306"><a href="#cb65-306" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb65-307"><a href="#cb65-307" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-308"><a href="#cb65-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-309"><a href="#cb65-309" aria-hidden="true" tabindex="-1"></a><span class="ex">**4.</span> Verify PROJ Installation<span class="pp">**</span></span>
<span id="cb65-310"><a href="#cb65-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-311"><a href="#cb65-311" aria-hidden="true" tabindex="-1"></a><span class="ex">If</span> problems persist, check your PROJ installation:</span>
<span id="cb65-312"><a href="#cb65-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-313"><a href="#cb65-313" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span>python</span>
<span id="cb65-314"><a href="#cb65-314" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> pyproj</span>
<span id="cb65-315"><a href="#cb65-315" aria-hidden="true" tabindex="-1"></a><span class="ex">print</span><span class="er">(</span><span class="ex">f</span><span class="st">"PROJ version: {pyproj.proj_version_str}"</span><span class="kw">)</span></span>
<span id="cb65-316"><a href="#cb65-316" aria-hidden="true" tabindex="-1"></a><span class="ex">print</span><span class="er">(</span><span class="ex">f</span><span class="st">"PROJ data dir: {pyproj.datadir.get_data_dir()}"</span><span class="kw">)</span></span>
<span id="cb65-317"><a href="#cb65-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-318"><a href="#cb65-318" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if proj.db exists</span></span>
<span id="cb65-319"><a href="#cb65-319" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> os</span>
<span id="cb65-320"><a href="#cb65-320" aria-hidden="true" tabindex="-1"></a><span class="ex">proj_dir</span> = pyproj.datadir.get_data_dir<span class="er">(</span><span class="kw">)</span></span>
<span id="cb65-321"><a href="#cb65-321" aria-hidden="true" tabindex="-1"></a><span class="ex">proj_db</span> = os.path.join<span class="er">(</span><span class="ex">proj_dir,</span> <span class="st">'proj.db'</span><span class="kw">)</span></span>
<span id="cb65-322"><a href="#cb65-322" aria-hidden="true" tabindex="-1"></a><span class="ex">print</span><span class="er">(</span><span class="ex">f</span><span class="st">"proj.db exists: {os.path.exists(proj_db)}"</span><span class="kw">)</span></span>
<span id="cb65-323"><a href="#cb65-323" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-324"><a href="#cb65-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-325"><a href="#cb65-325" aria-hidden="true" tabindex="-1"></a><span class="ex">**5.</span> Reinstall GDAL/PROJ <span class="er">(</span><span class="ex">Last</span> Resort<span class="kw">)</span><span class="ex">**</span></span>
<span id="cb65-326"><a href="#cb65-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-327"><a href="#cb65-327" aria-hidden="true" tabindex="-1"></a><span class="ex">If</span> all else fails, reinstall with compatible versions:</span>
<span id="cb65-328"><a href="#cb65-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-329"><a href="#cb65-329" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span>bash</span>
<span id="cb65-330"><a href="#cb65-330" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate geoAI</span>
<span id="cb65-331"><a href="#cb65-331" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> install <span class="at">-c</span> conda-forge gdal=3.10 pyproj=3.7 rasterio=1.4 <span class="at">--force-reinstall</span></span>
<span id="cb65-332"><a href="#cb65-332" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-333"><a href="#cb65-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-334"><a href="#cb65-334" aria-hidden="true" tabindex="-1"></a><span class="ex">**Common</span> Error Messages and Solutions:<span class="pp">**</span></span>
<span id="cb65-335"><a href="#cb65-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-336"><a href="#cb65-336" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span><span class="st">"proj.db not found"</span><span class="pp">**</span>: Set <span class="kw">`</span>PROJ_LIB<span class="kw">`</span> <span class="ex">environment</span> variable</span>
<span id="cb65-337"><a href="#cb65-337" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span><span class="st">"DATABASE.LAYOUT.VERSION mismatch"</span><span class="pp">**</span>: Multiple PROJ installations<span class="kw">;</span> <span class="ex">ensure</span> you<span class="st">'re using the one from your conda environment</span></span>
<span id="cb65-338"><a href="#cb65-338" aria-hidden="true" tabindex="-1"></a><span class="st">- **"CPLE_AppDefined in PROJ"**: GDAL is finding wrong PROJ installation; set environment variables explicitly</span></span>
<span id="cb65-339"><a href="#cb65-339" aria-hidden="true" tabindex="-1"></a><span class="st">- **Slow performance**: Network timeout issues; the `configure_gdal_environment()` function sets appropriate timeouts</span></span>
<span id="cb65-340"><a href="#cb65-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-341"><a href="#cb65-341" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-342"><a href="#cb65-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-343"><a href="#cb65-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-344"><a href="#cb65-344" aria-hidden="true" tabindex="-1"></a><span class="st">### 2.2 Import Essential Libraries and Create Helper Functions</span></span>
<span id="cb65-345"><a href="#cb65-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-346"><a href="#cb65-346" aria-hidden="true" tabindex="-1"></a><span class="st">Before diving into geospatial data analysis and AI workflows, it'</span>s important to import the essential Python libraries that form the backbone of this toolkit. The following code block brings together core geospatial libraries such as <span class="pp">[</span><span class="ss">rasterio</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://rasterio.readthedocs.io/</span><span class="kw">)</span> <span class="cf">for</span> raster <span class="ex">data</span> handling, <span class="pp">[</span><span class="ss">xarray</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://docs.xarray.dev/</span><span class="kw">)</span> <span class="ex">and</span> <span class="pp">[</span><span class="ss">rioxarray</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://corteva.github.io/rioxarray/stable/</span><span class="kw">)</span> <span class="cf">for</span> multi<span class="ex">-dimensional</span> array operations, <span class="pp">[</span><span class="ss">geopandas</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://geopandas.org/</span><span class="kw">)</span> <span class="cf">for</span> vector <span class="ex">data,</span> and <span class="pp">[</span><span class="ss">pystac</span><span class="pp">-</span><span class="ss">client</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://pystac-client.readthedocs.io/</span><span class="kw">)</span> <span class="cf">for</span> accessing <span class="ex">spatiotemporal</span> asset catalogs. </span>
<span id="cb65-347"><a href="#cb65-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-348"><a href="#cb65-348" aria-hidden="true" tabindex="-1"></a><span class="ex">Visualization</span> is supported by <span class="pp">[</span><span class="ss">matplotlib</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://matplotlib.org/</span><span class="kw">)</span> <span class="ex">and</span> <span class="pp">[</span><span class="ss">folium</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://python-visualization.github.io/folium/</span><span class="kw">)</span><span class="ex">,</span> while <span class="pp">[</span><span class="ss">torch</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://pytorch.org/</span><span class="kw">)</span> <span class="ex">enables</span> deep learning workflows. Additional utilities for data handling, logging, and reproducibility are also included. These libraries collectively provide a robust foundation for geospatial AI projects.</span>
<span id="cb65-349"><a href="#cb65-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-352"><a href="#cb65-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-353"><a href="#cb65-353" aria-hidden="true" tabindex="-1"></a><span class="co"># Core geospatial libraries</span></span>
<span id="cb65-354"><a href="#cb65-354" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> rasterio</span>
<span id="cb65-355"><a href="#cb65-355" aria-hidden="true" tabindex="-1"></a><span class="ex">from</span> rasterio.warp import calculate_default_transform, reproject, Resampling</span>
<span id="cb65-356"><a href="#cb65-356" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> xarray as xr</span>
<span id="cb65-357"><a href="#cb65-357" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> rioxarray  <span class="co"># Extends xarray with rasterio functionality</span></span>
<span id="cb65-358"><a href="#cb65-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-359"><a href="#cb65-359" aria-hidden="true" tabindex="-1"></a><span class="co"># Data access and processing</span></span>
<span id="cb65-360"><a href="#cb65-360" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> numpy as np</span>
<span id="cb65-361"><a href="#cb65-361" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> pandas as pd</span>
<span id="cb65-362"><a href="#cb65-362" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> geopandas as gpd</span>
<span id="cb65-363"><a href="#cb65-363" aria-hidden="true" tabindex="-1"></a><span class="ex">from</span> pystac_client import Client</span>
<span id="cb65-364"><a href="#cb65-364" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> planetary_computer as pc  <span class="co"># For signing asset URLs</span></span>
<span id="cb65-365"><a href="#cb65-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-366"><a href="#cb65-366" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb65-367"><a href="#cb65-367" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> matplotlib.pyplot as plt</span>
<span id="cb65-368"><a href="#cb65-368" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> folium</span>
<span id="cb65-369"><a href="#cb65-369" aria-hidden="true" tabindex="-1"></a><span class="ex">from</span> folium import plugins</span>
<span id="cb65-370"><a href="#cb65-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-371"><a href="#cb65-371" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilities</span></span>
<span id="cb65-372"><a href="#cb65-372" aria-hidden="true" tabindex="-1"></a><span class="ex">from</span> typing import Dict, List, Tuple, Optional, Union</span>
<span id="cb65-373"><a href="#cb65-373" aria-hidden="true" tabindex="-1"></a><span class="ex">from</span> pathlib import Path</span>
<span id="cb65-374"><a href="#cb65-374" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> json</span>
<span id="cb65-375"><a href="#cb65-375" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> time</span>
<span id="cb65-376"><a href="#cb65-376" aria-hidden="true" tabindex="-1"></a><span class="ex">from</span> datetime import datetime, timedelta</span>
<span id="cb65-377"><a href="#cb65-377" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> logging</span>
<span id="cb65-378"><a href="#cb65-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-379"><a href="#cb65-379" aria-hidden="true" tabindex="-1"></a><span class="co"># Deep learning libraries</span></span>
<span id="cb65-380"><a href="#cb65-380" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> torch</span>
<span id="cb65-381"><a href="#cb65-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-382"><a href="#cb65-382" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-383"><a href="#cb65-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-384"><a href="#cb65-384" aria-hidden="true" tabindex="-1"></a><span class="ex">Set</span> up some standard plot configuration options. </span>
<span id="cb65-385"><a href="#cb65-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-388"><a href="#cb65-388" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-389"><a href="#cb65-389" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure matplotlib for publication-quality plots</span></span>
<span id="cb65-390"><a href="#cb65-390" aria-hidden="true" tabindex="-1"></a><span class="ex">plt.rcParams.update</span><span class="er">(</span><span class="kw">{</span></span>
<span id="cb65-391"><a href="#cb65-391" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.figsize'</span><span class="ex">:</span> <span class="er">(</span><span class="ex">10,</span> 6<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-392"><a href="#cb65-392" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.dpi'</span><span class="ex">:</span> 100,</span>
<span id="cb65-393"><a href="#cb65-393" aria-hidden="true" tabindex="-1"></a>    <span class="st">'font.size'</span><span class="ex">:</span> 10,</span>
<span id="cb65-394"><a href="#cb65-394" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.titlesize'</span><span class="ex">:</span> 12,</span>
<span id="cb65-395"><a href="#cb65-395" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.labelsize'</span><span class="ex">:</span> 10,</span>
<span id="cb65-396"><a href="#cb65-396" aria-hidden="true" tabindex="-1"></a>    <span class="st">'xtick.labelsize'</span><span class="ex">:</span> 9,</span>
<span id="cb65-397"><a href="#cb65-397" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ytick.labelsize'</span><span class="ex">:</span> 9,</span>
<span id="cb65-398"><a href="#cb65-398" aria-hidden="true" tabindex="-1"></a>    <span class="st">'legend.fontsize'</span><span class="ex">:</span> 9</span>
<span id="cb65-399"><a href="#cb65-399" aria-hidden="true" tabindex="-1"></a><span class="kw">})</span></span>
<span id="cb65-400"><a href="#cb65-400" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-401"><a href="#cb65-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-402"><a href="#cb65-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-403"><a href="#cb65-403" aria-hidden="true" tabindex="-1"></a><span class="co">### 2.3 Setup Logging for our workflow</span></span>
<span id="cb65-404"><a href="#cb65-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-405"><a href="#cb65-405" aria-hidden="true" tabindex="-1"></a><span class="ex">Logging</span> is a crucial practice in data science and geospatial workflows, enabling you to track code execution, monitor data processing steps, and quickly diagnose issues. By setting up logging, you ensure that your analyses are reproducible and errors are easier to trace—especially important in production or collaborative environments. For more on logging in data science, see [Effective Logging for Data Science]<span class="er">(</span><span class="ex">https://towardsdatascience.com/5-easy-and-effective-ways-to-use-python-logging-a9564bd17ccd/</span><span class="kw">)</span> <span class="ex">and</span> the [Python logging HOWTO]<span class="er">(</span><span class="ex">https://docs.python.org/3/howto/logging.html</span><span class="kw">)</span><span class="bu">.</span></span>
<span id="cb65-406"><a href="#cb65-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-407"><a href="#cb65-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-410"><a href="#cb65-410" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-411"><a href="#cb65-411" aria-hidden="true" tabindex="-1"></a><span class="co"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-412"><a href="#cb65-412" aria-hidden="true" tabindex="-1"></a><span class="co"># | tangle-append: true</span></span>
<span id="cb65-413"><a href="#cb65-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-414"><a href="#cb65-414" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure logging for production-ready code</span></span>
<span id="cb65-415"><a href="#cb65-415" aria-hidden="true" tabindex="-1"></a><span class="ex">logging.basicConfig</span><span class="er">(</span></span>
<span id="cb65-416"><a href="#cb65-416" aria-hidden="true" tabindex="-1"></a>    <span class="va">level</span><span class="op">=</span>logging.INFO, <span class="va">format</span><span class="op">=</span><span class="st">"%(asctime)s - %(levelname)s - %(message)s"</span></span>
<span id="cb65-417"><a href="#cb65-417" aria-hidden="true" tabindex="-1"></a><span class="kw">)</span></span>
<span id="cb65-418"><a href="#cb65-418" aria-hidden="true" tabindex="-1"></a><span class="ex">logger</span> = logging.getLogger<span class="er">(</span><span class="ex">__name__</span><span class="kw">)</span></span>
<span id="cb65-419"><a href="#cb65-419" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-420"><a href="#cb65-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-421"><a href="#cb65-421" aria-hidden="true" tabindex="-1"></a><span class="co">### 2.4 Geospatial AI Toolkit: Comprehensive Helper Functions</span></span>
<span id="cb65-422"><a href="#cb65-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-423"><a href="#cb65-423" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> chapter is organized to guide you through the essential foundations of geospatial data science and AI. The file is structured into clear sections, each focusing on a key aspect of the geospatial workflow:</span>
<span id="cb65-424"><a href="#cb65-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-425"><a href="#cb65-425" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Library Imports and Setup<span class="pp">**</span>: All necessary Python packages are imported and configured for geospatial analysis and visualization.</span>
<span id="cb65-426"><a href="#cb65-426" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Helper Functions<span class="pp">**</span>: Modular utility functions are introduced to streamline common geospatial tasks.</span>
<span id="cb65-427"><a href="#cb65-427" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Sectioned Capabilities<span class="pp">**</span>: Each major capability <span class="er">(</span><span class="ex">such</span> as authentication, data access, and processing<span class="kw">)</span> <span class="ex">is</span> presented in its own section, with explanations of the underlying design patterns and best practices.</span>
<span id="cb65-428"><a href="#cb65-428" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Progressive Complexity<span class="pp">**</span>: Concepts and code build on each other, moving from foundational tools to more advanced techniques.</span>
<span id="cb65-429"><a href="#cb65-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-430"><a href="#cb65-430" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> structure is designed to help you understand not just how to use the tools, but also why certain architectural and security decisions are made—preparing you for both practical work and deeper learning as you progress through the course.</span>
<span id="cb65-431"><a href="#cb65-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-432"><a href="#cb65-432" aria-hidden="true" tabindex="-1"></a><span class="co">#### 2.4.1 STAC Authentication and Security 🔐</span></span>
<span id="cb65-433"><a href="#cb65-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-434"><a href="#cb65-434" aria-hidden="true" tabindex="-1"></a><span class="ex">:::{.callout-tip}</span></span>
<span id="cb65-435"><a href="#cb65-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-436"><a href="#cb65-436" aria-hidden="true" tabindex="-1"></a><span class="co">##### Learning Objectives</span></span>
<span id="cb65-437"><a href="#cb65-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-438"><a href="#cb65-438" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> Understand API authentication patterns for production systems</span>
<span id="cb65-439"><a href="#cb65-439" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> Implement secure credential management for cloud services</span>
<span id="cb65-440"><a href="#cb65-440" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> Design robust authentication with fallback mechanisms</span>
<span id="cb65-441"><a href="#cb65-441" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> Apply enterprise security best practices to geospatial workflows</span>
<span id="cb65-442"><a href="#cb65-442" aria-hidden="true" tabindex="-1"></a><span class="ex">:::</span></span>
<span id="cb65-443"><a href="#cb65-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-444"><a href="#cb65-444" aria-hidden="true" tabindex="-1"></a><span class="co">### Why Authentication Matters in Geospatial AI</span></span>
<span id="cb65-445"><a href="#cb65-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-446"><a href="#cb65-446" aria-hidden="true" tabindex="-1"></a><span class="ex">Modern</span> satellite data access relies on cloud-native APIs that require proper authentication for:</span>
<span id="cb65-447"><a href="#cb65-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-448"><a href="#cb65-448" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Rate Limit Management<span class="pp">**</span>: Authenticated users get higher request quotas</span>
<span id="cb65-449"><a href="#cb65-449" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Access Control<span class="pp">**</span>: Some datasets require institutional or commercial access</span>
<span id="cb65-450"><a href="#cb65-450" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Usage Tracking<span class="pp">**</span>: Providers need to monitor and bill for data access</span>
<span id="cb65-451"><a href="#cb65-451" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Security<span class="pp">**</span>: Prevents abuse and ensures sustainable data sharing</span>
<span id="cb65-452"><a href="#cb65-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-453"><a href="#cb65-453" aria-hidden="true" tabindex="-1"></a><span class="ex">:::{.callout-note}</span></span>
<span id="cb65-454"><a href="#cb65-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-455"><a href="#cb65-455" aria-hidden="true" tabindex="-1"></a><span class="co">##### How to Obtain a Microsoft Planetary Computer API Key</span></span>
<span id="cb65-456"><a href="#cb65-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-457"><a href="#cb65-457" aria-hidden="true" tabindex="-1"></a><span class="ex">To</span> access premium datasets and higher request quotas on the Microsoft Planetary Computer, you need to obtain a free API key. Follow these steps:</span>
<span id="cb65-458"><a href="#cb65-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-459"><a href="#cb65-459" aria-hidden="true" tabindex="-1"></a><span class="ex">1.</span> <span class="pp">**</span>Sign in with a Microsoft Account<span class="pp">**</span></span>
<span id="cb65-460"><a href="#cb65-460" aria-hidden="true" tabindex="-1"></a>   <span class="ex">-</span> Visit the [Planetary Computer sign-in page]<span class="er">(</span><span class="ex">https://planetarycomputer.microsoft.com/account</span><span class="kw">)</span><span class="bu">.</span></span>
<span id="cb65-461"><a href="#cb65-461" aria-hidden="true" tabindex="-1"></a>   <span class="ex">-</span> Click <span class="pp">**</span>Sign in<span class="pp">**</span> and log in using your Microsoft, GitHub, or LinkedIn account.</span>
<span id="cb65-462"><a href="#cb65-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-463"><a href="#cb65-463" aria-hidden="true" tabindex="-1"></a><span class="ex">2.</span> <span class="pp">**</span>Request an API Key<span class="pp">**</span></span>
<span id="cb65-464"><a href="#cb65-464" aria-hidden="true" tabindex="-1"></a>   <span class="ex">-</span> After signing in, navigate to the [API Keys section]<span class="er">(</span><span class="ex">https://planetarycomputer.microsoft.com/account/keys</span><span class="kw">)</span><span class="bu">.</span></span>
<span id="cb65-465"><a href="#cb65-465" aria-hidden="true" tabindex="-1"></a>   <span class="ex">-</span> Click <span class="pp">**</span>Request API Key<span class="pp">**</span>.</span>
<span id="cb65-466"><a href="#cb65-466" aria-hidden="true" tabindex="-1"></a>   <span class="ex">-</span> Fill out the brief form describing your intended use <span class="er">(</span><span class="ex">e.g.,</span> <span class="st">"For coursework in geospatial data science"</span><span class="kw">)</span><span class="bu">.</span></span>
<span id="cb65-467"><a href="#cb65-467" aria-hidden="true" tabindex="-1"></a>   <span class="ex">-</span> Submit the request. Approval is usually instant for academic and research use.</span>
<span id="cb65-468"><a href="#cb65-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-469"><a href="#cb65-469" aria-hidden="true" tabindex="-1"></a><span class="ex">3.</span> <span class="pp">**</span>Copy Your API Key<span class="pp">**</span></span>
<span id="cb65-470"><a href="#cb65-470" aria-hidden="true" tabindex="-1"></a>   <span class="ex">-</span> Once approved, your API key will be displayed on the page.</span>
<span id="cb65-471"><a href="#cb65-471" aria-hidden="true" tabindex="-1"></a>   <span class="ex">-</span> <span class="pp">**</span>Copy<span class="pp">**</span> the key and keep it secure. Do not share it publicly.</span>
<span id="cb65-472"><a href="#cb65-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-473"><a href="#cb65-473" aria-hidden="true" tabindex="-1"></a><span class="ex">4.</span> <span class="pp">**</span>Set the API Key for Your Code<span class="pp">**</span></span>
<span id="cb65-474"><a href="#cb65-474" aria-hidden="true" tabindex="-1"></a>   <span class="ex">-</span> <span class="pp">**</span>Recommended <span class="er">(</span><span class="cf">for</span> local <span class="ex">development</span><span class="kw">)</span><span class="bu">:</span><span class="pp">**</span>  </span>
<span id="cb65-475"><a href="#cb65-475" aria-hidden="true" tabindex="-1"></a>     <span class="ex">Create</span> a file named <span class="kw">`</span>.env<span class="kw">`</span> <span class="er">in</span> <span class="ex">your</span> project directory and add the following line:  </span>
<span id="cb65-476"><a href="#cb65-476" aria-hidden="true" tabindex="-1"></a>     <span class="kw">```</span></span>
<span id="cb65-477"><a href="#cb65-477" aria-hidden="true" tabindex="-1"></a>     <span class="va">PC_SDK_SUBSCRIPTION_KEY</span><span class="op">=</span>your_api_key_here</span>
<span id="cb65-478"><a href="#cb65-478" aria-hidden="true" tabindex="-1"></a>     <span class="kw">```</span></span>
<span id="cb65-479"><a href="#cb65-479" aria-hidden="true" tabindex="-1"></a>   <span class="ex">-</span> <span class="pp">**</span>Alternatively <span class="er">(</span><span class="cf">for</span> temporary <span class="ex">use</span><span class="kw">)</span><span class="bu">:</span><span class="pp">**</span>  </span>
<span id="cb65-480"><a href="#cb65-480" aria-hidden="true" tabindex="-1"></a>     <span class="ex">Set</span> the environment variable in your terminal before running your code:  </span>
<span id="cb65-481"><a href="#cb65-481" aria-hidden="true" tabindex="-1"></a>     <span class="kw">```</span></span>
<span id="cb65-482"><a href="#cb65-482" aria-hidden="true" tabindex="-1"></a>     <span class="bu">export</span> <span class="va">PC_SDK_SUBSCRIPTION_KEY</span><span class="op">=</span>your_api_key_here</span>
<span id="cb65-483"><a href="#cb65-483" aria-hidden="true" tabindex="-1"></a>     <span class="kw">```</span></span>
<span id="cb65-484"><a href="#cb65-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-485"><a href="#cb65-485" aria-hidden="true" tabindex="-1"></a><span class="ex">5.</span> <span class="pp">**</span>Verify Authentication<span class="pp">**</span></span>
<span id="cb65-486"><a href="#cb65-486" aria-hidden="true" tabindex="-1"></a>   <span class="ex">-</span> When you run the code in this chapter, it will automatically detect your API key and authenticate you with the Planetary Computer.</span>
<span id="cb65-487"><a href="#cb65-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-488"><a href="#cb65-488" aria-hidden="true" tabindex="-1"></a><span class="ex">:::</span></span>
<span id="cb65-489"><a href="#cb65-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-490"><a href="#cb65-490" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> <span class="ex">**Tip:**</span> If you lose your API key, you can always return to the [API Keys page]<span class="er">(</span><span class="ex">https://planetarycomputer.microsoft.com/account/keys</span><span class="kw">)</span> <span class="ex">to</span> view or regenerate it.</span>
<span id="cb65-491"><a href="#cb65-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-492"><a href="#cb65-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-495"><a href="#cb65-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-496"><a href="#cb65-496" aria-hidden="true" tabindex="-1"></a><span class="co">#| tangle: geogfm/c01.py</span></span>
<span id="cb65-497"><a href="#cb65-497" aria-hidden="true" tabindex="-1"></a><span class="co">#| tangle-append: true</span></span>
<span id="cb65-498"><a href="#cb65-498" aria-hidden="true" tabindex="-1"></a><span class="ex">def</span> setup_planetary_computer_auth<span class="er">(</span><span class="kw">)</span> <span class="ex">-</span><span class="op">&gt;</span> bool:</span>
<span id="cb65-499"><a href="#cb65-499" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb65-500"><a href="#cb65-500" aria-hidden="true" tabindex="-1"></a><span class="st">    Configure authentication for Microsoft Planetary Computer.</span></span>
<span id="cb65-501"><a href="#cb65-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-502"><a href="#cb65-502" aria-hidden="true" tabindex="-1"></a><span class="st">    Uses environment variables and .env files for credential discovery,</span></span>
<span id="cb65-503"><a href="#cb65-503" aria-hidden="true" tabindex="-1"></a><span class="st">    with graceful degradation to anonymous access.</span></span>
<span id="cb65-504"><a href="#cb65-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-505"><a href="#cb65-505" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb65-506"><a href="#cb65-506" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb65-507"><a href="#cb65-507" aria-hidden="true" tabindex="-1"></a><span class="st">    bool</span></span>
<span id="cb65-508"><a href="#cb65-508" aria-hidden="true" tabindex="-1"></a><span class="st">        True if authenticated, False for anonymous access</span></span>
<span id="cb65-509"><a href="#cb65-509" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-510"><a href="#cb65-510" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Try environment variables first (production)</span></span>
<span id="cb65-511"><a href="#cb65-511" aria-hidden="true" tabindex="-1"></a>    <span class="ex">auth_key</span> = os.getenv<span class="er">(</span><span class="st">'PC_SDK_SUBSCRIPTION_KEY'</span><span class="kw">)</span> <span class="ex">or</span> os.getenv<span class="er">(</span><span class="st">'PLANETARY_COMPUTER_API_KEY'</span><span class="kw">)</span></span>
<span id="cb65-512"><a href="#cb65-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-513"><a href="#cb65-513" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback to .env file (development)</span></span>
<span id="cb65-514"><a href="#cb65-514" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="ex">not</span> auth_key:</span>
<span id="cb65-515"><a href="#cb65-515" aria-hidden="true" tabindex="-1"></a>        <span class="ex">env_file</span> = Path<span class="er">(</span><span class="st">'.env'</span><span class="kw">)</span></span>
<span id="cb65-516"><a href="#cb65-516" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="fu">env_file.exists()</span><span class="bu">:</span></span>
<span id="cb65-517"><a href="#cb65-517" aria-hidden="true" tabindex="-1"></a>            <span class="ex">try:</span></span>
<span id="cb65-518"><a href="#cb65-518" aria-hidden="true" tabindex="-1"></a>                <span class="ex">with</span> open<span class="er">(</span><span class="ex">env_file</span><span class="kw">)</span> <span class="fu">as</span> f:</span>
<span id="cb65-519"><a href="#cb65-519" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> line <span class="kw">in</span> f:</span>
<span id="cb65-520"><a href="#cb65-520" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">line</span> = line.strip<span class="er">(</span><span class="kw">)</span></span>
<span id="cb65-521"><a href="#cb65-521" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="ex">line.startswith</span><span class="er">((</span><span class="st">'PC_SDK_SUBSCRIPTION_KEY='</span><span class="kw">,</span> <span class="st">'PLANETARY_COMPUTER_API_KEY='</span><span class="kw">))</span><span class="bu">:</span></span>
<span id="cb65-522"><a href="#cb65-522" aria-hidden="true" tabindex="-1"></a>                            <span class="ex">auth_key</span> = line.split<span class="er">(</span><span class="st">'='</span><span class="ex">,</span> 1<span class="kw">)</span><span class="ex">[1].strip</span><span class="er">(</span><span class="kw">)</span><span class="ex">.strip</span><span class="er">(</span><span class="st">'"\'')</span></span>
<span id="cb65-523"><a href="#cb65-523" aria-hidden="true" tabindex="-1"></a><span class="st">                            break</span></span>
<span id="cb65-524"><a href="#cb65-524" aria-hidden="true" tabindex="-1"></a><span class="st">            except Exception:</span></span>
<span id="cb65-525"><a href="#cb65-525" aria-hidden="true" tabindex="-1"></a><span class="st">                pass  # Continue with anonymous access</span></span>
<span id="cb65-526"><a href="#cb65-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-527"><a href="#cb65-527" aria-hidden="true" tabindex="-1"></a><span class="st">    # Configure authentication</span></span>
<span id="cb65-528"><a href="#cb65-528" aria-hidden="true" tabindex="-1"></a><span class="st">    if auth_key and len(auth_key) &gt; 10:</span></span>
<span id="cb65-529"><a href="#cb65-529" aria-hidden="true" tabindex="-1"></a><span class="st">        try:</span></span>
<span id="cb65-530"><a href="#cb65-530" aria-hidden="true" tabindex="-1"></a><span class="st">            pc.set_subscription_key(auth_key)</span></span>
<span id="cb65-531"><a href="#cb65-531" aria-hidden="true" tabindex="-1"></a><span class="st">            logger.info("Planetary Computer authentication successful")</span></span>
<span id="cb65-532"><a href="#cb65-532" aria-hidden="true" tabindex="-1"></a><span class="st">            return True</span></span>
<span id="cb65-533"><a href="#cb65-533" aria-hidden="true" tabindex="-1"></a><span class="st">        except Exception as e:</span></span>
<span id="cb65-534"><a href="#cb65-534" aria-hidden="true" tabindex="-1"></a><span class="st">            logger.warning(f"Authentication failed: {e}")</span></span>
<span id="cb65-535"><a href="#cb65-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-536"><a href="#cb65-536" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info("Using anonymous access (basic rate limits)")</span></span>
<span id="cb65-537"><a href="#cb65-537" aria-hidden="true" tabindex="-1"></a><span class="st">    return False</span></span>
<span id="cb65-538"><a href="#cb65-538" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-539"><a href="#cb65-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-540"><a href="#cb65-540" aria-hidden="true" tabindex="-1"></a><span class="st">### Authenticate to the Planetary Computer</span></span>
<span id="cb65-541"><a href="#cb65-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-544"><a href="#cb65-544" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-545"><a href="#cb65-545" aria-hidden="true" tabindex="-1"></a><span class="st"># Initialize authentication</span></span>
<span id="cb65-546"><a href="#cb65-546" aria-hidden="true" tabindex="-1"></a><span class="st">auth_status = setup_planetary_computer_auth()</span></span>
<span id="cb65-547"><a href="#cb65-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-548"><a href="#cb65-548" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"Planetary Computer authentication status: {'</span><span class="ex">Authenticated</span><span class="st">' if auth_status else '</span><span class="ex">Anonymous</span><span class="st">'}")</span></span>
<span id="cb65-549"><a href="#cb65-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-550"><a href="#cb65-550" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-551"><a href="#cb65-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-552"><a href="#cb65-552" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-note}</span></span>
<span id="cb65-553"><a href="#cb65-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-554"><a href="#cb65-554" aria-hidden="true" tabindex="-1"></a><span class="st">##### Security Best Practices</span></span>
<span id="cb65-555"><a href="#cb65-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-556"><a href="#cb65-556" aria-hidden="true" tabindex="-1"></a><span class="st">- **Never hardcode credentials** in source code or notebooks</span></span>
<span id="cb65-557"><a href="#cb65-557" aria-hidden="true" tabindex="-1"></a><span class="st">- **Use environment variables** for production deployments</span></span>
<span id="cb65-558"><a href="#cb65-558" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-559"><a href="#cb65-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-560"><a href="#cb65-560" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb65-561"><a href="#cb65-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-562"><a href="#cb65-562" aria-hidden="true" tabindex="-1"></a><span class="st">#### 2.4.2 STAC Data Discovery 🔍</span></span>
<span id="cb65-563"><a href="#cb65-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-564"><a href="#cb65-564" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-tip}</span></span>
<span id="cb65-565"><a href="#cb65-565" aria-hidden="true" tabindex="-1"></a><span class="st">##### Learning Objectives</span></span>
<span id="cb65-566"><a href="#cb65-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-567"><a href="#cb65-567" aria-hidden="true" tabindex="-1"></a><span class="st">- Master cloud-native data discovery patterns</span></span>
<span id="cb65-568"><a href="#cb65-568" aria-hidden="true" tabindex="-1"></a><span class="st">- Understand STAC query optimization strategies</span></span>
<span id="cb65-569"><a href="#cb65-569" aria-hidden="true" tabindex="-1"></a><span class="st">- Implement robust search with intelligent filtering</span></span>
<span id="cb65-570"><a href="#cb65-570" aria-hidden="true" tabindex="-1"></a><span class="st">- Design scalable data discovery for large-scale analysis</span></span>
<span id="cb65-571"><a href="#cb65-571" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-572"><a href="#cb65-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-573"><a href="#cb65-573" aria-hidden="true" tabindex="-1"></a><span class="st">### Cloud-Native Data Access Architecture</span></span>
<span id="cb65-574"><a href="#cb65-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-575"><a href="#cb65-575" aria-hidden="true" tabindex="-1"></a><span class="st">STAC APIs represent a paradigm shift from traditional data distribution:</span></span>
<span id="cb65-576"><a href="#cb65-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-577"><a href="#cb65-577" aria-hidden="true" tabindex="-1"></a><span class="st">- **Federated Catalogs**: Multiple providers, unified interface</span></span>
<span id="cb65-578"><a href="#cb65-578" aria-hidden="true" tabindex="-1"></a><span class="st">- **On-Demand Access**: No need to download entire datasets</span></span>
<span id="cb65-579"><a href="#cb65-579" aria-hidden="true" tabindex="-1"></a><span class="st">- **Rich Metadata**: Searchable properties for precise discovery</span></span>
<span id="cb65-580"><a href="#cb65-580" aria-hidden="true" tabindex="-1"></a><span class="st">- **Cloud Optimization**: Direct access to cloud-optimized formats</span></span>
<span id="cb65-581"><a href="#cb65-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-582"><a href="#cb65-582" aria-hidden="true" tabindex="-1"></a><span class="st">The code block below defines a function, `search_sentinel2_scenes`, which enables us to programmatically search for Sentinel-2 Level 2A satellite imagery using the Microsoft Planetary Computer (MPC) STAC API. </span></span>
<span id="cb65-583"><a href="#cb65-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-584"><a href="#cb65-584" aria-hidden="true" tabindex="-1"></a><span class="st">Here'</span><span class="ex">s</span> how it works:</span>
<span id="cb65-585"><a href="#cb65-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-586"><a href="#cb65-586" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Inputs<span class="pp">**</span>: You provide a bounding box <span class="er">(</span><span class="kw">`</span><span class="ex">bbox</span><span class="kw">`)</span><span class="ex">,</span> a date range <span class="er">(</span><span class="kw">`</span><span class="ex">date_range</span><span class="kw">`)</span><span class="ex">,</span> a maximum allowed cloud cover <span class="er">(</span><span class="kw">`</span><span class="ex">cloud_cover_max</span><span class="kw">`)</span><span class="ex">,</span> and a limit on the number of results.</span>
<span id="cb65-587"><a href="#cb65-587" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>STAC Search<span class="pp">**</span>: The function connects to the MPC<span class="st">'s STAC API endpoint and performs a search for Sentinel-2 scenes that match your criteria.</span></span>
<span id="cb65-588"><a href="#cb65-588" aria-hidden="true" tabindex="-1"></a><span class="st">- **Filtering**: It filters results by cloud cover and sorts them so that the clearest images (lowest cloud cover) come first.</span></span>
<span id="cb65-589"><a href="#cb65-589" aria-hidden="true" tabindex="-1"></a><span class="st">- **Output**: The function returns a list of STAC items (scenes) that you can further analyze or download.</span></span>
<span id="cb65-590"><a href="#cb65-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-591"><a href="#cb65-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-594"><a href="#cb65-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-595"><a href="#cb65-595" aria-hidden="true" tabindex="-1"></a><span class="st">#| tangle: geogfm/c01.py</span></span>
<span id="cb65-596"><a href="#cb65-596" aria-hidden="true" tabindex="-1"></a><span class="st">#| tangle-append: true</span></span>
<span id="cb65-597"><a href="#cb65-597" aria-hidden="true" tabindex="-1"></a><span class="st">def search_sentinel2_scenes(</span></span>
<span id="cb65-598"><a href="#cb65-598" aria-hidden="true" tabindex="-1"></a><span class="st">    bbox: List[float],</span></span>
<span id="cb65-599"><a href="#cb65-599" aria-hidden="true" tabindex="-1"></a><span class="st">    date_range: str,</span></span>
<span id="cb65-600"><a href="#cb65-600" aria-hidden="true" tabindex="-1"></a><span class="st">    cloud_cover_max: float = 20,</span></span>
<span id="cb65-601"><a href="#cb65-601" aria-hidden="true" tabindex="-1"></a><span class="st">    limit: int = 10</span></span>
<span id="cb65-602"><a href="#cb65-602" aria-hidden="true" tabindex="-1"></a><span class="st">) -&gt; List:</span></span>
<span id="cb65-603"><a href="#cb65-603" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-604"><a href="#cb65-604" aria-hidden="true" tabindex="-1"></a><span class="st">    Search Sentinel-2 Level 2A scenes using STAC API.</span></span>
<span id="cb65-605"><a href="#cb65-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-606"><a href="#cb65-606" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb65-607"><a href="#cb65-607" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb65-608"><a href="#cb65-608" aria-hidden="true" tabindex="-1"></a><span class="st">    bbox : List[float]</span></span>
<span id="cb65-609"><a href="#cb65-609" aria-hidden="true" tabindex="-1"></a><span class="st">        Bounding box as [west, south, east, north] in WGS84</span></span>
<span id="cb65-610"><a href="#cb65-610" aria-hidden="true" tabindex="-1"></a><span class="st">    date_range : str</span></span>
<span id="cb65-611"><a href="#cb65-611" aria-hidden="true" tabindex="-1"></a><span class="st">        ISO date range: "YYYY-MM-DD/YYYY-MM-DD"</span></span>
<span id="cb65-612"><a href="#cb65-612" aria-hidden="true" tabindex="-1"></a><span class="st">    cloud_cover_max : float</span></span>
<span id="cb65-613"><a href="#cb65-613" aria-hidden="true" tabindex="-1"></a><span class="st">        Maximum cloud cover percentage</span></span>
<span id="cb65-614"><a href="#cb65-614" aria-hidden="true" tabindex="-1"></a><span class="st">    limit : int</span></span>
<span id="cb65-615"><a href="#cb65-615" aria-hidden="true" tabindex="-1"></a><span class="st">        Maximum scenes to return</span></span>
<span id="cb65-616"><a href="#cb65-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-617"><a href="#cb65-617" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb65-618"><a href="#cb65-618" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb65-619"><a href="#cb65-619" aria-hidden="true" tabindex="-1"></a><span class="st">    List[pystac.Item]</span></span>
<span id="cb65-620"><a href="#cb65-620" aria-hidden="true" tabindex="-1"></a><span class="st">        List of STAC items sorted by cloud cover (ascending)</span></span>
<span id="cb65-621"><a href="#cb65-621" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-622"><a href="#cb65-622" aria-hidden="true" tabindex="-1"></a><span class="st">    catalog = Client.open(</span></span>
<span id="cb65-623"><a href="#cb65-623" aria-hidden="true" tabindex="-1"></a><span class="st">        "https://planetarycomputer.microsoft.com/api/stac/v1",</span></span>
<span id="cb65-624"><a href="#cb65-624" aria-hidden="true" tabindex="-1"></a><span class="st">        modifier=pc.sign_inplace</span></span>
<span id="cb65-625"><a href="#cb65-625" aria-hidden="true" tabindex="-1"></a><span class="st">    )</span></span>
<span id="cb65-626"><a href="#cb65-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-627"><a href="#cb65-627" aria-hidden="true" tabindex="-1"></a><span class="st">    search_params = {</span></span>
<span id="cb65-628"><a href="#cb65-628" aria-hidden="true" tabindex="-1"></a><span class="st">        "collections": ["sentinel-2-l2a"],</span></span>
<span id="cb65-629"><a href="#cb65-629" aria-hidden="true" tabindex="-1"></a><span class="st">        "bbox": bbox,</span></span>
<span id="cb65-630"><a href="#cb65-630" aria-hidden="true" tabindex="-1"></a><span class="st">        "datetime": date_range,</span></span>
<span id="cb65-631"><a href="#cb65-631" aria-hidden="true" tabindex="-1"></a><span class="st">        "query": {"eo:cloud_cover": {"lt": cloud_cover_max}},</span></span>
<span id="cb65-632"><a href="#cb65-632" aria-hidden="true" tabindex="-1"></a><span class="st">        "limit": limit</span></span>
<span id="cb65-633"><a href="#cb65-633" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb65-634"><a href="#cb65-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-635"><a href="#cb65-635" aria-hidden="true" tabindex="-1"></a><span class="st">    search_results = catalog.search(**search_params)</span></span>
<span id="cb65-636"><a href="#cb65-636" aria-hidden="true" tabindex="-1"></a><span class="st">    items = list(search_results.items())</span></span>
<span id="cb65-637"><a href="#cb65-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-638"><a href="#cb65-638" aria-hidden="true" tabindex="-1"></a><span class="st">    # Sort by cloud cover (best quality first)</span></span>
<span id="cb65-639"><a href="#cb65-639" aria-hidden="true" tabindex="-1"></a><span class="st">    items.sort(key=lambda x: x.properties.get('</span>eo:cloud_cover<span class="st">', 100))</span></span>
<span id="cb65-640"><a href="#cb65-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-641"><a href="#cb65-641" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"Found {len(items)} Sentinel-2 scenes (cloud cover &lt; {cloud_cover_max}%)")</span></span>
<span id="cb65-642"><a href="#cb65-642" aria-hidden="true" tabindex="-1"></a><span class="st">    return items</span></span>
<span id="cb65-643"><a href="#cb65-643" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-644"><a href="#cb65-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-645"><a href="#cb65-645" aria-hidden="true" tabindex="-1"></a><span class="st">While the `search_sentinel2_scenes` function is currently tailored for Sentinel-2 imagery from the Microsoft Planetary Computer (MPC) STAC, it can be easily adapted to access other types of imagery or even different STAC endpoints. </span></span>
<span id="cb65-646"><a href="#cb65-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-647"><a href="#cb65-647" aria-hidden="true" tabindex="-1"></a><span class="st">To search for other datasets—such as Landsat, NAIP, or commercial imagery—you can modify the `"collections"` parameter in the `search_params` dictionary to reference the desired collection (e.g., `"landsat-8-c2-l2"` for Landsat 8). Additionally, to query a different STAC API (such as a local STAC server or another cloud provider), simply change the `Client.open()` URL to the appropriate endpoint. You may also adjust the search filters (e.g., properties like spatial resolution, acquisition mode, or custom metadata fields) to suit the requirements of other imagery types. </span></span>
<span id="cb65-648"><a href="#cb65-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-649"><a href="#cb65-649" aria-hidden="true" tabindex="-1"></a><span class="st">The `search_STAC_scenes` function generalizes our `search_sentinel2_scenes` by allowing keyword parameters that define the collection and the URL to use to access the STAC. This flexibility allows you to leverage the same search pattern for a wide variety of geospatial datasets across multiple STAC-compliant catalogs.</span></span>
<span id="cb65-650"><a href="#cb65-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-653"><a href="#cb65-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-654"><a href="#cb65-654" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-655"><a href="#cb65-655" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle-append: true</span></span>
<span id="cb65-656"><a href="#cb65-656" aria-hidden="true" tabindex="-1"></a><span class="st">def search_STAC_scenes(</span></span>
<span id="cb65-657"><a href="#cb65-657" aria-hidden="true" tabindex="-1"></a><span class="st">    bbox: list,</span></span>
<span id="cb65-658"><a href="#cb65-658" aria-hidden="true" tabindex="-1"></a><span class="st">    date_range: str,</span></span>
<span id="cb65-659"><a href="#cb65-659" aria-hidden="true" tabindex="-1"></a><span class="st">    cloud_cover_max: float = 100.0,</span></span>
<span id="cb65-660"><a href="#cb65-660" aria-hidden="true" tabindex="-1"></a><span class="st">    limit: int = 10,</span></span>
<span id="cb65-661"><a href="#cb65-661" aria-hidden="true" tabindex="-1"></a><span class="st">    collection: str = "sentinel-2-l2a",</span></span>
<span id="cb65-662"><a href="#cb65-662" aria-hidden="true" tabindex="-1"></a><span class="st">    stac_url: str = "https://planetarycomputer.microsoft.com/api/stac/v1",</span></span>
<span id="cb65-663"><a href="#cb65-663" aria-hidden="true" tabindex="-1"></a><span class="st">    client_modifier=None,</span></span>
<span id="cb65-664"><a href="#cb65-664" aria-hidden="true" tabindex="-1"></a><span class="st">    extra_query: dict = None</span></span>
<span id="cb65-665"><a href="#cb65-665" aria-hidden="true" tabindex="-1"></a><span class="st">) -&gt; list:</span></span>
<span id="cb65-666"><a href="#cb65-666" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-667"><a href="#cb65-667" aria-hidden="true" tabindex="-1"></a><span class="st">    General-purpose function to search STAC scenes using a STAC API.</span></span>
<span id="cb65-668"><a href="#cb65-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-669"><a href="#cb65-669" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb65-670"><a href="#cb65-670" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb65-671"><a href="#cb65-671" aria-hidden="true" tabindex="-1"></a><span class="st">    bbox : List[float]</span></span>
<span id="cb65-672"><a href="#cb65-672" aria-hidden="true" tabindex="-1"></a><span class="st">        Bounding box as [west, south, east, north] in WGS84</span></span>
<span id="cb65-673"><a href="#cb65-673" aria-hidden="true" tabindex="-1"></a><span class="st">    date_range : str</span></span>
<span id="cb65-674"><a href="#cb65-674" aria-hidden="true" tabindex="-1"></a><span class="st">        ISO date range: "YYYY-MM-DD/YYYY-MM-DD"</span></span>
<span id="cb65-675"><a href="#cb65-675" aria-hidden="true" tabindex="-1"></a><span class="st">    cloud_cover_max : float, optional</span></span>
<span id="cb65-676"><a href="#cb65-676" aria-hidden="true" tabindex="-1"></a><span class="st">        Maximum cloud cover percentage (default: 100.0)</span></span>
<span id="cb65-677"><a href="#cb65-677" aria-hidden="true" tabindex="-1"></a><span class="st">    limit : int, optional</span></span>
<span id="cb65-678"><a href="#cb65-678" aria-hidden="true" tabindex="-1"></a><span class="st">        Maximum scenes to return (default: 10)</span></span>
<span id="cb65-679"><a href="#cb65-679" aria-hidden="true" tabindex="-1"></a><span class="st">    collection : str, optional</span></span>
<span id="cb65-680"><a href="#cb65-680" aria-hidden="true" tabindex="-1"></a><span class="st">        STAC collection name (default: "sentinel-2-l2a")</span></span>
<span id="cb65-681"><a href="#cb65-681" aria-hidden="true" tabindex="-1"></a><span class="st">    stac_url : str, optional</span></span>
<span id="cb65-682"><a href="#cb65-682" aria-hidden="true" tabindex="-1"></a><span class="st">        STAC API endpoint URL (default: MPC STAC)</span></span>
<span id="cb65-683"><a href="#cb65-683" aria-hidden="true" tabindex="-1"></a><span class="st">    client_modifier : callable, optional</span></span>
<span id="cb65-684"><a href="#cb65-684" aria-hidden="true" tabindex="-1"></a><span class="st">        Optional function to modify the STAC client (e.g., for auth)</span></span>
<span id="cb65-685"><a href="#cb65-685" aria-hidden="true" tabindex="-1"></a><span class="st">    extra_query : dict, optional</span></span>
<span id="cb65-686"><a href="#cb65-686" aria-hidden="true" tabindex="-1"></a><span class="st">        Additional query parameters for the search</span></span>
<span id="cb65-687"><a href="#cb65-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-688"><a href="#cb65-688" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb65-689"><a href="#cb65-689" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb65-690"><a href="#cb65-690" aria-hidden="true" tabindex="-1"></a><span class="st">    List[pystac.Item]</span></span>
<span id="cb65-691"><a href="#cb65-691" aria-hidden="true" tabindex="-1"></a><span class="st">        List of STAC items sorted by cloud cover (ascending, if available).</span></span>
<span id="cb65-692"><a href="#cb65-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-693"><a href="#cb65-693" aria-hidden="true" tabindex="-1"></a><span class="st">    Examples</span></span>
<span id="cb65-694"><a href="#cb65-694" aria-hidden="true" tabindex="-1"></a><span class="st">    --------</span></span>
<span id="cb65-695"><a href="#cb65-695" aria-hidden="true" tabindex="-1"></a><span class="st">    &gt;&gt;&gt; # Search for Sentinel-2 scenes (default) on the Microsoft Planetary Computer (default) </span></span>
<span id="cb65-696"><a href="#cb65-696" aria-hidden="true" tabindex="-1"></a><span class="st">    &gt;&gt;&gt; # over a bounding box in Oregon in January 2022</span></span>
<span id="cb65-697"><a href="#cb65-697" aria-hidden="true" tabindex="-1"></a><span class="st">    &gt;&gt;&gt; bbox = [-123.5, 45.0, -122.5, 46.0]</span></span>
<span id="cb65-698"><a href="#cb65-698" aria-hidden="true" tabindex="-1"></a><span class="st">    &gt;&gt;&gt; date_range = "2022-01-01/2022-01-31"</span></span>
<span id="cb65-699"><a href="#cb65-699" aria-hidden="true" tabindex="-1"></a><span class="st">    &gt;&gt;&gt; items = search_STAC_scenes(bbox, date_range, cloud_cover_max=10, limit=5)</span></span>
<span id="cb65-700"><a href="#cb65-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-701"><a href="#cb65-701" aria-hidden="true" tabindex="-1"></a><span class="st">    &gt;&gt;&gt; # Search for Landsat 8 scenes from a different STAC endpoint</span></span>
<span id="cb65-702"><a href="#cb65-702" aria-hidden="true" tabindex="-1"></a><span class="st">    &gt;&gt;&gt; landsat_url = "https://earth-search.aws.element84.com/v1"</span></span>
<span id="cb65-703"><a href="#cb65-703" aria-hidden="true" tabindex="-1"></a><span class="st">    &gt;&gt;&gt; items = search_STAC_scenes(</span></span>
<span id="cb65-704"><a href="#cb65-704" aria-hidden="true" tabindex="-1"></a><span class="st">    ...     bbox,</span></span>
<span id="cb65-705"><a href="#cb65-705" aria-hidden="true" tabindex="-1"></a><span class="st">    ...     "2021-06-01/2021-06-30",</span></span>
<span id="cb65-706"><a href="#cb65-706" aria-hidden="true" tabindex="-1"></a><span class="st">    ...     collection="landsat-8-c2-l2",</span></span>
<span id="cb65-707"><a href="#cb65-707" aria-hidden="true" tabindex="-1"></a><span class="st">    ...     stac_url=landsat_url,</span></span>
<span id="cb65-708"><a href="#cb65-708" aria-hidden="true" tabindex="-1"></a><span class="st">    ...     cloud_cover_max=20,</span></span>
<span id="cb65-709"><a href="#cb65-709" aria-hidden="true" tabindex="-1"></a><span class="st">    ...     limit=3</span></span>
<span id="cb65-710"><a href="#cb65-710" aria-hidden="true" tabindex="-1"></a><span class="st">    ... )</span></span>
<span id="cb65-711"><a href="#cb65-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-712"><a href="#cb65-712" aria-hidden="true" tabindex="-1"></a><span class="st">    &gt;&gt;&gt; # Add an extra query to filter by platform</span></span>
<span id="cb65-713"><a href="#cb65-713" aria-hidden="true" tabindex="-1"></a><span class="st">    &gt;&gt;&gt; items = search_STAC_scenes(</span></span>
<span id="cb65-714"><a href="#cb65-714" aria-hidden="true" tabindex="-1"></a><span class="st">    ...     bbox,</span></span>
<span id="cb65-715"><a href="#cb65-715" aria-hidden="true" tabindex="-1"></a><span class="st">    ...     date_range,</span></span>
<span id="cb65-716"><a href="#cb65-716" aria-hidden="true" tabindex="-1"></a><span class="st">    ...     extra_query={"platform": {"eq": "sentinel-2b"}}</span></span>
<span id="cb65-717"><a href="#cb65-717" aria-hidden="true" tabindex="-1"></a><span class="st">    ... )</span></span>
<span id="cb65-718"><a href="#cb65-718" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-719"><a href="#cb65-719" aria-hidden="true" tabindex="-1"></a><span class="st">    # Open the STAC client, with optional modifier (e.g., for MPC auth)</span></span>
<span id="cb65-720"><a href="#cb65-720" aria-hidden="true" tabindex="-1"></a><span class="st">    if client_modifier is not None:</span></span>
<span id="cb65-721"><a href="#cb65-721" aria-hidden="true" tabindex="-1"></a><span class="st">        catalog = Client.open(stac_url, modifier=client_modifier)</span></span>
<span id="cb65-722"><a href="#cb65-722" aria-hidden="true" tabindex="-1"></a><span class="st">    else:</span></span>
<span id="cb65-723"><a href="#cb65-723" aria-hidden="true" tabindex="-1"></a><span class="st">        catalog = Client.open(stac_url)</span></span>
<span id="cb65-724"><a href="#cb65-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-725"><a href="#cb65-725" aria-hidden="true" tabindex="-1"></a><span class="st">    # Build query parameters</span></span>
<span id="cb65-726"><a href="#cb65-726" aria-hidden="true" tabindex="-1"></a><span class="st">    search_params = {</span></span>
<span id="cb65-727"><a href="#cb65-727" aria-hidden="true" tabindex="-1"></a><span class="st">        "collections": [collection],</span></span>
<span id="cb65-728"><a href="#cb65-728" aria-hidden="true" tabindex="-1"></a><span class="st">        "bbox": bbox,</span></span>
<span id="cb65-729"><a href="#cb65-729" aria-hidden="true" tabindex="-1"></a><span class="st">        "datetime": date_range,</span></span>
<span id="cb65-730"><a href="#cb65-730" aria-hidden="true" tabindex="-1"></a><span class="st">        "limit": limit</span></span>
<span id="cb65-731"><a href="#cb65-731" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb65-732"><a href="#cb65-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-733"><a href="#cb65-733" aria-hidden="true" tabindex="-1"></a><span class="st">    # Add cloud cover filter if present</span></span>
<span id="cb65-734"><a href="#cb65-734" aria-hidden="true" tabindex="-1"></a><span class="st">    if cloud_cover_max &lt; 100.0:</span></span>
<span id="cb65-735"><a href="#cb65-735" aria-hidden="true" tabindex="-1"></a><span class="st">        search_params["query"] = {"eo:cloud_cover": {"lt": cloud_cover_max}}</span></span>
<span id="cb65-736"><a href="#cb65-736" aria-hidden="true" tabindex="-1"></a><span class="st">    if extra_query:</span></span>
<span id="cb65-737"><a href="#cb65-737" aria-hidden="true" tabindex="-1"></a><span class="st">        # Merge extra_query into search_params['</span>query<span class="st">']</span></span>
<span id="cb65-738"><a href="#cb65-738" aria-hidden="true" tabindex="-1"></a><span class="st">        if "query" not in search_params:</span></span>
<span id="cb65-739"><a href="#cb65-739" aria-hidden="true" tabindex="-1"></a><span class="st">            search_params["query"] = {}</span></span>
<span id="cb65-740"><a href="#cb65-740" aria-hidden="true" tabindex="-1"></a><span class="st">        search_params["query"].update(extra_query)</span></span>
<span id="cb65-741"><a href="#cb65-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-742"><a href="#cb65-742" aria-hidden="true" tabindex="-1"></a><span class="st">    search_results = catalog.search(**search_params)</span></span>
<span id="cb65-743"><a href="#cb65-743" aria-hidden="true" tabindex="-1"></a><span class="st">    items = list(search_results.items())</span></span>
<span id="cb65-744"><a href="#cb65-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-745"><a href="#cb65-745" aria-hidden="true" tabindex="-1"></a><span class="st">    # Sort by cloud cover if available</span></span>
<span id="cb65-746"><a href="#cb65-746" aria-hidden="true" tabindex="-1"></a><span class="st">    items.sort(key=lambda x: x.properties.get('</span>eo:cloud_cover<span class="st">', 100))</span></span>
<span id="cb65-747"><a href="#cb65-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-748"><a href="#cb65-748" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(</span></span>
<span id="cb65-749"><a href="#cb65-749" aria-hidden="true" tabindex="-1"></a><span class="st">        f"Found {len(items)} scenes in collection '</span>{collection}<span class="st">' (cloud cover &lt; {cloud_cover_max}%)"</span></span>
<span id="cb65-750"><a href="#cb65-750" aria-hidden="true" tabindex="-1"></a><span class="st">    )</span></span>
<span id="cb65-751"><a href="#cb65-751" aria-hidden="true" tabindex="-1"></a><span class="st">    return items</span></span>
<span id="cb65-752"><a href="#cb65-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-753"><a href="#cb65-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-754"><a href="#cb65-754" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-755"><a href="#cb65-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-756"><a href="#cb65-756" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-note}</span></span>
<span id="cb65-757"><a href="#cb65-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-758"><a href="#cb65-758" aria-hidden="true" tabindex="-1"></a><span class="st">##### Query Optimization Strategies</span></span>
<span id="cb65-759"><a href="#cb65-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-760"><a href="#cb65-760" aria-hidden="true" tabindex="-1"></a><span class="st">- **Spatial Indexing**: STAC APIs use spatial indices for fast geographic queries</span></span>
<span id="cb65-761"><a href="#cb65-761" aria-hidden="true" tabindex="-1"></a><span class="st">- **Temporal Partitioning**: Date-based organization enables efficient time series queries</span></span>
<span id="cb65-762"><a href="#cb65-762" aria-hidden="true" tabindex="-1"></a><span class="st">- **Property Filtering**: Server-side filtering reduces network transfer</span></span>
<span id="cb65-763"><a href="#cb65-763" aria-hidden="true" tabindex="-1"></a><span class="st">- **Result Ranking**: Sort by quality metrics (cloud cover, viewing angle) for best-first selection</span></span>
<span id="cb65-764"><a href="#cb65-764" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-765"><a href="#cb65-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-766"><a href="#cb65-766" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb65-767"><a href="#cb65-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-768"><a href="#cb65-768" aria-hidden="true" tabindex="-1"></a><span class="st">#### 2.4.3 Intelligent Data Loading 📥</span></span>
<span id="cb65-769"><a href="#cb65-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-770"><a href="#cb65-770" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-tip}</span></span>
<span id="cb65-771"><a href="#cb65-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-772"><a href="#cb65-772" aria-hidden="true" tabindex="-1"></a><span class="st">##### Learning Objectives</span></span>
<span id="cb65-773"><a href="#cb65-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-774"><a href="#cb65-774" aria-hidden="true" tabindex="-1"></a><span class="st">- Implement memory-efficient satellite data loading</span></span>
<span id="cb65-775"><a href="#cb65-775" aria-hidden="true" tabindex="-1"></a><span class="st">- Master coordinate reference system (CRS) transformations</span></span>
<span id="cb65-776"><a href="#cb65-776" aria-hidden="true" tabindex="-1"></a><span class="st">- Design robust error handling for network operations</span></span>
<span id="cb65-777"><a href="#cb65-777" aria-hidden="true" tabindex="-1"></a><span class="st">- Optimize data transfer with intelligent subsetting</span></span>
<span id="cb65-778"><a href="#cb65-778" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-779"><a href="#cb65-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-780"><a href="#cb65-780" aria-hidden="true" tabindex="-1"></a><span class="st">### Memory Management in Satellite Data Processing</span></span>
<span id="cb65-781"><a href="#cb65-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-782"><a href="#cb65-782" aria-hidden="true" tabindex="-1"></a><span class="st">Satellite scenes can be massive (&gt;1GB per scene), requiring intelligent loading strategies. The next block of code demonstrates how to efficiently load satellite data by implementing several optimization strategies:</span></span>
<span id="cb65-783"><a href="#cb65-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-784"><a href="#cb65-784" aria-hidden="true" tabindex="-1"></a><span class="st">- **Lazy Loading**: Data is only read from disk or over the network when explicitly requested, rather than preloading entire scenes. This conserves memory and speeds up initial operations.</span></span>
<span id="cb65-785"><a href="#cb65-785" aria-hidden="true" tabindex="-1"></a><span class="st">- **Subset Loading**: By allowing a `subset_bbox` parameter, only the region of interest is loaded into memory, reducing both data transfer and RAM usage.</span></span>
<span id="cb65-786"><a href="#cb65-786" aria-hidden="true" tabindex="-1"></a><span class="st">- **Retry Logic**: Network interruptions are handled gracefully with automatic retries, improving robustness for large or remote datasets.</span></span>
<span id="cb65-787"><a href="#cb65-787" aria-hidden="true" tabindex="-1"></a><span class="st">- **Progressive Loading**: The function is designed to handle multi-band and multi-resolution data, enabling users to load only the bands they need.</span></span>
<span id="cb65-788"><a href="#cb65-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-789"><a href="#cb65-789" aria-hidden="true" tabindex="-1"></a><span class="st">Together, these techniques ensure that satellite data processing is both memory- and network-efficient, making it practical to work with large geospatial datasets on typical hardware.</span></span>
<span id="cb65-790"><a href="#cb65-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-793"><a href="#cb65-793" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-794"><a href="#cb65-794" aria-hidden="true" tabindex="-1"></a><span class="st">#| tangle: geogfm/c01.py</span></span>
<span id="cb65-795"><a href="#cb65-795" aria-hidden="true" tabindex="-1"></a><span class="st">#| tangle-append: true</span></span>
<span id="cb65-796"><a href="#cb65-796" aria-hidden="true" tabindex="-1"></a><span class="st">def load_sentinel2_bands(</span></span>
<span id="cb65-797"><a href="#cb65-797" aria-hidden="true" tabindex="-1"></a><span class="st">    item,</span></span>
<span id="cb65-798"><a href="#cb65-798" aria-hidden="true" tabindex="-1"></a><span class="st">    bands: List[str] = ['</span>B04<span class="st">', '</span>B03<span class="st">', '</span>B02<span class="st">', '</span>B08<span class="st">'],</span></span>
<span id="cb65-799"><a href="#cb65-799" aria-hidden="true" tabindex="-1"></a><span class="st">    subset_bbox: Optional[List[float]] = None,</span></span>
<span id="cb65-800"><a href="#cb65-800" aria-hidden="true" tabindex="-1"></a><span class="st">    max_retries: int = 3</span></span>
<span id="cb65-801"><a href="#cb65-801" aria-hidden="true" tabindex="-1"></a><span class="st">) -&gt; Dict[str, Union[np.ndarray, str]]:</span></span>
<span id="cb65-802"><a href="#cb65-802" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-803"><a href="#cb65-803" aria-hidden="true" tabindex="-1"></a><span class="st">    Load Sentinel-2 bands with optional spatial subsetting.</span></span>
<span id="cb65-804"><a href="#cb65-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-805"><a href="#cb65-805" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb65-806"><a href="#cb65-806" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb65-807"><a href="#cb65-807" aria-hidden="true" tabindex="-1"></a><span class="st">    item : pystac.Item</span></span>
<span id="cb65-808"><a href="#cb65-808" aria-hidden="true" tabindex="-1"></a><span class="st">        STAC item representing the satellite scene</span></span>
<span id="cb65-809"><a href="#cb65-809" aria-hidden="true" tabindex="-1"></a><span class="st">    bands : List[str]</span></span>
<span id="cb65-810"><a href="#cb65-810" aria-hidden="true" tabindex="-1"></a><span class="st">        Spectral bands to load</span></span>
<span id="cb65-811"><a href="#cb65-811" aria-hidden="true" tabindex="-1"></a><span class="st">    subset_bbox : Optional[List[float]]</span></span>
<span id="cb65-812"><a href="#cb65-812" aria-hidden="true" tabindex="-1"></a><span class="st">        Spatial subset as [west, south, east, north] in WGS84</span></span>
<span id="cb65-813"><a href="#cb65-813" aria-hidden="true" tabindex="-1"></a><span class="st">    max_retries : int</span></span>
<span id="cb65-814"><a href="#cb65-814" aria-hidden="true" tabindex="-1"></a><span class="st">        Number of retry attempts per band</span></span>
<span id="cb65-815"><a href="#cb65-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-816"><a href="#cb65-816" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb65-817"><a href="#cb65-817" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb65-818"><a href="#cb65-818" aria-hidden="true" tabindex="-1"></a><span class="st">    Dict[str, Union[np.ndarray, str]]</span></span>
<span id="cb65-819"><a href="#cb65-819" aria-hidden="true" tabindex="-1"></a><span class="st">        Band arrays plus georeferencing metadata</span></span>
<span id="cb65-820"><a href="#cb65-820" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-821"><a href="#cb65-821" aria-hidden="true" tabindex="-1"></a><span class="st">    from rasterio.windows import from_bounds</span></span>
<span id="cb65-822"><a href="#cb65-822" aria-hidden="true" tabindex="-1"></a><span class="st">    from rasterio.warp import transform_bounds</span></span>
<span id="cb65-823"><a href="#cb65-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-824"><a href="#cb65-824" aria-hidden="true" tabindex="-1"></a><span class="st">    band_data = {}</span></span>
<span id="cb65-825"><a href="#cb65-825" aria-hidden="true" tabindex="-1"></a><span class="st">    successful_bands = []</span></span>
<span id="cb65-826"><a href="#cb65-826" aria-hidden="true" tabindex="-1"></a><span class="st">    failed_bands = []</span></span>
<span id="cb65-827"><a href="#cb65-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-828"><a href="#cb65-828" aria-hidden="true" tabindex="-1"></a><span class="st">    for band_name in bands:</span></span>
<span id="cb65-829"><a href="#cb65-829" aria-hidden="true" tabindex="-1"></a><span class="st">        if band_name not in item.assets:</span></span>
<span id="cb65-830"><a href="#cb65-830" aria-hidden="true" tabindex="-1"></a><span class="st">            failed_bands.append(band_name)</span></span>
<span id="cb65-831"><a href="#cb65-831" aria-hidden="true" tabindex="-1"></a><span class="st">            continue</span></span>
<span id="cb65-832"><a href="#cb65-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-833"><a href="#cb65-833" aria-hidden="true" tabindex="-1"></a><span class="st">        asset_url = item.assets[band_name].href</span></span>
<span id="cb65-834"><a href="#cb65-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-835"><a href="#cb65-835" aria-hidden="true" tabindex="-1"></a><span class="st">        # Retry logic with exponential backoff</span></span>
<span id="cb65-836"><a href="#cb65-836" aria-hidden="true" tabindex="-1"></a><span class="st">        for attempt in range(max_retries):</span></span>
<span id="cb65-837"><a href="#cb65-837" aria-hidden="true" tabindex="-1"></a><span class="st">            try:</span></span>
<span id="cb65-838"><a href="#cb65-838" aria-hidden="true" tabindex="-1"></a><span class="st">                # URL signing for authenticated access</span></span>
<span id="cb65-839"><a href="#cb65-839" aria-hidden="true" tabindex="-1"></a><span class="st">                signed_url = pc.sign(asset_url)</span></span>
<span id="cb65-840"><a href="#cb65-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-841"><a href="#cb65-841" aria-hidden="true" tabindex="-1"></a><span class="st">                # Memory-efficient loading with rasterio</span></span>
<span id="cb65-842"><a href="#cb65-842" aria-hidden="true" tabindex="-1"></a><span class="st">                with rasterio.open(signed_url) as src:</span></span>
<span id="cb65-843"><a href="#cb65-843" aria-hidden="true" tabindex="-1"></a><span class="st">                    # Validate data source</span></span>
<span id="cb65-844"><a href="#cb65-844" aria-hidden="true" tabindex="-1"></a><span class="st">                    if src.width == 0 or src.height == 0:</span></span>
<span id="cb65-845"><a href="#cb65-845" aria-hidden="true" tabindex="-1"></a><span class="st">                        raise ValueError(f"Invalid raster dimensions: {src.width}x{src.height}")</span></span>
<span id="cb65-846"><a href="#cb65-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-847"><a href="#cb65-847" aria-hidden="true" tabindex="-1"></a><span class="st">                    if subset_bbox:</span></span>
<span id="cb65-848"><a href="#cb65-848" aria-hidden="true" tabindex="-1"></a><span class="st">                        # Intelligent subsetting with CRS transformation</span></span>
<span id="cb65-849"><a href="#cb65-849" aria-hidden="true" tabindex="-1"></a><span class="st">                        try:</span></span>
<span id="cb65-850"><a href="#cb65-850" aria-hidden="true" tabindex="-1"></a><span class="st">                            # Transform bbox to source CRS if needed</span></span>
<span id="cb65-851"><a href="#cb65-851" aria-hidden="true" tabindex="-1"></a><span class="st">                            if src.crs != rasterio.crs.CRS.from_epsg(4326):</span></span>
<span id="cb65-852"><a href="#cb65-852" aria-hidden="true" tabindex="-1"></a><span class="st">                                subset_bbox_src_crs = transform_bounds(</span></span>
<span id="cb65-853"><a href="#cb65-853" aria-hidden="true" tabindex="-1"></a><span class="st">                                    rasterio.crs.CRS.from_epsg(4326), src.crs, *subset_bbox</span></span>
<span id="cb65-854"><a href="#cb65-854" aria-hidden="true" tabindex="-1"></a><span class="st">                                )</span></span>
<span id="cb65-855"><a href="#cb65-855" aria-hidden="true" tabindex="-1"></a><span class="st">                            else:</span></span>
<span id="cb65-856"><a href="#cb65-856" aria-hidden="true" tabindex="-1"></a><span class="st">                                subset_bbox_src_crs = subset_bbox</span></span>
<span id="cb65-857"><a href="#cb65-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-858"><a href="#cb65-858" aria-hidden="true" tabindex="-1"></a><span class="st">                            # Calculate reading window</span></span>
<span id="cb65-859"><a href="#cb65-859" aria-hidden="true" tabindex="-1"></a><span class="st">                            window = from_bounds(*subset_bbox_src_crs, src.transform)</span></span>
<span id="cb65-860"><a href="#cb65-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-861"><a href="#cb65-861" aria-hidden="true" tabindex="-1"></a><span class="st">                            # Ensure window is within raster bounds</span></span>
<span id="cb65-862"><a href="#cb65-862" aria-hidden="true" tabindex="-1"></a><span class="st">                            window = window.intersection(</span></span>
<span id="cb65-863"><a href="#cb65-863" aria-hidden="true" tabindex="-1"></a><span class="st">                                rasterio.windows.Window(0, 0, src.width, src.height)</span></span>
<span id="cb65-864"><a href="#cb65-864" aria-hidden="true" tabindex="-1"></a><span class="st">                            )</span></span>
<span id="cb65-865"><a href="#cb65-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-866"><a href="#cb65-866" aria-hidden="true" tabindex="-1"></a><span class="st">                            if window.width &gt; 0 and window.height &gt; 0:</span></span>
<span id="cb65-867"><a href="#cb65-867" aria-hidden="true" tabindex="-1"></a><span class="st">                                data = src.read(1, window=window)</span></span>
<span id="cb65-868"><a href="#cb65-868" aria-hidden="true" tabindex="-1"></a><span class="st">                                transform = src.window_transform(window)</span></span>
<span id="cb65-869"><a href="#cb65-869" aria-hidden="true" tabindex="-1"></a><span class="st">                                bounds = rasterio.windows.bounds(window, src.transform)</span></span>
<span id="cb65-870"><a href="#cb65-870" aria-hidden="true" tabindex="-1"></a><span class="st">                                if src.crs != rasterio.crs.CRS.from_epsg(4326):</span></span>
<span id="cb65-871"><a href="#cb65-871" aria-hidden="true" tabindex="-1"></a><span class="st">                                    bounds = transform_bounds(src.crs, rasterio.crs.CRS.from_epsg(4326), *bounds)</span></span>
<span id="cb65-872"><a href="#cb65-872" aria-hidden="true" tabindex="-1"></a><span class="st">                            else:</span></span>
<span id="cb65-873"><a href="#cb65-873" aria-hidden="true" tabindex="-1"></a><span class="st">                                # Fall back to full scene</span></span>
<span id="cb65-874"><a href="#cb65-874" aria-hidden="true" tabindex="-1"></a><span class="st">                                data = src.read(1)</span></span>
<span id="cb65-875"><a href="#cb65-875" aria-hidden="true" tabindex="-1"></a><span class="st">                                transform = src.transform</span></span>
<span id="cb65-876"><a href="#cb65-876" aria-hidden="true" tabindex="-1"></a><span class="st">                                bounds = src.bounds</span></span>
<span id="cb65-877"><a href="#cb65-877" aria-hidden="true" tabindex="-1"></a><span class="st">                        except Exception:</span></span>
<span id="cb65-878"><a href="#cb65-878" aria-hidden="true" tabindex="-1"></a><span class="st">                            # Fall back to full scene on subset error</span></span>
<span id="cb65-879"><a href="#cb65-879" aria-hidden="true" tabindex="-1"></a><span class="st">                            data = src.read(1)</span></span>
<span id="cb65-880"><a href="#cb65-880" aria-hidden="true" tabindex="-1"></a><span class="st">                            transform = src.transform</span></span>
<span id="cb65-881"><a href="#cb65-881" aria-hidden="true" tabindex="-1"></a><span class="st">                            bounds = src.bounds</span></span>
<span id="cb65-882"><a href="#cb65-882" aria-hidden="true" tabindex="-1"></a><span class="st">                    else:</span></span>
<span id="cb65-883"><a href="#cb65-883" aria-hidden="true" tabindex="-1"></a><span class="st">                        # Load full scene</span></span>
<span id="cb65-884"><a href="#cb65-884" aria-hidden="true" tabindex="-1"></a><span class="st">                        data = src.read(1)</span></span>
<span id="cb65-885"><a href="#cb65-885" aria-hidden="true" tabindex="-1"></a><span class="st">                        transform = src.transform</span></span>
<span id="cb65-886"><a href="#cb65-886" aria-hidden="true" tabindex="-1"></a><span class="st">                        bounds = src.bounds</span></span>
<span id="cb65-887"><a href="#cb65-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-888"><a href="#cb65-888" aria-hidden="true" tabindex="-1"></a><span class="st">                    if data.size == 0:</span></span>
<span id="cb65-889"><a href="#cb65-889" aria-hidden="true" tabindex="-1"></a><span class="st">                        raise ValueError("Loaded data has zero size")</span></span>
<span id="cb65-890"><a href="#cb65-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-891"><a href="#cb65-891" aria-hidden="true" tabindex="-1"></a><span class="st">                    # Store band data and metadata</span></span>
<span id="cb65-892"><a href="#cb65-892" aria-hidden="true" tabindex="-1"></a><span class="st">                    band_data[band_name] = data</span></span>
<span id="cb65-893"><a href="#cb65-893" aria-hidden="true" tabindex="-1"></a><span class="st">                    if '</span>transform<span class="st">' not in band_data:</span></span>
<span id="cb65-894"><a href="#cb65-894" aria-hidden="true" tabindex="-1"></a><span class="st">                        band_data.update({</span></span>
<span id="cb65-895"><a href="#cb65-895" aria-hidden="true" tabindex="-1"></a><span class="st">                            '</span>transform<span class="st">': transform,</span></span>
<span id="cb65-896"><a href="#cb65-896" aria-hidden="true" tabindex="-1"></a><span class="st">                            '</span>crs<span class="st">': src.crs,</span></span>
<span id="cb65-897"><a href="#cb65-897" aria-hidden="true" tabindex="-1"></a><span class="st">                            '</span>bounds<span class="st">': bounds,</span></span>
<span id="cb65-898"><a href="#cb65-898" aria-hidden="true" tabindex="-1"></a><span class="st">                            '</span>scene_id<span class="st">': item.id,</span></span>
<span id="cb65-899"><a href="#cb65-899" aria-hidden="true" tabindex="-1"></a><span class="st">                            '</span>date<span class="st">': item.properties['</span>datetime<span class="st">'].split('</span>T<span class="st">')[0]</span></span>
<span id="cb65-900"><a href="#cb65-900" aria-hidden="true" tabindex="-1"></a><span class="st">                        })</span></span>
<span id="cb65-901"><a href="#cb65-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-902"><a href="#cb65-902" aria-hidden="true" tabindex="-1"></a><span class="st">                    successful_bands.append(band_name)</span></span>
<span id="cb65-903"><a href="#cb65-903" aria-hidden="true" tabindex="-1"></a><span class="st">                    break</span></span>
<span id="cb65-904"><a href="#cb65-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-905"><a href="#cb65-905" aria-hidden="true" tabindex="-1"></a><span class="st">            except Exception as e:</span></span>
<span id="cb65-906"><a href="#cb65-906" aria-hidden="true" tabindex="-1"></a><span class="st">                if attempt &lt; max_retries - 1:</span></span>
<span id="cb65-907"><a href="#cb65-907" aria-hidden="true" tabindex="-1"></a><span class="st">                    time.sleep(2 ** attempt)  # Exponential backoff</span></span>
<span id="cb65-908"><a href="#cb65-908" aria-hidden="true" tabindex="-1"></a><span class="st">                    continue</span></span>
<span id="cb65-909"><a href="#cb65-909" aria-hidden="true" tabindex="-1"></a><span class="st">                else:</span></span>
<span id="cb65-910"><a href="#cb65-910" aria-hidden="true" tabindex="-1"></a><span class="st">                    failed_bands.append(band_name)</span></span>
<span id="cb65-911"><a href="#cb65-911" aria-hidden="true" tabindex="-1"></a><span class="st">                    logger.warning(f"Failed to load band {band_name}: {str(e)[:50]}")</span></span>
<span id="cb65-912"><a href="#cb65-912" aria-hidden="true" tabindex="-1"></a><span class="st">                    break</span></span>
<span id="cb65-913"><a href="#cb65-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-914"><a href="#cb65-914" aria-hidden="true" tabindex="-1"></a><span class="st">    # Validate results</span></span>
<span id="cb65-915"><a href="#cb65-915" aria-hidden="true" tabindex="-1"></a><span class="st">    if len(successful_bands) == 0:</span></span>
<span id="cb65-916"><a href="#cb65-916" aria-hidden="true" tabindex="-1"></a><span class="st">        raise Exception(f"Failed to load any bands from scene {item.id}")</span></span>
<span id="cb65-917"><a href="#cb65-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-918"><a href="#cb65-918" aria-hidden="true" tabindex="-1"></a><span class="st">    if failed_bands:</span></span>
<span id="cb65-919"><a href="#cb65-919" aria-hidden="true" tabindex="-1"></a><span class="st">        logger.warning(f"Failed to load {len(failed_bands)} bands: {failed_bands}")</span></span>
<span id="cb65-920"><a href="#cb65-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-921"><a href="#cb65-921" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"Successfully loaded {len(successful_bands)} bands: {successful_bands}")</span></span>
<span id="cb65-922"><a href="#cb65-922" aria-hidden="true" tabindex="-1"></a><span class="st">    return band_data</span></span>
<span id="cb65-923"><a href="#cb65-923" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-924"><a href="#cb65-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-925"><a href="#cb65-925" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-note}</span></span>
<span id="cb65-926"><a href="#cb65-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-927"><a href="#cb65-927" aria-hidden="true" tabindex="-1"></a><span class="st">##### Memory Management Best Practices</span></span>
<span id="cb65-928"><a href="#cb65-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-929"><a href="#cb65-929" aria-hidden="true" tabindex="-1"></a><span class="st">- **Use windowed reading** for large rasters to control memory usage</span></span>
<span id="cb65-930"><a href="#cb65-930" aria-hidden="true" tabindex="-1"></a><span class="st">- **Load bands on-demand** rather than all at once</span></span>
<span id="cb65-931"><a href="#cb65-931" aria-hidden="true" tabindex="-1"></a><span class="st">- **Implement progress monitoring** for user feedback during long operations</span></span>
<span id="cb65-932"><a href="#cb65-932" aria-hidden="true" tabindex="-1"></a><span class="st">- **Handle CRS transformations** automatically to ensure spatial consistency</span></span>
<span id="cb65-933"><a href="#cb65-933" aria-hidden="true" tabindex="-1"></a><span class="st">- **Cache georeferencing metadata** to avoid redundant I/O operations</span></span>
<span id="cb65-934"><a href="#cb65-934" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-935"><a href="#cb65-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-936"><a href="#cb65-936" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb65-937"><a href="#cb65-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-938"><a href="#cb65-938" aria-hidden="true" tabindex="-1"></a><span class="st">#### 2.4.4 Scene Processing and Subsetting 📐</span></span>
<span id="cb65-939"><a href="#cb65-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-940"><a href="#cb65-940" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-tip}</span></span>
<span id="cb65-941"><a href="#cb65-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-942"><a href="#cb65-942" aria-hidden="true" tabindex="-1"></a><span class="st">##### Learning Objectives</span></span>
<span id="cb65-943"><a href="#cb65-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-944"><a href="#cb65-944" aria-hidden="true" tabindex="-1"></a><span class="st">- Master percentage-based spatial subsetting for reproducible analysis</span></span>
<span id="cb65-945"><a href="#cb65-945" aria-hidden="true" tabindex="-1"></a><span class="st">- Understand scene geometry and coordinate system implications</span></span>
<span id="cb65-946"><a href="#cb65-946" aria-hidden="true" tabindex="-1"></a><span class="st">- Design scalable spatial partitioning strategies</span></span>
<span id="cb65-947"><a href="#cb65-947" aria-hidden="true" tabindex="-1"></a><span class="st">- Implement adaptive processing based on scene characteristics</span></span>
<span id="cb65-948"><a href="#cb65-948" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-949"><a href="#cb65-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-950"><a href="#cb65-950" aria-hidden="true" tabindex="-1"></a><span class="st">### Spatial Reasoning in Satellite Data Analysis</span></span>
<span id="cb65-951"><a href="#cb65-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-952"><a href="#cb65-952" aria-hidden="true" tabindex="-1"></a><span class="st">Satellite scenes come in various sizes and projections, requiring intelligent spatial handling:</span></span>
<span id="cb65-953"><a href="#cb65-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-954"><a href="#cb65-954" aria-hidden="true" tabindex="-1"></a><span class="st">- **Percentage-Based Subsetting**: Resolution-independent spatial cropping</span></span>
<span id="cb65-955"><a href="#cb65-955" aria-hidden="true" tabindex="-1"></a><span class="st">- **Adaptive Processing**: Adjust strategies based on scene characteristics</span></span>
<span id="cb65-956"><a href="#cb65-956" aria-hidden="true" tabindex="-1"></a><span class="st">- **Spatial Metadata**: Consistent georeferencing across operations</span></span>
<span id="cb65-957"><a href="#cb65-957" aria-hidden="true" tabindex="-1"></a><span class="st">- **Tiling Strategies**: Partition large scenes for parallel processing</span></span>
<span id="cb65-958"><a href="#cb65-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-959"><a href="#cb65-959" aria-hidden="true" tabindex="-1"></a><span class="st">::: {.callout-note}</span></span>
<span id="cb65-960"><a href="#cb65-960" aria-hidden="true" tabindex="-1"></a><span class="st">### What does the next block of code do, and why is it useful for GeoAI workflows?</span></span>
<span id="cb65-961"><a href="#cb65-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-962"><a href="#cb65-962" aria-hidden="true" tabindex="-1"></a><span class="st">The next block of code defines a function for **percentage-based spatial subsetting** of satellite scenes. Instead of specifying exact coordinates or pixel indices, you provide percentage ranges (e.g., 25% to 75%) for both the x (longitude) and y (latitude) axes. The function then calculates the corresponding bounding box in geographic coordinates.</span></span>
<span id="cb65-963"><a href="#cb65-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-964"><a href="#cb65-964" aria-hidden="true" tabindex="-1"></a><span class="st">**How does this help in GeoAI workflows?**</span></span>
<span id="cb65-965"><a href="#cb65-965" aria-hidden="true" tabindex="-1"></a><span class="st">- **Resolution Independence:** The same percentage-based subset works for any scene, regardless of its pixel size or spatial resolution.</span></span>
<span id="cb65-966"><a href="#cb65-966" aria-hidden="true" tabindex="-1"></a><span class="st">- **Reproducibility:** Analyses can be repeated on different scenes or at different times, always extracting the same relative region.</span></span>
<span id="cb65-967"><a href="#cb65-967" aria-hidden="true" tabindex="-1"></a><span class="st">- **Scalability:** Enables systematic tiling or grid-based sampling for large-scale or distributed processing.</span></span>
<span id="cb65-968"><a href="#cb65-968" aria-hidden="true" tabindex="-1"></a><span class="st">- **Adaptability:** Easily adjust the subset size or location based on scene characteristics or model requirements.</span></span>
<span id="cb65-969"><a href="#cb65-969" aria-hidden="true" tabindex="-1"></a><span class="st">- **Abstraction:** Hides the complexity of coordinate systems and scene geometry, making spatial operations more accessible and less error-prone.</span></span>
<span id="cb65-970"><a href="#cb65-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-971"><a href="#cb65-971" aria-hidden="true" tabindex="-1"></a><span class="st">This approach is especially valuable in GeoAI, where consistent, automated, and scalable spatial sampling is critical for training, validating, and deploying machine learning models on geospatial data.</span></span>
<span id="cb65-972"><a href="#cb65-972" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-973"><a href="#cb65-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-974"><a href="#cb65-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-977"><a href="#cb65-977" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-978"><a href="#cb65-978" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-979"><a href="#cb65-979" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle-append: true</span></span>
<span id="cb65-980"><a href="#cb65-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-981"><a href="#cb65-981" aria-hidden="true" tabindex="-1"></a><span class="st">def get_subset_from_scene(</span></span>
<span id="cb65-982"><a href="#cb65-982" aria-hidden="true" tabindex="-1"></a><span class="st">    item,</span></span>
<span id="cb65-983"><a href="#cb65-983" aria-hidden="true" tabindex="-1"></a><span class="st">    x_range: Tuple[float, float] = (25, 75),</span></span>
<span id="cb65-984"><a href="#cb65-984" aria-hidden="true" tabindex="-1"></a><span class="st">    y_range: Tuple[float, float] = (25, 75),</span></span>
<span id="cb65-985"><a href="#cb65-985" aria-hidden="true" tabindex="-1"></a><span class="st">) -&gt; List[float]:</span></span>
<span id="cb65-986"><a href="#cb65-986" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-987"><a href="#cb65-987" aria-hidden="true" tabindex="-1"></a><span class="st">    Intelligent spatial subsetting using percentage-based coordinates.</span></span>
<span id="cb65-988"><a href="#cb65-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-989"><a href="#cb65-989" aria-hidden="true" tabindex="-1"></a><span class="st">    This approach provides several advantages:</span></span>
<span id="cb65-990"><a href="#cb65-990" aria-hidden="true" tabindex="-1"></a><span class="st">    1. Resolution Independence: Works regardless of scene size or pixel resolution</span></span>
<span id="cb65-991"><a href="#cb65-991" aria-hidden="true" tabindex="-1"></a><span class="st">    2. Reproducibility: Same percentage always gives same relative location</span></span>
<span id="cb65-992"><a href="#cb65-992" aria-hidden="true" tabindex="-1"></a><span class="st">    3. Scalability: Easy to create systematic grids for batch processing</span></span>
<span id="cb65-993"><a href="#cb65-993" aria-hidden="true" tabindex="-1"></a><span class="st">    4. Adaptability: Can adjust subset size based on scene characteristics</span></span>
<span id="cb65-994"><a href="#cb65-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-995"><a href="#cb65-995" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb65-996"><a href="#cb65-996" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb65-997"><a href="#cb65-997" aria-hidden="true" tabindex="-1"></a><span class="st">    item : pystac.Item</span></span>
<span id="cb65-998"><a href="#cb65-998" aria-hidden="true" tabindex="-1"></a><span class="st">        STAC item containing scene geometry</span></span>
<span id="cb65-999"><a href="#cb65-999" aria-hidden="true" tabindex="-1"></a><span class="st">    x_range : Tuple[float, float]</span></span>
<span id="cb65-1000"><a href="#cb65-1000" aria-hidden="true" tabindex="-1"></a><span class="st">        Longitude percentage range (0-100)</span></span>
<span id="cb65-1001"><a href="#cb65-1001" aria-hidden="true" tabindex="-1"></a><span class="st">    y_range : Tuple[float, float]</span></span>
<span id="cb65-1002"><a href="#cb65-1002" aria-hidden="true" tabindex="-1"></a><span class="st">        Latitude percentage range (0-100)</span></span>
<span id="cb65-1003"><a href="#cb65-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1004"><a href="#cb65-1004" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb65-1005"><a href="#cb65-1005" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb65-1006"><a href="#cb65-1006" aria-hidden="true" tabindex="-1"></a><span class="st">    List[float]</span></span>
<span id="cb65-1007"><a href="#cb65-1007" aria-hidden="true" tabindex="-1"></a><span class="st">        Subset bounding box [west, south, east, north] in WGS84</span></span>
<span id="cb65-1008"><a href="#cb65-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1009"><a href="#cb65-1009" aria-hidden="true" tabindex="-1"></a><span class="st">    Design Pattern: Template Method with Spatial Reasoning</span></span>
<span id="cb65-1010"><a href="#cb65-1010" aria-hidden="true" tabindex="-1"></a><span class="st">    - Provides consistent interface for varied spatial operations</span></span>
<span id="cb65-1011"><a href="#cb65-1011" aria-hidden="true" tabindex="-1"></a><span class="st">    - Encapsulates coordinate system complexity</span></span>
<span id="cb65-1012"><a href="#cb65-1012" aria-hidden="true" tabindex="-1"></a><span class="st">    - Enables systematic spatial sampling strategies</span></span>
<span id="cb65-1013"><a href="#cb65-1013" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1014"><a href="#cb65-1014" aria-hidden="true" tabindex="-1"></a><span class="st">    # Extract scene geometry from STAC metadata</span></span>
<span id="cb65-1015"><a href="#cb65-1015" aria-hidden="true" tabindex="-1"></a><span class="st">    scene_bbox = item.bbox  # [west, south, east, north]</span></span>
<span id="cb65-1016"><a href="#cb65-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1017"><a href="#cb65-1017" aria-hidden="true" tabindex="-1"></a><span class="st">    # Input validation for percentage ranges</span></span>
<span id="cb65-1018"><a href="#cb65-1018" aria-hidden="true" tabindex="-1"></a><span class="st">    if not (0 &lt;= x_range[0] &lt; x_range[1] &lt;= 100):</span></span>
<span id="cb65-1019"><a href="#cb65-1019" aria-hidden="true" tabindex="-1"></a><span class="st">        raise ValueError(</span></span>
<span id="cb65-1020"><a href="#cb65-1020" aria-hidden="true" tabindex="-1"></a><span class="st">            f"Invalid x_range: {x_range}. Must be (min, max) with 0 &lt;= min &lt; max &lt;= 100"</span></span>
<span id="cb65-1021"><a href="#cb65-1021" aria-hidden="true" tabindex="-1"></a><span class="st">        )</span></span>
<span id="cb65-1022"><a href="#cb65-1022" aria-hidden="true" tabindex="-1"></a><span class="st">    if not (0 &lt;= y_range[0] &lt; y_range[1] &lt;= 100):</span></span>
<span id="cb65-1023"><a href="#cb65-1023" aria-hidden="true" tabindex="-1"></a><span class="st">        raise ValueError(</span></span>
<span id="cb65-1024"><a href="#cb65-1024" aria-hidden="true" tabindex="-1"></a><span class="st">            f"Invalid y_range: {y_range}. Must be (min, max) with 0 &lt;= min &lt; max &lt;= 100"</span></span>
<span id="cb65-1025"><a href="#cb65-1025" aria-hidden="true" tabindex="-1"></a><span class="st">        )</span></span>
<span id="cb65-1026"><a href="#cb65-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1027"><a href="#cb65-1027" aria-hidden="true" tabindex="-1"></a><span class="st">    # Calculate scene dimensions in geographic coordinates</span></span>
<span id="cb65-1028"><a href="#cb65-1028" aria-hidden="true" tabindex="-1"></a><span class="st">    scene_width = scene_bbox[2] - scene_bbox[0]  # east - west</span></span>
<span id="cb65-1029"><a href="#cb65-1029" aria-hidden="true" tabindex="-1"></a><span class="st">    scene_height = scene_bbox[3] - scene_bbox[1]  # north - south</span></span>
<span id="cb65-1030"><a href="#cb65-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1031"><a href="#cb65-1031" aria-hidden="true" tabindex="-1"></a><span class="st">    # Convert percentages to geographic coordinates</span></span>
<span id="cb65-1032"><a href="#cb65-1032" aria-hidden="true" tabindex="-1"></a><span class="st">    west = scene_bbox[0] + (x_range[0] / 100.0) * scene_width</span></span>
<span id="cb65-1033"><a href="#cb65-1033" aria-hidden="true" tabindex="-1"></a><span class="st">    east = scene_bbox[0] + (x_range[1] / 100.0) * scene_width</span></span>
<span id="cb65-1034"><a href="#cb65-1034" aria-hidden="true" tabindex="-1"></a><span class="st">    south = scene_bbox[1] + (y_range[0] / 100.0) * scene_height</span></span>
<span id="cb65-1035"><a href="#cb65-1035" aria-hidden="true" tabindex="-1"></a><span class="st">    north = scene_bbox[1] + (y_range[1] / 100.0) * scene_height</span></span>
<span id="cb65-1036"><a href="#cb65-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1037"><a href="#cb65-1037" aria-hidden="true" tabindex="-1"></a><span class="st">    subset_bbox = [west, south, east, north]</span></span>
<span id="cb65-1038"><a href="#cb65-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1039"><a href="#cb65-1039" aria-hidden="true" tabindex="-1"></a><span class="st">    # Calculate subset metrics for reporting</span></span>
<span id="cb65-1040"><a href="#cb65-1040" aria-hidden="true" tabindex="-1"></a><span class="st">    subset_area_percent = (</span></span>
<span id="cb65-1041"><a href="#cb65-1041" aria-hidden="true" tabindex="-1"></a><span class="st">        (x_range[1] - x_range[0]) * (y_range[1] - y_range[0])</span></span>
<span id="cb65-1042"><a href="#cb65-1042" aria-hidden="true" tabindex="-1"></a><span class="st">    ) / 100.0</span></span>
<span id="cb65-1043"><a href="#cb65-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1044"><a href="#cb65-1044" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info("📐 Calculated subset from scene bounds:")</span></span>
<span id="cb65-1045"><a href="#cb65-1045" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(</span></span>
<span id="cb65-1046"><a href="#cb65-1046" aria-hidden="true" tabindex="-1"></a><span class="st">        "   Scene bbox: [%.4f, %.4f, %.4f, %.4f]",</span></span>
<span id="cb65-1047"><a href="#cb65-1047" aria-hidden="true" tabindex="-1"></a><span class="st">        scene_bbox[0], scene_bbox[1], scene_bbox[2], scene_bbox[3]</span></span>
<span id="cb65-1048"><a href="#cb65-1048" aria-hidden="true" tabindex="-1"></a><span class="st">    )</span></span>
<span id="cb65-1049"><a href="#cb65-1049" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(</span></span>
<span id="cb65-1050"><a href="#cb65-1050" aria-hidden="true" tabindex="-1"></a><span class="st">        "   Subset bbox: [%.4f, %.4f, %.4f, %.4f]",</span></span>
<span id="cb65-1051"><a href="#cb65-1051" aria-hidden="true" tabindex="-1"></a><span class="st">        west, south, east, north</span></span>
<span id="cb65-1052"><a href="#cb65-1052" aria-hidden="true" tabindex="-1"></a><span class="st">    )</span></span>
<span id="cb65-1053"><a href="#cb65-1053" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(</span></span>
<span id="cb65-1054"><a href="#cb65-1054" aria-hidden="true" tabindex="-1"></a><span class="st">        "   X range: %s%%-%s%%, Y range: %s%%-%s%%",</span></span>
<span id="cb65-1055"><a href="#cb65-1055" aria-hidden="true" tabindex="-1"></a><span class="st">        x_range[0], x_range[1], y_range[0], y_range[1]</span></span>
<span id="cb65-1056"><a href="#cb65-1056" aria-hidden="true" tabindex="-1"></a><span class="st">    )</span></span>
<span id="cb65-1057"><a href="#cb65-1057" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(</span></span>
<span id="cb65-1058"><a href="#cb65-1058" aria-hidden="true" tabindex="-1"></a><span class="st">        "   Subset area: %.1f%% of original scene",</span></span>
<span id="cb65-1059"><a href="#cb65-1059" aria-hidden="true" tabindex="-1"></a><span class="st">        subset_area_percent</span></span>
<span id="cb65-1060"><a href="#cb65-1060" aria-hidden="true" tabindex="-1"></a><span class="st">    )</span></span>
<span id="cb65-1061"><a href="#cb65-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1062"><a href="#cb65-1062" aria-hidden="true" tabindex="-1"></a><span class="st">    return subset_bbox</span></span>
<span id="cb65-1063"><a href="#cb65-1063" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-1064"><a href="#cb65-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1067"><a href="#cb65-1067" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-1068"><a href="#cb65-1068" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-1069"><a href="#cb65-1069" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle-append: true</span></span>
<span id="cb65-1070"><a href="#cb65-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1071"><a href="#cb65-1071" aria-hidden="true" tabindex="-1"></a><span class="st">def get_scene_info(item):</span></span>
<span id="cb65-1072"><a href="#cb65-1072" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1073"><a href="#cb65-1073" aria-hidden="true" tabindex="-1"></a><span class="st">    Extract comprehensive scene characteristics for adaptive processing.</span></span>
<span id="cb65-1074"><a href="#cb65-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1075"><a href="#cb65-1075" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb65-1076"><a href="#cb65-1076" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb65-1077"><a href="#cb65-1077" aria-hidden="true" tabindex="-1"></a><span class="st">    item : pystac.Item</span></span>
<span id="cb65-1078"><a href="#cb65-1078" aria-hidden="true" tabindex="-1"></a><span class="st">        STAC item to analyze</span></span>
<span id="cb65-1079"><a href="#cb65-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1080"><a href="#cb65-1080" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb65-1081"><a href="#cb65-1081" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb65-1082"><a href="#cb65-1082" aria-hidden="true" tabindex="-1"></a><span class="st">    Dict</span></span>
<span id="cb65-1083"><a href="#cb65-1083" aria-hidden="true" tabindex="-1"></a><span class="st">        Scene characteristics including dimensions and geographic metrics</span></span>
<span id="cb65-1084"><a href="#cb65-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1085"><a href="#cb65-1085" aria-hidden="true" tabindex="-1"></a><span class="st">    Design Pattern: Information Expert</span></span>
<span id="cb65-1086"><a href="#cb65-1086" aria-hidden="true" tabindex="-1"></a><span class="st">    - Centralizes scene analysis logic</span></span>
<span id="cb65-1087"><a href="#cb65-1087" aria-hidden="true" tabindex="-1"></a><span class="st">    - Provides basis for adaptive processing decisions</span></span>
<span id="cb65-1088"><a href="#cb65-1088" aria-hidden="true" tabindex="-1"></a><span class="st">    - Enables consistent scene characterization across workflows</span></span>
<span id="cb65-1089"><a href="#cb65-1089" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1090"><a href="#cb65-1090" aria-hidden="true" tabindex="-1"></a><span class="st">    bbox = item.bbox</span></span>
<span id="cb65-1091"><a href="#cb65-1091" aria-hidden="true" tabindex="-1"></a><span class="st">    width_deg = bbox[2] - bbox[0]</span></span>
<span id="cb65-1092"><a href="#cb65-1092" aria-hidden="true" tabindex="-1"></a><span class="st">    height_deg = bbox[3] - bbox[1]</span></span>
<span id="cb65-1093"><a href="#cb65-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1094"><a href="#cb65-1094" aria-hidden="true" tabindex="-1"></a><span class="st">    # Approximate conversion to kilometers (suitable for most latitudes)</span></span>
<span id="cb65-1095"><a href="#cb65-1095" aria-hidden="true" tabindex="-1"></a><span class="st">    center_lat = (bbox[1] + bbox[3]) / 2</span></span>
<span id="cb65-1096"><a href="#cb65-1096" aria-hidden="true" tabindex="-1"></a><span class="st">    width_km = width_deg * 111 * np.cos(np.radians(center_lat))</span></span>
<span id="cb65-1097"><a href="#cb65-1097" aria-hidden="true" tabindex="-1"></a><span class="st">    height_km = height_deg * 111</span></span>
<span id="cb65-1098"><a href="#cb65-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1099"><a href="#cb65-1099" aria-hidden="true" tabindex="-1"></a><span class="st">    info = {</span></span>
<span id="cb65-1100"><a href="#cb65-1100" aria-hidden="true" tabindex="-1"></a><span class="st">        "scene_id": item.id,</span></span>
<span id="cb65-1101"><a href="#cb65-1101" aria-hidden="true" tabindex="-1"></a><span class="st">        "date": item.properties["datetime"].split("T")[0],</span></span>
<span id="cb65-1102"><a href="#cb65-1102" aria-hidden="true" tabindex="-1"></a><span class="st">        "bbox": bbox,</span></span>
<span id="cb65-1103"><a href="#cb65-1103" aria-hidden="true" tabindex="-1"></a><span class="st">        "width_deg": width_deg,</span></span>
<span id="cb65-1104"><a href="#cb65-1104" aria-hidden="true" tabindex="-1"></a><span class="st">        "height_deg": height_deg,</span></span>
<span id="cb65-1105"><a href="#cb65-1105" aria-hidden="true" tabindex="-1"></a><span class="st">        "width_km": width_km,</span></span>
<span id="cb65-1106"><a href="#cb65-1106" aria-hidden="true" tabindex="-1"></a><span class="st">        "height_km": height_km,</span></span>
<span id="cb65-1107"><a href="#cb65-1107" aria-hidden="true" tabindex="-1"></a><span class="st">        "area_km2": width_km * height_km,</span></span>
<span id="cb65-1108"><a href="#cb65-1108" aria-hidden="true" tabindex="-1"></a><span class="st">        "center_lat": center_lat,</span></span>
<span id="cb65-1109"><a href="#cb65-1109" aria-hidden="true" tabindex="-1"></a><span class="st">        "center_lon": (bbox[0] + bbox[2]) / 2,</span></span>
<span id="cb65-1110"><a href="#cb65-1110" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb65-1111"><a href="#cb65-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1112"><a href="#cb65-1112" aria-hidden="true" tabindex="-1"></a><span class="st">    return info</span></span>
<span id="cb65-1113"><a href="#cb65-1113" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-1114"><a href="#cb65-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1115"><a href="#cb65-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1116"><a href="#cb65-1116" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-note}</span></span>
<span id="cb65-1117"><a href="#cb65-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1118"><a href="#cb65-1118" aria-hidden="true" tabindex="-1"></a><span class="st">##### Spatial Processing Design Patterns</span></span>
<span id="cb65-1119"><a href="#cb65-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1120"><a href="#cb65-1120" aria-hidden="true" tabindex="-1"></a><span class="st">- **Percentage-based coordinates** provide resolution independence</span></span>
<span id="cb65-1121"><a href="#cb65-1121" aria-hidden="true" tabindex="-1"></a><span class="st">- **Adaptive processing** adjusts strategies based on scene size</span></span>
<span id="cb65-1122"><a href="#cb65-1122" aria-hidden="true" tabindex="-1"></a><span class="st">- **Systematic spatial sampling** enables reproducible analysis</span></span>
<span id="cb65-1123"><a href="#cb65-1123" aria-hidden="true" tabindex="-1"></a><span class="st">- **Geographic metrics** support intelligent subset sizing decisions</span></span>
<span id="cb65-1124"><a href="#cb65-1124" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-1125"><a href="#cb65-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1126"><a href="#cb65-1126" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb65-1127"><a href="#cb65-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1128"><a href="#cb65-1128" aria-hidden="true" tabindex="-1"></a><span class="st">#### 2.4.5 Data Processing Pipelines 🔬</span></span>
<span id="cb65-1129"><a href="#cb65-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1130"><a href="#cb65-1130" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-tip}</span></span>
<span id="cb65-1131"><a href="#cb65-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1132"><a href="#cb65-1132" aria-hidden="true" tabindex="-1"></a><span class="st">##### Learning Objectives</span></span>
<span id="cb65-1133"><a href="#cb65-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1134"><a href="#cb65-1134" aria-hidden="true" tabindex="-1"></a><span class="st">- Master spectral analysis and vegetation index calculations</span></span>
<span id="cb65-1135"><a href="#cb65-1135" aria-hidden="true" tabindex="-1"></a><span class="st">- Implement robust statistical analysis with error handling</span></span>
<span id="cb65-1136"><a href="#cb65-1136" aria-hidden="true" tabindex="-1"></a><span class="st">- Design composable processing functions for workflow flexibility</span></span>
<span id="cb65-1137"><a href="#cb65-1137" aria-hidden="true" tabindex="-1"></a><span class="st">- Understand radiometric enhancement techniques for visualization</span></span>
<span id="cb65-1138"><a href="#cb65-1138" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-1139"><a href="#cb65-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1140"><a href="#cb65-1140" aria-hidden="true" tabindex="-1"></a><span class="st">### Spectral Analysis Fundamentals</span></span>
<span id="cb65-1141"><a href="#cb65-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1142"><a href="#cb65-1142" aria-hidden="true" tabindex="-1"></a><span class="st">Satellite sensors capture electromagnetic radiation across multiple spectral bands, enabling sophisticated analysis:</span></span>
<span id="cb65-1143"><a href="#cb65-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1144"><a href="#cb65-1144" aria-hidden="true" tabindex="-1"></a><span class="st">- **Radiometric Enhancement**: Optimize visual representation of spectral data</span></span>
<span id="cb65-1145"><a href="#cb65-1145" aria-hidden="true" tabindex="-1"></a><span class="st">- **Vegetation Indices**: Combine bands to highlight biological activity</span></span>
<span id="cb65-1146"><a href="#cb65-1146" aria-hidden="true" tabindex="-1"></a><span class="st">- **Statistical Analysis**: Characterize data distributions and quality</span></span>
<span id="cb65-1147"><a href="#cb65-1147" aria-hidden="true" tabindex="-1"></a><span class="st">- **Composable Functions**: Build complex workflows from simple operations</span></span>
<span id="cb65-1148"><a href="#cb65-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1149"><a href="#cb65-1149" aria-hidden="true" tabindex="-1"></a><span class="st">#### Band Normalization</span></span>
<span id="cb65-1150"><a href="#cb65-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1151"><a href="#cb65-1151" aria-hidden="true" tabindex="-1"></a><span class="st">The `normalize_band` function performs percentile-based normalization of a satellite image band (a 2D NumPy array of pixel values). Its main purpose is to enhance the visual contrast of the data for display or further analysis, while being robust to outliers and invalid values.</span></span>
<span id="cb65-1152"><a href="#cb65-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1153"><a href="#cb65-1153" aria-hidden="true" tabindex="-1"></a><span class="st">**How it works:**</span></span>
<span id="cb65-1154"><a href="#cb65-1154" aria-hidden="true" tabindex="-1"></a><span class="st">- **Input:** The function takes a NumPy array (`band`) representing the raw values of a spectral band, a tuple of percentiles (defaulting to the 2nd and 98th), and a `clip` flag.</span></span>
<span id="cb65-1155"><a href="#cb65-1155" aria-hidden="true" tabindex="-1"></a><span class="st">- **Robustness:** It first creates a mask to identify valid (finite) values, ignoring NaNs and infinities.</span></span>
<span id="cb65-1156"><a href="#cb65-1156" aria-hidden="true" tabindex="-1"></a><span class="st">- **Percentile Stretch:** It computes the lower and upper percentile values (`p_low`, `p_high`) from the valid data. These percentiles define the range for stretching, which helps ignore extreme outliers.</span></span>
<span id="cb65-1157"><a href="#cb65-1157" aria-hidden="true" tabindex="-1"></a><span class="st">- **Normalization:** The band is linearly scaled so that `p_low` maps to 0 and `p_high` maps to 1. Values outside this range can be optionally clipped.</span></span>
<span id="cb65-1158"><a href="#cb65-1158" aria-hidden="true" tabindex="-1"></a><span class="st">- **Edge Cases:** If all values are invalid or the percentiles are equal (no variation), it returns an array of zeros.</span></span>
<span id="cb65-1159"><a href="#cb65-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1160"><a href="#cb65-1160" aria-hidden="true" tabindex="-1"></a><span class="st">**Why use this?**</span></span>
<span id="cb65-1161"><a href="#cb65-1161" aria-hidden="true" tabindex="-1"></a><span class="st">- It improves image contrast for visualization.</span></span>
<span id="cb65-1162"><a href="#cb65-1162" aria-hidden="true" tabindex="-1"></a><span class="st">- It is robust to outliers and missing data.</span></span>
<span id="cb65-1163"><a href="#cb65-1163" aria-hidden="true" tabindex="-1"></a><span class="st">- It preserves the relative relationships between pixel values.</span></span>
<span id="cb65-1164"><a href="#cb65-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1165"><a href="#cb65-1165" aria-hidden="true" tabindex="-1"></a><span class="st">This function exemplifies the "Strategy Pattern" by encapsulating a normalization approach that can be swapped or extended for other enhancement strategies.</span></span>
<span id="cb65-1166"><a href="#cb65-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1167"><a href="#cb65-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1170"><a href="#cb65-1170" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-1171"><a href="#cb65-1171" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-1172"><a href="#cb65-1172" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle-append: true</span></span>
<span id="cb65-1173"><a href="#cb65-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1174"><a href="#cb65-1174" aria-hidden="true" tabindex="-1"></a><span class="st">def normalize_band(</span></span>
<span id="cb65-1175"><a href="#cb65-1175" aria-hidden="true" tabindex="-1"></a><span class="st">    band: np.ndarray, percentiles: Tuple[float, float] = (2, 98), clip: bool = True</span></span>
<span id="cb65-1176"><a href="#cb65-1176" aria-hidden="true" tabindex="-1"></a><span class="st">) -&gt; np.ndarray:</span></span>
<span id="cb65-1177"><a href="#cb65-1177" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1178"><a href="#cb65-1178" aria-hidden="true" tabindex="-1"></a><span class="st">    Percentile-based radiometric enhancement for optimal visualization.</span></span>
<span id="cb65-1179"><a href="#cb65-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1180"><a href="#cb65-1180" aria-hidden="true" tabindex="-1"></a><span class="st">    This normalization approach addresses several challenges:</span></span>
<span id="cb65-1181"><a href="#cb65-1181" aria-hidden="true" tabindex="-1"></a><span class="st">    1. Dynamic Range: Raw satellite data often has poor contrast</span></span>
<span id="cb65-1182"><a href="#cb65-1182" aria-hidden="true" tabindex="-1"></a><span class="st">    2. Outlier Robustness: Percentiles ignore extreme values</span></span>
<span id="cb65-1183"><a href="#cb65-1183" aria-hidden="true" tabindex="-1"></a><span class="st">    3. Visual Optimization: Results in pleasing, interpretable images</span></span>
<span id="cb65-1184"><a href="#cb65-1184" aria-hidden="true" tabindex="-1"></a><span class="st">    4. Statistical Validity: Preserves relative data relationships</span></span>
<span id="cb65-1185"><a href="#cb65-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1186"><a href="#cb65-1186" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb65-1187"><a href="#cb65-1187" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb65-1188"><a href="#cb65-1188" aria-hidden="true" tabindex="-1"></a><span class="st">    band : np.ndarray</span></span>
<span id="cb65-1189"><a href="#cb65-1189" aria-hidden="true" tabindex="-1"></a><span class="st">        Raw satellite band values</span></span>
<span id="cb65-1190"><a href="#cb65-1190" aria-hidden="true" tabindex="-1"></a><span class="st">    percentiles : Tuple[float, float]</span></span>
<span id="cb65-1191"><a href="#cb65-1191" aria-hidden="true" tabindex="-1"></a><span class="st">        Lower and upper percentiles for stretching</span></span>
<span id="cb65-1192"><a href="#cb65-1192" aria-hidden="true" tabindex="-1"></a><span class="st">    clip : bool</span></span>
<span id="cb65-1193"><a href="#cb65-1193" aria-hidden="true" tabindex="-1"></a><span class="st">        Whether to clip values to [0, 1] range</span></span>
<span id="cb65-1194"><a href="#cb65-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1195"><a href="#cb65-1195" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb65-1196"><a href="#cb65-1196" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb65-1197"><a href="#cb65-1197" aria-hidden="true" tabindex="-1"></a><span class="st">    np.ndarray</span></span>
<span id="cb65-1198"><a href="#cb65-1198" aria-hidden="true" tabindex="-1"></a><span class="st">        Normalized band values optimized for visualization</span></span>
<span id="cb65-1199"><a href="#cb65-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1200"><a href="#cb65-1200" aria-hidden="true" tabindex="-1"></a><span class="st">    Design Pattern: Strategy Pattern for Enhancement</span></span>
<span id="cb65-1201"><a href="#cb65-1201" aria-hidden="true" tabindex="-1"></a><span class="st">    - Encapsulates different enhancement algorithms</span></span>
<span id="cb65-1202"><a href="#cb65-1202" aria-hidden="true" tabindex="-1"></a><span class="st">    - Provides consistent interface for various normalization strategies</span></span>
<span id="cb65-1203"><a href="#cb65-1203" aria-hidden="true" tabindex="-1"></a><span class="st">    - Handles edge cases (NaN, infinite values) robustly</span></span>
<span id="cb65-1204"><a href="#cb65-1204" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1205"><a href="#cb65-1205" aria-hidden="true" tabindex="-1"></a><span class="st">    # Handle NaN and infinite values robustly</span></span>
<span id="cb65-1206"><a href="#cb65-1206" aria-hidden="true" tabindex="-1"></a><span class="st">    valid_mask = np.isfinite(band)</span></span>
<span id="cb65-1207"><a href="#cb65-1207" aria-hidden="true" tabindex="-1"></a><span class="st">    if not np.any(valid_mask):</span></span>
<span id="cb65-1208"><a href="#cb65-1208" aria-hidden="true" tabindex="-1"></a><span class="st">        return np.zeros_like(band)</span></span>
<span id="cb65-1209"><a href="#cb65-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1210"><a href="#cb65-1210" aria-hidden="true" tabindex="-1"></a><span class="st">    # Calculate percentiles on valid data only</span></span>
<span id="cb65-1211"><a href="#cb65-1211" aria-hidden="true" tabindex="-1"></a><span class="st">    p_low, p_high = np.percentile(band[valid_mask], percentiles)</span></span>
<span id="cb65-1212"><a href="#cb65-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1213"><a href="#cb65-1213" aria-hidden="true" tabindex="-1"></a><span class="st">    # Avoid division by zero</span></span>
<span id="cb65-1214"><a href="#cb65-1214" aria-hidden="true" tabindex="-1"></a><span class="st">    if p_high == p_low:</span></span>
<span id="cb65-1215"><a href="#cb65-1215" aria-hidden="true" tabindex="-1"></a><span class="st">        return np.zeros_like(band)</span></span>
<span id="cb65-1216"><a href="#cb65-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1217"><a href="#cb65-1217" aria-hidden="true" tabindex="-1"></a><span class="st">    # Linear stretch based on percentiles</span></span>
<span id="cb65-1218"><a href="#cb65-1218" aria-hidden="true" tabindex="-1"></a><span class="st">    normalized = (band - p_low) / (p_high - p_low)</span></span>
<span id="cb65-1219"><a href="#cb65-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1220"><a href="#cb65-1220" aria-hidden="true" tabindex="-1"></a><span class="st">    # Optional clipping to [0, 1] range</span></span>
<span id="cb65-1221"><a href="#cb65-1221" aria-hidden="true" tabindex="-1"></a><span class="st">    if clip:</span></span>
<span id="cb65-1222"><a href="#cb65-1222" aria-hidden="true" tabindex="-1"></a><span class="st">        normalized = np.clip(normalized, 0, 1)</span></span>
<span id="cb65-1223"><a href="#cb65-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1224"><a href="#cb65-1224" aria-hidden="true" tabindex="-1"></a><span class="st">    return normalized</span></span>
<span id="cb65-1225"><a href="#cb65-1225" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-1226"><a href="#cb65-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1227"><a href="#cb65-1227" aria-hidden="true" tabindex="-1"></a><span class="st">#### RGB Composite</span></span>
<span id="cb65-1228"><a href="#cb65-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1229"><a href="#cb65-1229" aria-hidden="true" tabindex="-1"></a><span class="st">The next code block introduces the function `create_rgb_composite`, which is designed to generate publication-quality RGB composite images from individual spectral bands (red, green, and blue). This function optionally applies automatic contrast enhancement to each band using the previously defined `normalize_band` function, ensuring that the resulting composite is visually optimized and suitable for analysis or presentation. The function demonstrates the Composite design pattern by combining multiple bands into a unified RGB representation, applying consistent processing across all channels, and producing an output format compatible with standard visualization libraries.</span></span>
<span id="cb65-1230"><a href="#cb65-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1233"><a href="#cb65-1233" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-1234"><a href="#cb65-1234" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-1235"><a href="#cb65-1235" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle-append: true</span></span>
<span id="cb65-1236"><a href="#cb65-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1237"><a href="#cb65-1237" aria-hidden="true" tabindex="-1"></a><span class="st">def create_rgb_composite(</span></span>
<span id="cb65-1238"><a href="#cb65-1238" aria-hidden="true" tabindex="-1"></a><span class="st">    red: np.ndarray, green: np.ndarray, blue: np.ndarray, enhance: bool = True</span></span>
<span id="cb65-1239"><a href="#cb65-1239" aria-hidden="true" tabindex="-1"></a><span class="st">) -&gt; np.ndarray:</span></span>
<span id="cb65-1240"><a href="#cb65-1240" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1241"><a href="#cb65-1241" aria-hidden="true" tabindex="-1"></a><span class="st">    Create publication-quality RGB composite images.</span></span>
<span id="cb65-1242"><a href="#cb65-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1243"><a href="#cb65-1243" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb65-1244"><a href="#cb65-1244" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb65-1245"><a href="#cb65-1245" aria-hidden="true" tabindex="-1"></a><span class="st">    red, green, blue : np.ndarray</span></span>
<span id="cb65-1246"><a href="#cb65-1246" aria-hidden="true" tabindex="-1"></a><span class="st">        Individual spectral bands</span></span>
<span id="cb65-1247"><a href="#cb65-1247" aria-hidden="true" tabindex="-1"></a><span class="st">    enhance : bool</span></span>
<span id="cb65-1248"><a href="#cb65-1248" aria-hidden="true" tabindex="-1"></a><span class="st">        Apply automatic contrast enhancement</span></span>
<span id="cb65-1249"><a href="#cb65-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1250"><a href="#cb65-1250" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb65-1251"><a href="#cb65-1251" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb65-1252"><a href="#cb65-1252" aria-hidden="true" tabindex="-1"></a><span class="st">    np.ndarray</span></span>
<span id="cb65-1253"><a href="#cb65-1253" aria-hidden="true" tabindex="-1"></a><span class="st">        RGB composite with shape (height, width, 3)</span></span>
<span id="cb65-1254"><a href="#cb65-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1255"><a href="#cb65-1255" aria-hidden="true" tabindex="-1"></a><span class="st">    Design Pattern: Composite Pattern for Multi-band Operations</span></span>
<span id="cb65-1256"><a href="#cb65-1256" aria-hidden="true" tabindex="-1"></a><span class="st">    - Combines multiple bands into unified representation</span></span>
<span id="cb65-1257"><a href="#cb65-1257" aria-hidden="true" tabindex="-1"></a><span class="st">    - Applies consistent enhancement across all channels</span></span>
<span id="cb65-1258"><a href="#cb65-1258" aria-hidden="true" tabindex="-1"></a><span class="st">    - Produces standard format for visualization libraries</span></span>
<span id="cb65-1259"><a href="#cb65-1259" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1260"><a href="#cb65-1260" aria-hidden="true" tabindex="-1"></a><span class="st">    # Apply enhancement to each channel</span></span>
<span id="cb65-1261"><a href="#cb65-1261" aria-hidden="true" tabindex="-1"></a><span class="st">    if enhance:</span></span>
<span id="cb65-1262"><a href="#cb65-1262" aria-hidden="true" tabindex="-1"></a><span class="st">        red_norm = normalize_band(red)</span></span>
<span id="cb65-1263"><a href="#cb65-1263" aria-hidden="true" tabindex="-1"></a><span class="st">        green_norm = normalize_band(green)</span></span>
<span id="cb65-1264"><a href="#cb65-1264" aria-hidden="true" tabindex="-1"></a><span class="st">        blue_norm = normalize_band(blue)</span></span>
<span id="cb65-1265"><a href="#cb65-1265" aria-hidden="true" tabindex="-1"></a><span class="st">    else:</span></span>
<span id="cb65-1266"><a href="#cb65-1266" aria-hidden="true" tabindex="-1"></a><span class="st">        # Simple linear scaling</span></span>
<span id="cb65-1267"><a href="#cb65-1267" aria-hidden="true" tabindex="-1"></a><span class="st">        red_norm = red / np.max(red) if np.max(red) &gt; 0 else red</span></span>
<span id="cb65-1268"><a href="#cb65-1268" aria-hidden="true" tabindex="-1"></a><span class="st">        green_norm = green / np.max(green) if np.max(green) &gt; 0 else green</span></span>
<span id="cb65-1269"><a href="#cb65-1269" aria-hidden="true" tabindex="-1"></a><span class="st">        blue_norm = blue / np.max(blue) if np.max(blue) &gt; 0 else blue</span></span>
<span id="cb65-1270"><a href="#cb65-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1271"><a href="#cb65-1271" aria-hidden="true" tabindex="-1"></a><span class="st">    # Stack into RGB composite</span></span>
<span id="cb65-1272"><a href="#cb65-1272" aria-hidden="true" tabindex="-1"></a><span class="st">    rgb_composite = np.dstack([red_norm, green_norm, blue_norm])</span></span>
<span id="cb65-1273"><a href="#cb65-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1274"><a href="#cb65-1274" aria-hidden="true" tabindex="-1"></a><span class="st">    return rgb_composite</span></span>
<span id="cb65-1275"><a href="#cb65-1275" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-1276"><a href="#cb65-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1277"><a href="#cb65-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1278"><a href="#cb65-1278" aria-hidden="true" tabindex="-1"></a><span class="st">### Derived band calculations</span></span>
<span id="cb65-1279"><a href="#cb65-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1280"><a href="#cb65-1280" aria-hidden="true" tabindex="-1"></a><span class="st">The following code block introduces the function `calculate_ndvi`, which computes the Normalized Difference Vegetation Index (NDVI) from near-infrared (NIR) and red spectral bands. NDVI is a widely used vegetation index in remote sensing, defined as (NIR - Red) / (NIR + Red). This index leverages the fact that healthy vegetation strongly reflects NIR light while absorbing red light due to chlorophyll, making NDVI a robust indicator of plant health, biomass, and vegetation cover. The function includes robust error handling for numerical stability and edge cases, ensuring reliable results even when input values are near zero or contain invalid data.</span></span>
<span id="cb65-1281"><a href="#cb65-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1282"><a href="#cb65-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1285"><a href="#cb65-1285" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-1286"><a href="#cb65-1286" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-1287"><a href="#cb65-1287" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle-append: true</span></span>
<span id="cb65-1288"><a href="#cb65-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1289"><a href="#cb65-1289" aria-hidden="true" tabindex="-1"></a><span class="st">def calculate_ndvi(</span></span>
<span id="cb65-1290"><a href="#cb65-1290" aria-hidden="true" tabindex="-1"></a><span class="st">    nir: np.ndarray, red: np.ndarray, epsilon: float = 1e-8</span></span>
<span id="cb65-1291"><a href="#cb65-1291" aria-hidden="true" tabindex="-1"></a><span class="st">) -&gt; np.ndarray:</span></span>
<span id="cb65-1292"><a href="#cb65-1292" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1293"><a href="#cb65-1293" aria-hidden="true" tabindex="-1"></a><span class="st">    Calculate Normalized Difference Vegetation Index with robust error handling.</span></span>
<span id="cb65-1294"><a href="#cb65-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1295"><a href="#cb65-1295" aria-hidden="true" tabindex="-1"></a><span class="st">    NDVI = (NIR - Red) / (NIR + Red)</span></span>
<span id="cb65-1296"><a href="#cb65-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1297"><a href="#cb65-1297" aria-hidden="true" tabindex="-1"></a><span class="st">    NDVI is fundamental to vegetation monitoring because:</span></span>
<span id="cb65-1298"><a href="#cb65-1298" aria-hidden="true" tabindex="-1"></a><span class="st">    1. Physical Basis: Reflects chlorophyll absorption and cellular structure</span></span>
<span id="cb65-1299"><a href="#cb65-1299" aria-hidden="true" tabindex="-1"></a><span class="st">    2. Standardization: Normalized to [-1, 1] range for comparison</span></span>
<span id="cb65-1300"><a href="#cb65-1300" aria-hidden="true" tabindex="-1"></a><span class="st">    3. Temporal Stability: Enables change detection across seasons/years</span></span>
<span id="cb65-1301"><a href="#cb65-1301" aria-hidden="true" tabindex="-1"></a><span class="st">    4. Ecological Meaning: Strong correlation with biomass and health</span></span>
<span id="cb65-1302"><a href="#cb65-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1303"><a href="#cb65-1303" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb65-1304"><a href="#cb65-1304" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb65-1305"><a href="#cb65-1305" aria-hidden="true" tabindex="-1"></a><span class="st">    nir : np.ndarray</span></span>
<span id="cb65-1306"><a href="#cb65-1306" aria-hidden="true" tabindex="-1"></a><span class="st">        Near-infrared reflectance (Band 8: 842nm)</span></span>
<span id="cb65-1307"><a href="#cb65-1307" aria-hidden="true" tabindex="-1"></a><span class="st">    red : np.ndarray</span></span>
<span id="cb65-1308"><a href="#cb65-1308" aria-hidden="true" tabindex="-1"></a><span class="st">        Red reflectance (Band 4: 665nm)</span></span>
<span id="cb65-1309"><a href="#cb65-1309" aria-hidden="true" tabindex="-1"></a><span class="st">    epsilon : float</span></span>
<span id="cb65-1310"><a href="#cb65-1310" aria-hidden="true" tabindex="-1"></a><span class="st">        Numerical stability constant</span></span>
<span id="cb65-1311"><a href="#cb65-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1312"><a href="#cb65-1312" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb65-1313"><a href="#cb65-1313" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb65-1314"><a href="#cb65-1314" aria-hidden="true" tabindex="-1"></a><span class="st">    np.ndarray</span></span>
<span id="cb65-1315"><a href="#cb65-1315" aria-hidden="true" tabindex="-1"></a><span class="st">        NDVI values in range [-1, 1]</span></span>
<span id="cb65-1316"><a href="#cb65-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1317"><a href="#cb65-1317" aria-hidden="true" tabindex="-1"></a><span class="st">    Design Pattern: Domain-Specific Language for Spectral Indices</span></span>
<span id="cb65-1318"><a href="#cb65-1318" aria-hidden="true" tabindex="-1"></a><span class="st">    - Encapsulates spectral physics knowledge</span></span>
<span id="cb65-1319"><a href="#cb65-1319" aria-hidden="true" tabindex="-1"></a><span class="st">    - Provides numerical stability for edge cases</span></span>
<span id="cb65-1320"><a href="#cb65-1320" aria-hidden="true" tabindex="-1"></a><span class="st">    - Enables consistent index calculation across projects</span></span>
<span id="cb65-1321"><a href="#cb65-1321" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1322"><a href="#cb65-1322" aria-hidden="true" tabindex="-1"></a><span class="st">    # Convert to float for numerical precision</span></span>
<span id="cb65-1323"><a href="#cb65-1323" aria-hidden="true" tabindex="-1"></a><span class="st">    nir_float = nir.astype(np.float32)</span></span>
<span id="cb65-1324"><a href="#cb65-1324" aria-hidden="true" tabindex="-1"></a><span class="st">    red_float = red.astype(np.float32)</span></span>
<span id="cb65-1325"><a href="#cb65-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1326"><a href="#cb65-1326" aria-hidden="true" tabindex="-1"></a><span class="st">    # Calculate NDVI with numerical stability</span></span>
<span id="cb65-1327"><a href="#cb65-1327" aria-hidden="true" tabindex="-1"></a><span class="st">    numerator = nir_float - red_float</span></span>
<span id="cb65-1328"><a href="#cb65-1328" aria-hidden="true" tabindex="-1"></a><span class="st">    denominator = nir_float + red_float + epsilon</span></span>
<span id="cb65-1329"><a href="#cb65-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1330"><a href="#cb65-1330" aria-hidden="true" tabindex="-1"></a><span class="st">    ndvi = numerator / denominator</span></span>
<span id="cb65-1331"><a href="#cb65-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1332"><a href="#cb65-1332" aria-hidden="true" tabindex="-1"></a><span class="st">    # Handle edge cases (both bands zero, etc.)</span></span>
<span id="cb65-1333"><a href="#cb65-1333" aria-hidden="true" tabindex="-1"></a><span class="st">    ndvi = np.where(np.isfinite(ndvi), ndvi, 0)</span></span>
<span id="cb65-1334"><a href="#cb65-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1335"><a href="#cb65-1335" aria-hidden="true" tabindex="-1"></a><span class="st">    return ndvi</span></span>
<span id="cb65-1336"><a href="#cb65-1336" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-1337"><a href="#cb65-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1338"><a href="#cb65-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1339"><a href="#cb65-1339" aria-hidden="true" tabindex="-1"></a><span class="st">#### Band statistics</span></span>
<span id="cb65-1340"><a href="#cb65-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1341"><a href="#cb65-1341" aria-hidden="true" tabindex="-1"></a><span class="st">The next function, `calculate_band_statistics`, provides a comprehensive statistical summary of a satellite image band. It computes key statistics such as minimum, maximum, mean, standard deviation, median, and percentiles, as well as counts of valid and total pixels. This function is essential in GeoAI workflows for several reasons:</span></span>
<span id="cb65-1342"><a href="#cb65-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1343"><a href="#cb65-1343" aria-hidden="true" tabindex="-1"></a><span class="st">- **Data Quality Assessment:** By summarizing the distribution and quality of pixel values, it helps identify anomalies, outliers, or missing data before further analysis.</span></span>
<span id="cb65-1344"><a href="#cb65-1344" aria-hidden="true" tabindex="-1"></a><span class="st">- **Feature Engineering:** Statistical summaries can be used as features in machine learning models for land cover classification, anomaly detection, or change detection.</span></span>
<span id="cb65-1345"><a href="#cb65-1345" aria-hidden="true" tabindex="-1"></a><span class="st">- **Automated Validation:** Integrating this function into data pipelines enables automated quality control, ensuring only reliable data is used for downstream tasks.</span></span>
<span id="cb65-1346"><a href="#cb65-1346" aria-hidden="true" tabindex="-1"></a><span class="st">- **Reporting and Visualization:** The output can be used to generate reports or visualizations that communicate data characteristics to stakeholders.</span></span>
<span id="cb65-1347"><a href="#cb65-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1348"><a href="#cb65-1348" aria-hidden="true" tabindex="-1"></a><span class="st">In practice, `calculate_band_statistics` can be called on each band of a satellite image to quickly assess data readiness and inform preprocessing or modeling decisions in GeoAI projects.</span></span>
<span id="cb65-1349"><a href="#cb65-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1352"><a href="#cb65-1352" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-1353"><a href="#cb65-1353" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-1354"><a href="#cb65-1354" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle-append: true</span></span>
<span id="cb65-1355"><a href="#cb65-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1356"><a href="#cb65-1356" aria-hidden="true" tabindex="-1"></a><span class="st">def calculate_band_statistics(band: np.ndarray, name: str = "Band") -&gt; Dict:</span></span>
<span id="cb65-1357"><a href="#cb65-1357" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1358"><a href="#cb65-1358" aria-hidden="true" tabindex="-1"></a><span class="st">    Comprehensive statistical characterization of satellite bands.</span></span>
<span id="cb65-1359"><a href="#cb65-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1360"><a href="#cb65-1360" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb65-1361"><a href="#cb65-1361" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb65-1362"><a href="#cb65-1362" aria-hidden="true" tabindex="-1"></a><span class="st">    band : np.ndarray</span></span>
<span id="cb65-1363"><a href="#cb65-1363" aria-hidden="true" tabindex="-1"></a><span class="st">        Input band array</span></span>
<span id="cb65-1364"><a href="#cb65-1364" aria-hidden="true" tabindex="-1"></a><span class="st">    name : str</span></span>
<span id="cb65-1365"><a href="#cb65-1365" aria-hidden="true" tabindex="-1"></a><span class="st">        Descriptive name for reporting</span></span>
<span id="cb65-1366"><a href="#cb65-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1367"><a href="#cb65-1367" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb65-1368"><a href="#cb65-1368" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb65-1369"><a href="#cb65-1369" aria-hidden="true" tabindex="-1"></a><span class="st">    Dict</span></span>
<span id="cb65-1370"><a href="#cb65-1370" aria-hidden="true" tabindex="-1"></a><span class="st">        Complete statistical summary including percentiles and counts</span></span>
<span id="cb65-1371"><a href="#cb65-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1372"><a href="#cb65-1372" aria-hidden="true" tabindex="-1"></a><span class="st">    Design Pattern: Observer Pattern for Data Quality Assessment</span></span>
<span id="cb65-1373"><a href="#cb65-1373" aria-hidden="true" tabindex="-1"></a><span class="st">    - Provides standardized quality metrics</span></span>
<span id="cb65-1374"><a href="#cb65-1374" aria-hidden="true" tabindex="-1"></a><span class="st">    - Enables data validation and quality control</span></span>
<span id="cb65-1375"><a href="#cb65-1375" aria-hidden="true" tabindex="-1"></a><span class="st">    - Supports automated quality assessment workflows</span></span>
<span id="cb65-1376"><a href="#cb65-1376" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1377"><a href="#cb65-1377" aria-hidden="true" tabindex="-1"></a><span class="st">    valid_mask = np.isfinite(band)</span></span>
<span id="cb65-1378"><a href="#cb65-1378" aria-hidden="true" tabindex="-1"></a><span class="st">    valid_data = band[valid_mask]</span></span>
<span id="cb65-1379"><a href="#cb65-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1380"><a href="#cb65-1380" aria-hidden="true" tabindex="-1"></a><span class="st">    if len(valid_data) == 0:</span></span>
<span id="cb65-1381"><a href="#cb65-1381" aria-hidden="true" tabindex="-1"></a><span class="st">        return {</span></span>
<span id="cb65-1382"><a href="#cb65-1382" aria-hidden="true" tabindex="-1"></a><span class="st">            "name": name,</span></span>
<span id="cb65-1383"><a href="#cb65-1383" aria-hidden="true" tabindex="-1"></a><span class="st">            "min": np.nan,</span></span>
<span id="cb65-1384"><a href="#cb65-1384" aria-hidden="true" tabindex="-1"></a><span class="st">            "max": np.nan,</span></span>
<span id="cb65-1385"><a href="#cb65-1385" aria-hidden="true" tabindex="-1"></a><span class="st">            "mean": np.nan,</span></span>
<span id="cb65-1386"><a href="#cb65-1386" aria-hidden="true" tabindex="-1"></a><span class="st">            "std": np.nan,</span></span>
<span id="cb65-1387"><a href="#cb65-1387" aria-hidden="true" tabindex="-1"></a><span class="st">            "median": np.nan,</span></span>
<span id="cb65-1388"><a href="#cb65-1388" aria-hidden="true" tabindex="-1"></a><span class="st">            "valid_pixels": 0,</span></span>
<span id="cb65-1389"><a href="#cb65-1389" aria-hidden="true" tabindex="-1"></a><span class="st">            "total_pixels": band.size,</span></span>
<span id="cb65-1390"><a href="#cb65-1390" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb65-1391"><a href="#cb65-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1392"><a href="#cb65-1392" aria-hidden="true" tabindex="-1"></a><span class="st">    stats = {</span></span>
<span id="cb65-1393"><a href="#cb65-1393" aria-hidden="true" tabindex="-1"></a><span class="st">        "name": name,</span></span>
<span id="cb65-1394"><a href="#cb65-1394" aria-hidden="true" tabindex="-1"></a><span class="st">        "min": float(np.min(valid_data)),</span></span>
<span id="cb65-1395"><a href="#cb65-1395" aria-hidden="true" tabindex="-1"></a><span class="st">        "max": float(np.max(valid_data)),</span></span>
<span id="cb65-1396"><a href="#cb65-1396" aria-hidden="true" tabindex="-1"></a><span class="st">        "mean": float(np.mean(valid_data)),</span></span>
<span id="cb65-1397"><a href="#cb65-1397" aria-hidden="true" tabindex="-1"></a><span class="st">        "std": float(np.std(valid_data)),</span></span>
<span id="cb65-1398"><a href="#cb65-1398" aria-hidden="true" tabindex="-1"></a><span class="st">        "median": float(np.median(valid_data)),</span></span>
<span id="cb65-1399"><a href="#cb65-1399" aria-hidden="true" tabindex="-1"></a><span class="st">        "valid_pixels": int(np.sum(valid_mask)),</span></span>
<span id="cb65-1400"><a href="#cb65-1400" aria-hidden="true" tabindex="-1"></a><span class="st">        "total_pixels": int(band.size),</span></span>
<span id="cb65-1401"><a href="#cb65-1401" aria-hidden="true" tabindex="-1"></a><span class="st">        "percentiles": {</span></span>
<span id="cb65-1402"><a href="#cb65-1402" aria-hidden="true" tabindex="-1"></a><span class="st">            "p25": float(np.percentile(valid_data, 25)),</span></span>
<span id="cb65-1403"><a href="#cb65-1403" aria-hidden="true" tabindex="-1"></a><span class="st">            "p75": float(np.percentile(valid_data, 75)),</span></span>
<span id="cb65-1404"><a href="#cb65-1404" aria-hidden="true" tabindex="-1"></a><span class="st">            "p95": float(np.percentile(valid_data, 95)),</span></span>
<span id="cb65-1405"><a href="#cb65-1405" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-1406"><a href="#cb65-1406" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb65-1407"><a href="#cb65-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1408"><a href="#cb65-1408" aria-hidden="true" tabindex="-1"></a><span class="st">    return stats</span></span>
<span id="cb65-1409"><a href="#cb65-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1410"><a href="#cb65-1410" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-1411"><a href="#cb65-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1412"><a href="#cb65-1412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1413"><a href="#cb65-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1414"><a href="#cb65-1414" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-note}</span></span>
<span id="cb65-1415"><a href="#cb65-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1416"><a href="#cb65-1416" aria-hidden="true" tabindex="-1"></a><span class="st">##### Spectral Analysis Best Practices</span></span>
<span id="cb65-1417"><a href="#cb65-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1418"><a href="#cb65-1418" aria-hidden="true" tabindex="-1"></a><span class="st">- **Percentile normalization** provides robust enhancement against outliers</span></span>
<span id="cb65-1419"><a href="#cb65-1419" aria-hidden="true" tabindex="-1"></a><span class="st">- **Numerical stability constants** prevent division by zero in index calculations</span></span>
<span id="cb65-1420"><a href="#cb65-1420" aria-hidden="true" tabindex="-1"></a><span class="st">- **Type conversion to float32** ensures adequate precision for calculations</span></span>
<span id="cb65-1421"><a href="#cb65-1421" aria-hidden="true" tabindex="-1"></a><span class="st">- **Comprehensive statistics** enable quality assessment and validation</span></span>
<span id="cb65-1422"><a href="#cb65-1422" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-1423"><a href="#cb65-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1424"><a href="#cb65-1424" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb65-1425"><a href="#cb65-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1426"><a href="#cb65-1426" aria-hidden="true" tabindex="-1"></a><span class="st">#### 2.4.6 Visualization Functions 📊</span></span>
<span id="cb65-1427"><a href="#cb65-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1428"><a href="#cb65-1428" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-tip}</span></span>
<span id="cb65-1429"><a href="#cb65-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1430"><a href="#cb65-1430" aria-hidden="true" tabindex="-1"></a><span class="st">##### Learning Objectives</span></span>
<span id="cb65-1431"><a href="#cb65-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1432"><a href="#cb65-1432" aria-hidden="true" tabindex="-1"></a><span class="st">- Design publication-quality visualization systems</span></span>
<span id="cb65-1433"><a href="#cb65-1433" aria-hidden="true" tabindex="-1"></a><span class="st">- Implement adaptive layout algorithms for multi-panel displays</span></span>
<span id="cb65-1434"><a href="#cb65-1434" aria-hidden="true" tabindex="-1"></a><span class="st">- Master colormap selection for scientific data representation</span></span>
<span id="cb65-1435"><a href="#cb65-1435" aria-hidden="true" tabindex="-1"></a><span class="st">- Create interactive and informative visual narratives</span></span>
<span id="cb65-1436"><a href="#cb65-1436" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-1437"><a href="#cb65-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1438"><a href="#cb65-1438" aria-hidden="true" tabindex="-1"></a><span class="st">### Scientific Visualization Design Principles</span></span>
<span id="cb65-1439"><a href="#cb65-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1440"><a href="#cb65-1440" aria-hidden="true" tabindex="-1"></a><span class="st">Effective satellite data visualization requires careful consideration of:</span></span>
<span id="cb65-1441"><a href="#cb65-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1442"><a href="#cb65-1442" aria-hidden="true" tabindex="-1"></a><span class="st">- **Perceptual Uniformity**: Colormaps that accurately represent data relationships</span></span>
<span id="cb65-1443"><a href="#cb65-1443" aria-hidden="true" tabindex="-1"></a><span class="st">- **Information Density**: Maximum insight per pixel</span></span>
<span id="cb65-1444"><a href="#cb65-1444" aria-hidden="true" tabindex="-1"></a><span class="st">- **Adaptive Layout**: Accommodate variable numbers of data layers</span></span>
<span id="cb65-1445"><a href="#cb65-1445" aria-hidden="true" tabindex="-1"></a><span class="st">- **Context Preservation**: Maintain spatial and temporal reference information</span></span>
<span id="cb65-1446"><a href="#cb65-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1449"><a href="#cb65-1449" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-1450"><a href="#cb65-1450" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-1451"><a href="#cb65-1451" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle-append: true</span></span>
<span id="cb65-1452"><a href="#cb65-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1453"><a href="#cb65-1453" aria-hidden="true" tabindex="-1"></a><span class="st">def plot_band_comparison(</span></span>
<span id="cb65-1454"><a href="#cb65-1454" aria-hidden="true" tabindex="-1"></a><span class="st">    bands: Dict[str, np.ndarray],</span></span>
<span id="cb65-1455"><a href="#cb65-1455" aria-hidden="true" tabindex="-1"></a><span class="st">    rgb: Optional[np.ndarray] = None,</span></span>
<span id="cb65-1456"><a href="#cb65-1456" aria-hidden="true" tabindex="-1"></a><span class="st">    ndvi: Optional[np.ndarray] = None,</span></span>
<span id="cb65-1457"><a href="#cb65-1457" aria-hidden="true" tabindex="-1"></a><span class="st">    title: str = "Multi-band Analysis",</span></span>
<span id="cb65-1458"><a href="#cb65-1458" aria-hidden="true" tabindex="-1"></a><span class="st">) -&gt; None:</span></span>
<span id="cb65-1459"><a href="#cb65-1459" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1460"><a href="#cb65-1460" aria-hidden="true" tabindex="-1"></a><span class="st">    Create comprehensive multi-panel visualization for satellite analysis.</span></span>
<span id="cb65-1461"><a href="#cb65-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1462"><a href="#cb65-1462" aria-hidden="true" tabindex="-1"></a><span class="st">    This function demonstrates several visualization principles:</span></span>
<span id="cb65-1463"><a href="#cb65-1463" aria-hidden="true" tabindex="-1"></a><span class="st">    1. Adaptive Layout: Automatically adjusts grid based on available data</span></span>
<span id="cb65-1464"><a href="#cb65-1464" aria-hidden="true" tabindex="-1"></a><span class="st">    2. Consistent Scaling: Uniform treatment of individual bands</span></span>
<span id="cb65-1465"><a href="#cb65-1465" aria-hidden="true" tabindex="-1"></a><span class="st">    3. Specialized Colormaps: Scientific colormaps for different data types</span></span>
<span id="cb65-1466"><a href="#cb65-1466" aria-hidden="true" tabindex="-1"></a><span class="st">    4. Context Information: Titles, colorbars, and interpretive text</span></span>
<span id="cb65-1467"><a href="#cb65-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1468"><a href="#cb65-1468" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb65-1469"><a href="#cb65-1469" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb65-1470"><a href="#cb65-1470" aria-hidden="true" tabindex="-1"></a><span class="st">    bands : Dict[str, np.ndarray]</span></span>
<span id="cb65-1471"><a href="#cb65-1471" aria-hidden="true" tabindex="-1"></a><span class="st">        Individual spectral bands to visualize</span></span>
<span id="cb65-1472"><a href="#cb65-1472" aria-hidden="true" tabindex="-1"></a><span class="st">    rgb : Optional[np.ndarray]</span></span>
<span id="cb65-1473"><a href="#cb65-1473" aria-hidden="true" tabindex="-1"></a><span class="st">        True color composite for context</span></span>
<span id="cb65-1474"><a href="#cb65-1474" aria-hidden="true" tabindex="-1"></a><span class="st">    ndvi : Optional[np.ndarray]</span></span>
<span id="cb65-1475"><a href="#cb65-1475" aria-hidden="true" tabindex="-1"></a><span class="st">        Vegetation index with specialized colormap</span></span>
<span id="cb65-1476"><a href="#cb65-1476" aria-hidden="true" tabindex="-1"></a><span class="st">    title : str</span></span>
<span id="cb65-1477"><a href="#cb65-1477" aria-hidden="true" tabindex="-1"></a><span class="st">        Overall figure title</span></span>
<span id="cb65-1478"><a href="#cb65-1478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1479"><a href="#cb65-1479" aria-hidden="true" tabindex="-1"></a><span class="st">    Design Pattern: Facade Pattern for Complex Visualizations</span></span>
<span id="cb65-1480"><a href="#cb65-1480" aria-hidden="true" tabindex="-1"></a><span class="st">    - Simplifies complex matplotlib operations</span></span>
<span id="cb65-1481"><a href="#cb65-1481" aria-hidden="true" tabindex="-1"></a><span class="st">    - Provides consistent visualization interface</span></span>
<span id="cb65-1482"><a href="#cb65-1482" aria-hidden="true" tabindex="-1"></a><span class="st">    - Handles layout complexity automatically</span></span>
<span id="cb65-1483"><a href="#cb65-1483" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1484"><a href="#cb65-1484" aria-hidden="true" tabindex="-1"></a><span class="st">    # Calculate layout</span></span>
<span id="cb65-1485"><a href="#cb65-1485" aria-hidden="true" tabindex="-1"></a><span class="st">    n_panels = (</span></span>
<span id="cb65-1486"><a href="#cb65-1486" aria-hidden="true" tabindex="-1"></a><span class="st">        len(bands) + (1 if rgb is not None else 0) + (1 if ndvi is not None else 0)</span></span>
<span id="cb65-1487"><a href="#cb65-1487" aria-hidden="true" tabindex="-1"></a><span class="st">    )</span></span>
<span id="cb65-1488"><a href="#cb65-1488" aria-hidden="true" tabindex="-1"></a><span class="st">    n_cols = min(3, n_panels)</span></span>
<span id="cb65-1489"><a href="#cb65-1489" aria-hidden="true" tabindex="-1"></a><span class="st">    n_rows = (n_panels + n_cols - 1) // n_cols</span></span>
<span id="cb65-1490"><a href="#cb65-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1491"><a href="#cb65-1491" aria-hidden="true" tabindex="-1"></a><span class="st">    fig, axes = plt.subplots(n_rows, n_cols, figsize=(5 * n_cols, 4 * n_rows))</span></span>
<span id="cb65-1492"><a href="#cb65-1492" aria-hidden="true" tabindex="-1"></a><span class="st">    if n_panels == 1:</span></span>
<span id="cb65-1493"><a href="#cb65-1493" aria-hidden="true" tabindex="-1"></a><span class="st">        axes = [axes]</span></span>
<span id="cb65-1494"><a href="#cb65-1494" aria-hidden="true" tabindex="-1"></a><span class="st">    elif n_rows &gt; 1:</span></span>
<span id="cb65-1495"><a href="#cb65-1495" aria-hidden="true" tabindex="-1"></a><span class="st">        axes = axes.flatten()</span></span>
<span id="cb65-1496"><a href="#cb65-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1497"><a href="#cb65-1497" aria-hidden="true" tabindex="-1"></a><span class="st">    panel_idx = 0</span></span>
<span id="cb65-1498"><a href="#cb65-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1499"><a href="#cb65-1499" aria-hidden="true" tabindex="-1"></a><span class="st">    # RGB composite</span></span>
<span id="cb65-1500"><a href="#cb65-1500" aria-hidden="true" tabindex="-1"></a><span class="st">    if rgb is not None:</span></span>
<span id="cb65-1501"><a href="#cb65-1501" aria-hidden="true" tabindex="-1"></a><span class="st">        axes[panel_idx].imshow(rgb)</span></span>
<span id="cb65-1502"><a href="#cb65-1502" aria-hidden="true" tabindex="-1"></a><span class="st">        axes[panel_idx].set_title("RGB Composite", fontweight="bold")</span></span>
<span id="cb65-1503"><a href="#cb65-1503" aria-hidden="true" tabindex="-1"></a><span class="st">        axes[panel_idx].axis("off")</span></span>
<span id="cb65-1504"><a href="#cb65-1504" aria-hidden="true" tabindex="-1"></a><span class="st">        panel_idx += 1</span></span>
<span id="cb65-1505"><a href="#cb65-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1506"><a href="#cb65-1506" aria-hidden="true" tabindex="-1"></a><span class="st">    # Individual bands</span></span>
<span id="cb65-1507"><a href="#cb65-1507" aria-hidden="true" tabindex="-1"></a><span class="st">    for band_name, band_data in bands.items():</span></span>
<span id="cb65-1508"><a href="#cb65-1508" aria-hidden="true" tabindex="-1"></a><span class="st">        if panel_idx &lt; len(axes):</span></span>
<span id="cb65-1509"><a href="#cb65-1509" aria-hidden="true" tabindex="-1"></a><span class="st">            normalized = normalize_band(band_data)</span></span>
<span id="cb65-1510"><a href="#cb65-1510" aria-hidden="true" tabindex="-1"></a><span class="st">            axes[panel_idx].imshow(normalized, cmap="gray", vmin=0, vmax=1)</span></span>
<span id="cb65-1511"><a href="#cb65-1511" aria-hidden="true" tabindex="-1"></a><span class="st">            axes[panel_idx].set_title(f"Band: {band_name}", fontweight="bold")</span></span>
<span id="cb65-1512"><a href="#cb65-1512" aria-hidden="true" tabindex="-1"></a><span class="st">            axes[panel_idx].axis("off")</span></span>
<span id="cb65-1513"><a href="#cb65-1513" aria-hidden="true" tabindex="-1"></a><span class="st">            panel_idx += 1</span></span>
<span id="cb65-1514"><a href="#cb65-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1515"><a href="#cb65-1515" aria-hidden="true" tabindex="-1"></a><span class="st">    # NDVI with colorbar</span></span>
<span id="cb65-1516"><a href="#cb65-1516" aria-hidden="true" tabindex="-1"></a><span class="st">    if ndvi is not None and panel_idx &lt; len(axes):</span></span>
<span id="cb65-1517"><a href="#cb65-1517" aria-hidden="true" tabindex="-1"></a><span class="st">        im = axes[panel_idx].imshow(ndvi, cmap="RdYlGn", vmin=-0.5, vmax=1.0)</span></span>
<span id="cb65-1518"><a href="#cb65-1518" aria-hidden="true" tabindex="-1"></a><span class="st">        axes[panel_idx].set_title("NDVI", fontweight="bold")</span></span>
<span id="cb65-1519"><a href="#cb65-1519" aria-hidden="true" tabindex="-1"></a><span class="st">        axes[panel_idx].axis("off")</span></span>
<span id="cb65-1520"><a href="#cb65-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1521"><a href="#cb65-1521" aria-hidden="true" tabindex="-1"></a><span class="st">        cbar = plt.colorbar(im, ax=axes[panel_idx], shrink=0.6)</span></span>
<span id="cb65-1522"><a href="#cb65-1522" aria-hidden="true" tabindex="-1"></a><span class="st">        cbar.set_label("NDVI Value", rotation=270, labelpad=15)</span></span>
<span id="cb65-1523"><a href="#cb65-1523" aria-hidden="true" tabindex="-1"></a><span class="st">        panel_idx += 1</span></span>
<span id="cb65-1524"><a href="#cb65-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1525"><a href="#cb65-1525" aria-hidden="true" tabindex="-1"></a><span class="st">    # Hide unused panels</span></span>
<span id="cb65-1526"><a href="#cb65-1526" aria-hidden="true" tabindex="-1"></a><span class="st">    for idx in range(panel_idx, len(axes)):</span></span>
<span id="cb65-1527"><a href="#cb65-1527" aria-hidden="true" tabindex="-1"></a><span class="st">        axes[idx].axis("off")</span></span>
<span id="cb65-1528"><a href="#cb65-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1529"><a href="#cb65-1529" aria-hidden="true" tabindex="-1"></a><span class="st">    plt.suptitle(title, fontsize=14, fontweight="bold")</span></span>
<span id="cb65-1530"><a href="#cb65-1530" aria-hidden="true" tabindex="-1"></a><span class="st">    plt.tight_layout()</span></span>
<span id="cb65-1531"><a href="#cb65-1531" aria-hidden="true" tabindex="-1"></a><span class="st">    plt.show()</span></span>
<span id="cb65-1532"><a href="#cb65-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1533"><a href="#cb65-1533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1534"><a href="#cb65-1534" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-1535"><a href="#cb65-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1536"><a href="#cb65-1536" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-note}</span></span>
<span id="cb65-1537"><a href="#cb65-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1538"><a href="#cb65-1538" aria-hidden="true" tabindex="-1"></a><span class="st">##### Visualization Design Principles</span></span>
<span id="cb65-1539"><a href="#cb65-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1540"><a href="#cb65-1540" aria-hidden="true" tabindex="-1"></a><span class="st">- **Adaptive layouts** accommodate varying numbers of data layers</span></span>
<span id="cb65-1541"><a href="#cb65-1541" aria-hidden="true" tabindex="-1"></a><span class="st">- **Perceptually uniform colormaps** (like RdYlGn for NDVI) accurately represent data relationships</span></span>
<span id="cb65-1542"><a href="#cb65-1542" aria-hidden="true" tabindex="-1"></a><span class="st">- **Consistent normalization** enables fair comparison between bands</span></span>
<span id="cb65-1543"><a href="#cb65-1543" aria-hidden="true" tabindex="-1"></a><span class="st">- **Interpretive elements** (colorbars, labels) provide context for non-experts</span></span>
<span id="cb65-1544"><a href="#cb65-1544" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-1545"><a href="#cb65-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1546"><a href="#cb65-1546" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb65-1547"><a href="#cb65-1547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1548"><a href="#cb65-1548" aria-hidden="true" tabindex="-1"></a><span class="st">#### 2.4.7 Data Export and Interoperability 💾</span></span>
<span id="cb65-1549"><a href="#cb65-1549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1550"><a href="#cb65-1550" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-tip}</span></span>
<span id="cb65-1551"><a href="#cb65-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1552"><a href="#cb65-1552" aria-hidden="true" tabindex="-1"></a><span class="st">##### Learning Objectives</span></span>
<span id="cb65-1553"><a href="#cb65-1553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1554"><a href="#cb65-1554" aria-hidden="true" tabindex="-1"></a><span class="st">- Master geospatial data standards (GeoTIFF, CRS, metadata)</span></span>
<span id="cb65-1555"><a href="#cb65-1555" aria-hidden="true" tabindex="-1"></a><span class="st">- Implement cloud-optimized data formats for scalable access</span></span>
<span id="cb65-1556"><a href="#cb65-1556" aria-hidden="true" tabindex="-1"></a><span class="st">- Design interoperable workflows for multi-platform analysis</span></span>
<span id="cb65-1557"><a href="#cb65-1557" aria-hidden="true" tabindex="-1"></a><span class="st">- Ensure data provenance and reproducibility through metadata</span></span>
<span id="cb65-1558"><a href="#cb65-1558" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-1559"><a href="#cb65-1559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1560"><a href="#cb65-1560" aria-hidden="true" tabindex="-1"></a><span class="st">### Geospatial Data Standards and Interoperability</span></span>
<span id="cb65-1561"><a href="#cb65-1561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1562"><a href="#cb65-1562" aria-hidden="true" tabindex="-1"></a><span class="st">Modern geospatial workflows require adherence to established standards:</span></span>
<span id="cb65-1563"><a href="#cb65-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1564"><a href="#cb65-1564" aria-hidden="true" tabindex="-1"></a><span class="st">- **GeoTIFF**: Industry standard for georeferenced raster data</span></span>
<span id="cb65-1565"><a href="#cb65-1565" aria-hidden="true" tabindex="-1"></a><span class="st">- **CRS Preservation**: Maintain spatial reference throughout processing</span></span>
<span id="cb65-1566"><a href="#cb65-1566" aria-hidden="true" tabindex="-1"></a><span class="st">- **Metadata Standards**: Ensure data provenance and reproducibility</span></span>
<span id="cb65-1567"><a href="#cb65-1567" aria-hidden="true" tabindex="-1"></a><span class="st">- **Cloud Optimization**: Structure data for efficient cloud-native access</span></span>
<span id="cb65-1568"><a href="#cb65-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1571"><a href="#cb65-1571" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-1572"><a href="#cb65-1572" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-1573"><a href="#cb65-1573" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle-append: true</span></span>
<span id="cb65-1574"><a href="#cb65-1574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1575"><a href="#cb65-1575" aria-hidden="true" tabindex="-1"></a><span class="st">def save_geotiff(</span></span>
<span id="cb65-1576"><a href="#cb65-1576" aria-hidden="true" tabindex="-1"></a><span class="st">    data: np.ndarray,</span></span>
<span id="cb65-1577"><a href="#cb65-1577" aria-hidden="true" tabindex="-1"></a><span class="st">    output_path: Union[str, Path],</span></span>
<span id="cb65-1578"><a href="#cb65-1578" aria-hidden="true" tabindex="-1"></a><span class="st">    transform,</span></span>
<span id="cb65-1579"><a href="#cb65-1579" aria-hidden="true" tabindex="-1"></a><span class="st">    crs,</span></span>
<span id="cb65-1580"><a href="#cb65-1580" aria-hidden="true" tabindex="-1"></a><span class="st">    band_names: Optional[List[str]] = None,</span></span>
<span id="cb65-1581"><a href="#cb65-1581" aria-hidden="true" tabindex="-1"></a><span class="st">) -&gt; None:</span></span>
<span id="cb65-1582"><a href="#cb65-1582" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1583"><a href="#cb65-1583" aria-hidden="true" tabindex="-1"></a><span class="st">    Export georeferenced data using industry-standard GeoTIFF format.</span></span>
<span id="cb65-1584"><a href="#cb65-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1585"><a href="#cb65-1585" aria-hidden="true" tabindex="-1"></a><span class="st">    This function embodies several geospatial best practices:</span></span>
<span id="cb65-1586"><a href="#cb65-1586" aria-hidden="true" tabindex="-1"></a><span class="st">    1. Standards Compliance: Uses OGC-compliant GeoTIFF format</span></span>
<span id="cb65-1587"><a href="#cb65-1587" aria-hidden="true" tabindex="-1"></a><span class="st">    2. Metadata Preservation: Maintains CRS and transform information</span></span>
<span id="cb65-1588"><a href="#cb65-1588" aria-hidden="true" tabindex="-1"></a><span class="st">    3. Compression: Applies lossless compression for efficiency</span></span>
<span id="cb65-1589"><a href="#cb65-1589" aria-hidden="true" tabindex="-1"></a><span class="st">    4. Band Description: Documents spectral band information</span></span>
<span id="cb65-1590"><a href="#cb65-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1591"><a href="#cb65-1591" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb65-1592"><a href="#cb65-1592" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb65-1593"><a href="#cb65-1593" aria-hidden="true" tabindex="-1"></a><span class="st">    data : np.ndarray</span></span>
<span id="cb65-1594"><a href="#cb65-1594" aria-hidden="true" tabindex="-1"></a><span class="st">        Data array (2D for single band, 3D for multi-band)</span></span>
<span id="cb65-1595"><a href="#cb65-1595" aria-hidden="true" tabindex="-1"></a><span class="st">    output_path : Union[str, Path]</span></span>
<span id="cb65-1596"><a href="#cb65-1596" aria-hidden="true" tabindex="-1"></a><span class="st">        Output file path</span></span>
<span id="cb65-1597"><a href="#cb65-1597" aria-hidden="true" tabindex="-1"></a><span class="st">    transform : rasterio.transform.Affine</span></span>
<span id="cb65-1598"><a href="#cb65-1598" aria-hidden="true" tabindex="-1"></a><span class="st">        Geospatial transform matrix</span></span>
<span id="cb65-1599"><a href="#cb65-1599" aria-hidden="true" tabindex="-1"></a><span class="st">    crs : rasterio.crs.CRS</span></span>
<span id="cb65-1600"><a href="#cb65-1600" aria-hidden="true" tabindex="-1"></a><span class="st">        Coordinate reference system</span></span>
<span id="cb65-1601"><a href="#cb65-1601" aria-hidden="true" tabindex="-1"></a><span class="st">    band_names : Optional[List[str]]</span></span>
<span id="cb65-1602"><a href="#cb65-1602" aria-hidden="true" tabindex="-1"></a><span class="st">        Descriptive names for each band</span></span>
<span id="cb65-1603"><a href="#cb65-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1604"><a href="#cb65-1604" aria-hidden="true" tabindex="-1"></a><span class="st">    Design Pattern: Builder Pattern for Geospatial Data Export</span></span>
<span id="cb65-1605"><a href="#cb65-1605" aria-hidden="true" tabindex="-1"></a><span class="st">    - Constructs complex geospatial files incrementally</span></span>
<span id="cb65-1606"><a href="#cb65-1606" aria-hidden="true" tabindex="-1"></a><span class="st">    - Ensures all required metadata is preserved</span></span>
<span id="cb65-1607"><a href="#cb65-1607" aria-hidden="true" tabindex="-1"></a><span class="st">    - Provides extensible framework for additional metadata</span></span>
<span id="cb65-1608"><a href="#cb65-1608" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1609"><a href="#cb65-1609" aria-hidden="true" tabindex="-1"></a><span class="st">    output_path = Path(output_path)</span></span>
<span id="cb65-1610"><a href="#cb65-1610" aria-hidden="true" tabindex="-1"></a><span class="st">    output_path.parent.mkdir(parents=True, exist_ok=True)</span></span>
<span id="cb65-1611"><a href="#cb65-1611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1612"><a href="#cb65-1612" aria-hidden="true" tabindex="-1"></a><span class="st">    # Handle both 2D and 3D arrays</span></span>
<span id="cb65-1613"><a href="#cb65-1613" aria-hidden="true" tabindex="-1"></a><span class="st">    if data.ndim == 2:</span></span>
<span id="cb65-1614"><a href="#cb65-1614" aria-hidden="true" tabindex="-1"></a><span class="st">        count = 1</span></span>
<span id="cb65-1615"><a href="#cb65-1615" aria-hidden="true" tabindex="-1"></a><span class="st">        height, width = data.shape</span></span>
<span id="cb65-1616"><a href="#cb65-1616" aria-hidden="true" tabindex="-1"></a><span class="st">    else:</span></span>
<span id="cb65-1617"><a href="#cb65-1617" aria-hidden="true" tabindex="-1"></a><span class="st">        count, height, width = data.shape</span></span>
<span id="cb65-1618"><a href="#cb65-1618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1619"><a href="#cb65-1619" aria-hidden="true" tabindex="-1"></a><span class="st">    # Write GeoTIFF with comprehensive metadata</span></span>
<span id="cb65-1620"><a href="#cb65-1620" aria-hidden="true" tabindex="-1"></a><span class="st">    with rasterio.open(</span></span>
<span id="cb65-1621"><a href="#cb65-1621" aria-hidden="true" tabindex="-1"></a><span class="st">        output_path,</span></span>
<span id="cb65-1622"><a href="#cb65-1622" aria-hidden="true" tabindex="-1"></a><span class="st">        "w",</span></span>
<span id="cb65-1623"><a href="#cb65-1623" aria-hidden="true" tabindex="-1"></a><span class="st">        driver="GTiff",</span></span>
<span id="cb65-1624"><a href="#cb65-1624" aria-hidden="true" tabindex="-1"></a><span class="st">        height=height,</span></span>
<span id="cb65-1625"><a href="#cb65-1625" aria-hidden="true" tabindex="-1"></a><span class="st">        width=width,</span></span>
<span id="cb65-1626"><a href="#cb65-1626" aria-hidden="true" tabindex="-1"></a><span class="st">        count=count,</span></span>
<span id="cb65-1627"><a href="#cb65-1627" aria-hidden="true" tabindex="-1"></a><span class="st">        dtype=data.dtype,</span></span>
<span id="cb65-1628"><a href="#cb65-1628" aria-hidden="true" tabindex="-1"></a><span class="st">        crs=crs,</span></span>
<span id="cb65-1629"><a href="#cb65-1629" aria-hidden="true" tabindex="-1"></a><span class="st">        transform=transform,</span></span>
<span id="cb65-1630"><a href="#cb65-1630" aria-hidden="true" tabindex="-1"></a><span class="st">        compress="deflate",  # Lossless compression</span></span>
<span id="cb65-1631"><a href="#cb65-1631" aria-hidden="true" tabindex="-1"></a><span class="st">        tiled=True,  # Cloud-optimized structure</span></span>
<span id="cb65-1632"><a href="#cb65-1632" aria-hidden="true" tabindex="-1"></a><span class="st">        blockxsize=512,  # Optimize for cloud access</span></span>
<span id="cb65-1633"><a href="#cb65-1633" aria-hidden="true" tabindex="-1"></a><span class="st">        blockysize=512,</span></span>
<span id="cb65-1634"><a href="#cb65-1634" aria-hidden="true" tabindex="-1"></a><span class="st">    ) as dst:</span></span>
<span id="cb65-1635"><a href="#cb65-1635" aria-hidden="true" tabindex="-1"></a><span class="st">        if data.ndim == 2:</span></span>
<span id="cb65-1636"><a href="#cb65-1636" aria-hidden="true" tabindex="-1"></a><span class="st">            dst.write(data, 1)</span></span>
<span id="cb65-1637"><a href="#cb65-1637" aria-hidden="true" tabindex="-1"></a><span class="st">            if band_names:</span></span>
<span id="cb65-1638"><a href="#cb65-1638" aria-hidden="true" tabindex="-1"></a><span class="st">                dst.set_band_description(1, band_names[0])</span></span>
<span id="cb65-1639"><a href="#cb65-1639" aria-hidden="true" tabindex="-1"></a><span class="st">        else:</span></span>
<span id="cb65-1640"><a href="#cb65-1640" aria-hidden="true" tabindex="-1"></a><span class="st">            for i in range(count):</span></span>
<span id="cb65-1641"><a href="#cb65-1641" aria-hidden="true" tabindex="-1"></a><span class="st">                dst.write(data[i], i + 1)</span></span>
<span id="cb65-1642"><a href="#cb65-1642" aria-hidden="true" tabindex="-1"></a><span class="st">                if band_names and i &lt; len(band_names):</span></span>
<span id="cb65-1643"><a href="#cb65-1643" aria-hidden="true" tabindex="-1"></a><span class="st">                    dst.set_band_description(i + 1, band_names[i])</span></span>
<span id="cb65-1644"><a href="#cb65-1644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1645"><a href="#cb65-1645" aria-hidden="true" tabindex="-1"></a><span class="st">    logger = logging.getLogger(__name__)</span></span>
<span id="cb65-1646"><a href="#cb65-1646" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"💾 Saved GeoTIFF: {output_path}")</span></span>
<span id="cb65-1647"><a href="#cb65-1647" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"   Shape: {data.shape}")</span></span>
<span id="cb65-1648"><a href="#cb65-1648" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"   CRS: {crs}")</span></span>
<span id="cb65-1649"><a href="#cb65-1649" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"   Compression: deflate, tiled")</span></span>
<span id="cb65-1650"><a href="#cb65-1650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1651"><a href="#cb65-1651" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-1652"><a href="#cb65-1652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1653"><a href="#cb65-1653" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-note}</span></span>
<span id="cb65-1654"><a href="#cb65-1654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1655"><a href="#cb65-1655" aria-hidden="true" tabindex="-1"></a><span class="st">##### Geospatial Data Standards</span></span>
<span id="cb65-1656"><a href="#cb65-1656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1657"><a href="#cb65-1657" aria-hidden="true" tabindex="-1"></a><span class="st">- **GeoTIFF with COG optimization** ensures cloud-native accessibility</span></span>
<span id="cb65-1658"><a href="#cb65-1658" aria-hidden="true" tabindex="-1"></a><span class="st">- **CRS preservation** maintains spatial accuracy across platforms</span></span>
<span id="cb65-1659"><a href="#cb65-1659" aria-hidden="true" tabindex="-1"></a><span class="st">- **Lossless compression** reduces storage costs without data loss</span></span>
<span id="cb65-1660"><a href="#cb65-1660" aria-hidden="true" tabindex="-1"></a><span class="st">- **Band descriptions** provide metadata for analysis reproducibility</span></span>
<span id="cb65-1661"><a href="#cb65-1661" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-1662"><a href="#cb65-1662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1663"><a href="#cb65-1663" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb65-1664"><a href="#cb65-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1665"><a href="#cb65-1665" aria-hidden="true" tabindex="-1"></a><span class="st">#### 2.4.8 Advanced Workflow Patterns 🚀</span></span>
<span id="cb65-1666"><a href="#cb65-1666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1667"><a href="#cb65-1667" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-tip}</span></span>
<span id="cb65-1668"><a href="#cb65-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1669"><a href="#cb65-1669" aria-hidden="true" tabindex="-1"></a><span class="st">##### Learning Objectives</span></span>
<span id="cb65-1670"><a href="#cb65-1670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1671"><a href="#cb65-1671" aria-hidden="true" tabindex="-1"></a><span class="st">- Design scalable spatial partitioning strategies for large-scale analysis</span></span>
<span id="cb65-1672"><a href="#cb65-1672" aria-hidden="true" tabindex="-1"></a><span class="st">- Implement testing frameworks for geospatial data pipelines</span></span>
<span id="cb65-1673"><a href="#cb65-1673" aria-hidden="true" tabindex="-1"></a><span class="st">- Master parallel processing patterns for satellite data workflows</span></span>
<span id="cb65-1674"><a href="#cb65-1674" aria-hidden="true" tabindex="-1"></a><span class="st">- Create adaptive processing strategies based on scene characteristics</span></span>
<span id="cb65-1675"><a href="#cb65-1675" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-1676"><a href="#cb65-1676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1677"><a href="#cb65-1677" aria-hidden="true" tabindex="-1"></a><span class="st">### Scalable Geospatial Processing Architectures</span></span>
<span id="cb65-1678"><a href="#cb65-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1679"><a href="#cb65-1679" aria-hidden="true" tabindex="-1"></a><span class="st">Large-scale satellite analysis requires sophisticated workflow patterns:</span></span>
<span id="cb65-1680"><a href="#cb65-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1681"><a href="#cb65-1681" aria-hidden="true" tabindex="-1"></a><span class="st">- **Spatial Partitioning**: Divide scenes into manageable processing units</span></span>
<span id="cb65-1682"><a href="#cb65-1682" aria-hidden="true" tabindex="-1"></a><span class="st">- **Adaptive Strategies**: Adjust processing based on data characteristics</span></span>
<span id="cb65-1683"><a href="#cb65-1683" aria-hidden="true" tabindex="-1"></a><span class="st">- **Quality Assurance**: Automated testing of processing pipelines</span></span>
<span id="cb65-1684"><a href="#cb65-1684" aria-hidden="true" tabindex="-1"></a><span class="st">- **Parallel Execution**: Leverage multiple cores/nodes for efficiency</span></span>
<span id="cb65-1685"><a href="#cb65-1685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1686"><a href="#cb65-1686" aria-hidden="true" tabindex="-1"></a><span class="st">The `create_scene_tiles` function systematically partitions a geospatial scene (represented by a STAC item) into a grid of smaller tiles for scalable and parallel processing. It takes as input a STAC item and a desired grid size (e.g., 3×3), then:</span></span>
<span id="cb65-1687"><a href="#cb65-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1688"><a href="#cb65-1688" aria-hidden="true" tabindex="-1"></a><span class="st">- Retrieves scene metadata (such as bounding box and area).</span></span>
<span id="cb65-1689"><a href="#cb65-1689" aria-hidden="true" tabindex="-1"></a><span class="st">- Iterates over the grid dimensions to compute the spatial extent of each tile as a percentage of the scene.</span></span>
<span id="cb65-1690"><a href="#cb65-1690" aria-hidden="true" tabindex="-1"></a><span class="st">- For each tile, calculates its bounding box and relevant metadata.</span></span>
<span id="cb65-1691"><a href="#cb65-1691" aria-hidden="true" tabindex="-1"></a><span class="st">- Returns a list of dictionaries, each describing a tile'</span>s spatial boundaries and processing information.</span>
<span id="cb65-1692"><a href="#cb65-1692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1693"><a href="#cb65-1693" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> approach enables efficient parallelization, memory management, and quality control by allowing independent processing and testing of each tile, and is designed to be flexible for different partitioning strategies.</span>
<span id="cb65-1694"><a href="#cb65-1694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1695"><a href="#cb65-1695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1698"><a href="#cb65-1698" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-1699"><a href="#cb65-1699" aria-hidden="true" tabindex="-1"></a><span class="co"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-1700"><a href="#cb65-1700" aria-hidden="true" tabindex="-1"></a><span class="co"># | tangle-append: true</span></span>
<span id="cb65-1701"><a href="#cb65-1701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1702"><a href="#cb65-1702" aria-hidden="true" tabindex="-1"></a><span class="ex">def</span> create_scene_tiles<span class="er">(</span><span class="ex">item,</span> tile_size: Tuple[int, int] = <span class="er">(</span><span class="ex">3,</span> 3<span class="kw">))</span><span class="bu">:</span></span>
<span id="cb65-1703"><a href="#cb65-1703" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb65-1704"><a href="#cb65-1704" aria-hidden="true" tabindex="-1"></a><span class="st">    Create systematic spatial partitioning for parallel processing workflows.</span></span>
<span id="cb65-1705"><a href="#cb65-1705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1706"><a href="#cb65-1706" aria-hidden="true" tabindex="-1"></a><span class="st">    This tiling approach enables several advanced patterns:</span></span>
<span id="cb65-1707"><a href="#cb65-1707" aria-hidden="true" tabindex="-1"></a><span class="st">    1. Parallel Processing: Independent tiles can be processed simultaneously</span></span>
<span id="cb65-1708"><a href="#cb65-1708" aria-hidden="true" tabindex="-1"></a><span class="st">    2. Memory Management: Process large scenes without loading entirely</span></span>
<span id="cb65-1709"><a href="#cb65-1709" aria-hidden="true" tabindex="-1"></a><span class="st">    3. Quality Control: Test processing on representative tiles first</span></span>
<span id="cb65-1710"><a href="#cb65-1710" aria-hidden="true" tabindex="-1"></a><span class="st">    4. Scalability: Extend to arbitrary scene sizes and processing resources</span></span>
<span id="cb65-1711"><a href="#cb65-1711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1712"><a href="#cb65-1712" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb65-1713"><a href="#cb65-1713" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb65-1714"><a href="#cb65-1714" aria-hidden="true" tabindex="-1"></a><span class="st">    item : pystac.Item</span></span>
<span id="cb65-1715"><a href="#cb65-1715" aria-hidden="true" tabindex="-1"></a><span class="st">        STAC item to partition</span></span>
<span id="cb65-1716"><a href="#cb65-1716" aria-hidden="true" tabindex="-1"></a><span class="st">    tile_size : Tuple[int, int]</span></span>
<span id="cb65-1717"><a href="#cb65-1717" aria-hidden="true" tabindex="-1"></a><span class="st">        Grid dimensions (nx, ny)</span></span>
<span id="cb65-1718"><a href="#cb65-1718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1719"><a href="#cb65-1719" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb65-1720"><a href="#cb65-1720" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb65-1721"><a href="#cb65-1721" aria-hidden="true" tabindex="-1"></a><span class="st">    List[Dict]</span></span>
<span id="cb65-1722"><a href="#cb65-1722" aria-hidden="true" tabindex="-1"></a><span class="st">        Tile metadata with bounding boxes and processing information</span></span>
<span id="cb65-1723"><a href="#cb65-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1724"><a href="#cb65-1724" aria-hidden="true" tabindex="-1"></a><span class="st">    Design Pattern: Strategy Pattern for Spatial Partitioning</span></span>
<span id="cb65-1725"><a href="#cb65-1725" aria-hidden="true" tabindex="-1"></a><span class="st">    - Provides flexible tiling strategies for different use cases</span></span>
<span id="cb65-1726"><a href="#cb65-1726" aria-hidden="true" tabindex="-1"></a><span class="st">    - Encapsulates spatial mathematics complexity</span></span>
<span id="cb65-1727"><a href="#cb65-1727" aria-hidden="true" tabindex="-1"></a><span class="st">    - Enables systematic quality control and testing</span></span>
<span id="cb65-1728"><a href="#cb65-1728" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1729"><a href="#cb65-1729" aria-hidden="true" tabindex="-1"></a>    <span class="ex">tiles</span> = []</span>
<span id="cb65-1730"><a href="#cb65-1730" aria-hidden="true" tabindex="-1"></a>    <span class="ex">nx,</span> ny = tile_size</span>
<span id="cb65-1731"><a href="#cb65-1731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1732"><a href="#cb65-1732" aria-hidden="true" tabindex="-1"></a>    <span class="ex">scene_info</span> = get_scene_info<span class="er">(</span><span class="ex">item</span><span class="kw">)</span></span>
<span id="cb65-1733"><a href="#cb65-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1734"><a href="#cb65-1734" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"🔲 Creating {nx}×{ny} tile grid from scene..."</span><span class="kw">)</span></span>
<span id="cb65-1735"><a href="#cb65-1735" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"   Total tiles: {nx * ny}"</span><span class="kw">)</span></span>
<span id="cb65-1736"><a href="#cb65-1736" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"   Scene area: {scene_info['area_km2']:.0f} km²"</span><span class="kw">)</span></span>
<span id="cb65-1737"><a href="#cb65-1737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1738"><a href="#cb65-1738" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> range<span class="er">(</span><span class="ex">nx</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb65-1739"><a href="#cb65-1739" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> range<span class="er">(</span><span class="ex">ny</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb65-1740"><a href="#cb65-1740" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate percentage ranges for this tile</span></span>
<span id="cb65-1741"><a href="#cb65-1741" aria-hidden="true" tabindex="-1"></a>            <span class="ex">x_start</span> = <span class="er">(</span><span class="ex">i</span> / nx<span class="kw">)</span> <span class="ex">*</span> 100</span>
<span id="cb65-1742"><a href="#cb65-1742" aria-hidden="true" tabindex="-1"></a>            <span class="ex">x_end</span> = <span class="er">(</span><span class="kw">(</span><span class="ex">i</span> + 1<span class="kw">)</span> <span class="ex">/</span> nx<span class="kw">)</span> <span class="ex">*</span> 100</span>
<span id="cb65-1743"><a href="#cb65-1743" aria-hidden="true" tabindex="-1"></a>            <span class="ex">y_start</span> = <span class="er">(</span><span class="ex">j</span> / ny<span class="kw">)</span> <span class="ex">*</span> 100</span>
<span id="cb65-1744"><a href="#cb65-1744" aria-hidden="true" tabindex="-1"></a>            <span class="ex">y_end</span> = <span class="er">(</span><span class="kw">(</span><span class="ex">j</span> + 1<span class="kw">)</span> <span class="ex">/</span> ny<span class="kw">)</span> <span class="ex">*</span> 100</span>
<span id="cb65-1745"><a href="#cb65-1745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1746"><a href="#cb65-1746" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generate tile bounding box</span></span>
<span id="cb65-1747"><a href="#cb65-1747" aria-hidden="true" tabindex="-1"></a>            <span class="ex">tile_bbox</span> = get_subset_from_scene<span class="er">(</span></span>
<span id="cb65-1748"><a href="#cb65-1748" aria-hidden="true" tabindex="-1"></a>                <span class="ex">item,</span> x_range=<span class="er">(</span><span class="ex">x_start,</span> x_end<span class="kw">)</span><span class="ex">,</span> y_range=<span class="er">(</span><span class="ex">y_start,</span> y_end<span class="kw">)</span></span>
<span id="cb65-1749"><a href="#cb65-1749" aria-hidden="true" tabindex="-1"></a>            <span class="kw">)</span></span>
<span id="cb65-1750"><a href="#cb65-1750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1751"><a href="#cb65-1751" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Package tile metadata for processing</span></span>
<span id="cb65-1752"><a href="#cb65-1752" aria-hidden="true" tabindex="-1"></a>            <span class="ex">tile_info</span> = {</span>
<span id="cb65-1753"><a href="#cb65-1753" aria-hidden="true" tabindex="-1"></a>                <span class="st">"tile_id"</span><span class="ex">:</span> f<span class="st">"{i}_{j}"</span>,</span>
<span id="cb65-1754"><a href="#cb65-1754" aria-hidden="true" tabindex="-1"></a>                <span class="st">"row"</span><span class="ex">:</span> j,</span>
<span id="cb65-1755"><a href="#cb65-1755" aria-hidden="true" tabindex="-1"></a>                <span class="st">"col"</span><span class="ex">:</span> i,</span>
<span id="cb65-1756"><a href="#cb65-1756" aria-hidden="true" tabindex="-1"></a>                <span class="st">"bbox"</span><span class="ex">:</span> tile_bbox,</span>
<span id="cb65-1757"><a href="#cb65-1757" aria-hidden="true" tabindex="-1"></a>                <span class="st">"x_range"</span><span class="ex">:</span> <span class="er">(</span><span class="ex">x_start,</span> x_end<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-1758"><a href="#cb65-1758" aria-hidden="true" tabindex="-1"></a>                <span class="st">"y_range"</span><span class="ex">:</span> <span class="er">(</span><span class="ex">y_start,</span> y_end<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-1759"><a href="#cb65-1759" aria-hidden="true" tabindex="-1"></a>                <span class="st">"area_percent"</span><span class="ex">:</span> <span class="er">(</span><span class="kw">(</span><span class="ex">x_end</span> <span class="at">-</span> x_start<span class="kw">)</span> <span class="ex">*</span> <span class="er">(</span><span class="ex">y_end</span> <span class="at">-</span> y_start<span class="kw">))</span> <span class="ex">/</span> 100.0,</span>
<span id="cb65-1760"><a href="#cb65-1760" aria-hidden="true" tabindex="-1"></a>                <span class="st">"processing_priority"</span><span class="ex">:</span> <span class="st">"high"</span></span>
<span id="cb65-1761"><a href="#cb65-1761" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">(</span><span class="ex">i</span> == nx // 2 and j == ny // 2<span class="kw">)</span></span>
<span id="cb65-1762"><a href="#cb65-1762" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> <span class="st">"normal"</span><span class="ex">,</span>  <span class="co"># Center tile first</span></span>
<span id="cb65-1763"><a href="#cb65-1763" aria-hidden="true" tabindex="-1"></a>            <span class="er">}</span></span>
<span id="cb65-1764"><a href="#cb65-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1765"><a href="#cb65-1765" aria-hidden="true" tabindex="-1"></a>            <span class="ex">tiles.append</span><span class="er">(</span><span class="ex">tile_info</span><span class="kw">)</span></span>
<span id="cb65-1766"><a href="#cb65-1766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1767"><a href="#cb65-1767" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span></span>
<span id="cb65-1768"><a href="#cb65-1768" aria-hidden="true" tabindex="-1"></a>        <span class="ex">f</span><span class="st">"   ✅ Created {len(tiles)} tiles, each covering {tiles[0]['area_percent']:.1f}% of scene"</span></span>
<span id="cb65-1769"><a href="#cb65-1769" aria-hidden="true" tabindex="-1"></a>    <span class="kw">)</span></span>
<span id="cb65-1770"><a href="#cb65-1770" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ex">tiles</span></span>
<span id="cb65-1771"><a href="#cb65-1771" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-1772"><a href="#cb65-1772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1773"><a href="#cb65-1773" aria-hidden="true" tabindex="-1"></a><span class="co">#### Testing functionality</span></span>
<span id="cb65-1774"><a href="#cb65-1774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1775"><a href="#cb65-1775" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> next code block introduces a function called <span class="kw">`</span><span class="ex">test_subset_functionality</span><span class="kw">`</span>. This function is designed to perform automated quality assurance on geospatial data loading pipelines. It does so by running a series of tests on a small, central subset of a geospatial scene, using a STAC item as input. The function checks that the subset extraction and band loading processes work correctly, verifies that data is actually loaded, and provides informative print statements about the test results. This approach helps catch errors early, ensures that the core data loading functionality is operational before processing larger datasets, and validates performance on a manageable data sample.</span>
<span id="cb65-1776"><a href="#cb65-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1777"><a href="#cb65-1777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1780"><a href="#cb65-1780" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-1781"><a href="#cb65-1781" aria-hidden="true" tabindex="-1"></a><span class="co"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-1782"><a href="#cb65-1782" aria-hidden="true" tabindex="-1"></a><span class="co"># | tangle-append: true</span></span>
<span id="cb65-1783"><a href="#cb65-1783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1784"><a href="#cb65-1784" aria-hidden="true" tabindex="-1"></a><span class="ex">def</span> test_subset_functionality<span class="er">(</span><span class="ex">item</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb65-1785"><a href="#cb65-1785" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb65-1786"><a href="#cb65-1786" aria-hidden="true" tabindex="-1"></a><span class="st">    Automated quality assurance for data loading pipelines.</span></span>
<span id="cb65-1787"><a href="#cb65-1787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1788"><a href="#cb65-1788" aria-hidden="true" tabindex="-1"></a><span class="st">    This testing approach demonstrates:</span></span>
<span id="cb65-1789"><a href="#cb65-1789" aria-hidden="true" tabindex="-1"></a><span class="st">    1. Smoke Testing: Verify basic functionality before full processing</span></span>
<span id="cb65-1790"><a href="#cb65-1790" aria-hidden="true" tabindex="-1"></a><span class="st">    2. Representative Sampling: Test with manageable data subset</span></span>
<span id="cb65-1791"><a href="#cb65-1791" aria-hidden="true" tabindex="-1"></a><span class="st">    3. Error Detection: Identify issues early in processing pipeline</span></span>
<span id="cb65-1792"><a href="#cb65-1792" aria-hidden="true" tabindex="-1"></a><span class="st">    4. Performance Validation: Ensure acceptable loading performance</span></span>
<span id="cb65-1793"><a href="#cb65-1793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1794"><a href="#cb65-1794" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb65-1795"><a href="#cb65-1795" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb65-1796"><a href="#cb65-1796" aria-hidden="true" tabindex="-1"></a><span class="st">    item : pystac.Item</span></span>
<span id="cb65-1797"><a href="#cb65-1797" aria-hidden="true" tabindex="-1"></a><span class="st">        STAC item to test</span></span>
<span id="cb65-1798"><a href="#cb65-1798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1799"><a href="#cb65-1799" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb65-1800"><a href="#cb65-1800" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb65-1801"><a href="#cb65-1801" aria-hidden="true" tabindex="-1"></a><span class="st">    bool</span></span>
<span id="cb65-1802"><a href="#cb65-1802" aria-hidden="true" tabindex="-1"></a><span class="st">        True if subset functionality is working correctly</span></span>
<span id="cb65-1803"><a href="#cb65-1803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1804"><a href="#cb65-1804" aria-hidden="true" tabindex="-1"></a><span class="st">    Design Pattern: Chain of Responsibility for Quality Assurance</span></span>
<span id="cb65-1805"><a href="#cb65-1805" aria-hidden="true" tabindex="-1"></a><span class="st">    - Implements systematic testing hierarchy</span></span>
<span id="cb65-1806"><a href="#cb65-1806" aria-hidden="true" tabindex="-1"></a><span class="st">    - Provides early failure detection</span></span>
<span id="cb65-1807"><a href="#cb65-1807" aria-hidden="true" tabindex="-1"></a><span class="st">    - Validates core functionality before expensive operations</span></span>
<span id="cb65-1808"><a href="#cb65-1808" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-1809"><a href="#cb65-1809" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"🧪 Testing subset functionality..."</span><span class="kw">)</span></span>
<span id="cb65-1810"><a href="#cb65-1810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1811"><a href="#cb65-1811" aria-hidden="true" tabindex="-1"></a>    <span class="ex">try:</span></span>
<span id="cb65-1812"><a href="#cb65-1812" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test with small central area (minimal data transfer)</span></span>
<span id="cb65-1813"><a href="#cb65-1813" aria-hidden="true" tabindex="-1"></a>        <span class="ex">test_bbox</span> = get_subset_from_scene<span class="er">(</span><span class="ex">item,</span> x_range=<span class="er">(</span><span class="ex">40,</span> 60<span class="kw">)</span><span class="ex">,</span> y_range=<span class="er">(</span><span class="ex">40,</span> 60<span class="kw">))</span></span>
<span id="cb65-1814"><a href="#cb65-1814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1815"><a href="#cb65-1815" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load minimal data for testing</span></span>
<span id="cb65-1816"><a href="#cb65-1816" aria-hidden="true" tabindex="-1"></a>        <span class="ex">test_data</span> = load_sentinel2_bands<span class="er">(</span></span>
<span id="cb65-1817"><a href="#cb65-1817" aria-hidden="true" tabindex="-1"></a>            <span class="ex">item,</span></span>
<span id="cb65-1818"><a href="#cb65-1818" aria-hidden="true" tabindex="-1"></a>            <span class="va">bands</span><span class="op">=</span><span class="pp">[</span><span class="st">"B04"</span><span class="pp">]</span>,  <span class="co"># Single band reduces test time</span></span>
<span id="cb65-1819"><a href="#cb65-1819" aria-hidden="true" tabindex="-1"></a>            <span class="va">subset_bbox</span><span class="op">=</span>test_bbox,</span>
<span id="cb65-1820"><a href="#cb65-1820" aria-hidden="true" tabindex="-1"></a>            <span class="va">max_retries</span><span class="op">=</span>2,</span>
<span id="cb65-1821"><a href="#cb65-1821" aria-hidden="true" tabindex="-1"></a>        <span class="kw">)</span></span>
<span id="cb65-1822"><a href="#cb65-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1823"><a href="#cb65-1823" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"B04"</span> in test_data:</span>
<span id="cb65-1824"><a href="#cb65-1824" aria-hidden="true" tabindex="-1"></a>            <span class="ex">shape</span> = test_data<span class="pp">[</span><span class="st">"B04"</span><span class="pp">]</span>.shape</span>
<span id="cb65-1825"><a href="#cb65-1825" aria-hidden="true" tabindex="-1"></a>            <span class="ex">has_data</span> = test_data<span class="pp">[</span><span class="st">"B04"</span><span class="pp">]</span>.size <span class="op">&gt;</span> 0</span>
<span id="cb65-1826"><a href="#cb65-1826" aria-hidden="true" tabindex="-1"></a>            <span class="ex">logger.info</span><span class="er">(</span></span>
<span id="cb65-1827"><a href="#cb65-1827" aria-hidden="true" tabindex="-1"></a>                <span class="ex">f</span><span class="st">"   ✅ Subset test successful: {shape} pixels, {test_data['B04'].size} total"</span></span>
<span id="cb65-1828"><a href="#cb65-1828" aria-hidden="true" tabindex="-1"></a>            <span class="kw">)</span></span>
<span id="cb65-1829"><a href="#cb65-1829" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ex">True</span></span>
<span id="cb65-1830"><a href="#cb65-1830" aria-hidden="true" tabindex="-1"></a>        <span class="ex">else:</span></span>
<span id="cb65-1831"><a href="#cb65-1831" aria-hidden="true" tabindex="-1"></a>            <span class="ex">logger.error</span><span class="er">(</span><span class="ex">f</span><span class="st">"   ❌ Subset test failed: no data returned"</span><span class="kw">)</span></span>
<span id="cb65-1832"><a href="#cb65-1832" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ex">False</span></span>
<span id="cb65-1833"><a href="#cb65-1833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1834"><a href="#cb65-1834" aria-hidden="true" tabindex="-1"></a>    <span class="ex">except</span> Exception as e:</span>
<span id="cb65-1835"><a href="#cb65-1835" aria-hidden="true" tabindex="-1"></a>        <span class="ex">logger.error</span><span class="er">(</span><span class="ex">f</span><span class="st">"   ❌ Subset test failed: {str(e)[:50]}..."</span><span class="kw">)</span></span>
<span id="cb65-1836"><a href="#cb65-1836" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ex">False</span></span>
<span id="cb65-1837"><a href="#cb65-1837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1838"><a href="#cb65-1838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1839"><a href="#cb65-1839" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-1840"><a href="#cb65-1840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1841"><a href="#cb65-1841" aria-hidden="true" tabindex="-1"></a><span class="co">### 2.5 Summary: Your Geospatial AI Toolkit</span></span>
<span id="cb65-1842"><a href="#cb65-1842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1843"><a href="#cb65-1843" aria-hidden="true" tabindex="-1"></a><span class="ex">You</span> now have a comprehensive, production-ready toolkit with:</span>
<span id="cb65-1844"><a href="#cb65-1844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1845"><a href="#cb65-1845" aria-hidden="true" tabindex="-1"></a><span class="ex">**Core</span> Capabilities:<span class="pp">**</span></span>
<span id="cb65-1846"><a href="#cb65-1846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1847"><a href="#cb65-1847" aria-hidden="true" tabindex="-1"></a><span class="ex">1.</span> <span class="pp">**</span>🔐 Enterprise Authentication<span class="pp">**</span>: Secure, scalable API access patterns</span>
<span id="cb65-1848"><a href="#cb65-1848" aria-hidden="true" tabindex="-1"></a><span class="ex">2.</span> <span class="pp">**</span>🔍 Intelligent Data Discovery<span class="pp">**</span>: Cloud-native search with optimization</span>
<span id="cb65-1849"><a href="#cb65-1849" aria-hidden="true" tabindex="-1"></a><span class="ex">3.</span> <span class="pp">**</span>📥 Memory-Efficient Loading<span class="pp">**</span>: Robust data access with subsetting</span>
<span id="cb65-1850"><a href="#cb65-1850" aria-hidden="true" tabindex="-1"></a><span class="ex">4.</span> <span class="pp">**</span>📐 Spatial Processing<span class="pp">**</span>: Percentage-based, reproducible operations</span>
<span id="cb65-1851"><a href="#cb65-1851" aria-hidden="true" tabindex="-1"></a><span class="ex">5.</span> <span class="pp">**</span>🔬 Spectral Analysis<span class="pp">**</span>: Publication-quality processing pipelines</span>
<span id="cb65-1852"><a href="#cb65-1852" aria-hidden="true" tabindex="-1"></a><span class="ex">6.</span> <span class="pp">**</span>📊 Scientific Visualization<span class="pp">**</span>: Adaptive, informative displays</span>
<span id="cb65-1853"><a href="#cb65-1853" aria-hidden="true" tabindex="-1"></a><span class="ex">7.</span> <span class="pp">**</span>💾 Standards-Compliant Export<span class="pp">**</span>: Interoperable data formats</span>
<span id="cb65-1854"><a href="#cb65-1854" aria-hidden="true" tabindex="-1"></a><span class="ex">8.</span> <span class="pp">**</span>🚀 Scalable Workflows<span class="pp">**</span>: Parallel processing and quality assurance</span>
<span id="cb65-1855"><a href="#cb65-1855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1856"><a href="#cb65-1856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1857"><a href="#cb65-1857" aria-hidden="true" tabindex="-1"></a><span class="ex">**Design</span> Philosophy:<span class="pp">**</span></span>
<span id="cb65-1858"><a href="#cb65-1858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1859"><a href="#cb65-1859" aria-hidden="true" tabindex="-1"></a><span class="ex">Each</span> function embodies software engineering best practices:</span>
<span id="cb65-1860"><a href="#cb65-1860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1861"><a href="#cb65-1861" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Error Handling<span class="pp">**</span>: Graceful degradation and informative error messages</span>
<span id="cb65-1862"><a href="#cb65-1862" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Composability<span class="pp">**</span>: Functions work together in complex workflows</span>
<span id="cb65-1863"><a href="#cb65-1863" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Extensibility<span class="pp">**</span>: Easy to modify and extend for new requirements</span>
<span id="cb65-1864"><a href="#cb65-1864" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Documentation<span class="pp">**</span>: Clear examples and architectural reasoning</span>
<span id="cb65-1865"><a href="#cb65-1865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1866"><a href="#cb65-1866" aria-hidden="true" tabindex="-1"></a><span class="ex">**Ready</span> for Production:<span class="pp">**</span></span>
<span id="cb65-1867"><a href="#cb65-1867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1868"><a href="#cb65-1868" aria-hidden="true" tabindex="-1"></a><span class="ex">These</span> functions are designed for real-world deployment:</span>
<span id="cb65-1869"><a href="#cb65-1869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1870"><a href="#cb65-1870" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Scalability<span class="pp">**</span>: Handle datasets from small studies to global analysis</span>
<span id="cb65-1871"><a href="#cb65-1871" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Reliability<span class="pp">**</span>: Robust error handling and recovery mechanisms</span>
<span id="cb65-1872"><a href="#cb65-1872" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Performance<span class="pp">**</span>: Memory-efficient algorithms and cloud optimization</span>
<span id="cb65-1873"><a href="#cb65-1873" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Maintainability<span class="pp">**</span>: Clear code structure and comprehensive documentation</span>
<span id="cb65-1874"><a href="#cb65-1874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1875"><a href="#cb65-1875" aria-hidden="true" tabindex="-1"></a><span class="ex">**Troubleshooting:**</span></span>
<span id="cb65-1876"><a href="#cb65-1876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1877"><a href="#cb65-1877" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Systematic tiling<span class="pp">**</span> enables parallel processing of large datasets</span>
<span id="cb65-1878"><a href="#cb65-1878" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Quality assurance testing<span class="pp">**</span> prevents failures in production workflows</span>
<span id="cb65-1879"><a href="#cb65-1879" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Adaptive processing priorities<span class="pp">**</span> optimize resource utilization</span>
<span id="cb65-1880"><a href="#cb65-1880" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Metadata packaging<span class="pp">**</span> supports complex workflow orchestration</span>
<span id="cb65-1881"><a href="#cb65-1881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1882"><a href="#cb65-1882" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
<span id="cb65-1883"><a href="#cb65-1883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1884"><a href="#cb65-1884" aria-hidden="true" tabindex="-1"></a><span class="co">## 3. Understanding STAC APIs and Cloud-Native Geospatial Architecture</span></span>
<span id="cb65-1885"><a href="#cb65-1885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1886"><a href="#cb65-1886" aria-hidden="true" tabindex="-1"></a><span class="ex">:::{.callout-tip}</span></span>
<span id="cb65-1887"><a href="#cb65-1887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1888"><a href="#cb65-1888" aria-hidden="true" tabindex="-1"></a><span class="co">##### Learning Objectives</span></span>
<span id="cb65-1889"><a href="#cb65-1889" aria-hidden="true" tabindex="-1"></a><span class="ex">By</span> the end of this section, you will:</span>
<span id="cb65-1890"><a href="#cb65-1890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1891"><a href="#cb65-1891" aria-hidden="true" tabindex="-1"></a><span class="ex">Understand</span> the STAC specification and its role in modern geospatial architecture</span>
<span id="cb65-1892"><a href="#cb65-1892" aria-hidden="true" tabindex="-1"></a><span class="ex">Connect</span> to cloud-native data catalogs with proper authentication</span>
<span id="cb65-1893"><a href="#cb65-1893" aria-hidden="true" tabindex="-1"></a><span class="ex">Explore</span> available satellite datasets and their characteristics</span>
<span id="cb65-1894"><a href="#cb65-1894" aria-hidden="true" tabindex="-1"></a><span class="ex">Design</span> robust data discovery workflows for production systems</span>
<span id="cb65-1895"><a href="#cb65-1895" aria-hidden="true" tabindex="-1"></a><span class="ex">:::</span></span>
<span id="cb65-1896"><a href="#cb65-1896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1897"><a href="#cb65-1897" aria-hidden="true" tabindex="-1"></a><span class="co">### The STAC Revolution: From Data Downloads to Cloud-Native Discovery</span></span>
<span id="cb65-1898"><a href="#cb65-1898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1899"><a href="#cb65-1899" aria-hidden="true" tabindex="-1"></a><span class="ex">**STAC</span> <span class="er">(</span><span class="ex">SpatioTemporal</span> Asset Catalog<span class="kw">)</span><span class="ex">**</span> represents a fundamental shift in how we access geospatial data. Instead of downloading entire datasets <span class="er">(</span><span class="ex">often</span> terabytes<span class="kw">)</span><span class="ex">,</span> STAC enables intelligent, on-demand access to exactly the data you need.</span>
<span id="cb65-1900"><a href="#cb65-1900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1901"><a href="#cb65-1901" aria-hidden="true" tabindex="-1"></a><span class="co">#### Why STAC Matters for Geospatial AI</span></span>
<span id="cb65-1902"><a href="#cb65-1902" aria-hidden="true" tabindex="-1"></a><span class="ex">Traditional</span> satellite data distribution faced several challenges. Users were required to download and store massive datasets locally, leading to significant storage bottlenecks. There was no standardized way to search across different providers, making data discovery difficult. Before analysis could begin, heavy preprocessing was often necessary, creating additional barriers. Furthermore, tracking data lineage and updates was challenging, complicating version control.</span>
<span id="cb65-1903"><a href="#cb65-1903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1904"><a href="#cb65-1904" aria-hidden="true" tabindex="-1"></a><span class="ex">STAC</span> addresses these issues by enabling federated discovery, allowing users to search across multiple data providers through a unified interface. It supports lazy loading, so only the necessary spatial and temporal subsets are accessed. The use of rich, standardized metadata enables intelligent filtering of data. Additionally, STAC is optimized for the cloud, providing direct access to analysis-ready data stored remotely.</span>
<span id="cb65-1905"><a href="#cb65-1905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1906"><a href="#cb65-1906" aria-hidden="true" tabindex="-1"></a><span class="co">### STAC Architecture Components</span></span>
<span id="cb65-1907"><a href="#cb65-1907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1908"><a href="#cb65-1908" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> STAC architecture is composed of several key elements. STAC Items represent individual scenes or data granules, each described with standardized metadata. These items are grouped into STAC Collections, which organize related items, such as all Sentinel-2 data. Collections and items are further structured within STAC Catalogs, creating a hierarchical organization that enables efficient navigation and discovery. Access to these resources is provided through STAC APIs, which are RESTful interfaces designed for searching and retrieving geospatial data.</span>
<span id="cb65-1909"><a href="#cb65-1909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1910"><a href="#cb65-1910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1911"><a href="#cb65-1911" aria-hidden="true" tabindex="-1"></a><span class="co">### Practical STAC Connection: Microsoft Planetary Computer</span></span>
<span id="cb65-1912"><a href="#cb65-1912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1913"><a href="#cb65-1913" aria-hidden="true" tabindex="-1"></a><span class="ex">Microsoft</span> Planetary Computer hosts one of the world<span class="st">'s largest STAC catalogs, providing free access to petabytes of environmental data. Let'</span>s establish a robust connection and explore available datasets.</span>
<span id="cb65-1914"><a href="#cb65-1914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1915"><a href="#cb65-1915" aria-hidden="true" tabindex="-1"></a><span class="co">#### Testing STAC Connectivity and Catalog Discovery</span></span>
<span id="cb65-1916"><a href="#cb65-1916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1917"><a href="#cb65-1917" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> connection test demonstrates several important concepts for production geospatial systems:</span>
<span id="cb65-1918"><a href="#cb65-1918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1919"><a href="#cb65-1919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1922"><a href="#cb65-1922" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-1923"><a href="#cb65-1923" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to STAC catalog</span></span>
<span id="cb65-1924"><a href="#cb65-1924" aria-hidden="true" tabindex="-1"></a><span class="ex">try:</span></span>
<span id="cb65-1925"><a href="#cb65-1925" aria-hidden="true" tabindex="-1"></a>    <span class="ex">catalog</span> = Client.open<span class="er">(</span></span>
<span id="cb65-1926"><a href="#cb65-1926" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://planetarycomputer.microsoft.com/api/stac/v1"</span><span class="ex">,</span></span>
<span id="cb65-1927"><a href="#cb65-1927" aria-hidden="true" tabindex="-1"></a>        <span class="va">modifier</span><span class="op">=</span>pc.sign_inplace</span>
<span id="cb65-1928"><a href="#cb65-1928" aria-hidden="true" tabindex="-1"></a>    <span class="kw">)</span></span>
<span id="cb65-1929"><a href="#cb65-1929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1930"><a href="#cb65-1930" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="st">"Connected to Planetary Computer STAC API"</span><span class="kw">)</span></span>
<span id="cb65-1931"><a href="#cb65-1931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1932"><a href="#cb65-1932" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get catalog information</span></span>
<span id="cb65-1933"><a href="#cb65-1933" aria-hidden="true" tabindex="-1"></a>    <span class="ex">try:</span></span>
<span id="cb65-1934"><a href="#cb65-1934" aria-hidden="true" tabindex="-1"></a>        <span class="ex">catalog_info</span> = catalog.get_self<span class="er">(</span><span class="kw">)</span></span>
<span id="cb65-1935"><a href="#cb65-1935" aria-hidden="true" tabindex="-1"></a>        <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Catalog: {catalog_info.title}"</span><span class="kw">)</span></span>
<span id="cb65-1936"><a href="#cb65-1936" aria-hidden="true" tabindex="-1"></a>    <span class="ex">except</span> Exception:</span>
<span id="cb65-1937"><a href="#cb65-1937" aria-hidden="true" tabindex="-1"></a>        <span class="ex">logger.info</span><span class="er">(</span><span class="st">"Basic connection successful"</span><span class="kw">)</span></span>
<span id="cb65-1938"><a href="#cb65-1938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1939"><a href="#cb65-1939" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Explore key satellite datasets</span></span>
<span id="cb65-1940"><a href="#cb65-1940" aria-hidden="true" tabindex="-1"></a>    <span class="ex">satellite_collections</span> = {</span>
<span id="cb65-1941"><a href="#cb65-1941" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sentinel-2-l2a'</span><span class="ex">:</span> <span class="st">'Sentinel-2 Level 2A (10m optical)'</span>,</span>
<span id="cb65-1942"><a href="#cb65-1942" aria-hidden="true" tabindex="-1"></a>        <span class="st">'landsat-c2-l2'</span><span class="ex">:</span> <span class="st">'Landsat Collection 2 Level 2 (30m optical)'</span>,</span>
<span id="cb65-1943"><a href="#cb65-1943" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sentinel-1-grd'</span><span class="ex">:</span> <span class="st">'Sentinel-1 SAR (radar)'</span>,</span>
<span id="cb65-1944"><a href="#cb65-1944" aria-hidden="true" tabindex="-1"></a>        <span class="st">'naip'</span><span class="ex">:</span> <span class="st">'NAIP (1m aerial imagery)'</span></span>
<span id="cb65-1945"><a href="#cb65-1945" aria-hidden="true" tabindex="-1"></a>    <span class="er">}</span></span>
<span id="cb65-1946"><a href="#cb65-1946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1947"><a href="#cb65-1947" aria-hidden="true" tabindex="-1"></a>    <span class="ex">available_collections</span> = []</span>
<span id="cb65-1948"><a href="#cb65-1948" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> collection_id<span class="ex">,</span> description in satellite_collections.items<span class="er">(</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb65-1949"><a href="#cb65-1949" aria-hidden="true" tabindex="-1"></a>        <span class="ex">try:</span></span>
<span id="cb65-1950"><a href="#cb65-1950" aria-hidden="true" tabindex="-1"></a>            <span class="ex">collection</span> = catalog.get_collection<span class="er">(</span><span class="ex">collection_id</span><span class="kw">)</span></span>
<span id="cb65-1951"><a href="#cb65-1951" aria-hidden="true" tabindex="-1"></a>            <span class="ex">available_collections.append</span><span class="er">(</span><span class="ex">collection_id</span><span class="kw">)</span></span>
<span id="cb65-1952"><a href="#cb65-1952" aria-hidden="true" tabindex="-1"></a>            <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Available: {description}"</span><span class="kw">)</span></span>
<span id="cb65-1953"><a href="#cb65-1953" aria-hidden="true" tabindex="-1"></a>        <span class="ex">except</span> Exception:</span>
<span id="cb65-1954"><a href="#cb65-1954" aria-hidden="true" tabindex="-1"></a>            <span class="ex">logger.warning</span><span class="er">(</span><span class="ex">f</span><span class="st">"Not accessible: {description}"</span><span class="kw">)</span></span>
<span id="cb65-1955"><a href="#cb65-1955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1956"><a href="#cb65-1956" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Accessible collections: {len(available_collections)}/{len(satellite_collections)}"</span><span class="kw">)</span></span>
<span id="cb65-1957"><a href="#cb65-1957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1958"><a href="#cb65-1958" aria-hidden="true" tabindex="-1"></a><span class="ex">except</span> Exception as e:</span>
<span id="cb65-1959"><a href="#cb65-1959" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.error</span><span class="er">(</span><span class="ex">f</span><span class="st">"\n❌ STAC connection failed: {str(e)}"</span><span class="kw">)</span></span>
<span id="cb65-1960"><a href="#cb65-1960" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"\n🔧 Troubleshooting steps:"</span><span class="kw">)</span></span>
<span id="cb65-1961"><a href="#cb65-1961" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"   1. Verify internet connectivity"</span><span class="kw">)</span></span>
<span id="cb65-1962"><a href="#cb65-1962" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"   2. Check Planetary Computer API status: https://planetarycomputer.microsoft.com/"</span><span class="kw">)</span></span>
<span id="cb65-1963"><a href="#cb65-1963" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"   3. Ensure pystac-client is installed: pip install pystac-client"</span><span class="kw">)</span></span>
<span id="cb65-1964"><a href="#cb65-1964" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"   4. Verify planetary-computer package: pip install planetary-computer"</span><span class="kw">)</span></span>
<span id="cb65-1965"><a href="#cb65-1965" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"   5. Try again in a few minutes (temporary API issues)"</span><span class="kw">)</span></span>
<span id="cb65-1966"><a href="#cb65-1966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1967"><a href="#cb65-1967" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-1968"><a href="#cb65-1968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1969"><a href="#cb65-1969" aria-hidden="true" tabindex="-1"></a><span class="co">## Connection Troubleshooting</span></span>
<span id="cb65-1970"><a href="#cb65-1970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1971"><a href="#cb65-1971" aria-hidden="true" tabindex="-1"></a><span class="ex">If</span> you encounter connection issues, first verify your internet connectivity and check your firewall settings. Keep in mind that anonymous users have lower API rate limits than authenticated users, which can also cause problems. You should also check the [Planetary Computer status page]<span class="er">(</span><span class="ex">https://planetarycomputer.microsoft.com/</span><span class="kw">)</span> <span class="ex">to</span> see if there are any ongoing outages. Finally, make sure you have the latest versions of both the <span class="kw">`</span><span class="ex">pystac-client</span><span class="kw">`</span> and <span class="kw">`</span><span class="ex">planetary-computer</span><span class="kw">`</span> packages installed.</span>
<span id="cb65-1972"><a href="#cb65-1972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1973"><a href="#cb65-1973" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> connection process demonstrates real-world challenges in building production geospatial systems.</span>
<span id="cb65-1974"><a href="#cb65-1974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1975"><a href="#cb65-1975" aria-hidden="true" tabindex="-1"></a><span class="co">### Understanding Collection Metadata and Selection Criteria</span></span>
<span id="cb65-1976"><a href="#cb65-1976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1977"><a href="#cb65-1977" aria-hidden="true" tabindex="-1"></a><span class="ex">Each</span> STAC collection contains rich metadata that helps you choose the right dataset for your analysis. Let<span class="st">'s explore how to make informed decisions about which satellite data to use:</span></span>
<span id="cb65-1978"><a href="#cb65-1978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1979"><a href="#cb65-1979" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb65-1980"><a href="#cb65-1980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1981"><a href="#cb65-1981" aria-hidden="true" tabindex="-1"></a><span class="st">## 4. Spatial Analysis Design - Defining Areas of Interest</span></span>
<span id="cb65-1982"><a href="#cb65-1982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1983"><a href="#cb65-1983" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-tip}</span></span>
<span id="cb65-1984"><a href="#cb65-1984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1985"><a href="#cb65-1985" aria-hidden="true" tabindex="-1"></a><span class="st">##### Learning Objectives</span></span>
<span id="cb65-1986"><a href="#cb65-1986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1987"><a href="#cb65-1987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1988"><a href="#cb65-1988" aria-hidden="true" tabindex="-1"></a><span class="st">By the end of this section, you will be able to understand coordinate systems and bounding box conventions in geospatial analysis, design effective study areas based on analysis objectives and data characteristics, create interactive maps for spatial context and validation, and apply best practices for reproducible spatial analysis workflows.</span></span>
<span id="cb65-1989"><a href="#cb65-1989" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-1990"><a href="#cb65-1990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1991"><a href="#cb65-1991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1992"><a href="#cb65-1992" aria-hidden="true" tabindex="-1"></a><span class="st">### The Art and Science of Spatial Scope Definition</span></span>
<span id="cb65-1993"><a href="#cb65-1993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1994"><a href="#cb65-1994" aria-hidden="true" tabindex="-1"></a><span class="st">Defining your Area of Interest (AOI) is a critical design decision that influences several aspects of your analysis. The size of the area determines the amount of data you need to process and store. The validity of your analysis depends on how well your study boundaries align with relevant ecological or administrative regions. The location of your AOI affects satellite revisit patterns and data availability, and the way you define your area can impact processing efficiency, such as the choice of optimal tile sizes for your workflow.</span></span>
<span id="cb65-1995"><a href="#cb65-1995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1996"><a href="#cb65-1996" aria-hidden="true" tabindex="-1"></a><span class="st">#### Coordinate Systems and Bounding Box Conventions</span></span>
<span id="cb65-1997"><a href="#cb65-1997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1998"><a href="#cb65-1998" aria-hidden="true" tabindex="-1"></a><span class="st">For our AOI definition, we will use the WGS84 geographic coordinate system (EPSG:4326). In this system, longitude (X) represents the east-west position and ranges from -180° to +180°, with negative values indicating west. Latitude (Y) represents the north-south position and ranges from -90° to +90°, with negative values indicating south. Bounding boxes are formatted as [west, south, east, north], corresponding to (min_x, min_y, max_x, max_y).</span></span>
<span id="cb65-1999"><a href="#cb65-1999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2000"><a href="#cb65-2000" aria-hidden="true" tabindex="-1"></a><span class="st">#### Study Area Selection: Santa Barbara Region</span></span>
<span id="cb65-2001"><a href="#cb65-2001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2002"><a href="#cb65-2002" aria-hidden="true" tabindex="-1"></a><span class="st">We'</span>ll use the Santa Barbara region as our exemplar study region because it features a diverse mix of coastal, urban, mountainous, and agricultural environments. The region is characterized by dynamic processes such as coastal dynamics, wildfire activity, vegetation changes, and urban-wildland interface transitions. It also benefits from frequent satellite coverage and presents geographic complexity, including the Santa Ynez Mountains, Channel Islands, agricultural valleys, and varied coastal ecosystems.</span>
<span id="cb65-2003"><a href="#cb65-2003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2004"><a href="#cb65-2004" aria-hidden="true" tabindex="-1"></a><span class="ex">**Designing</span> Area of Interest <span class="er">(</span><span class="ex">AOI</span><span class="kw">)</span> <span class="cf">for</span> Geospatial <span class="ex">Analysis**</span></span>
<span id="cb65-2005"><a href="#cb65-2005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2006"><a href="#cb65-2006" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> demonstrates spatial scope definition for satellite-based studies. We<span class="st">'ll work with the Santa Barbara region as our primary study area.</span></span>
<span id="cb65-2007"><a href="#cb65-2007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2010"><a href="#cb65-2010" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-2011"><a href="#cb65-2011" aria-hidden="true" tabindex="-1"></a><span class="st"># Step 3A: Define Area of Interest with Geographic Reasoning</span></span>
<span id="cb65-2012"><a href="#cb65-2012" aria-hidden="true" tabindex="-1"></a><span class="st"># Primary study area: Santa Barbara Region</span></span>
<span id="cb65-2013"><a href="#cb65-2013" aria-hidden="true" tabindex="-1"></a><span class="st"># Coordinates chosen to encompass the greater Santa Barbara County coastal region</span></span>
<span id="cb65-2014"><a href="#cb65-2014" aria-hidden="true" tabindex="-1"></a><span class="st">santa_barbara_bbox = [-120.5, 34.3, -119.5, 34.7]  # [west, south, east, north]</span></span>
<span id="cb65-2015"><a href="#cb65-2015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2016"><a href="#cb65-2016" aria-hidden="true" tabindex="-1"></a><span class="st"># Import required libraries for spatial calculations</span></span>
<span id="cb65-2017"><a href="#cb65-2017" aria-hidden="true" tabindex="-1"></a><span class="st">from shapely.geometry import box</span></span>
<span id="cb65-2018"><a href="#cb65-2018" aria-hidden="true" tabindex="-1"></a><span class="st">import os</span></span>
<span id="cb65-2019"><a href="#cb65-2019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2020"><a href="#cb65-2020" aria-hidden="true" tabindex="-1"></a><span class="st"># Create geometry object for area calculations</span></span>
<span id="cb65-2021"><a href="#cb65-2021" aria-hidden="true" tabindex="-1"></a><span class="st">aoi_geom = box(*santa_barbara_bbox)</span></span>
<span id="cb65-2022"><a href="#cb65-2022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2023"><a href="#cb65-2023" aria-hidden="true" tabindex="-1"></a><span class="st"># Calculate basic spatial metrics</span></span>
<span id="cb65-2024"><a href="#cb65-2024" aria-hidden="true" tabindex="-1"></a><span class="st">area_degrees = aoi_geom.area</span></span>
<span id="cb65-2025"><a href="#cb65-2025" aria-hidden="true" tabindex="-1"></a><span class="st"># Approximate conversion to kilometers (valid for mid-latitudes)</span></span>
<span id="cb65-2026"><a href="#cb65-2026" aria-hidden="true" tabindex="-1"></a><span class="st">center_lat = (santa_barbara_bbox[1] + santa_barbara_bbox[3]) / 2</span></span>
<span id="cb65-2027"><a href="#cb65-2027" aria-hidden="true" tabindex="-1"></a><span class="st">lat_correction = np.cos(np.radians(center_lat))</span></span>
<span id="cb65-2028"><a href="#cb65-2028" aria-hidden="true" tabindex="-1"></a><span class="st">area_km2 = area_degrees * (111.32 ** 2) * lat_correction  # 1 degree ≈ 111.32 km</span></span>
<span id="cb65-2029"><a href="#cb65-2029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2030"><a href="#cb65-2030" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"\n📊 AOI Spatial Characteristics:")</span></span>
<span id="cb65-2031"><a href="#cb65-2031" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"   📍 Region: Santa Barbara County Coastal Region")</span></span>
<span id="cb65-2032"><a href="#cb65-2032" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"   🗺️ Bounding box: {santa_barbara_bbox}")</span></span>
<span id="cb65-2033"><a href="#cb65-2033" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"   📐 Dimensions: {(santa_barbara_bbox[2] - santa_barbara_bbox[0]):.2f}° × {(santa_barbara_bbox[3] - santa_barbara_bbox[1]):.2f}°")</span></span>
<span id="cb65-2034"><a href="#cb65-2034" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"   📏 Approximate area: {area_km2:.0f} km²")</span></span>
<span id="cb65-2035"><a href="#cb65-2035" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"   🏙️ Population: ~450,000 (Santa Barbara County)")</span></span>
<span id="cb65-2036"><a href="#cb65-2036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2037"><a href="#cb65-2037" aria-hidden="true" tabindex="-1"></a><span class="st"># Provide alternative study areas for different research interests</span></span>
<span id="cb65-2038"><a href="#cb65-2038" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"\n🌐 Alternative AOI Options for Different Study Objectives:")</span></span>
<span id="cb65-2039"><a href="#cb65-2039" aria-hidden="true" tabindex="-1"></a><span class="st">alternative_aois = {</span></span>
<span id="cb65-2040"><a href="#cb65-2040" aria-hidden="true" tabindex="-1"></a><span class="st">    "San Francisco Bay Area": {</span></span>
<span id="cb65-2041"><a href="#cb65-2041" aria-hidden="true" tabindex="-1"></a><span class="st">        "bbox": [-122.5, 37.3, -121.8, 38.0],</span></span>
<span id="cb65-2042"><a href="#cb65-2042" aria-hidden="true" tabindex="-1"></a><span class="st">        "focus": "Urban growth, water dynamics, mixed land use",</span></span>
<span id="cb65-2043"><a href="#cb65-2043" aria-hidden="true" tabindex="-1"></a><span class="st">        "challenges": "Fog and cloud cover in summer"</span></span>
<span id="cb65-2044"><a href="#cb65-2044" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb65-2045"><a href="#cb65-2045" aria-hidden="true" tabindex="-1"></a><span class="st">    "Los Angeles Basin": {</span></span>
<span id="cb65-2046"><a href="#cb65-2046" aria-hidden="true" tabindex="-1"></a><span class="st">        "bbox": [-118.7, 33.7, -118.1, 34.3],</span></span>
<span id="cb65-2047"><a href="#cb65-2047" aria-hidden="true" tabindex="-1"></a><span class="st">        "focus": "Urban heat islands, air quality, sprawl patterns",</span></span>
<span id="cb65-2048"><a href="#cb65-2048" aria-hidden="true" tabindex="-1"></a><span class="st">        "challenges": "Frequent clouds, complex topography"</span></span>
<span id="cb65-2049"><a href="#cb65-2049" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb65-2050"><a href="#cb65-2050" aria-hidden="true" tabindex="-1"></a><span class="st">    "Central Valley Agriculture": {</span></span>
<span id="cb65-2051"><a href="#cb65-2051" aria-hidden="true" tabindex="-1"></a><span class="st">        "bbox": [-121.5, 36.0, -120.0, 37.5],</span></span>
<span id="cb65-2052"><a href="#cb65-2052" aria-hidden="true" tabindex="-1"></a><span class="st">        "focus": "Crop monitoring, irrigation patterns, drought",</span></span>
<span id="cb65-2053"><a href="#cb65-2053" aria-hidden="true" tabindex="-1"></a><span class="st">        "challenges": "Seasonal variations, haze"</span></span>
<span id="cb65-2054"><a href="#cb65-2054" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb65-2055"><a href="#cb65-2055" aria-hidden="true" tabindex="-1"></a><span class="st">    "Channel Islands": {</span></span>
<span id="cb65-2056"><a href="#cb65-2056" aria-hidden="true" tabindex="-1"></a><span class="st">        "bbox": [-120.5, 33.9, -119.0, 34.1],</span></span>
<span id="cb65-2057"><a href="#cb65-2057" aria-hidden="true" tabindex="-1"></a><span class="st">        "focus": "Island ecology, marine-terrestrial interface, conservation",</span></span>
<span id="cb65-2058"><a href="#cb65-2058" aria-hidden="true" tabindex="-1"></a><span class="st">        "challenges": "Marine layer, limited ground truth"</span></span>
<span id="cb65-2059"><a href="#cb65-2059" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb65-2060"><a href="#cb65-2060" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb65-2061"><a href="#cb65-2061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2062"><a href="#cb65-2062" aria-hidden="true" tabindex="-1"></a><span class="st">for region, info in alternative_aois.items():</span></span>
<span id="cb65-2063"><a href="#cb65-2063" aria-hidden="true" tabindex="-1"></a><span class="st">    bbox = info["bbox"]</span></span>
<span id="cb65-2064"><a href="#cb65-2064" aria-hidden="true" tabindex="-1"></a><span class="st">    area_alt = ((bbox[2] - bbox[0]) * (bbox[3] - bbox[1]) *</span></span>
<span id="cb65-2065"><a href="#cb65-2065" aria-hidden="true" tabindex="-1"></a><span class="st">                (111.32 ** 2) * np.cos(np.radians((bbox[1] + bbox[3]) / 2)))</span></span>
<span id="cb65-2066"><a href="#cb65-2066" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"   🗺️ {region}: {info['</span>bbox<span class="st">']} ({area_alt:.0f} km²)")</span></span>
<span id="cb65-2067"><a href="#cb65-2067" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"      🎯 Research focus: {info['</span>focus<span class="st">']}")</span></span>
<span id="cb65-2068"><a href="#cb65-2068" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"      ⚠️ Considerations: {info['</span>challenges<span class="st">']}")</span></span>
<span id="cb65-2069"><a href="#cb65-2069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2070"><a href="#cb65-2070" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"\n💡 Pro Tip: Choose AOI based on:")</span></span>
<span id="cb65-2071"><a href="#cb65-2071" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"   1. Research objectives and required spatial resolution")</span></span>
<span id="cb65-2072"><a href="#cb65-2072" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"   2. Data availability and typical cloud cover patterns")</span></span>
<span id="cb65-2073"><a href="#cb65-2073" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"   3. Computational resources and processing time constraints")</span></span>
<span id="cb65-2074"><a href="#cb65-2074" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"   4. Ecological or administrative boundary alignment")</span></span>
<span id="cb65-2075"><a href="#cb65-2075" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-2076"><a href="#cb65-2076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2077"><a href="#cb65-2077" aria-hidden="true" tabindex="-1"></a><span class="st">#### Interactive Mapping for Spatial Context and Validation</span></span>
<span id="cb65-2078"><a href="#cb65-2078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2079"><a href="#cb65-2079" aria-hidden="true" tabindex="-1"></a><span class="st">Creating interactive maps serves several important purposes in geospatial analysis, such as providing spatial context to understand the geographic setting and features, validating that the area of interest (AOI) encompasses the intended study features, supporting stakeholder communication through visual representation for project discussions, and enabling quality assurance by helping to detect coordinate errors or unrealistic extents.</span></span>
<span id="cb65-2080"><a href="#cb65-2080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2081"><a href="#cb65-2081" aria-hidden="true" tabindex="-1"></a><span class="st">**Creating Interactive Map for Spatial Context:**</span></span>
<span id="cb65-2082"><a href="#cb65-2082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2083"><a href="#cb65-2083" aria-hidden="true" tabindex="-1"></a><span class="st">This demonstrates best practices for geospatial visualization with multiple basemap options.</span></span>
<span id="cb65-2084"><a href="#cb65-2084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2087"><a href="#cb65-2087" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-2088"><a href="#cb65-2088" aria-hidden="true" tabindex="-1"></a><span class="st"># Step 3B: Create Interactive Map with Multiple Basemap Options</span></span>
<span id="cb65-2089"><a href="#cb65-2089" aria-hidden="true" tabindex="-1"></a><span class="st"># Calculate map center for optimal display</span></span>
<span id="cb65-2090"><a href="#cb65-2090" aria-hidden="true" tabindex="-1"></a><span class="st">center_lat = (santa_barbara_bbox[1] + santa_barbara_bbox[3]) / 2</span></span>
<span id="cb65-2091"><a href="#cb65-2091" aria-hidden="true" tabindex="-1"></a><span class="st">center_lon = (santa_barbara_bbox[0] + santa_barbara_bbox[2]) / 2</span></span>
<span id="cb65-2092"><a href="#cb65-2092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2093"><a href="#cb65-2093" aria-hidden="true" tabindex="-1"></a><span class="st"># Initialize folium map with appropriate zoom level</span></span>
<span id="cb65-2094"><a href="#cb65-2094" aria-hidden="true" tabindex="-1"></a><span class="st"># Zoom level chosen to show entire AOI while maintaining detail</span></span>
<span id="cb65-2095"><a href="#cb65-2095" aria-hidden="true" tabindex="-1"></a><span class="st">m = folium.Map(</span></span>
<span id="cb65-2096"><a href="#cb65-2096" aria-hidden="true" tabindex="-1"></a><span class="st">    location=[center_lat, center_lon],</span></span>
<span id="cb65-2097"><a href="#cb65-2097" aria-hidden="true" tabindex="-1"></a><span class="st">    zoom_start=9,  # Optimal for metropolitan area viewing</span></span>
<span id="cb65-2098"><a href="#cb65-2098" aria-hidden="true" tabindex="-1"></a><span class="st">    tiles='</span>OpenStreetMap<span class="st">'</span></span>
<span id="cb65-2099"><a href="#cb65-2099" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb65-2100"><a href="#cb65-2100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2101"><a href="#cb65-2101" aria-hidden="true" tabindex="-1"></a><span class="st"># Add diverse basemap options for different analysis contexts</span></span>
<span id="cb65-2102"><a href="#cb65-2102" aria-hidden="true" tabindex="-1"></a><span class="st">basemap_options = {</span></span>
<span id="cb65-2103"><a href="#cb65-2103" aria-hidden="true" tabindex="-1"></a><span class="st">    '</span>CartoDB positron<span class="st">': {</span></span>
<span id="cb65-2104"><a href="#cb65-2104" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>layer<span class="st">': folium.TileLayer('</span>CartoDB positron<span class="st">', name='</span>Clean Basemap<span class="st">'),</span></span>
<span id="cb65-2105"><a href="#cb65-2105" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>use_case<span class="st">': '</span>Data overlay visualization, presentations<span class="st">'</span></span>
<span id="cb65-2106"><a href="#cb65-2106" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb65-2107"><a href="#cb65-2107" aria-hidden="true" tabindex="-1"></a><span class="st">    '</span>CartoDB dark_matter<span class="st">': {</span></span>
<span id="cb65-2108"><a href="#cb65-2108" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>layer<span class="st">': folium.TileLayer('</span>CartoDB dark_matter<span class="st">', name='</span>Dark Theme<span class="st">'),</span></span>
<span id="cb65-2109"><a href="#cb65-2109" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>use_case<span class="st">': '</span>Night mode, reducing eye strain<span class="st">'</span></span>
<span id="cb65-2110"><a href="#cb65-2110" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb65-2111"><a href="#cb65-2111" aria-hidden="true" tabindex="-1"></a><span class="st">    '</span>Esri World Imagery<span class="st">': {</span></span>
<span id="cb65-2112"><a href="#cb65-2112" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>layer<span class="st">': folium.TileLayer(</span></span>
<span id="cb65-2113"><a href="#cb65-2113" aria-hidden="true" tabindex="-1"></a><span class="st">            tiles='</span>https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}<span class="st">',</span></span>
<span id="cb65-2114"><a href="#cb65-2114" aria-hidden="true" tabindex="-1"></a><span class="st">            attr='</span>Esri<span class="st">', name='</span>Satellite Imagery<span class="st">', overlay=False, control=True</span></span>
<span id="cb65-2115"><a href="#cb65-2115" aria-hidden="true" tabindex="-1"></a><span class="st">        ),</span></span>
<span id="cb65-2116"><a href="#cb65-2116" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>use_case<span class="st">': '</span>Ground truth validation, visual interpretation<span class="st">'</span></span>
<span id="cb65-2117"><a href="#cb65-2117" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb65-2118"><a href="#cb65-2118" aria-hidden="true" tabindex="-1"></a><span class="st">    '</span>OpenTopoMap<span class="st">': {</span></span>
<span id="cb65-2119"><a href="#cb65-2119" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>layer<span class="st">': folium.TileLayer(</span></span>
<span id="cb65-2120"><a href="#cb65-2120" aria-hidden="true" tabindex="-1"></a><span class="st">            tiles='</span>https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png<span class="st">',</span></span>
<span id="cb65-2121"><a href="#cb65-2121" aria-hidden="true" tabindex="-1"></a><span class="st">            name='</span>Topographic <span class="er">(</span><span class="ex">OpenTopoMap</span><span class="kw">)</span><span class="st">',</span></span>
<span id="cb65-2122"><a href="#cb65-2122" aria-hidden="true" tabindex="-1"></a><span class="st">            attr='</span><span class="ex">Map</span> data: © OpenStreetMap contributors, SRTM <span class="kw">|</span> <span class="ex">Map</span> style: © OpenTopoMap <span class="er">(</span><span class="ex">CC-BY-SA</span><span class="kw">)</span><span class="st">',</span></span>
<span id="cb65-2123"><a href="#cb65-2123" aria-hidden="true" tabindex="-1"></a><span class="st">            overlay=False,</span></span>
<span id="cb65-2124"><a href="#cb65-2124" aria-hidden="true" tabindex="-1"></a><span class="st">            control=True</span></span>
<span id="cb65-2125"><a href="#cb65-2125" aria-hidden="true" tabindex="-1"></a><span class="st">        ),</span></span>
<span id="cb65-2126"><a href="#cb65-2126" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span><span class="ex">use_case</span><span class="st">': '</span><span class="ex">Elevation</span> context, watershed analysis<span class="st">'</span></span>
<span id="cb65-2127"><a href="#cb65-2127" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb65-2128"><a href="#cb65-2128" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb65-2129"><a href="#cb65-2129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2130"><a href="#cb65-2130" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"   📚 Adding {len(basemap_options)} basemap options:")</span></span>
<span id="cb65-2131"><a href="#cb65-2131" aria-hidden="true" tabindex="-1"></a><span class="st">for name, info in basemap_options.items():</span></span>
<span id="cb65-2132"><a href="#cb65-2132" aria-hidden="true" tabindex="-1"></a><span class="st">    info['</span>layer<span class="st">'].add_to(m)</span></span>
<span id="cb65-2133"><a href="#cb65-2133" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"     • {name}: {info['</span>use_case<span class="st">']}")</span></span>
<span id="cb65-2134"><a href="#cb65-2134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2135"><a href="#cb65-2135" aria-hidden="true" tabindex="-1"></a><span class="st"># Add AOI boundary with informative styling</span></span>
<span id="cb65-2136"><a href="#cb65-2136" aria-hidden="true" tabindex="-1"></a><span class="st">aoi_bounds = [[santa_barbara_bbox[1], santa_barbara_bbox[0]],  # southwest corner</span></span>
<span id="cb65-2137"><a href="#cb65-2137" aria-hidden="true" tabindex="-1"></a><span class="st">              [santa_barbara_bbox[3], santa_barbara_bbox[2]]]  # northeast corner</span></span>
<span id="cb65-2138"><a href="#cb65-2138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2139"><a href="#cb65-2139" aria-hidden="true" tabindex="-1"></a><span class="st">folium.Rectangle(</span></span>
<span id="cb65-2140"><a href="#cb65-2140" aria-hidden="true" tabindex="-1"></a><span class="st">    bounds=aoi_bounds,</span></span>
<span id="cb65-2141"><a href="#cb65-2141" aria-hidden="true" tabindex="-1"></a><span class="st">    color='</span>red<span class="st">',</span></span>
<span id="cb65-2142"><a href="#cb65-2142" aria-hidden="true" tabindex="-1"></a><span class="st">    weight=3,</span></span>
<span id="cb65-2143"><a href="#cb65-2143" aria-hidden="true" tabindex="-1"></a><span class="st">    fill=True,</span></span>
<span id="cb65-2144"><a href="#cb65-2144" aria-hidden="true" tabindex="-1"></a><span class="st">    fillOpacity=0.1,</span></span>
<span id="cb65-2145"><a href="#cb65-2145" aria-hidden="true" tabindex="-1"></a><span class="st">    popup=folium.Popup(</span></span>
<span id="cb65-2146"><a href="#cb65-2146" aria-hidden="true" tabindex="-1"></a><span class="st">        f"""</span></span>
<span id="cb65-2147"><a href="#cb65-2147" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div style="font-family: Arial; width: 300px;"&gt;</span></span>
<span id="cb65-2148"><a href="#cb65-2148" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;h4&gt;📊 Study Area Details&lt;/h4&gt;</span></span>
<span id="cb65-2149"><a href="#cb65-2149" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;b&gt;Region:&lt;/b&gt; Santa Barbara County Coastal Region&lt;br&gt;</span></span>
<span id="cb65-2150"><a href="#cb65-2150" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;b&gt;Coordinates:&lt;/b&gt; {santa_barbara_bbox}&lt;br&gt;</span></span>
<span id="cb65-2151"><a href="#cb65-2151" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;b&gt;Area:&lt;/b&gt; {area_km2:.0f} km²&lt;br&gt;</span></span>
<span id="cb65-2152"><a href="#cb65-2152" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;b&gt;Purpose:&lt;/b&gt; Geospatial AI Training&lt;br&gt;</span></span>
<span id="cb65-2153"><a href="#cb65-2153" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;b&gt;Data Type:&lt;/b&gt; Sentinel-2 Optical&lt;br&gt;</span></span>
<span id="cb65-2154"><a href="#cb65-2154" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb65-2155"><a href="#cb65-2155" aria-hidden="true" tabindex="-1"></a><span class="st">        """,</span></span>
<span id="cb65-2156"><a href="#cb65-2156" aria-hidden="true" tabindex="-1"></a><span class="st">        max_width=350</span></span>
<span id="cb65-2157"><a href="#cb65-2157" aria-hidden="true" tabindex="-1"></a><span class="st">    ),</span></span>
<span id="cb65-2158"><a href="#cb65-2158" aria-hidden="true" tabindex="-1"></a><span class="st">    tooltip="Study Area Boundary - Click for details"</span></span>
<span id="cb65-2159"><a href="#cb65-2159" aria-hidden="true" tabindex="-1"></a><span class="st">).add_to(m)</span></span>
<span id="cb65-2160"><a href="#cb65-2160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2161"><a href="#cb65-2161" aria-hidden="true" tabindex="-1"></a><span class="st"># Add geographic reference points with contextual information</span></span>
<span id="cb65-2162"><a href="#cb65-2162" aria-hidden="true" tabindex="-1"></a><span class="st">reference_locations = [</span></span>
<span id="cb65-2163"><a href="#cb65-2163" aria-hidden="true" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb65-2164"><a href="#cb65-2164" aria-hidden="true" tabindex="-1"></a><span class="st">        "name": "Santa Barbara",</span></span>
<span id="cb65-2165"><a href="#cb65-2165" aria-hidden="true" tabindex="-1"></a><span class="st">        "coords": [34.4208, -119.6982],</span></span>
<span id="cb65-2166"><a href="#cb65-2166" aria-hidden="true" tabindex="-1"></a><span class="st">        "description": "Coastal city, urban-wildland interface",</span></span>
<span id="cb65-2167"><a href="#cb65-2167" aria-hidden="true" tabindex="-1"></a><span class="st">        "icon": "building",</span></span>
<span id="cb65-2168"><a href="#cb65-2168" aria-hidden="true" tabindex="-1"></a><span class="st">        "color": "blue"</span></span>
<span id="cb65-2169"><a href="#cb65-2169" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb65-2170"><a href="#cb65-2170" aria-hidden="true" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb65-2171"><a href="#cb65-2171" aria-hidden="true" tabindex="-1"></a><span class="st">        "name": "UCSB",</span></span>
<span id="cb65-2172"><a href="#cb65-2172" aria-hidden="true" tabindex="-1"></a><span class="st">        "coords": [34.4140, -119.8489],</span></span>
<span id="cb65-2173"><a href="#cb65-2173" aria-hidden="true" tabindex="-1"></a><span class="st">        "description": "University campus, research facilities",</span></span>
<span id="cb65-2174"><a href="#cb65-2174" aria-hidden="true" tabindex="-1"></a><span class="st">        "icon": "graduation-cap",</span></span>
<span id="cb65-2175"><a href="#cb65-2175" aria-hidden="true" tabindex="-1"></a><span class="st">        "color": "green"</span></span>
<span id="cb65-2176"><a href="#cb65-2176" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb65-2177"><a href="#cb65-2177" aria-hidden="true" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb65-2178"><a href="#cb65-2178" aria-hidden="true" tabindex="-1"></a><span class="st">        "name": "Goleta",</span></span>
<span id="cb65-2179"><a href="#cb65-2179" aria-hidden="true" tabindex="-1"></a><span class="st">        "coords": [34.4358, -119.8276],</span></span>
<span id="cb65-2180"><a href="#cb65-2180" aria-hidden="true" tabindex="-1"></a><span class="st">        "description": "Tech corridor, agricultural transition zone",</span></span>
<span id="cb65-2181"><a href="#cb65-2181" aria-hidden="true" tabindex="-1"></a><span class="st">        "icon": "microchip",</span></span>
<span id="cb65-2182"><a href="#cb65-2182" aria-hidden="true" tabindex="-1"></a><span class="st">        "color": "purple"</span></span>
<span id="cb65-2183"><a href="#cb65-2183" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb65-2184"><a href="#cb65-2184" aria-hidden="true" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb65-2185"><a href="#cb65-2185" aria-hidden="true" tabindex="-1"></a><span class="st">        "name": "Montecito",</span></span>
<span id="cb65-2186"><a href="#cb65-2186" aria-hidden="true" tabindex="-1"></a><span class="st">        "coords": [34.4358, -119.6376],</span></span>
<span id="cb65-2187"><a href="#cb65-2187" aria-hidden="true" tabindex="-1"></a><span class="st">        "description": "Wildfire-prone, high-value urban area",</span></span>
<span id="cb65-2188"><a href="#cb65-2188" aria-hidden="true" tabindex="-1"></a><span class="st">        "icon": "fire",</span></span>
<span id="cb65-2189"><a href="#cb65-2189" aria-hidden="true" tabindex="-1"></a><span class="st">        "color": "red"</span></span>
<span id="cb65-2190"><a href="#cb65-2190" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb65-2191"><a href="#cb65-2191" aria-hidden="true" tabindex="-1"></a><span class="st">]</span></span>
<span id="cb65-2192"><a href="#cb65-2192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2193"><a href="#cb65-2193" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"Adding {len(reference_locations)} geographic reference points")</span></span>
<span id="cb65-2194"><a href="#cb65-2194" aria-hidden="true" tabindex="-1"></a><span class="st">for location in reference_locations:</span></span>
<span id="cb65-2195"><a href="#cb65-2195" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.debug(f"{location['</span>name<span class="st">']}: {location['</span>description<span class="st">']}")</span></span>
<span id="cb65-2196"><a href="#cb65-2196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2197"><a href="#cb65-2197" aria-hidden="true" tabindex="-1"></a><span class="st">    folium.Marker(</span></span>
<span id="cb65-2198"><a href="#cb65-2198" aria-hidden="true" tabindex="-1"></a><span class="st">        location=location["coords"],</span></span>
<span id="cb65-2199"><a href="#cb65-2199" aria-hidden="true" tabindex="-1"></a><span class="st">        popup=folium.Popup(</span></span>
<span id="cb65-2200"><a href="#cb65-2200" aria-hidden="true" tabindex="-1"></a><span class="st">            f"""</span></span>
<span id="cb65-2201"><a href="#cb65-2201" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;div style="font-family: Arial;"&gt;</span></span>
<span id="cb65-2202"><a href="#cb65-2202" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;h4&gt;{location['</span>name<span class="st">']}&lt;/h4&gt;</span></span>
<span id="cb65-2203"><a href="#cb65-2203" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;b&gt;Coordinates:&lt;/b&gt; {location['</span>coords<span class="st">'][0]:.4f}, {location['</span>coords<span class="st">'][1]:.4f}&lt;br&gt;</span></span>
<span id="cb65-2204"><a href="#cb65-2204" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;b&gt;Context:&lt;/b&gt; {location['</span>description<span class="st">']}&lt;br&gt;</span></span>
<span id="cb65-2205"><a href="#cb65-2205" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;b&gt;Role in Analysis:&lt;/b&gt; Geographic reference point</span></span>
<span id="cb65-2206"><a href="#cb65-2206" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;/div&gt;</span></span>
<span id="cb65-2207"><a href="#cb65-2207" aria-hidden="true" tabindex="-1"></a><span class="st">            """,</span></span>
<span id="cb65-2208"><a href="#cb65-2208" aria-hidden="true" tabindex="-1"></a><span class="st">            max_width=250</span></span>
<span id="cb65-2209"><a href="#cb65-2209" aria-hidden="true" tabindex="-1"></a><span class="st">        ),</span></span>
<span id="cb65-2210"><a href="#cb65-2210" aria-hidden="true" tabindex="-1"></a><span class="st">        tooltip=f"{location['</span>name<span class="st">']} - {location['</span>description<span class="st">']}",</span></span>
<span id="cb65-2211"><a href="#cb65-2211" aria-hidden="true" tabindex="-1"></a><span class="st">        icon=folium.Icon(</span></span>
<span id="cb65-2212"><a href="#cb65-2212" aria-hidden="true" tabindex="-1"></a><span class="st">            color=location['</span>color<span class="st">'],</span></span>
<span id="cb65-2213"><a href="#cb65-2213" aria-hidden="true" tabindex="-1"></a><span class="st">            icon=location['</span>icon<span class="st">'],</span></span>
<span id="cb65-2214"><a href="#cb65-2214" aria-hidden="true" tabindex="-1"></a><span class="st">            prefix='</span>fa<span class="st">'</span></span>
<span id="cb65-2215"><a href="#cb65-2215" aria-hidden="true" tabindex="-1"></a><span class="st">        )</span></span>
<span id="cb65-2216"><a href="#cb65-2216" aria-hidden="true" tabindex="-1"></a><span class="st">    ).add_to(m)</span></span>
<span id="cb65-2217"><a href="#cb65-2217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2218"><a href="#cb65-2218" aria-hidden="true" tabindex="-1"></a><span class="st"># Add measurement and interaction tools for analysis</span></span>
<span id="cb65-2219"><a href="#cb65-2219" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info("Adding interactive analysis tools")</span></span>
<span id="cb65-2220"><a href="#cb65-2220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2221"><a href="#cb65-2221" aria-hidden="true" tabindex="-1"></a><span class="st"># Measurement tool for distance/area calculations</span></span>
<span id="cb65-2222"><a href="#cb65-2222" aria-hidden="true" tabindex="-1"></a><span class="st">from folium.plugins import MeasureControl</span></span>
<span id="cb65-2223"><a href="#cb65-2223" aria-hidden="true" tabindex="-1"></a><span class="st">measure_control = MeasureControl(</span></span>
<span id="cb65-2224"><a href="#cb65-2224" aria-hidden="true" tabindex="-1"></a><span class="st">    primary_length_unit='</span>kilometers<span class="st">',</span></span>
<span id="cb65-2225"><a href="#cb65-2225" aria-hidden="true" tabindex="-1"></a><span class="st">    primary_area_unit='</span>sqkilometers<span class="st">',</span></span>
<span id="cb65-2226"><a href="#cb65-2226" aria-hidden="true" tabindex="-1"></a><span class="st">    secondary_length_unit='</span>miles<span class="st">',</span></span>
<span id="cb65-2227"><a href="#cb65-2227" aria-hidden="true" tabindex="-1"></a><span class="st">    secondary_area_unit='</span>sqmiles<span class="st">'</span></span>
<span id="cb65-2228"><a href="#cb65-2228" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb65-2229"><a href="#cb65-2229" aria-hidden="true" tabindex="-1"></a><span class="st">m.add_child(measure_control)</span></span>
<span id="cb65-2230"><a href="#cb65-2230" aria-hidden="true" tabindex="-1"></a><span class="st">logger.debug("Added measurement tool for distance/area calculations")</span></span>
<span id="cb65-2231"><a href="#cb65-2231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2232"><a href="#cb65-2232" aria-hidden="true" tabindex="-1"></a><span class="st"># Fullscreen capability for detailed examination</span></span>
<span id="cb65-2233"><a href="#cb65-2233" aria-hidden="true" tabindex="-1"></a><span class="st">from folium.plugins import Fullscreen</span></span>
<span id="cb65-2234"><a href="#cb65-2234" aria-hidden="true" tabindex="-1"></a><span class="st">Fullscreen(</span></span>
<span id="cb65-2235"><a href="#cb65-2235" aria-hidden="true" tabindex="-1"></a><span class="st">    position='</span>topright<span class="st">',</span></span>
<span id="cb65-2236"><a href="#cb65-2236" aria-hidden="true" tabindex="-1"></a><span class="st">    title='</span>Full Screen Mode<span class="st">',</span></span>
<span id="cb65-2237"><a href="#cb65-2237" aria-hidden="true" tabindex="-1"></a><span class="st">    title_cancel='</span>Exit Full Screen<span class="st">',</span></span>
<span id="cb65-2238"><a href="#cb65-2238" aria-hidden="true" tabindex="-1"></a><span class="st">    force_separate_button=True</span></span>
<span id="cb65-2239"><a href="#cb65-2239" aria-hidden="true" tabindex="-1"></a><span class="st">).add_to(m)</span></span>
<span id="cb65-2240"><a href="#cb65-2240" aria-hidden="true" tabindex="-1"></a><span class="st">logger.debug("Added fullscreen mode capability")</span></span>
<span id="cb65-2241"><a href="#cb65-2241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2242"><a href="#cb65-2242" aria-hidden="true" tabindex="-1"></a><span class="st"># Layer control for basemap switching</span></span>
<span id="cb65-2243"><a href="#cb65-2243" aria-hidden="true" tabindex="-1"></a><span class="st">layer_control = folium.LayerControl(</span></span>
<span id="cb65-2244"><a href="#cb65-2244" aria-hidden="true" tabindex="-1"></a><span class="st">    position='</span>topright<span class="st">',</span></span>
<span id="cb65-2245"><a href="#cb65-2245" aria-hidden="true" tabindex="-1"></a><span class="st">    collapsed=False</span></span>
<span id="cb65-2246"><a href="#cb65-2246" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb65-2247"><a href="#cb65-2247" aria-hidden="true" tabindex="-1"></a><span class="st">layer_control.add_to(m)</span></span>
<span id="cb65-2248"><a href="#cb65-2248" aria-hidden="true" tabindex="-1"></a><span class="st">logger.debug("Added layer control for basemap switching")</span></span>
<span id="cb65-2249"><a href="#cb65-2249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2250"><a href="#cb65-2250" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info("Interactive map created with comprehensive spatial context")</span></span>
<span id="cb65-2251"><a href="#cb65-2251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2252"><a href="#cb65-2252" aria-hidden="true" tabindex="-1"></a><span class="st"># Display the map</span></span>
<span id="cb65-2253"><a href="#cb65-2253" aria-hidden="true" tabindex="-1"></a><span class="st">m</span></span>
<span id="cb65-2254"><a href="#cb65-2254" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-2255"><a href="#cb65-2255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2256"><a href="#cb65-2256" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-note} </span></span>
<span id="cb65-2257"><a href="#cb65-2257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2258"><a href="#cb65-2258" aria-hidden="true" tabindex="-1"></a><span class="st">#### AOI Design Best Practices</span></span>
<span id="cb65-2259"><a href="#cb65-2259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2260"><a href="#cb65-2260" aria-hidden="true" tabindex="-1"></a><span class="st">**Size Considerations:**  </span></span>
<span id="cb65-2261"><a href="#cb65-2261" aria-hidden="true" tabindex="-1"></a><span class="st">When defining your Area of Interest (AOI), consider that an area too small may miss important spatial patterns or edge effects, while an area too large can increase processing time and may include irrelevant regions. Aim for a balance that ensures computational efficiency without sacrificing analytical completeness.</span></span>
<span id="cb65-2262"><a href="#cb65-2262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2263"><a href="#cb65-2263" aria-hidden="true" tabindex="-1"></a><span class="st">**Boundary Alignment:**  </span></span>
<span id="cb65-2264"><a href="#cb65-2264" aria-hidden="true" tabindex="-1"></a><span class="st">AOI boundaries can be aligned with ecological features such as watersheds, ecoregions, or habitat boundaries; with administrative units like counties, states, or protected areas; or with sensor-based divisions such as satellite tile boundaries and processing units. Choose the alignment that best fits your study objectives.</span></span>
<span id="cb65-2265"><a href="#cb65-2265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2266"><a href="#cb65-2266" aria-hidden="true" tabindex="-1"></a><span class="st">**Temporal Considerations:**  </span></span>
<span id="cb65-2267"><a href="#cb65-2267" aria-hidden="true" tabindex="-1"></a><span class="st">Ensure your AOI captures relevant seasonal dynamics and accounts for both historical and projected changes in the study area. Also, verify that data coverage is consistent across your intended temporal study period.</span></span>
<span id="cb65-2268"><a href="#cb65-2268" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-2269"><a href="#cb65-2269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2270"><a href="#cb65-2270" aria-hidden="true" tabindex="-1"></a><span class="st">### Validating Your AOI Selection</span></span>
<span id="cb65-2271"><a href="#cb65-2271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2272"><a href="#cb65-2272" aria-hidden="true" tabindex="-1"></a><span class="st">Before proceeding with data acquisition, confirm that your AOI is well-matched to your analysis objectives.</span></span>
<span id="cb65-2273"><a href="#cb65-2273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2274"><a href="#cb65-2274" aria-hidden="true" tabindex="-1"></a><span class="st">## 5. Intelligent Satellite Scene Discovery and Selection</span></span>
<span id="cb65-2275"><a href="#cb65-2275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2276"><a href="#cb65-2276" aria-hidden="true" tabindex="-1"></a><span class="st">### 5.1 Intelligent Satellite Scene Discovery</span></span>
<span id="cb65-2277"><a href="#cb65-2277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2278"><a href="#cb65-2278" aria-hidden="true" tabindex="-1"></a><span class="st">Selecting appropriate satellite imagery is a multi-faceted challenge that requires balancing several key factors: temporal coverage (recent vs. historical data), data quality (cloud cover, sensor conditions, processing artifacts), spatial coverage (ensuring your AOI is fully captured), and the processing level of the data (raw vs. analysis-ready products). Relying on a single search strategy often leads to missed opportunities or suboptimal results, especially when data availability is limited by weather or acquisition schedules.</span></span>
<span id="cb65-2279"><a href="#cb65-2279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2280"><a href="#cb65-2280" aria-hidden="true" tabindex="-1"></a><span class="st">To address these challenges, a robust approach involves designing and implementing multi-strategy search patterns. This means systematically applying a sequence of search strategies, each with progressively relaxed criteria—such as expanding the temporal window or increasing the allowable cloud cover. By doing so, you maximize the chances of finding suitable imagery while still prioritizing the highest quality data available. This method is widely used in operational geospatial systems to ensure reliable and efficient satellite scene discovery, even under less-than-ideal conditions.</span></span>
<span id="cb65-2281"><a href="#cb65-2281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2282"><a href="#cb65-2282" aria-hidden="true" tabindex="-1"></a><span class="st">By the end of this section, you will be able to design robust, multi-strategy search workflows for satellite data discovery, understand how quality filters and temporal windows affect data availability, implement fallback mechanisms to guarantee reliable data access, and evaluate scene metadata to select the most appropriate imagery for your analysis.</span></span>
<span id="cb65-2283"><a href="#cb65-2283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2286"><a href="#cb65-2286" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-2287"><a href="#cb65-2287" aria-hidden="true" tabindex="-1"></a><span class="st"># Step 4A: Implement Robust Multi-Strategy Scene Discovery</span></span>
<span id="cb65-2288"><a href="#cb65-2288" aria-hidden="true" tabindex="-1"></a><span class="st">from datetime import datetime, timedelta</span></span>
<span id="cb65-2289"><a href="#cb65-2289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2290"><a href="#cb65-2290" aria-hidden="true" tabindex="-1"></a><span class="st"># Strategy 1: Dynamic temporal window based on current date</span></span>
<span id="cb65-2291"><a href="#cb65-2291" aria-hidden="true" tabindex="-1"></a><span class="st">current_date = datetime.now()</span></span>
<span id="cb65-2292"><a href="#cb65-2292" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"Calculating optimal temporal search windows (current date: {current_date.strftime('</span>%Y-%m-%d<span class="st">')})")</span></span>
<span id="cb65-2293"><a href="#cb65-2293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2294"><a href="#cb65-2294" aria-hidden="true" tabindex="-1"></a><span class="st"># Define multiple search strategies with different trade-offs</span></span>
<span id="cb65-2295"><a href="#cb65-2295" aria-hidden="true" tabindex="-1"></a><span class="st"># Each strategy balances data quality against data availability</span></span>
<span id="cb65-2296"><a href="#cb65-2296" aria-hidden="true" tabindex="-1"></a><span class="st">search_strategies = [</span></span>
<span id="cb65-2297"><a href="#cb65-2297" aria-hidden="true" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb65-2298"><a href="#cb65-2298" aria-hidden="true" tabindex="-1"></a><span class="st">        "name": "Optimal Quality",</span></span>
<span id="cb65-2299"><a href="#cb65-2299" aria-hidden="true" tabindex="-1"></a><span class="st">        "date_range": "2024-06-01/2024-09-30",</span></span>
<span id="cb65-2300"><a href="#cb65-2300" aria-hidden="true" tabindex="-1"></a><span class="st">        "cloud_max": 20,</span></span>
<span id="cb65-2301"><a href="#cb65-2301" aria-hidden="true" tabindex="-1"></a><span class="st">        "description": "Recent summer data with excellent atmospheric conditions",</span></span>
<span id="cb65-2302"><a href="#cb65-2302" aria-hidden="true" tabindex="-1"></a><span class="st">        "priority": "Best for analysis quality",</span></span>
<span id="cb65-2303"><a href="#cb65-2303" aria-hidden="true" tabindex="-1"></a><span class="st">        "trade_offs": "May have limited availability"</span></span>
<span id="cb65-2304"><a href="#cb65-2304" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb65-2305"><a href="#cb65-2305" aria-hidden="true" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb65-2306"><a href="#cb65-2306" aria-hidden="true" tabindex="-1"></a><span class="st">        "name": "Good Quality",</span></span>
<span id="cb65-2307"><a href="#cb65-2307" aria-hidden="true" tabindex="-1"></a><span class="st">        "date_range": "2024-03-01/2024-08-31",</span></span>
<span id="cb65-2308"><a href="#cb65-2308" aria-hidden="true" tabindex="-1"></a><span class="st">        "cloud_max": 35,</span></span>
<span id="cb65-2309"><a href="#cb65-2309" aria-hidden="true" tabindex="-1"></a><span class="st">        "description": "Extended seasonal window with good conditions",</span></span>
<span id="cb65-2310"><a href="#cb65-2310" aria-hidden="true" tabindex="-1"></a><span class="st">        "priority": "Balance of quality and availability",</span></span>
<span id="cb65-2311"><a href="#cb65-2311" aria-hidden="true" tabindex="-1"></a><span class="st">        "trade_offs": "Some atmospheric interference"</span></span>
<span id="cb65-2312"><a href="#cb65-2312" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb65-2313"><a href="#cb65-2313" aria-hidden="true" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb65-2314"><a href="#cb65-2314" aria-hidden="true" tabindex="-1"></a><span class="st">        "name": "Acceptable Quality",</span></span>
<span id="cb65-2315"><a href="#cb65-2315" aria-hidden="true" tabindex="-1"></a><span class="st">        "date_range": "2023-09-01/2024-11-30",</span></span>
<span id="cb65-2316"><a href="#cb65-2316" aria-hidden="true" tabindex="-1"></a><span class="st">        "cloud_max": 50,</span></span>
<span id="cb65-2317"><a href="#cb65-2317" aria-hidden="true" tabindex="-1"></a><span class="st">        "description": "Broader temporal and quality window",</span></span>
<span id="cb65-2318"><a href="#cb65-2318" aria-hidden="true" tabindex="-1"></a><span class="st">        "priority": "Reliable data availability",</span></span>
<span id="cb65-2319"><a href="#cb65-2319" aria-hidden="true" tabindex="-1"></a><span class="st">        "trade_offs": "May require additional preprocessing"</span></span>
<span id="cb65-2320"><a href="#cb65-2320" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb65-2321"><a href="#cb65-2321" aria-hidden="true" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb65-2322"><a href="#cb65-2322" aria-hidden="true" tabindex="-1"></a><span class="st">        "name": "Fallback Option",</span></span>
<span id="cb65-2323"><a href="#cb65-2323" aria-hidden="true" tabindex="-1"></a><span class="st">        "date_range": "2023-01-01/2024-12-31",</span></span>
<span id="cb65-2324"><a href="#cb65-2324" aria-hidden="true" tabindex="-1"></a><span class="st">        "cloud_max": 75,</span></span>
<span id="cb65-2325"><a href="#cb65-2325" aria-hidden="true" tabindex="-1"></a><span class="st">        "description": "Maximum temporal window, relaxed quality constraints",</span></span>
<span id="cb65-2326"><a href="#cb65-2326" aria-hidden="true" tabindex="-1"></a><span class="st">        "priority": "Guaranteed data access",</span></span>
<span id="cb65-2327"><a href="#cb65-2327" aria-hidden="true" tabindex="-1"></a><span class="st">        "trade_offs": "Significant cloud contamination possible"</span></span>
<span id="cb65-2328"><a href="#cb65-2328" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb65-2329"><a href="#cb65-2329" aria-hidden="true" tabindex="-1"></a><span class="st">]</span></span>
<span id="cb65-2330"><a href="#cb65-2330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2331"><a href="#cb65-2331" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"Defined {len(search_strategies)} search strategies")</span></span>
<span id="cb65-2332"><a href="#cb65-2332" aria-hidden="true" tabindex="-1"></a><span class="st">for i, strategy in enumerate(search_strategies, 1):</span></span>
<span id="cb65-2333"><a href="#cb65-2333" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.debug(f"Strategy {i}: {strategy['</span>name<span class="st">']} - {strategy['</span>description<span class="st">']}")</span></span>
<span id="cb65-2334"><a href="#cb65-2334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2335"><a href="#cb65-2335" aria-hidden="true" tabindex="-1"></a><span class="st"># Execute search strategies in order of preference</span></span>
<span id="cb65-2336"><a href="#cb65-2336" aria-hidden="true" tabindex="-1"></a><span class="st">scenes = []</span></span>
<span id="cb65-2337"><a href="#cb65-2337" aria-hidden="true" tabindex="-1"></a><span class="st">successful_strategy = None</span></span>
<span id="cb65-2338"><a href="#cb65-2338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2339"><a href="#cb65-2339" aria-hidden="true" tabindex="-1"></a><span class="st">for i, strategy in enumerate(search_strategies, 1):</span></span>
<span id="cb65-2340"><a href="#cb65-2340" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"Executing Strategy {i}: {strategy['</span>name<span class="st">']} (dates: {strategy['</span>date_range<span class="st">']}, cloud &lt; {strategy['</span>cloud_max<span class="st">']}%)")</span></span>
<span id="cb65-2341"><a href="#cb65-2341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2342"><a href="#cb65-2342" aria-hidden="true" tabindex="-1"></a><span class="st">    try:</span></span>
<span id="cb65-2343"><a href="#cb65-2343" aria-hidden="true" tabindex="-1"></a><span class="st">        # Use our optimized search function with current strategy parameters</span></span>
<span id="cb65-2344"><a href="#cb65-2344" aria-hidden="true" tabindex="-1"></a><span class="st">        temp_scenes = search_sentinel2_scenes(</span></span>
<span id="cb65-2345"><a href="#cb65-2345" aria-hidden="true" tabindex="-1"></a><span class="st">            bbox=santa_barbara_bbox,</span></span>
<span id="cb65-2346"><a href="#cb65-2346" aria-hidden="true" tabindex="-1"></a><span class="st">            date_range=strategy["date_range"],</span></span>
<span id="cb65-2347"><a href="#cb65-2347" aria-hidden="true" tabindex="-1"></a><span class="st">            cloud_cover_max=strategy["cloud_max"],</span></span>
<span id="cb65-2348"><a href="#cb65-2348" aria-hidden="true" tabindex="-1"></a><span class="st">            limit=100  # Generous limit for selection flexibility</span></span>
<span id="cb65-2349"><a href="#cb65-2349" aria-hidden="true" tabindex="-1"></a><span class="st">        )</span></span>
<span id="cb65-2350"><a href="#cb65-2350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2351"><a href="#cb65-2351" aria-hidden="true" tabindex="-1"></a><span class="st">        if temp_scenes:</span></span>
<span id="cb65-2352"><a href="#cb65-2352" aria-hidden="true" tabindex="-1"></a><span class="st">            scenes = temp_scenes</span></span>
<span id="cb65-2353"><a href="#cb65-2353" aria-hidden="true" tabindex="-1"></a><span class="st">            successful_strategy = strategy</span></span>
<span id="cb65-2354"><a href="#cb65-2354" aria-hidden="true" tabindex="-1"></a><span class="st">            logger.info(f"SUCCESS! Found {len(scenes)} qualifying scenes with {strategy['</span>name<span class="st">']} strategy")</span></span>
<span id="cb65-2355"><a href="#cb65-2355" aria-hidden="true" tabindex="-1"></a><span class="st">            break</span></span>
<span id="cb65-2356"><a href="#cb65-2356" aria-hidden="true" tabindex="-1"></a><span class="st">        else:</span></span>
<span id="cb65-2357"><a href="#cb65-2357" aria-hidden="true" tabindex="-1"></a><span class="st">            logger.warning(f"No scenes found with {strategy['</span>name<span class="st">']} strategy, proceeding to next")</span></span>
<span id="cb65-2358"><a href="#cb65-2358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2359"><a href="#cb65-2359" aria-hidden="true" tabindex="-1"></a><span class="st">    except Exception as e:</span></span>
<span id="cb65-2360"><a href="#cb65-2360" aria-hidden="true" tabindex="-1"></a><span class="st">        logger.warning(f"Search execution failed for {strategy['</span>name<span class="st">']}: {str(e)[:80]}")</span></span>
<span id="cb65-2361"><a href="#cb65-2361" aria-hidden="true" tabindex="-1"></a><span class="st">        continue</span></span>
<span id="cb65-2362"><a href="#cb65-2362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2363"><a href="#cb65-2363" aria-hidden="true" tabindex="-1"></a><span class="st"># Validate search results and provide detailed feedback</span></span>
<span id="cb65-2364"><a href="#cb65-2364" aria-hidden="true" tabindex="-1"></a><span class="st">if not scenes:</span></span>
<span id="cb65-2365"><a href="#cb65-2365" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.error(f"Scene discovery failed after trying all {len(search_strategies)} strategies")</span></span>
<span id="cb65-2366"><a href="#cb65-2366" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info("Diagnostic steps: 1) Check network connectivity, 2) Verify API status, 3) Confirm AOI coverage, 4) Try broader date ranges, 5) Check authentication")</span></span>
<span id="cb65-2367"><a href="#cb65-2367" aria-hidden="true" tabindex="-1"></a><span class="st">    raise Exception("Critical failure in scene discovery. Review diagnostic steps and retry.")</span></span>
<span id="cb65-2368"><a href="#cb65-2368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2369"><a href="#cb65-2369" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"Scene discovery completed: {successful_strategy['</span>name<span class="st">']} strategy found {len(scenes)} scenes (attempt {search_strategies.index(successful_strategy) + 1}/{len(search_strategies)})")</span></span>
<span id="cb65-2370"><a href="#cb65-2370" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-2371"><a href="#cb65-2371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2372"><a href="#cb65-2372" aria-hidden="true" tabindex="-1"></a><span class="st">### 5.2 Scene Quality Assessment and Selection</span></span>
<span id="cb65-2373"><a href="#cb65-2373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2374"><a href="#cb65-2374" aria-hidden="true" tabindex="-1"></a><span class="st">Once we have candidate scenes, we need to systematically evaluate and select the best option:</span></span>
<span id="cb65-2375"><a href="#cb65-2375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2376"><a href="#cb65-2376" aria-hidden="true" tabindex="-1"></a><span class="st">**Performing Comprehensive Scene Quality Assessment:**</span></span>
<span id="cb65-2377"><a href="#cb65-2377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2378"><a href="#cb65-2378" aria-hidden="true" tabindex="-1"></a><span class="st">This demonstrates multi-criteria decision making for satellite data selection using cloud cover, acquisition date, and other quality metrics.</span></span>
<span id="cb65-2379"><a href="#cb65-2379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2382"><a href="#cb65-2382" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-2383"><a href="#cb65-2383" aria-hidden="true" tabindex="-1"></a><span class="st"># Step 4B: Intelligent Scene Selection Based on Multiple Quality Criteria</span></span>
<span id="cb65-2384"><a href="#cb65-2384" aria-hidden="true" tabindex="-1"></a><span class="st"># Sort scenes by multiple quality criteria</span></span>
<span id="cb65-2385"><a href="#cb65-2385" aria-hidden="true" tabindex="-1"></a><span class="st"># Primary: cloud cover (lower is better)</span></span>
<span id="cb65-2386"><a href="#cb65-2386" aria-hidden="true" tabindex="-1"></a><span class="st"># Secondary: date (more recent is better)</span></span>
<span id="cb65-2387"><a href="#cb65-2387" aria-hidden="true" tabindex="-1"></a><span class="st">scenes_with_scores = []</span></span>
<span id="cb65-2388"><a href="#cb65-2388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2389"><a href="#cb65-2389" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"Evaluating {len(scenes)} candidate scenes for quality assessment")</span></span>
<span id="cb65-2390"><a href="#cb65-2390" aria-hidden="true" tabindex="-1"></a><span class="st">for scene in scenes:</span></span>
<span id="cb65-2391"><a href="#cb65-2391" aria-hidden="true" tabindex="-1"></a><span class="st">    props = scene.properties</span></span>
<span id="cb65-2392"><a href="#cb65-2392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2393"><a href="#cb65-2393" aria-hidden="true" tabindex="-1"></a><span class="st">    # Extract key quality metrics</span></span>
<span id="cb65-2394"><a href="#cb65-2394" aria-hidden="true" tabindex="-1"></a><span class="st">    cloud_cover = props.get('</span>eo:cloud_cover<span class="st">', 100)</span></span>
<span id="cb65-2395"><a href="#cb65-2395" aria-hidden="true" tabindex="-1"></a><span class="st">    date_str = props.get('</span>datetime<span class="st">', '').split('</span>T<span class="st">')[0]</span></span>
<span id="cb65-2396"><a href="#cb65-2396" aria-hidden="true" tabindex="-1"></a><span class="st">    scene_date = datetime.strptime(date_str, '</span>%Y-%m-%d<span class="st">')</span></span>
<span id="cb65-2397"><a href="#cb65-2397" aria-hidden="true" tabindex="-1"></a><span class="st">    days_old = (current_date - scene_date).days</span></span>
<span id="cb65-2398"><a href="#cb65-2398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2399"><a href="#cb65-2399" aria-hidden="true" tabindex="-1"></a><span class="st">    # Calculate composite quality score (lower is better)</span></span>
<span id="cb65-2400"><a href="#cb65-2400" aria-hidden="true" tabindex="-1"></a><span class="st">    # Weight factors: cloud cover (70%), recency (30%)</span></span>
<span id="cb65-2401"><a href="#cb65-2401" aria-hidden="true" tabindex="-1"></a><span class="st">    cloud_score = cloud_cover  # 0-100 scale</span></span>
<span id="cb65-2402"><a href="#cb65-2402" aria-hidden="true" tabindex="-1"></a><span class="st">    recency_score = min(days_old / 30, 100)  # Normalize to 0-100, cap at 100</span></span>
<span id="cb65-2403"><a href="#cb65-2403" aria-hidden="true" tabindex="-1"></a><span class="st">    quality_score = (0.7 * cloud_score) + (0.3 * recency_score)</span></span>
<span id="cb65-2404"><a href="#cb65-2404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2405"><a href="#cb65-2405" aria-hidden="true" tabindex="-1"></a><span class="st">    scene_info = {</span></span>
<span id="cb65-2406"><a href="#cb65-2406" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>scene<span class="st">': scene,</span></span>
<span id="cb65-2407"><a href="#cb65-2407" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>date<span class="st">': date_str,</span></span>
<span id="cb65-2408"><a href="#cb65-2408" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>cloud_cover<span class="st">': cloud_cover,</span></span>
<span id="cb65-2409"><a href="#cb65-2409" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>days_old<span class="st">': days_old,</span></span>
<span id="cb65-2410"><a href="#cb65-2410" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>quality_score<span class="st">': quality_score,</span></span>
<span id="cb65-2411"><a href="#cb65-2411" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>tile_id<span class="st">': props.get('</span>sentinel:grid_square<span class="st">', '</span>Unknown<span class="st">'),</span></span>
<span id="cb65-2412"><a href="#cb65-2412" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>platform<span class="st">': props.get('</span>platform<span class="st">', '</span>Sentinel-2<span class="st">')</span></span>
<span id="cb65-2413"><a href="#cb65-2413" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb65-2414"><a href="#cb65-2414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2415"><a href="#cb65-2415" aria-hidden="true" tabindex="-1"></a><span class="st">    scenes_with_scores.append(scene_info)</span></span>
<span id="cb65-2416"><a href="#cb65-2416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2417"><a href="#cb65-2417" aria-hidden="true" tabindex="-1"></a><span class="st"># Sort by quality score (best first)</span></span>
<span id="cb65-2418"><a href="#cb65-2418" aria-hidden="true" tabindex="-1"></a><span class="st">scenes_with_scores.sort(key=lambda x: x['</span>quality_score<span class="st">'])</span></span>
<span id="cb65-2419"><a href="#cb65-2419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2420"><a href="#cb65-2420" aria-hidden="true" tabindex="-1"></a><span class="st"># Display top candidates for educational purposes</span></span>
<span id="cb65-2421"><a href="#cb65-2421" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info("Top 5 Scene Candidates (ranked by quality score):")</span></span>
<span id="cb65-2422"><a href="#cb65-2422" aria-hidden="true" tabindex="-1"></a><span class="st">for i, scene_info in enumerate(scenes_with_scores[:5], 1):</span></span>
<span id="cb65-2423"><a href="#cb65-2423" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.debug(f"{i}. {scene_info['</span>date<span class="st">']} - Cloud: {scene_info['</span>cloud_cover<span class="st">']:.1f}%, Age: {scene_info['</span>days_old<span class="st">']} days, Score: {scene_info['</span>quality_score<span class="st">']:.1f}")</span></span>
<span id="cb65-2424"><a href="#cb65-2424" aria-hidden="true" tabindex="-1"></a><span class="st">    if i == 1:</span></span>
<span id="cb65-2425"><a href="#cb65-2425" aria-hidden="true" tabindex="-1"></a><span class="st">        logger.info(f"Selected optimal scene: {scene_info['</span>date<span class="st">']}")</span></span>
<span id="cb65-2426"><a href="#cb65-2426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2427"><a href="#cb65-2427" aria-hidden="true" tabindex="-1"></a><span class="st"># Select the best scene</span></span>
<span id="cb65-2428"><a href="#cb65-2428" aria-hidden="true" tabindex="-1"></a><span class="st">best_scene_info = scenes_with_scores[0]</span></span>
<span id="cb65-2429"><a href="#cb65-2429" aria-hidden="true" tabindex="-1"></a><span class="st">best_scene = best_scene_info['</span>scene<span class="st">']</span></span>
<span id="cb65-2430"><a href="#cb65-2430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2431"><a href="#cb65-2431" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info(f"Optimal scene selected: {best_scene_info['</span>date<span class="st">']} ({best_scene_info['</span>cloud_cover<span class="st">']:.1f}% cloud cover, {best_scene_info['</span>platform<span class="st">']}, Tile: {best_scene_info['</span>tile_id<span class="st">']})")</span></span>
<span id="cb65-2432"><a href="#cb65-2432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2433"><a href="#cb65-2433" aria-hidden="true" tabindex="-1"></a><span class="st"># Validate scene completeness for required analysis</span></span>
<span id="cb65-2434"><a href="#cb65-2434" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info("Validating scene data completeness")</span></span>
<span id="cb65-2435"><a href="#cb65-2435" aria-hidden="true" tabindex="-1"></a><span class="st">required_bands = ['</span>B02<span class="st">', '</span>B03<span class="st">', '</span>B04<span class="st">', '</span>B08<span class="st">']  # Blue, Green, Red, NIR</span></span>
<span id="cb65-2436"><a href="#cb65-2436" aria-hidden="true" tabindex="-1"></a><span class="st">available_bands = list(best_scene.assets.keys())</span></span>
<span id="cb65-2437"><a href="#cb65-2437" aria-hidden="true" tabindex="-1"></a><span class="st">spectral_bands = [b for b in available_bands if b.startswith('</span>B<span class="st">') and len(b) &lt;= 3]</span></span>
<span id="cb65-2438"><a href="#cb65-2438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2439"><a href="#cb65-2439" aria-hidden="true" tabindex="-1"></a><span class="st">logger.debug(f"Available spectral bands: {len(spectral_bands)}, Required: {required_bands}")</span></span>
<span id="cb65-2440"><a href="#cb65-2440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2441"><a href="#cb65-2441" aria-hidden="true" tabindex="-1"></a><span class="st">missing_bands = [b for b in required_bands if b not in available_bands]</span></span>
<span id="cb65-2442"><a href="#cb65-2442" aria-hidden="true" tabindex="-1"></a><span class="st">if missing_bands:</span></span>
<span id="cb65-2443"><a href="#cb65-2443" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.warning(f"Missing critical bands: {missing_bands} - this may limit analysis capabilities")</span></span>
<span id="cb65-2444"><a href="#cb65-2444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2445"><a href="#cb65-2445" aria-hidden="true" tabindex="-1"></a><span class="st">    # Check for alternative bands</span></span>
<span id="cb65-2446"><a href="#cb65-2446" aria-hidden="true" tabindex="-1"></a><span class="st">    alternative_mapping = {'</span>B02<span class="st">': '</span>blue<span class="st">', '</span>B03<span class="st">': '</span>green<span class="st">', '</span>B04<span class="st">': '</span>red<span class="st">', '</span>B08<span class="st">': '</span>nir<span class="st">'}</span></span>
<span id="cb65-2447"><a href="#cb65-2447" aria-hidden="true" tabindex="-1"></a><span class="st">    alternatives_found = []</span></span>
<span id="cb65-2448"><a href="#cb65-2448" aria-hidden="true" tabindex="-1"></a><span class="st">    for missing in missing_bands:</span></span>
<span id="cb65-2449"><a href="#cb65-2449" aria-hidden="true" tabindex="-1"></a><span class="st">        alt_name = alternative_mapping.get(missing, missing.lower())</span></span>
<span id="cb65-2450"><a href="#cb65-2450" aria-hidden="true" tabindex="-1"></a><span class="st">        if alt_name in available_bands:</span></span>
<span id="cb65-2451"><a href="#cb65-2451" aria-hidden="true" tabindex="-1"></a><span class="st">            alternatives_found.append((missing, alt_name))</span></span>
<span id="cb65-2452"><a href="#cb65-2452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2453"><a href="#cb65-2453" aria-hidden="true" tabindex="-1"></a><span class="st">    if alternatives_found:</span></span>
<span id="cb65-2454"><a href="#cb65-2454" aria-hidden="true" tabindex="-1"></a><span class="st">        logger.info(f"Found alternative band names: {alternatives_found}")</span></span>
<span id="cb65-2455"><a href="#cb65-2455" aria-hidden="true" tabindex="-1"></a><span class="st">else:</span></span>
<span id="cb65-2456"><a href="#cb65-2456" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info("All required bands available")</span></span>
<span id="cb65-2457"><a href="#cb65-2457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2458"><a href="#cb65-2458" aria-hidden="true" tabindex="-1"></a><span class="st"># Additional quality checks</span></span>
<span id="cb65-2459"><a href="#cb65-2459" aria-hidden="true" tabindex="-1"></a><span class="st">extra_bands = [b for b in spectral_bands if b not in required_bands]</span></span>
<span id="cb65-2460"><a href="#cb65-2460" aria-hidden="true" tabindex="-1"></a><span class="st">if extra_bands:</span></span>
<span id="cb65-2461"><a href="#cb65-2461" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.debug(f"Bonus bands available: {extra_bands[:5]}{'</span>...<span class="st">' if len(extra_bands) &gt; 5 else ''} (enable advanced spectral analysis)")</span></span>
<span id="cb65-2462"><a href="#cb65-2462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2463"><a href="#cb65-2463" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info("Scene validation complete - ready for data loading")</span></span>
<span id="cb65-2464"><a href="#cb65-2464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2465"><a href="#cb65-2465" aria-hidden="true" tabindex="-1"></a><span class="st"># Quick connectivity test using our helper function</span></span>
<span id="cb65-2466"><a href="#cb65-2466" aria-hidden="true" tabindex="-1"></a><span class="st">logger.info("Performing pre-flight connectivity test")</span></span>
<span id="cb65-2467"><a href="#cb65-2467" aria-hidden="true" tabindex="-1"></a><span class="st">connectivity_test = test_subset_functionality(best_scene)</span></span>
<span id="cb65-2468"><a href="#cb65-2468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2469"><a href="#cb65-2469" aria-hidden="true" tabindex="-1"></a><span class="st">if connectivity_test:</span></span>
<span id="cb65-2470"><a href="#cb65-2470" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info("Data access confirmed - all systems ready")</span></span>
<span id="cb65-2471"><a href="#cb65-2471" aria-hidden="true" tabindex="-1"></a><span class="st">else:</span></span>
<span id="cb65-2472"><a href="#cb65-2472" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.warning("Connectivity issues detected - will attempt full download with fallback mechanisms")</span></span>
<span id="cb65-2473"><a href="#cb65-2473" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-2474"><a href="#cb65-2474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2475"><a href="#cb65-2475" aria-hidden="true" tabindex="-1"></a><span class="st">Scene selection for geospatial analysis should prioritize several key quality criteria. Cloud cover is the most important factor, as it directly affects data usability. Temporal relevance is also critical; more recent data better reflects current conditions. The processing level matters as well—Level 2A data, for example, provides atmospheric correction, which is often preferred. Finally, consider spatial coverage, ensuring that the selected scene fully covers the area of interest rather than only partially.</span></span>
<span id="cb65-2476"><a href="#cb65-2476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2477"><a href="#cb65-2477" aria-hidden="true" tabindex="-1"></a><span class="st">In production workflows, it is important to have fallback strategies in place, such as using multiple search approaches to ensure data availability. Automated selection can be improved by applying standardized quality scoring metrics. Always validate metadata to confirm that all required bands and assets are present, and test connectivity to the data source before starting major processing tasks.</span></span>
<span id="cb65-2478"><a href="#cb65-2478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2479"><a href="#cb65-2479" aria-hidden="true" tabindex="-1"></a><span class="st">Before loading data, it is helpful to examine the characteristics of the selected Sentinel-2 scene. For example, you can use the `eo:cloud_cover` property to filter scenes by cloud coverage. Sentinel-2 satellites revisit the same location every five days, so multiple scenes are usually available for a given area. Level 2A data is already atmospherically corrected, which simplifies preprocessing. Be aware that different satellites may use different naming conventions and have varying properties.</span></span>
<span id="cb65-2480"><a href="#cb65-2480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2481"><a href="#cb65-2481" aria-hidden="true" tabindex="-1"></a><span class="st">A thorough analysis of scene metadata is essential for designing effective workflows. By systematically inventorying available assets and understanding sensor characteristics, you can take full advantage of the rich metadata provided in STAC items and ensure your analysis is both robust and reliable.</span></span>
<span id="cb65-2482"><a href="#cb65-2482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2485"><a href="#cb65-2485" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-2486"><a href="#cb65-2486" aria-hidden="true" tabindex="-1"></a><span class="st"># Step 4C: Comprehensive Scene and Sensor Characterization</span></span>
<span id="cb65-2487"><a href="#cb65-2487" aria-hidden="true" tabindex="-1"></a><span class="st">if '</span>best_scene<span class="st">' in locals():</span></span>
<span id="cb65-2488"><a href="#cb65-2488" aria-hidden="true" tabindex="-1"></a><span class="st">    scene_props = best_scene.properties</span></span>
<span id="cb65-2489"><a href="#cb65-2489" aria-hidden="true" tabindex="-1"></a><span class="st">    scene_assets = best_scene.assets</span></span>
<span id="cb65-2490"><a href="#cb65-2490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2491"><a href="#cb65-2491" aria-hidden="true" tabindex="-1"></a><span class="st">    # Sentinel-2 spectral band specifications with AI applications</span></span>
<span id="cb65-2492"><a href="#cb65-2492" aria-hidden="true" tabindex="-1"></a><span class="st">    sentinel2_bands = {</span></span>
<span id="cb65-2493"><a href="#cb65-2493" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>B01<span class="st">': {</span></span>
<span id="cb65-2494"><a href="#cb65-2494" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>Coastal/Aerosol<span class="st">',</span></span>
<span id="cb65-2495"><a href="#cb65-2495" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>wavelength<span class="st">': '</span>443 nm<span class="st">',</span></span>
<span id="cb65-2496"><a href="#cb65-2496" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>resolution<span class="st">': '</span>60m<span class="st">',</span></span>
<span id="cb65-2497"><a href="#cb65-2497" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Atmospheric correction, aerosol detection<span class="st">'</span></span>
<span id="cb65-2498"><a href="#cb65-2498" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2499"><a href="#cb65-2499" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>B02<span class="st">': {</span></span>
<span id="cb65-2500"><a href="#cb65-2500" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>Blue<span class="st">',</span></span>
<span id="cb65-2501"><a href="#cb65-2501" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>wavelength<span class="st">': '</span>490 nm<span class="st">',</span></span>
<span id="cb65-2502"><a href="#cb65-2502" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>resolution<span class="st">': '</span>10m<span class="st">',</span></span>
<span id="cb65-2503"><a href="#cb65-2503" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Water body detection, urban classification<span class="st">'</span></span>
<span id="cb65-2504"><a href="#cb65-2504" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2505"><a href="#cb65-2505" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>B03<span class="st">': {</span></span>
<span id="cb65-2506"><a href="#cb65-2506" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>Green<span class="st">',</span></span>
<span id="cb65-2507"><a href="#cb65-2507" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>wavelength<span class="st">': '</span>560 nm<span class="st">',</span></span>
<span id="cb65-2508"><a href="#cb65-2508" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>resolution<span class="st">': '</span>10m<span class="st">',</span></span>
<span id="cb65-2509"><a href="#cb65-2509" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Vegetation health, true color composites<span class="st">'</span></span>
<span id="cb65-2510"><a href="#cb65-2510" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2511"><a href="#cb65-2511" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>B04<span class="st">': {</span></span>
<span id="cb65-2512"><a href="#cb65-2512" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>Red<span class="st">',</span></span>
<span id="cb65-2513"><a href="#cb65-2513" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>wavelength<span class="st">': '</span>665 nm<span class="st">',</span></span>
<span id="cb65-2514"><a href="#cb65-2514" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>resolution<span class="st">': '</span>10m<span class="st">',</span></span>
<span id="cb65-2515"><a href="#cb65-2515" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Vegetation stress, NDVI calculation<span class="st">'</span></span>
<span id="cb65-2516"><a href="#cb65-2516" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2517"><a href="#cb65-2517" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>B05<span class="st">': {</span></span>
<span id="cb65-2518"><a href="#cb65-2518" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>Red Edge 1<span class="st">',</span></span>
<span id="cb65-2519"><a href="#cb65-2519" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>wavelength<span class="st">': '</span>705 nm<span class="st">',</span></span>
<span id="cb65-2520"><a href="#cb65-2520" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>resolution<span class="st">': '</span>20m<span class="st">',</span></span>
<span id="cb65-2521"><a href="#cb65-2521" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Vegetation analysis, crop type classification<span class="st">'</span></span>
<span id="cb65-2522"><a href="#cb65-2522" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2523"><a href="#cb65-2523" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>B06<span class="st">': {</span></span>
<span id="cb65-2524"><a href="#cb65-2524" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>Red Edge 2<span class="st">',</span></span>
<span id="cb65-2525"><a href="#cb65-2525" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>wavelength<span class="st">': '</span>740 nm<span class="st">',</span></span>
<span id="cb65-2526"><a href="#cb65-2526" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>resolution<span class="st">': '</span>20m<span class="st">',</span></span>
<span id="cb65-2527"><a href="#cb65-2527" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Advanced vegetation indices, stress detection<span class="st">'</span></span>
<span id="cb65-2528"><a href="#cb65-2528" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2529"><a href="#cb65-2529" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>B07<span class="st">': {</span></span>
<span id="cb65-2530"><a href="#cb65-2530" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>Red Edge 3<span class="st">',</span></span>
<span id="cb65-2531"><a href="#cb65-2531" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>wavelength<span class="st">': '</span>783 nm<span class="st">',</span></span>
<span id="cb65-2532"><a href="#cb65-2532" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>resolution<span class="st">': '</span>20m<span class="st">',</span></span>
<span id="cb65-2533"><a href="#cb65-2533" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Vegetation biophysical parameters<span class="st">'</span></span>
<span id="cb65-2534"><a href="#cb65-2534" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2535"><a href="#cb65-2535" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>B08<span class="st">': {</span></span>
<span id="cb65-2536"><a href="#cb65-2536" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>NIR <span class="er">(</span><span class="ex">Near</span> Infrared<span class="kw">)</span><span class="st">',</span></span>
<span id="cb65-2537"><a href="#cb65-2537" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span><span class="ex">wavelength</span><span class="st">': '</span><span class="ex">842</span> nm<span class="st">',</span></span>
<span id="cb65-2538"><a href="#cb65-2538" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>resolution<span class="st">': '</span>10m<span class="st">',</span></span>
<span id="cb65-2539"><a href="#cb65-2539" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Biomass estimation, water/land separation<span class="st">'</span></span>
<span id="cb65-2540"><a href="#cb65-2540" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2541"><a href="#cb65-2541" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>B8A<span class="st">': {</span></span>
<span id="cb65-2542"><a href="#cb65-2542" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>NIR Narrow<span class="st">',</span></span>
<span id="cb65-2543"><a href="#cb65-2543" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>wavelength<span class="st">': '</span>865 nm<span class="st">',</span></span>
<span id="cb65-2544"><a href="#cb65-2544" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>resolution<span class="st">': '</span>20m<span class="st">',</span></span>
<span id="cb65-2545"><a href="#cb65-2545" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Refined vegetation analysis<span class="st">'</span></span>
<span id="cb65-2546"><a href="#cb65-2546" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2547"><a href="#cb65-2547" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>B09<span class="st">': {</span></span>
<span id="cb65-2548"><a href="#cb65-2548" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>Water Vapor<span class="st">',</span></span>
<span id="cb65-2549"><a href="#cb65-2549" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>wavelength<span class="st">': '</span>945 nm<span class="st">',</span></span>
<span id="cb65-2550"><a href="#cb65-2550" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>resolution<span class="st">': '</span>60m<span class="st">',</span></span>
<span id="cb65-2551"><a href="#cb65-2551" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Atmospheric water vapor correction<span class="st">'</span></span>
<span id="cb65-2552"><a href="#cb65-2552" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2553"><a href="#cb65-2553" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>B11<span class="st">': {</span></span>
<span id="cb65-2554"><a href="#cb65-2554" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>SWIR 1<span class="st">',</span></span>
<span id="cb65-2555"><a href="#cb65-2555" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>wavelength<span class="st">': '</span>1610 nm<span class="st">',</span></span>
<span id="cb65-2556"><a href="#cb65-2556" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>resolution<span class="st">': '</span>20m<span class="st">',</span></span>
<span id="cb65-2557"><a href="#cb65-2557" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Fire detection, soil moisture, geology<span class="st">'</span></span>
<span id="cb65-2558"><a href="#cb65-2558" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2559"><a href="#cb65-2559" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>B12<span class="st">': {</span></span>
<span id="cb65-2560"><a href="#cb65-2560" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>SWIR 2<span class="st">',</span></span>
<span id="cb65-2561"><a href="#cb65-2561" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>wavelength<span class="st">': '</span>2190 nm<span class="st">',</span></span>
<span id="cb65-2562"><a href="#cb65-2562" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>resolution<span class="st">': '</span>20m<span class="st">',</span></span>
<span id="cb65-2563"><a href="#cb65-2563" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Burn area mapping, mineral detection<span class="st">'</span></span>
<span id="cb65-2564"><a href="#cb65-2564" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb65-2565"><a href="#cb65-2565" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb65-2566"><a href="#cb65-2566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2567"><a href="#cb65-2567" aria-hidden="true" tabindex="-1"></a><span class="st">    # Additional data products available in Level 2A</span></span>
<span id="cb65-2568"><a href="#cb65-2568" aria-hidden="true" tabindex="-1"></a><span class="st">    additional_products = {</span></span>
<span id="cb65-2569"><a href="#cb65-2569" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>SCL<span class="st">': {</span></span>
<span id="cb65-2570"><a href="#cb65-2570" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>Scene Classification Layer<span class="st">',</span></span>
<span id="cb65-2571"><a href="#cb65-2571" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>description<span class="st">': '</span>Pixel-level land cover classification<span class="st">',</span></span>
<span id="cb65-2572"><a href="#cb65-2572" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Cloud masking, quality assessment<span class="st">'</span></span>
<span id="cb65-2573"><a href="#cb65-2573" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2574"><a href="#cb65-2574" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>AOT<span class="st">': {</span></span>
<span id="cb65-2575"><a href="#cb65-2575" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>Aerosol Optical Thickness<span class="st">',</span></span>
<span id="cb65-2576"><a href="#cb65-2576" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>description<span class="st">': '</span>Atmospheric aerosol content<span class="st">',</span></span>
<span id="cb65-2577"><a href="#cb65-2577" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Atmospheric correction validation<span class="st">'</span></span>
<span id="cb65-2578"><a href="#cb65-2578" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2579"><a href="#cb65-2579" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>WVP<span class="st">': {</span></span>
<span id="cb65-2580"><a href="#cb65-2580" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>Water Vapor Pressure<span class="st">',</span></span>
<span id="cb65-2581"><a href="#cb65-2581" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>description<span class="st">': '</span>Columnar water vapor content<span class="st">',</span></span>
<span id="cb65-2582"><a href="#cb65-2582" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Atmospheric correction, weather analysis<span class="st">'</span></span>
<span id="cb65-2583"><a href="#cb65-2583" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2584"><a href="#cb65-2584" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>visual<span class="st">': {</span></span>
<span id="cb65-2585"><a href="#cb65-2585" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>True Color Preview<span class="st">',</span></span>
<span id="cb65-2586"><a href="#cb65-2586" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>description<span class="st">': '</span>RGB composite for visualization<span class="st">',</span></span>
<span id="cb65-2587"><a href="#cb65-2587" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Quick visual assessment, presentation<span class="st">'</span></span>
<span id="cb65-2588"><a href="#cb65-2588" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2589"><a href="#cb65-2589" aria-hidden="true" tabindex="-1"></a><span class="st">        '</span>thumbnail<span class="st">': {</span></span>
<span id="cb65-2590"><a href="#cb65-2590" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>name<span class="st">': '</span>Scene Thumbnail<span class="st">',</span></span>
<span id="cb65-2591"><a href="#cb65-2591" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>description<span class="st">': '</span>Low-resolution preview image<span class="st">',</span></span>
<span id="cb65-2592"><a href="#cb65-2592" aria-hidden="true" tabindex="-1"></a><span class="st">            '</span>ai_applications<span class="st">': '</span>Rapid quality screening<span class="st">'</span></span>
<span id="cb65-2593"><a href="#cb65-2593" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb65-2594"><a href="#cb65-2594" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb65-2595"><a href="#cb65-2595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2596"><a href="#cb65-2596" aria-hidden="true" tabindex="-1"></a><span class="st">    # Scene technical specifications</span></span>
<span id="cb65-2597"><a href="#cb65-2597" aria-hidden="true" tabindex="-1"></a><span class="st">    acquisition_date = scene_props.get('</span>datetime<span class="st">', '</span>Unknown<span class="st">').split('</span>T<span class="st">')[0]</span></span>
<span id="cb65-2598"><a href="#cb65-2598" aria-hidden="true" tabindex="-1"></a><span class="st">    platform = scene_props.get('</span>platform<span class="st">', '</span>Unknown<span class="st">')</span></span>
<span id="cb65-2599"><a href="#cb65-2599" aria-hidden="true" tabindex="-1"></a><span class="st">    cloud_cover = scene_props.get('</span>eo:cloud_cover<span class="st">', 0)</span></span>
<span id="cb65-2600"><a href="#cb65-2600" aria-hidden="true" tabindex="-1"></a><span class="st">    tile_id = scene_props.get('</span>sentinel:grid_square<span class="st">', '</span>Unknown<span class="st">')</span></span>
<span id="cb65-2601"><a href="#cb65-2601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2602"><a href="#cb65-2602" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"Scene: {platform} {acquisition_date}, Cloud: {cloud_cover:.1f}%, Tile: {tile_id}")</span></span>
<span id="cb65-2603"><a href="#cb65-2603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2604"><a href="#cb65-2604" aria-hidden="true" tabindex="-1"></a><span class="st">    # Inventory available spectral bands</span></span>
<span id="cb65-2605"><a href="#cb65-2605" aria-hidden="true" tabindex="-1"></a><span class="st">    available_spectral = []</span></span>
<span id="cb65-2606"><a href="#cb65-2606" aria-hidden="true" tabindex="-1"></a><span class="st">    available_products = []</span></span>
<span id="cb65-2607"><a href="#cb65-2607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2608"><a href="#cb65-2608" aria-hidden="true" tabindex="-1"></a><span class="st">    for band_id, info in sentinel2_bands.items():</span></span>
<span id="cb65-2609"><a href="#cb65-2609" aria-hidden="true" tabindex="-1"></a><span class="st">        if band_id in scene_assets:</span></span>
<span id="cb65-2610"><a href="#cb65-2610" aria-hidden="true" tabindex="-1"></a><span class="st">            available_spectral.append(band_id)</span></span>
<span id="cb65-2611"><a href="#cb65-2611" aria-hidden="true" tabindex="-1"></a><span class="st">            logger.debug(f"Available: {band_id} ({info['</span>name<span class="st">']}, {info['</span>resolution<span class="st">']})")</span></span>
<span id="cb65-2612"><a href="#cb65-2612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2613"><a href="#cb65-2613" aria-hidden="true" tabindex="-1"></a><span class="st">    for product_id, info in additional_products.items():</span></span>
<span id="cb65-2614"><a href="#cb65-2614" aria-hidden="true" tabindex="-1"></a><span class="st">        if product_id in scene_assets:</span></span>
<span id="cb65-2615"><a href="#cb65-2615" aria-hidden="true" tabindex="-1"></a><span class="st">            available_products.append(product_id)</span></span>
<span id="cb65-2616"><a href="#cb65-2616" aria-hidden="true" tabindex="-1"></a><span class="st">            logger.debug(f"Available product: {product_id} - {info['</span>name<span class="st">']}")</span></span>
<span id="cb65-2617"><a href="#cb65-2617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2618"><a href="#cb65-2618" aria-hidden="true" tabindex="-1"></a><span class="st">    # Analysis readiness assessment</span></span>
<span id="cb65-2619"><a href="#cb65-2619" aria-hidden="true" tabindex="-1"></a><span class="st">    core_bands = ['</span>B02<span class="st">', '</span>B03<span class="st">', '</span>B04<span class="st">', '</span>B08<span class="st">']  # Essential for basic analysis</span></span>
<span id="cb65-2620"><a href="#cb65-2620" aria-hidden="true" tabindex="-1"></a><span class="st">    advanced_bands = ['</span>B05<span class="st">', '</span>B06<span class="st">', '</span>B07<span class="st">', '</span>B8A<span class="st">', '</span>B11<span class="st">', '</span>B12<span class="st">']  # For advanced analysis</span></span>
<span id="cb65-2621"><a href="#cb65-2621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2622"><a href="#cb65-2622" aria-hidden="true" tabindex="-1"></a><span class="st">    core_available = sum(1 for band in core_bands if band in available_spectral)</span></span>
<span id="cb65-2623"><a href="#cb65-2623" aria-hidden="true" tabindex="-1"></a><span class="st">    advanced_available = sum(1 for band in advanced_bands if band in available_spectral)</span></span>
<span id="cb65-2624"><a href="#cb65-2624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2625"><a href="#cb65-2625" aria-hidden="true" tabindex="-1"></a><span class="st">    # Analysis readiness assessment</span></span>
<span id="cb65-2626"><a href="#cb65-2626" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"Bands available: {core_available}/{len(core_bands)} core, {advanced_available}/{len(advanced_bands)} advanced")</span></span>
<span id="cb65-2627"><a href="#cb65-2627" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"Additional products: {len(available_products)}")</span></span>
<span id="cb65-2628"><a href="#cb65-2628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2629"><a href="#cb65-2629" aria-hidden="true" tabindex="-1"></a><span class="st">    # Determine analysis capabilities</span></span>
<span id="cb65-2630"><a href="#cb65-2630" aria-hidden="true" tabindex="-1"></a><span class="st">    if core_available == len(core_bands):</span></span>
<span id="cb65-2631"><a href="#cb65-2631" aria-hidden="true" tabindex="-1"></a><span class="st">        analysis_capabilities = ["NDVI calculation", "True color visualization", "Basic land cover classification"]</span></span>
<span id="cb65-2632"><a href="#cb65-2632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2633"><a href="#cb65-2633" aria-hidden="true" tabindex="-1"></a><span class="st">        if '</span>B11<span class="st">' in available_spectral and '</span>B12<span class="st">' in available_spectral:</span></span>
<span id="cb65-2634"><a href="#cb65-2634" aria-hidden="true" tabindex="-1"></a><span class="st">            analysis_capabilities.extend(["Fire detection", "Soil moisture analysis"])</span></span>
<span id="cb65-2635"><a href="#cb65-2635" aria-hidden="true" tabindex="-1"></a><span class="st">        if advanced_available &gt;= 4:</span></span>
<span id="cb65-2636"><a href="#cb65-2636" aria-hidden="true" tabindex="-1"></a><span class="st">            analysis_capabilities.extend(["Advanced vegetation indices", "Crop type classification"])</span></span>
<span id="cb65-2637"><a href="#cb65-2637" aria-hidden="true" tabindex="-1"></a><span class="st">        if '</span>SCL<span class="st">' in available_products:</span></span>
<span id="cb65-2638"><a href="#cb65-2638" aria-hidden="true" tabindex="-1"></a><span class="st">            analysis_capabilities.append("Automated cloud masking")</span></span>
<span id="cb65-2639"><a href="#cb65-2639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2640"><a href="#cb65-2640" aria-hidden="true" tabindex="-1"></a><span class="st">        logger.info(f"Analysis ready: {len(analysis_capabilities)} capabilities enabled")</span></span>
<span id="cb65-2641"><a href="#cb65-2641" aria-hidden="true" tabindex="-1"></a><span class="st">    else:</span></span>
<span id="cb65-2642"><a href="#cb65-2642" aria-hidden="true" tabindex="-1"></a><span class="st">        missing_core = [band for band in core_bands if band not in available_spectral]</span></span>
<span id="cb65-2643"><a href="#cb65-2643" aria-hidden="true" tabindex="-1"></a><span class="st">        logger.warning(f"Limited analysis: missing core bands {missing_core}")</span></span>
<span id="cb65-2644"><a href="#cb65-2644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2645"><a href="#cb65-2645" aria-hidden="true" tabindex="-1"></a><span class="st">    # Store technical metadata</span></span>
<span id="cb65-2646"><a href="#cb65-2646" aria-hidden="true" tabindex="-1"></a><span class="st">    crs_info = f"EPSG:{scene_props['</span>proj:epsg<span class="st">']}" if '</span>proj:epsg<span class="st">' in scene_props else "UTM"</span></span>
<span id="cb65-2647"><a href="#cb65-2647" aria-hidden="true" tabindex="-1"></a><span class="st">    utm_zone = scene_props.get('</span>sentinel:utm_zone<span class="st">', '</span>Unknown<span class="st">')</span></span>
<span id="cb65-2648"><a href="#cb65-2648" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"Metadata: {crs_info}, UTM zone {utm_zone}, 16-bit COG format")</span></span>
<span id="cb65-2649"><a href="#cb65-2649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2650"><a href="#cb65-2650" aria-hidden="true" tabindex="-1"></a><span class="st">else:</span></span>
<span id="cb65-2651"><a href="#cb65-2651" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.warning("No optimal scene selected - cannot perform metadata analysis")</span></span>
<span id="cb65-2652"><a href="#cb65-2652" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-2653"><a href="#cb65-2653" aria-hidden="true" tabindex="-1"></a><span class="st">## Sentinel-2 for AI Applications</span></span>
<span id="cb65-2654"><a href="#cb65-2654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2655"><a href="#cb65-2655" aria-hidden="true" tabindex="-1"></a><span class="st">Sentinel-2 is well-suited for geospatial AI due to its 13 multi-spectral bands spanning the visible to shortwave infrared range. The satellite offers a high revisit frequency of every 5 days, enabling temporal analysis. Its moderate spatial resolution of 10 to 20 meters is optimal for landscape-scale AI tasks. Sentinel-2 data is freely accessible under an open data policy, which supports large-scale model training. The standardized Level 2A processing ensures consistent data quality, and global coverage provides uniform data characteristics worldwide.</span></span>
<span id="cb65-2656"><a href="#cb65-2656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2657"><a href="#cb65-2657" aria-hidden="true" tabindex="-1"></a><span class="st">For AI applications, Sentinel-2 offers several advantages. The large data volume supports robust model development and training. The scene classification layer can be used as ground truth for validation. Time series data enables the development of sequence models, and the availability of multiple spatial resolutions allows for hierarchical learning approaches.</span></span>
<span id="cb65-2658"><a href="#cb65-2658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2659"><a href="#cb65-2659" aria-hidden="true" tabindex="-1"></a><span class="st">Now let'</span>s examine the scene<span class="st">'s geographic characteristics and proceed to data loading.</span></span>
<span id="cb65-2660"><a href="#cb65-2660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2661"><a href="#cb65-2661" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb65-2662"><a href="#cb65-2662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2663"><a href="#cb65-2663" aria-hidden="true" tabindex="-1"></a><span class="st">## 6. Production-Grade Satellite Data Loading and Processing</span></span>
<span id="cb65-2664"><a href="#cb65-2664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2665"><a href="#cb65-2665" aria-hidden="true" tabindex="-1"></a><span class="st">:::{.callout-tip} </span></span>
<span id="cb65-2666"><a href="#cb65-2666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2667"><a href="#cb65-2667" aria-hidden="true" tabindex="-1"></a><span class="st">#### Learning Objectives</span></span>
<span id="cb65-2668"><a href="#cb65-2668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2669"><a href="#cb65-2669" aria-hidden="true" tabindex="-1"></a><span class="st">By the end of this section, you will be able to implement memory-efficient satellite data loading with intelligent subsetting, design adaptive processing strategies based on scene characteristics, create robust error handling for network-dependent data workflows, and build multi-dimensional datasets suitable for AI and machine learning applications.</span></span>
<span id="cb65-2670"><a href="#cb65-2670" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-2671"><a href="#cb65-2671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2672"><a href="#cb65-2672" aria-hidden="true" tabindex="-1"></a><span class="st">### 6.1 The Challenge of Large-Scale Satellite Data Loading</span></span>
<span id="cb65-2673"><a href="#cb65-2673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2674"><a href="#cb65-2674" aria-hidden="true" tabindex="-1"></a><span class="st">Modern satellite scenes can exceed 1GB in size, which requires careful planning for data loading and processing. Efficient memory management is necessary to avoid loading unnecessary data into RAM. Network efficiency is also important to minimize data transfer while maintaining analysis quality. Processing strategies should be adaptive, adjusting to the size and characteristics of each scene. Additionally, workflows must be resilient to network interruptions and data access failures.</span></span>
<span id="cb65-2675"><a href="#cb65-2675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2676"><a href="#cb65-2676" aria-hidden="true" tabindex="-1"></a><span class="st">### 6.2 Intelligent Data Loading Architecture</span></span>
<span id="cb65-2677"><a href="#cb65-2677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2678"><a href="#cb65-2678" aria-hidden="true" tabindex="-1"></a><span class="st">The following approach demonstrates production-ready patterns used in operational systems. It implements an intelligent satellite data loading pipeline that adapts processing based on scene characteristics, selecting optimal loading strategies according to the scene size and analysis requirements.</span></span>
<span id="cb65-2679"><a href="#cb65-2679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2682"><a href="#cb65-2682" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-2683"><a href="#cb65-2683" aria-hidden="true" tabindex="-1"></a><span class="st"># Step 5A: Scene Analysis and Adaptive Subset Strategy Selection</span></span>
<span id="cb65-2684"><a href="#cb65-2684" aria-hidden="true" tabindex="-1"></a><span class="st">if '</span>best_scene<span class="st">' in locals():</span></span>
<span id="cb65-2685"><a href="#cb65-2685" aria-hidden="true" tabindex="-1"></a><span class="st">    # Comprehensive scene analysis for optimal loading strategy</span></span>
<span id="cb65-2686"><a href="#cb65-2686" aria-hidden="true" tabindex="-1"></a><span class="st">    scene_info = get_scene_info(best_scene)</span></span>
<span id="cb65-2687"><a href="#cb65-2687" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"Scene extent: {scene_info['</span>width_km<span class="st">']:.1f}×{scene_info['</span>height_km<span class="st">']:.1f} km ({scene_info['</span>area_km2<span class="st">']:.0f} km²)")</span></span>
<span id="cb65-2688"><a href="#cb65-2688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2689"><a href="#cb65-2689" aria-hidden="true" tabindex="-1"></a><span class="st">    # Adaptive subset strategy based on scene characteristics</span></span>
<span id="cb65-2690"><a href="#cb65-2690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2691"><a href="#cb65-2691" aria-hidden="true" tabindex="-1"></a><span class="st">    # Decision matrix for subset sizing</span></span>
<span id="cb65-2692"><a href="#cb65-2692" aria-hidden="true" tabindex="-1"></a><span class="st">    subset_strategies = {</span></span>
<span id="cb65-2693"><a href="#cb65-2693" aria-hidden="true" tabindex="-1"></a><span class="st">        "large_scene": {</span></span>
<span id="cb65-2694"><a href="#cb65-2694" aria-hidden="true" tabindex="-1"></a><span class="st">            "condition": scene_info['</span>area_km2<span class="st">'] &gt; 5000,</span></span>
<span id="cb65-2695"><a href="#cb65-2695" aria-hidden="true" tabindex="-1"></a><span class="st">            "x_range": (30, 70),</span></span>
<span id="cb65-2696"><a href="#cb65-2696" aria-hidden="true" tabindex="-1"></a><span class="st">            "y_range": (30, 70),</span></span>
<span id="cb65-2697"><a href="#cb65-2697" aria-hidden="true" tabindex="-1"></a><span class="st">            "coverage": 16,  # 40% × 40%</span></span>
<span id="cb65-2698"><a href="#cb65-2698" aria-hidden="true" tabindex="-1"></a><span class="st">            "rationale": "Conservative subset for large scenes to manage memory usage",</span></span>
<span id="cb65-2699"><a href="#cb65-2699" aria-hidden="true" tabindex="-1"></a><span class="st">            "description": "middle 40% (large scene optimization)"</span></span>
<span id="cb65-2700"><a href="#cb65-2700" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2701"><a href="#cb65-2701" aria-hidden="true" tabindex="-1"></a><span class="st">        "medium_scene": {</span></span>
<span id="cb65-2702"><a href="#cb65-2702" aria-hidden="true" tabindex="-1"></a><span class="st">            "condition": scene_info['</span>area_km2<span class="st">'] &gt; 1000,</span></span>
<span id="cb65-2703"><a href="#cb65-2703" aria-hidden="true" tabindex="-1"></a><span class="st">            "x_range": (20, 80),</span></span>
<span id="cb65-2704"><a href="#cb65-2704" aria-hidden="true" tabindex="-1"></a><span class="st">            "y_range": (20, 80),</span></span>
<span id="cb65-2705"><a href="#cb65-2705" aria-hidden="true" tabindex="-1"></a><span class="st">            "coverage": 36,  # 60% × 60%</span></span>
<span id="cb65-2706"><a href="#cb65-2706" aria-hidden="true" tabindex="-1"></a><span class="st">            "rationale": "Balanced subset for medium scenes",</span></span>
<span id="cb65-2707"><a href="#cb65-2707" aria-hidden="true" tabindex="-1"></a><span class="st">            "description": "middle 60% (balanced approach)"</span></span>
<span id="cb65-2708"><a href="#cb65-2708" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb65-2709"><a href="#cb65-2709" aria-hidden="true" tabindex="-1"></a><span class="st">        "small_scene": {</span></span>
<span id="cb65-2710"><a href="#cb65-2710" aria-hidden="true" tabindex="-1"></a><span class="st">            "condition": scene_info['</span>area_km2<span class="st">'] &lt;= 1000,</span></span>
<span id="cb65-2711"><a href="#cb65-2711" aria-hidden="true" tabindex="-1"></a><span class="st">            "x_range": (10, 90),</span></span>
<span id="cb65-2712"><a href="#cb65-2712" aria-hidden="true" tabindex="-1"></a><span class="st">            "y_range": (10, 90),</span></span>
<span id="cb65-2713"><a href="#cb65-2713" aria-hidden="true" tabindex="-1"></a><span class="st">            "coverage": 64,  # 80% × 80%</span></span>
<span id="cb65-2714"><a href="#cb65-2714" aria-hidden="true" tabindex="-1"></a><span class="st">            "rationale": "Maximum coverage for small scenes",</span></span>
<span id="cb65-2715"><a href="#cb65-2715" aria-hidden="true" tabindex="-1"></a><span class="st">            "description": "most of scene (small scene - maximize coverage)"</span></span>
<span id="cb65-2716"><a href="#cb65-2716" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb65-2717"><a href="#cb65-2717" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb65-2718"><a href="#cb65-2718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2719"><a href="#cb65-2719" aria-hidden="true" tabindex="-1"></a><span class="st">    # Select optimal strategy</span></span>
<span id="cb65-2720"><a href="#cb65-2720" aria-hidden="true" tabindex="-1"></a><span class="st">    selected_strategy = None</span></span>
<span id="cb65-2721"><a href="#cb65-2721" aria-hidden="true" tabindex="-1"></a><span class="st">    for strategy_name, strategy in subset_strategies.items():</span></span>
<span id="cb65-2722"><a href="#cb65-2722" aria-hidden="true" tabindex="-1"></a><span class="st">        if strategy["condition"]:</span></span>
<span id="cb65-2723"><a href="#cb65-2723" aria-hidden="true" tabindex="-1"></a><span class="st">            selected_strategy = strategy</span></span>
<span id="cb65-2724"><a href="#cb65-2724" aria-hidden="true" tabindex="-1"></a><span class="st">            strategy_name_selected = strategy_name</span></span>
<span id="cb65-2725"><a href="#cb65-2725" aria-hidden="true" tabindex="-1"></a><span class="st">            logger.info(f"Selected strategy: {strategy_name} ({strategy['</span>coverage<span class="st">']}% coverage)")</span></span>
<span id="cb65-2726"><a href="#cb65-2726" aria-hidden="true" tabindex="-1"></a><span class="st">            break</span></span>
<span id="cb65-2727"><a href="#cb65-2727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2728"><a href="#cb65-2728" aria-hidden="true" tabindex="-1"></a><span class="st">    # Apply selected subset strategy</span></span>
<span id="cb65-2729"><a href="#cb65-2729" aria-hidden="true" tabindex="-1"></a><span class="st">    x_range, y_range = selected_strategy["x_range"], selected_strategy["y_range"]</span></span>
<span id="cb65-2730"><a href="#cb65-2730" aria-hidden="true" tabindex="-1"></a><span class="st">    subset_bbox = get_subset_from_scene(best_scene, x_range=x_range, y_range=y_range)</span></span>
<span id="cb65-2731"><a href="#cb65-2731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2732"><a href="#cb65-2732" aria-hidden="true" tabindex="-1"></a><span class="st">    # Calculate expected data characteristics</span></span>
<span id="cb65-2733"><a href="#cb65-2733" aria-hidden="true" tabindex="-1"></a><span class="st">    subset_area_km2 = scene_info['</span>area_km2<span class="st">'] * (selected_strategy['</span>coverage<span class="st">'] / 100)</span></span>
<span id="cb65-2734"><a href="#cb65-2734" aria-hidden="true" tabindex="-1"></a><span class="st">    estimated_pixels_10m = subset_area_km2 * 1e6 / (10 * 10)  # 10m pixel size</span></span>
<span id="cb65-2735"><a href="#cb65-2735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2736"><a href="#cb65-2736" aria-hidden="true" tabindex="-1"></a><span class="st">    # Log subset characteristics</span></span>
<span id="cb65-2737"><a href="#cb65-2737" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"Subset: {subset_area_km2:.0f} km², {estimated_pixels_10m:,.0f} pixels, ~{estimated_pixels_10m * 4 * 2 / 1e6:.1f} MB")</span></span>
<span id="cb65-2738"><a href="#cb65-2738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2739"><a href="#cb65-2739" aria-hidden="true" tabindex="-1"></a><span class="st">    # Alternative subset strategies available for experimentation</span></span>
<span id="cb65-2740"><a href="#cb65-2740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2741"><a href="#cb65-2741" aria-hidden="true" tabindex="-1"></a><span class="st">    # Core bands for essential analysis</span></span>
<span id="cb65-2742"><a href="#cb65-2742" aria-hidden="true" tabindex="-1"></a><span class="st">    core_bands = ['</span>B04<span class="st">', '</span>B03<span class="st">', '</span>B02<span class="st">', '</span>B08<span class="st">']  # Red, Green, Blue, NIR</span></span>
<span id="cb65-2743"><a href="#cb65-2743" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"Selected {len(core_bands)} core bands for RGB and NDVI analysis")</span></span>
<span id="cb65-2744"><a href="#cb65-2744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2745"><a href="#cb65-2745" aria-hidden="true" tabindex="-1"></a><span class="st">else:</span></span>
<span id="cb65-2746"><a href="#cb65-2746" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.warning("No optimal scene available - using default configuration")</span></span>
<span id="cb65-2747"><a href="#cb65-2747" aria-hidden="true" tabindex="-1"></a><span class="st">    core_bands = ['</span>B04<span class="st">', '</span>B03<span class="st">', '</span>B02<span class="st">', '</span>B08<span class="st">']  # Default selection</span></span>
<span id="cb65-2748"><a href="#cb65-2748" aria-hidden="true" tabindex="-1"></a><span class="st">    subset_bbox = None</span></span>
<span id="cb65-2749"><a href="#cb65-2749" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-2750"><a href="#cb65-2750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2751"><a href="#cb65-2751" aria-hidden="true" tabindex="-1"></a><span class="st">### 6.3 High-Performance Data Loading Implementation</span></span>
<span id="cb65-2752"><a href="#cb65-2752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2753"><a href="#cb65-2753" aria-hidden="true" tabindex="-1"></a><span class="st">Now we'</span>ll implement the actual data loading with comprehensive error handling and performance monitoring:</span>
<span id="cb65-2754"><a href="#cb65-2754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2755"><a href="#cb65-2755" aria-hidden="true" tabindex="-1"></a><span class="ex">**Executing</span> Production-Grade Data Loading:<span class="pp">**</span></span>
<span id="cb65-2756"><a href="#cb65-2756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2757"><a href="#cb65-2757" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> demonstrates enterprise-level error handling and performance optimization with comprehensive pre-loading validation.</span>
<span id="cb65-2758"><a href="#cb65-2758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2761"><a href="#cb65-2761" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-2762"><a href="#cb65-2762" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5B: Execute Robust Data Loading with Performance Monitoring</span></span>
<span id="cb65-2763"><a href="#cb65-2763" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'best_scene'</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="ex">and</span> <span class="st">'subset_bbox'</span> in locals<span class="er">(</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb65-2764"><a href="#cb65-2764" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pre-loading validation and preparation</span></span>
<span id="cb65-2765"><a href="#cb65-2765" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Loading scene {best_scene.id}: {len(core_bands)} bands, ~{estimated_pixels_10m * len(core_bands) * 2 / 1e6:.1f} MB"</span><span class="kw">)</span></span>
<span id="cb65-2766"><a href="#cb65-2766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2767"><a href="#cb65-2767" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enhanced loading with comprehensive monitoring</span></span>
<span id="cb65-2768"><a href="#cb65-2768" aria-hidden="true" tabindex="-1"></a>    <span class="ex">loading_start_time</span> = time.time<span class="er">(</span><span class="kw">)</span></span>
<span id="cb65-2769"><a href="#cb65-2769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2770"><a href="#cb65-2770" aria-hidden="true" tabindex="-1"></a>    <span class="ex">try:</span></span>
<span id="cb65-2771"><a href="#cb65-2771" aria-hidden="true" tabindex="-1"></a>        <span class="ex">band_data</span> = load_sentinel2_bands<span class="er">(</span></span>
<span id="cb65-2772"><a href="#cb65-2772" aria-hidden="true" tabindex="-1"></a>            <span class="ex">best_scene,</span></span>
<span id="cb65-2773"><a href="#cb65-2773" aria-hidden="true" tabindex="-1"></a>            <span class="va">bands</span><span class="op">=</span>core_bands,</span>
<span id="cb65-2774"><a href="#cb65-2774" aria-hidden="true" tabindex="-1"></a>            <span class="va">subset_bbox</span><span class="op">=</span>subset_bbox,</span>
<span id="cb65-2775"><a href="#cb65-2775" aria-hidden="true" tabindex="-1"></a>            <span class="va">max_retries</span><span class="op">=</span>5</span>
<span id="cb65-2776"><a href="#cb65-2776" aria-hidden="true" tabindex="-1"></a>        <span class="kw">)</span></span>
<span id="cb65-2777"><a href="#cb65-2777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2778"><a href="#cb65-2778" aria-hidden="true" tabindex="-1"></a>        <span class="ex">loading_duration</span> = time.time<span class="er">(</span><span class="kw">)</span> <span class="ex">-</span> loading_start_time</span>
<span id="cb65-2779"><a href="#cb65-2779" aria-hidden="true" tabindex="-1"></a>        <span class="ex">transfer_rate</span> = <span class="er">(</span><span class="ex">estimated_pixels_10m</span> <span class="pp">*</span> len<span class="er">(</span><span class="ex">core_bands</span><span class="kw">)</span> <span class="ex">*</span> 2 / 1e6<span class="kw">)</span> <span class="ex">/</span> loading_duration</span>
<span id="cb65-2780"><a href="#cb65-2780" aria-hidden="true" tabindex="-1"></a>        <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Data loading successful: {loading_duration:.1f}s, {transfer_rate:.1f} MB/s"</span><span class="kw">)</span></span>
<span id="cb65-2781"><a href="#cb65-2781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2782"><a href="#cb65-2782" aria-hidden="true" tabindex="-1"></a>    <span class="ex">except</span> Exception as loading_error:</span>
<span id="cb65-2783"><a href="#cb65-2783" aria-hidden="true" tabindex="-1"></a>        <span class="ex">loading_duration</span> = time.time<span class="er">(</span><span class="kw">)</span> <span class="ex">-</span> loading_start_time</span>
<span id="cb65-2784"><a href="#cb65-2784" aria-hidden="true" tabindex="-1"></a>        <span class="ex">logger.error</span><span class="er">(</span><span class="ex">f</span><span class="st">"Data loading failed after {loading_duration:.1f}s: {str(loading_error)[:80]}"</span><span class="kw">)</span></span>
<span id="cb65-2785"><a href="#cb65-2785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2786"><a href="#cb65-2786" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fallback 1: Try without subset</span></span>
<span id="cb65-2787"><a href="#cb65-2787" aria-hidden="true" tabindex="-1"></a>        <span class="ex">try:</span></span>
<span id="cb65-2788"><a href="#cb65-2788" aria-hidden="true" tabindex="-1"></a>            <span class="ex">band_data</span> = load_sentinel2_bands<span class="er">(</span></span>
<span id="cb65-2789"><a href="#cb65-2789" aria-hidden="true" tabindex="-1"></a>                <span class="ex">best_scene,</span></span>
<span id="cb65-2790"><a href="#cb65-2790" aria-hidden="true" tabindex="-1"></a>                <span class="va">bands</span><span class="op">=</span>core_bands,</span>
<span id="cb65-2791"><a href="#cb65-2791" aria-hidden="true" tabindex="-1"></a>                <span class="va">subset_bbox</span><span class="op">=</span>None,</span>
<span id="cb65-2792"><a href="#cb65-2792" aria-hidden="true" tabindex="-1"></a>                <span class="va">max_retries</span><span class="op">=</span>3</span>
<span id="cb65-2793"><a href="#cb65-2793" aria-hidden="true" tabindex="-1"></a>            <span class="kw">)</span></span>
<span id="cb65-2794"><a href="#cb65-2794" aria-hidden="true" tabindex="-1"></a>            <span class="ex">logger.info</span><span class="er">(</span><span class="st">"Full scene loading successful"</span><span class="kw">)</span></span>
<span id="cb65-2795"><a href="#cb65-2795" aria-hidden="true" tabindex="-1"></a>            <span class="ex">subset_bbox</span> = None</span>
<span id="cb65-2796"><a href="#cb65-2796" aria-hidden="true" tabindex="-1"></a>        <span class="ex">except</span> Exception as full_scene_error:</span>
<span id="cb65-2797"><a href="#cb65-2797" aria-hidden="true" tabindex="-1"></a>            <span class="ex">logger.warning</span><span class="er">(</span><span class="ex">f</span><span class="st">"Full scene loading failed: {str(full_scene_error)[:80]}"</span><span class="kw">)</span></span>
<span id="cb65-2798"><a href="#cb65-2798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2799"><a href="#cb65-2799" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Fallback 2: Reduce band count</span></span>
<span id="cb65-2800"><a href="#cb65-2800" aria-hidden="true" tabindex="-1"></a>            <span class="ex">try:</span></span>
<span id="cb65-2801"><a href="#cb65-2801" aria-hidden="true" tabindex="-1"></a>                <span class="ex">essential_bands</span> = [<span class="st">'B04'</span>, <span class="st">'B08'</span>]  <span class="co"># Minimum for NDVI</span></span>
<span id="cb65-2802"><a href="#cb65-2802" aria-hidden="true" tabindex="-1"></a>                <span class="ex">band_data</span> = load_sentinel2_bands<span class="er">(</span></span>
<span id="cb65-2803"><a href="#cb65-2803" aria-hidden="true" tabindex="-1"></a>                    <span class="ex">best_scene,</span></span>
<span id="cb65-2804"><a href="#cb65-2804" aria-hidden="true" tabindex="-1"></a>                    <span class="va">bands</span><span class="op">=</span>essential_bands,</span>
<span id="cb65-2805"><a href="#cb65-2805" aria-hidden="true" tabindex="-1"></a>                    <span class="va">subset_bbox</span><span class="op">=</span>subset_bbox,</span>
<span id="cb65-2806"><a href="#cb65-2806" aria-hidden="true" tabindex="-1"></a>                    <span class="va">max_retries</span><span class="op">=</span>3</span>
<span id="cb65-2807"><a href="#cb65-2807" aria-hidden="true" tabindex="-1"></a>                <span class="kw">)</span></span>
<span id="cb65-2808"><a href="#cb65-2808" aria-hidden="true" tabindex="-1"></a>                <span class="ex">core_bands</span> = essential_bands</span>
<span id="cb65-2809"><a href="#cb65-2809" aria-hidden="true" tabindex="-1"></a>                <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Reduced band loading successful ({len(essential_bands)} bands)"</span><span class="kw">)</span></span>
<span id="cb65-2810"><a href="#cb65-2810" aria-hidden="true" tabindex="-1"></a>            <span class="ex">except</span> Exception as reduced_error:</span>
<span id="cb65-2811"><a href="#cb65-2811" aria-hidden="true" tabindex="-1"></a>                <span class="ex">logger.error</span><span class="er">(</span><span class="st">"All loading strategies failed - creating synthetic data"</span><span class="kw">)</span></span>
<span id="cb65-2812"><a href="#cb65-2812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2813"><a href="#cb65-2813" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Create realistic synthetic data for educational continuity</span></span>
<span id="cb65-2814"><a href="#cb65-2814" aria-hidden="true" tabindex="-1"></a>                <span class="ex">synthetic_size</span> = <span class="er">(</span><span class="ex">1000,</span> 1000<span class="kw">)</span></span>
<span id="cb65-2815"><a href="#cb65-2815" aria-hidden="true" tabindex="-1"></a>                <span class="ex">band_data</span> = {</span>
<span id="cb65-2816"><a href="#cb65-2816" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B04'</span><span class="ex">:</span> np.random.randint<span class="er">(</span><span class="ex">1000,</span> 4000, synthetic_size, dtype=np.uint16<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-2817"><a href="#cb65-2817" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B03'</span><span class="ex">:</span> np.random.randint<span class="er">(</span><span class="ex">1000,</span> 4000, synthetic_size, dtype=np.uint16<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-2818"><a href="#cb65-2818" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B02'</span><span class="ex">:</span> np.random.randint<span class="er">(</span><span class="ex">1000,</span> 4000, synthetic_size, dtype=np.uint16<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-2819"><a href="#cb65-2819" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B08'</span><span class="ex">:</span> np.random.randint<span class="er">(</span><span class="ex">2000,</span> 6000, synthetic_size, dtype=np.uint16<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-2820"><a href="#cb65-2820" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'transform'</span><span class="ex">:</span> None,</span>
<span id="cb65-2821"><a href="#cb65-2821" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'crs'</span><span class="ex">:</span> None,</span>
<span id="cb65-2822"><a href="#cb65-2822" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'bounds'</span><span class="ex">:</span> subset_bbox if subset_bbox else santa_barbara_bbox,</span>
<span id="cb65-2823"><a href="#cb65-2823" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'scene_id'</span><span class="ex">:</span> <span class="st">'SYNTHETIC_DEMO'</span>,</span>
<span id="cb65-2824"><a href="#cb65-2824" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'date'</span><span class="ex">:</span> <span class="st">'2024-01-01'</span></span>
<span id="cb65-2825"><a href="#cb65-2825" aria-hidden="true" tabindex="-1"></a>                <span class="er">}</span></span>
<span id="cb65-2826"><a href="#cb65-2826" aria-hidden="true" tabindex="-1"></a>                <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Synthetic data created: {synthetic_size[0]}×{synthetic_size[1]} pixels"</span><span class="kw">)</span></span>
<span id="cb65-2827"><a href="#cb65-2827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2828"><a href="#cb65-2828" aria-hidden="true" tabindex="-1"></a><span class="ex">else:</span></span>
<span id="cb65-2829"><a href="#cb65-2829" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback for educational purposes</span></span>
<span id="cb65-2830"><a href="#cb65-2830" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="st">"No scene available - creating educational synthetic dataset"</span><span class="kw">)</span></span>
<span id="cb65-2831"><a href="#cb65-2831" aria-hidden="true" tabindex="-1"></a>    <span class="ex">synthetic_size</span> = <span class="er">(</span><span class="ex">800,</span> 800<span class="kw">)</span></span>
<span id="cb65-2832"><a href="#cb65-2832" aria-hidden="true" tabindex="-1"></a>    <span class="ex">band_data</span> = {</span>
<span id="cb65-2833"><a href="#cb65-2833" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B04'</span><span class="ex">:</span> np.random.randint<span class="er">(</span><span class="ex">1000,</span> 4000, synthetic_size, dtype=np.uint16<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-2834"><a href="#cb65-2834" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B03'</span><span class="ex">:</span> np.random.randint<span class="er">(</span><span class="ex">1000,</span> 4000, synthetic_size, dtype=np.uint16<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-2835"><a href="#cb65-2835" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B02'</span><span class="ex">:</span> np.random.randint<span class="er">(</span><span class="ex">1000,</span> 4000, synthetic_size, dtype=np.uint16<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-2836"><a href="#cb65-2836" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B08'</span><span class="ex">:</span> np.random.randint<span class="er">(</span><span class="ex">2000,</span> 6000, synthetic_size, dtype=np.uint16<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-2837"><a href="#cb65-2837" aria-hidden="true" tabindex="-1"></a>        <span class="st">'transform'</span><span class="ex">:</span> None,</span>
<span id="cb65-2838"><a href="#cb65-2838" aria-hidden="true" tabindex="-1"></a>        <span class="st">'crs'</span><span class="ex">:</span> None,</span>
<span id="cb65-2839"><a href="#cb65-2839" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bounds'</span><span class="ex">:</span> [-122.5, 37.7, <span class="at">-122.35,</span> 37.85],</span>
<span id="cb65-2840"><a href="#cb65-2840" aria-hidden="true" tabindex="-1"></a>        <span class="st">'scene_id'</span><span class="ex">:</span> <span class="st">'EDUCATIONAL_DEMO'</span>,</span>
<span id="cb65-2841"><a href="#cb65-2841" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span><span class="ex">:</span> <span class="st">'2024-01-01'</span></span>
<span id="cb65-2842"><a href="#cb65-2842" aria-hidden="true" tabindex="-1"></a>    <span class="er">}</span></span>
<span id="cb65-2843"><a href="#cb65-2843" aria-hidden="true" tabindex="-1"></a>    <span class="ex">core_bands</span> = [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>, <span class="st">'B08'</span>]</span>
<span id="cb65-2844"><a href="#cb65-2844" aria-hidden="true" tabindex="-1"></a>    <span class="ex">subset_bbox</span> = None</span>
<span id="cb65-2845"><a href="#cb65-2845" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Educational dataset ready: {synthetic_size[0]}×{synthetic_size[1]} pixels"</span><span class="kw">)</span></span>
<span id="cb65-2846"><a href="#cb65-2846" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-2847"><a href="#cb65-2847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2848"><a href="#cb65-2848" aria-hidden="true" tabindex="-1"></a><span class="co">### 6.4 Comprehensive Data Validation and Quality Assessment</span></span>
<span id="cb65-2849"><a href="#cb65-2849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2850"><a href="#cb65-2850" aria-hidden="true" tabindex="-1"></a><span class="ex">After</span> loading, we must validate data quality and completeness before proceeding with analysis:</span>
<span id="cb65-2851"><a href="#cb65-2851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2852"><a href="#cb65-2852" aria-hidden="true" tabindex="-1"></a><span class="ex">**Performing</span> Comprehensive Data Validation:<span class="pp">**</span></span>
<span id="cb65-2853"><a href="#cb65-2853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2854"><a href="#cb65-2854" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> demonstrates production-level quality assurance for satellite data including validation of data loading success and quality metrics.</span>
<span id="cb65-2855"><a href="#cb65-2855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2858"><a href="#cb65-2858" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-2859"><a href="#cb65-2859" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5C: Comprehensive Data Validation and Quality Assessment</span></span>
<span id="cb65-2860"><a href="#cb65-2860" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate successful data loading</span></span>
<span id="cb65-2861"><a href="#cb65-2861" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'band_data'</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="ex">and</span> band_data:</span>
<span id="cb65-2862"><a href="#cb65-2862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2863"><a href="#cb65-2863" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract loaded bands and metadata</span></span>
<span id="cb65-2864"><a href="#cb65-2864" aria-hidden="true" tabindex="-1"></a>    <span class="ex">available_bands</span> = [b for b in core_bands if b in band_data and isinstance<span class="er">(</span><span class="va">band_data</span><span class="op">[</span>b<span class="op">]</span><span class="ex">,</span> np.ndarray<span class="kw">)</span><span class="ex">]</span></span>
<span id="cb65-2865"><a href="#cb65-2865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2866"><a href="#cb65-2866" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract georeferencing information</span></span>
<span id="cb65-2867"><a href="#cb65-2867" aria-hidden="true" tabindex="-1"></a>    <span class="ex">transform</span> = band_data.get<span class="er">(</span><span class="st">'transform'</span><span class="ex">,</span> None<span class="kw">)</span></span>
<span id="cb65-2868"><a href="#cb65-2868" aria-hidden="true" tabindex="-1"></a>    <span class="ex">crs</span> = band_data.get<span class="er">(</span><span class="st">'crs'</span><span class="ex">,</span> None<span class="kw">)</span></span>
<span id="cb65-2869"><a href="#cb65-2869" aria-hidden="true" tabindex="-1"></a>    <span class="ex">bounds</span> = band_data.get<span class="er">(</span><span class="st">'bounds'</span><span class="ex">,</span> subset_bbox if <span class="st">'subset_bbox'</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="cf">else</span> <span class="ex">santa_barbara_bbox</span><span class="kw">)</span></span>
<span id="cb65-2870"><a href="#cb65-2870" aria-hidden="true" tabindex="-1"></a>    <span class="ex">scene_id</span> = band_data.get<span class="er">(</span><span class="st">'scene_id'</span><span class="ex">,</span> <span class="st">'Unknown'</span><span class="kw">)</span></span>
<span id="cb65-2871"><a href="#cb65-2871" aria-hidden="true" tabindex="-1"></a>    <span class="ex">acquisition_date</span> = band_data.get<span class="er">(</span><span class="st">'date'</span><span class="ex">,</span> <span class="st">'Unknown'</span><span class="kw">)</span></span>
<span id="cb65-2872"><a href="#cb65-2872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2873"><a href="#cb65-2873" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Loaded {len(available_bands)}/{len(core_bands)} bands: {available_bands}"</span><span class="kw">)</span></span>
<span id="cb65-2874"><a href="#cb65-2874" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Scene: {scene_id} ({acquisition_date})"</span><span class="kw">)</span></span>
<span id="cb65-2875"><a href="#cb65-2875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2876"><a href="#cb65-2876" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Quality assessment</span></span>
<span id="cb65-2877"><a href="#cb65-2877" aria-hidden="true" tabindex="-1"></a>    <span class="ex">band_stats_summary</span> = {}</span>
<span id="cb65-2878"><a href="#cb65-2878" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_name <span class="kw">in</span> available_bands:</span>
<span id="cb65-2879"><a href="#cb65-2879" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="ex">band_name</span> in band_data:</span>
<span id="cb65-2880"><a href="#cb65-2880" aria-hidden="true" tabindex="-1"></a>            <span class="ex">stats</span> = calculate_band_statistics<span class="er">(</span><span class="va">band_data</span><span class="op">[</span>band_name<span class="op">]</span><span class="ex">,</span> band_name<span class="kw">)</span></span>
<span id="cb65-2881"><a href="#cb65-2881" aria-hidden="true" tabindex="-1"></a>            <span class="va">band_stats_summary</span><span class="op">[</span>band_name<span class="op">]</span> <span class="ex">=</span> stats</span>
<span id="cb65-2882"><a href="#cb65-2882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2883"><a href="#cb65-2883" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Quality flags</span></span>
<span id="cb65-2884"><a href="#cb65-2884" aria-hidden="true" tabindex="-1"></a>            <span class="ex">quality_flags</span> = []</span>
<span id="cb65-2885"><a href="#cb65-2885" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">stats</span><span class="op">[</span><span class="st">'valid_pixels'</span><span class="op">]</span> <span class="op">&lt;</span> stats<span class="pp">[</span><span class="st">'total_pixels'</span><span class="pp">]</span> <span class="ex">*</span> 0.95:</span>
<span id="cb65-2886"><a href="#cb65-2886" aria-hidden="true" tabindex="-1"></a>                <span class="ex">quality_flags.append</span><span class="er">(</span><span class="st">"invalid pixels"</span><span class="kw">)</span></span>
<span id="cb65-2887"><a href="#cb65-2887" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">stats</span><span class="op">[</span><span class="st">'std'</span><span class="op">]</span> <span class="op">&lt;</span> 10:</span>
<span id="cb65-2888"><a href="#cb65-2888" aria-hidden="true" tabindex="-1"></a>                <span class="ex">quality_flags.append</span><span class="er">(</span><span class="st">"low variance"</span><span class="kw">)</span></span>
<span id="cb65-2889"><a href="#cb65-2889" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">stats</span><span class="op">[</span><span class="st">'max'</span><span class="op">]</span> <span class="op">&gt;</span> 10000:</span>
<span id="cb65-2890"><a href="#cb65-2890" aria-hidden="true" tabindex="-1"></a>                <span class="ex">quality_flags.append</span><span class="er">(</span><span class="st">"possible saturation"</span><span class="kw">)</span></span>
<span id="cb65-2891"><a href="#cb65-2891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2892"><a href="#cb65-2892" aria-hidden="true" tabindex="-1"></a>            <span class="ex">quality_status</span> = <span class="st">"; "</span>.join<span class="er">(</span><span class="ex">quality_flags</span><span class="kw">)</span> <span class="cf">if</span> <span class="ex">quality_flags</span> else <span class="st">"normal"</span></span>
<span id="cb65-2893"><a href="#cb65-2893" aria-hidden="true" tabindex="-1"></a>            <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"{band_name}: range [{stats['min']:.0f}, {stats['max']:.0f}], quality: {quality_status}"</span><span class="kw">)</span></span>
<span id="cb65-2894"><a href="#cb65-2894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2895"><a href="#cb65-2895" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cross-band validation</span></span>
<span id="cb65-2896"><a href="#cb65-2896" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="ex">len</span><span class="er">(</span><span class="ex">available_bands</span><span class="kw">)</span> <span class="op">&gt;</span>= <span class="ex">2:</span></span>
<span id="cb65-2897"><a href="#cb65-2897" aria-hidden="true" tabindex="-1"></a>        <span class="ex">shapes</span> = [band_data<span class="pp">[</span><span class="ss">band</span><span class="pp">]</span>.shape for band in available_bands]</span>
<span id="cb65-2898"><a href="#cb65-2898" aria-hidden="true" tabindex="-1"></a>        <span class="ex">consistent_shape</span> = all<span class="er">(</span><span class="ex">shape</span> == shapes<span class="pp">[</span><span class="ss">0</span><span class="pp">]</span> for shape in shapes<span class="kw">)</span></span>
<span id="cb65-2899"><a href="#cb65-2899" aria-hidden="true" tabindex="-1"></a>        <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Spatial consistency: {'✓' if consistent_shape else '⚠'} shape {shapes[0] if consistent_shape else 'mixed'}"</span><span class="kw">)</span></span>
<span id="cb65-2900"><a href="#cb65-2900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2901"><a href="#cb65-2901" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check for reasonable spectral relationships</span></span>
<span id="cb65-2902"><a href="#cb65-2902" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'B04'</span> in available_bands and <span class="st">'B08'</span> in available_bands:</span>
<span id="cb65-2903"><a href="#cb65-2903" aria-hidden="true" tabindex="-1"></a>            <span class="ex">ndvi_sample</span> = calculate_ndvi<span class="er">(</span><span class="va">band_data</span><span class="op">[</span><span class="st">'B08'</span><span class="op">][</span>:100, :100<span class="op">]</span><span class="ex">,</span> band_data<span class="pp">[</span><span class="st">'B04'</span><span class="pp">]</span>[:100, :100]<span class="kw">)</span></span>
<span id="cb65-2904"><a href="#cb65-2904" aria-hidden="true" tabindex="-1"></a>            <span class="ex">ndvi_mean</span> = np.nanmean<span class="er">(</span><span class="ex">ndvi_sample</span><span class="kw">)</span></span>
<span id="cb65-2905"><a href="#cb65-2905" aria-hidden="true" tabindex="-1"></a>            <span class="co"># NDVI sanity check</span></span>
<span id="cb65-2906"><a href="#cb65-2906" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="ex">-1</span> <span class="op">&lt;</span>= ndvi_mean <span class="op">&lt;</span>= 1:</span>
<span id="cb65-2907"><a href="#cb65-2907" aria-hidden="true" tabindex="-1"></a>                <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"NDVI validation passed: mean = {ndvi_mean:.3f}"</span><span class="kw">)</span></span>
<span id="cb65-2908"><a href="#cb65-2908" aria-hidden="true" tabindex="-1"></a>            <span class="ex">else:</span></span>
<span id="cb65-2909"><a href="#cb65-2909" aria-hidden="true" tabindex="-1"></a>                <span class="ex">logger.warning</span><span class="er">(</span><span class="ex">f</span><span class="st">"NDVI anomaly detected: mean = {ndvi_mean:.3f}"</span><span class="kw">)</span></span>
<span id="cb65-2910"><a href="#cb65-2910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2911"><a href="#cb65-2911" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overall data readiness assessment</span></span>
<span id="cb65-2912"><a href="#cb65-2912" aria-hidden="true" tabindex="-1"></a>    <span class="ex">readiness_score</span> = 0</span>
<span id="cb65-2913"><a href="#cb65-2913" aria-hidden="true" tabindex="-1"></a>    <span class="ex">readiness_criteria</span> = {</span>
<span id="cb65-2914"><a href="#cb65-2914" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bands_available'</span><span class="ex">:</span> len<span class="er">(</span><span class="ex">available_bands</span><span class="kw">)</span> <span class="op">&gt;</span>= <span class="ex">3,</span>  <span class="co"># Minimum for RGB</span></span>
<span id="cb65-2915"><a href="#cb65-2915" aria-hidden="true" tabindex="-1"></a>        <span class="st">'spatial_consistency'</span><span class="ex">:</span> <span class="st">'consistent_shape'</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="ex">and</span> consistent_shape,</span>
<span id="cb65-2916"><a href="#cb65-2916" aria-hidden="true" tabindex="-1"></a>        <span class="st">'valid_pixels'</span><span class="ex">:</span> all<span class="er">(</span><span class="va">stats</span><span class="op">[</span><span class="st">'valid_pixels'</span><span class="op">]</span> <span class="op">&gt;</span> stats<span class="pp">[</span><span class="st">'total_pixels'</span><span class="pp">]</span> <span class="ex">*</span> 0.9 for stats in band_stats_summary.values<span class="er">(</span><span class="kw">))</span><span class="ex">,</span></span>
<span id="cb65-2917"><a href="#cb65-2917" aria-hidden="true" tabindex="-1"></a>        <span class="st">'spectral_sanity'</span><span class="ex">:</span> <span class="st">'ndvi_mean'</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="ex">and</span> <span class="at">-1</span> <span class="op">&lt;</span>= ndvi_mean <span class="op">&lt;</span>= 1</span>
<span id="cb65-2918"><a href="#cb65-2918" aria-hidden="true" tabindex="-1"></a>    <span class="er">}</span></span>
<span id="cb65-2919"><a href="#cb65-2919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2920"><a href="#cb65-2920" aria-hidden="true" tabindex="-1"></a>    <span class="ex">readiness_score</span> = sum<span class="er">(</span><span class="fu">readiness_criteria.values()</span><span class="kw">)</span></span>
<span id="cb65-2921"><a href="#cb65-2921" aria-hidden="true" tabindex="-1"></a>    <span class="ex">max_score</span> = len<span class="er">(</span><span class="ex">readiness_criteria</span><span class="kw">)</span></span>
<span id="cb65-2922"><a href="#cb65-2922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2923"><a href="#cb65-2923" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overall data readiness assessment</span></span>
<span id="cb65-2924"><a href="#cb65-2924" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Data readiness: {readiness_score}/{max_score} criteria passed"</span><span class="kw">)</span></span>
<span id="cb65-2925"><a href="#cb65-2925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2926"><a href="#cb65-2926" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="ex">readiness_score</span> <span class="op">&gt;</span>= max_score <span class="pp">*</span> 0.75:</span>
<span id="cb65-2927"><a href="#cb65-2927" aria-hidden="true" tabindex="-1"></a>        <span class="ex">logger.info</span><span class="er">(</span><span class="st">"STATUS: READY for analysis - High quality data confirmed"</span><span class="kw">)</span></span>
<span id="cb65-2928"><a href="#cb65-2928" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="ex">readiness_score</span> <span class="op">&gt;</span>= max_score <span class="pp">*</span> 0.5:</span>
<span id="cb65-2929"><a href="#cb65-2929" aria-hidden="true" tabindex="-1"></a>        <span class="ex">logger.warning</span><span class="er">(</span><span class="st">"STATUS: PROCEED WITH CAUTION - Some quality issues detected"</span><span class="kw">)</span></span>
<span id="cb65-2930"><a href="#cb65-2930" aria-hidden="true" tabindex="-1"></a>    <span class="ex">else:</span></span>
<span id="cb65-2931"><a href="#cb65-2931" aria-hidden="true" tabindex="-1"></a>        <span class="ex">logger.error</span><span class="er">(</span><span class="st">"STATUS: QUALITY ISSUES - Consider alternative data sources"</span><span class="kw">)</span></span>
<span id="cb65-2932"><a href="#cb65-2932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2933"><a href="#cb65-2933" aria-hidden="true" tabindex="-1"></a><span class="ex">else:</span></span>
<span id="cb65-2934"><a href="#cb65-2934" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.error</span><span class="er">(</span><span class="st">"Data validation failed - no valid satellite data available"</span><span class="kw">)</span></span>
<span id="cb65-2935"><a href="#cb65-2935" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-2936"><a href="#cb65-2936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2937"><a href="#cb65-2937" aria-hidden="true" tabindex="-1"></a><span class="co">### 6.5 Creating AI-Ready Multi-Dimensional Datasets</span></span>
<span id="cb65-2938"><a href="#cb65-2938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2939"><a href="#cb65-2939" aria-hidden="true" tabindex="-1"></a><span class="ex">Transform</span> loaded bands into analysis-ready xarray datasets optimized for AI/ML workflows:</span>
<span id="cb65-2940"><a href="#cb65-2940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2941"><a href="#cb65-2941" aria-hidden="true" tabindex="-1"></a><span class="ex">**Creating</span> AI-Ready Multi-Dimensional Dataset:<span class="pp">**</span></span>
<span id="cb65-2942"><a href="#cb65-2942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2943"><a href="#cb65-2943" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> demonstrates data structuring for machine learning applications, transforming raw satellite bands into analysis-ready xarray datasets.</span>
<span id="cb65-2944"><a href="#cb65-2944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2947"><a href="#cb65-2947" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-2948"><a href="#cb65-2948" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5D: Build AI-Ready Multi-Dimensional Dataset</span></span>
<span id="cb65-2949"><a href="#cb65-2949" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'band_data'</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="ex">and</span> band_data and available_bands:</span>
<span id="cb65-2950"><a href="#cb65-2950" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get spatial dimensions from first available band</span></span>
<span id="cb65-2951"><a href="#cb65-2951" aria-hidden="true" tabindex="-1"></a>    <span class="ex">sample_band</span> = band_data[available_bands<span class="pp">[</span><span class="ss">0</span><span class="pp">]</span>]</span>
<span id="cb65-2952"><a href="#cb65-2952" aria-hidden="true" tabindex="-1"></a>    <span class="ex">height,</span> width = sample_band.shape</span>
<span id="cb65-2953"><a href="#cb65-2953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2954"><a href="#cb65-2954" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dataset characteristics</span></span>
<span id="cb65-2955"><a href="#cb65-2955" aria-hidden="true" tabindex="-1"></a>    <span class="ex">total_elements</span> = height <span class="pp">*</span> width <span class="pp">*</span> len<span class="er">(</span><span class="ex">available_bands</span><span class="kw">)</span></span>
<span id="cb65-2956"><a href="#cb65-2956" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Dataset: {height}×{width} pixels, {len(available_bands)} bands, {total_elements:,} elements"</span><span class="kw">)</span></span>
<span id="cb65-2957"><a href="#cb65-2957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2958"><a href="#cb65-2958" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create sophisticated coordinate system</span></span>
<span id="cb65-2959"><a href="#cb65-2959" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="ex">bounds</span> and len<span class="er">(</span><span class="ex">bounds</span><span class="kw">)</span> <span class="ex">==</span> 4:</span>
<span id="cb65-2960"><a href="#cb65-2960" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Geographic coordinates (WGS84)</span></span>
<span id="cb65-2961"><a href="#cb65-2961" aria-hidden="true" tabindex="-1"></a>        <span class="ex">x_coords</span> = np.linspace<span class="er">(</span><span class="va">bounds</span><span class="op">[</span><span class="dv">0</span><span class="op">]</span><span class="ex">,</span> bounds<span class="pp">[</span><span class="ss">2</span><span class="pp">]</span>, width<span class="kw">)</span>   <span class="co"># Longitude</span></span>
<span id="cb65-2962"><a href="#cb65-2962" aria-hidden="true" tabindex="-1"></a>        <span class="ex">y_coords</span> = np.linspace<span class="er">(</span><span class="va">bounds</span><span class="op">[</span><span class="dv">3</span><span class="op">]</span><span class="ex">,</span> bounds<span class="pp">[</span><span class="ss">1</span><span class="pp">]</span>, height<span class="kw">)</span>  <span class="co"># Latitude (north to south)</span></span>
<span id="cb65-2963"><a href="#cb65-2963" aria-hidden="true" tabindex="-1"></a>        <span class="ex">coord_system</span> = <span class="st">"geographic"</span></span>
<span id="cb65-2964"><a href="#cb65-2964" aria-hidden="true" tabindex="-1"></a>    <span class="ex">else:</span></span>
<span id="cb65-2965"><a href="#cb65-2965" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pixel coordinates</span></span>
<span id="cb65-2966"><a href="#cb65-2966" aria-hidden="true" tabindex="-1"></a>        <span class="ex">x_coords</span> = np.arange<span class="er">(</span><span class="ex">width</span><span class="kw">)</span></span>
<span id="cb65-2967"><a href="#cb65-2967" aria-hidden="true" tabindex="-1"></a>        <span class="ex">y_coords</span> = np.arange<span class="er">(</span><span class="ex">height</span><span class="kw">)</span></span>
<span id="cb65-2968"><a href="#cb65-2968" aria-hidden="true" tabindex="-1"></a>        <span class="ex">coord_system</span> = <span class="st">"pixel"</span></span>
<span id="cb65-2969"><a href="#cb65-2969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2970"><a href="#cb65-2970" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.debug</span><span class="er">(</span><span class="ex">f</span><span class="st">"Coordinates: {coord_system}, X: {x_coords[0]:.4f} to {x_coords[-1]:.4f}, Y: {y_coords[0]:.4f} to {y_coords[-1]:.4f}"</span><span class="kw">)</span></span>
<span id="cb65-2971"><a href="#cb65-2971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2972"><a href="#cb65-2972" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build xarray DataArrays with comprehensive metadata</span></span>
<span id="cb65-2973"><a href="#cb65-2973" aria-hidden="true" tabindex="-1"></a>    <span class="ex">data_arrays</span> = {}</span>
<span id="cb65-2974"><a href="#cb65-2974" aria-hidden="true" tabindex="-1"></a>    <span class="ex">band_metadata</span> = {</span>
<span id="cb65-2975"><a href="#cb65-2975" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B02'</span><span class="ex">:</span> {<span class="st">'name'</span>: <span class="st">'blue'</span>, <span class="st">'wavelength'</span>: 490, <span class="st">'description'</span>: <span class="st">'Blue band (coastal/aerosol)'</span>},</span>
<span id="cb65-2976"><a href="#cb65-2976" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B03'</span><span class="ex">:</span> {<span class="st">'name'</span>: <span class="st">'green'</span>, <span class="st">'wavelength'</span>: 560, <span class="st">'description'</span>: <span class="st">'Green band (vegetation)'</span>},</span>
<span id="cb65-2977"><a href="#cb65-2977" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B04'</span><span class="ex">:</span> {<span class="st">'name'</span>: <span class="st">'red'</span>, <span class="st">'wavelength'</span>: 665, <span class="st">'description'</span>: <span class="st">'Red band (chlorophyll absorption)'</span>},</span>
<span id="cb65-2978"><a href="#cb65-2978" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B08'</span><span class="ex">:</span> {<span class="st">'name'</span>: <span class="st">'nir'</span>, <span class="st">'wavelength'</span>: 842, <span class="st">'description'</span>: <span class="st">'Near-infrared (biomass/structure)'</span>}</span>
<span id="cb65-2979"><a href="#cb65-2979" aria-hidden="true" tabindex="-1"></a>    <span class="er">}</span></span>
<span id="cb65-2980"><a href="#cb65-2980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2981"><a href="#cb65-2981" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build spectral data arrays</span></span>
<span id="cb65-2982"><a href="#cb65-2982" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_id <span class="kw">in</span> available_bands:</span>
<span id="cb65-2983"><a href="#cb65-2983" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="ex">band_id</span> in band_metadata:</span>
<span id="cb65-2984"><a href="#cb65-2984" aria-hidden="true" tabindex="-1"></a>            <span class="ex">metadata</span> = band_metadata<span class="pp">[</span><span class="ss">band_id</span><span class="pp">]</span></span>
<span id="cb65-2985"><a href="#cb65-2985" aria-hidden="true" tabindex="-1"></a>            <span class="ex">band_name</span> = metadata<span class="pp">[</span><span class="st">'name'</span><span class="pp">]</span></span>
<span id="cb65-2986"><a href="#cb65-2986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2987"><a href="#cb65-2987" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create DataArray with rich metadata</span></span>
<span id="cb65-2988"><a href="#cb65-2988" aria-hidden="true" tabindex="-1"></a>            <span class="va">data_arrays</span><span class="op">[</span>band_name<span class="op">]</span> <span class="ex">=</span> xr.DataArray<span class="er">(</span></span>
<span id="cb65-2989"><a href="#cb65-2989" aria-hidden="true" tabindex="-1"></a>                <span class="va">band_data</span><span class="op">[</span>band_id<span class="op">]</span><span class="ex">,</span></span>
<span id="cb65-2990"><a href="#cb65-2990" aria-hidden="true" tabindex="-1"></a>                <span class="va">dims</span><span class="op">=</span>[<span class="st">'y'</span>, <span class="st">'x'</span><span class="ex">],</span></span>
<span id="cb65-2991"><a href="#cb65-2991" aria-hidden="true" tabindex="-1"></a>                <span class="va">coords</span><span class="op">=</span>{</span>
<span id="cb65-2992"><a href="#cb65-2992" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'y'</span><span class="ex">:</span> <span class="er">(</span><span class="st">'y'</span><span class="ex">,</span> y_coords, {<span class="st">'long_name'</span>: <span class="st">'Latitude'</span> if coord_system == <span class="st">'geographic'</span> else <span class="st">'Y coordinate'</span>,</span>
<span id="cb65-2993"><a href="#cb65-2993" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'units'</span><span class="ex">:</span> <span class="st">'degrees_north'</span> if coord_system == <span class="st">'geographic'</span> else <span class="st">'pixels'</span>}<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-2994"><a href="#cb65-2994" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'x'</span><span class="ex">:</span> <span class="er">(</span><span class="st">'x'</span><span class="ex">,</span> x_coords, {<span class="st">'long_name'</span>: <span class="st">'Longitude'</span> if coord_system == <span class="st">'geographic'</span> else <span class="st">'X coordinate'</span>,</span>
<span id="cb65-2995"><a href="#cb65-2995" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'units'</span><span class="ex">:</span> <span class="st">'degrees_east'</span> if coord_system == <span class="st">'geographic'</span> else <span class="st">'pixels'</span>}<span class="kw">)</span></span>
<span id="cb65-2996"><a href="#cb65-2996" aria-hidden="true" tabindex="-1"></a>                <span class="er">}</span><span class="ex">,</span></span>
<span id="cb65-2997"><a href="#cb65-2997" aria-hidden="true" tabindex="-1"></a>                <span class="va">attrs</span><span class="op">=</span>{</span>
<span id="cb65-2998"><a href="#cb65-2998" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'band_id'</span><span class="ex">:</span> band_id,</span>
<span id="cb65-2999"><a href="#cb65-2999" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'long_name'</span><span class="ex">:</span> metadata<span class="pp">[</span><span class="st">'description'</span><span class="pp">]</span>,</span>
<span id="cb65-3000"><a href="#cb65-3000" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'wavelength'</span><span class="ex">:</span> metadata<span class="pp">[</span><span class="st">'wavelength'</span><span class="pp">]</span>,</span>
<span id="cb65-3001"><a href="#cb65-3001" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'wavelength_units'</span><span class="ex">:</span> <span class="st">'nanometers'</span>,</span>
<span id="cb65-3002"><a href="#cb65-3002" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'units'</span><span class="ex">:</span> <span class="st">'DN'</span>,</span>
<span id="cb65-3003"><a href="#cb65-3003" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'valid_range'</span><span class="ex">:</span> [0, 10000],</span>
<span id="cb65-3004"><a href="#cb65-3004" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'scale_factor'</span><span class="ex">:</span> 1.0,</span>
<span id="cb65-3005"><a href="#cb65-3005" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'add_offset'</span><span class="ex">:</span> 0.0</span>
<span id="cb65-3006"><a href="#cb65-3006" aria-hidden="true" tabindex="-1"></a>                <span class="er">}</span></span>
<span id="cb65-3007"><a href="#cb65-3007" aria-hidden="true" tabindex="-1"></a>            <span class="kw">)</span></span>
<span id="cb65-3008"><a href="#cb65-3008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3009"><a href="#cb65-3009" aria-hidden="true" tabindex="-1"></a>            <span class="ex">logger.debug</span><span class="er">(</span><span class="ex">f</span><span class="st">"Created DataArray: {band_name} ({metadata['wavelength']}nm)"</span><span class="kw">)</span></span>
<span id="cb65-3010"><a href="#cb65-3010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3011"><a href="#cb65-3011" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create comprehensive Dataset</span></span>
<span id="cb65-3012"><a href="#cb65-3012" aria-hidden="true" tabindex="-1"></a>    <span class="ex">satellite_ds</span> = xr.Dataset<span class="er">(</span></span>
<span id="cb65-3013"><a href="#cb65-3013" aria-hidden="true" tabindex="-1"></a>        <span class="ex">data_arrays,</span></span>
<span id="cb65-3014"><a href="#cb65-3014" aria-hidden="true" tabindex="-1"></a>        <span class="va">attrs</span><span class="op">=</span>{</span>
<span id="cb65-3015"><a href="#cb65-3015" aria-hidden="true" tabindex="-1"></a>            <span class="st">'title'</span><span class="ex">:</span> <span class="st">'Sentinel-2 Level 2A Surface Reflectance'</span>,</span>
<span id="cb65-3016"><a href="#cb65-3016" aria-hidden="true" tabindex="-1"></a>            <span class="st">'source'</span><span class="ex">:</span> f<span class="st">'Scene: {scene_id}'</span>,</span>
<span id="cb65-3017"><a href="#cb65-3017" aria-hidden="true" tabindex="-1"></a>            <span class="st">'acquisition_date'</span><span class="ex">:</span> acquisition_date,</span>
<span id="cb65-3018"><a href="#cb65-3018" aria-hidden="true" tabindex="-1"></a>            <span class="st">'processing_level'</span><span class="ex">:</span> <span class="st">'L2A'</span>,</span>
<span id="cb65-3019"><a href="#cb65-3019" aria-hidden="true" tabindex="-1"></a>            <span class="st">'crs'</span><span class="ex">:</span> str<span class="er">(</span><span class="ex">crs</span><span class="kw">)</span> <span class="cf">if</span> <span class="ex">crs</span> else <span class="st">'WGS84 (assumed)'</span>,</span>
<span id="cb65-3020"><a href="#cb65-3020" aria-hidden="true" tabindex="-1"></a>            <span class="st">'spatial_resolution'</span><span class="ex">:</span> <span class="st">'10 meters'</span>,</span>
<span id="cb65-3021"><a href="#cb65-3021" aria-hidden="true" tabindex="-1"></a>            <span class="st">'coordinate_system'</span><span class="ex">:</span> coord_system,</span>
<span id="cb65-3022"><a href="#cb65-3022" aria-hidden="true" tabindex="-1"></a>            <span class="st">'creation_date'</span><span class="ex">:</span> pd.Timestamp.now<span class="er">(</span><span class="kw">)</span><span class="fu">.isoformat()</span><span class="ex">,</span></span>
<span id="cb65-3023"><a href="#cb65-3023" aria-hidden="true" tabindex="-1"></a>            <span class="st">'processing_software'</span><span class="ex">:</span> <span class="st">'Geospatial AI Toolkit'</span>,</span>
<span id="cb65-3024"><a href="#cb65-3024" aria-hidden="true" tabindex="-1"></a>            <span class="st">'data_access'</span><span class="ex">:</span> <span class="st">'Microsoft Planetary Computer via STAC'</span></span>
<span id="cb65-3025"><a href="#cb65-3025" aria-hidden="true" tabindex="-1"></a>        <span class="er">}</span></span>
<span id="cb65-3026"><a href="#cb65-3026" aria-hidden="true" tabindex="-1"></a>    <span class="kw">)</span></span>
<span id="cb65-3027"><a href="#cb65-3027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3028"><a href="#cb65-3028" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Created xarray Dataset with {len(data_arrays)} bands: {list(satellite_ds.data_vars)}"</span><span class="kw">)</span></span>
<span id="cb65-3029"><a href="#cb65-3029" aria-hidden="true" tabindex="-1"></a>    <span class="ex">print</span><span class="er">(</span><span class="ex">satellite_ds</span><span class="kw">)</span>  <span class="co"># Display dataset structure</span></span>
<span id="cb65-3030"><a href="#cb65-3030" aria-hidden="true" tabindex="-1"></a><span class="ex">else:</span></span>
<span id="cb65-3031"><a href="#cb65-3031" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.warning</span><span class="er">(</span><span class="st">"No band data available for xarray Dataset creation"</span><span class="kw">)</span></span>
<span id="cb65-3032"><a href="#cb65-3032" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-3033"><a href="#cb65-3033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3034"><a href="#cb65-3034" aria-hidden="true" tabindex="-1"></a><span class="co">## Rasterio, Xarray, and Rioxarray</span></span>
<span id="cb65-3035"><a href="#cb65-3035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3036"><a href="#cb65-3036" aria-hidden="true" tabindex="-1"></a><span class="ex">Rasterio</span> provides lower-level, direct file access and is well-suited for basic geospatial raster operations. Xarray offers a higher-level interface, making it easier to handle metadata and perform advanced analysis. Rioxarray extends xarray by adding geospatial capabilities, effectively bridging the gap between the two approaches.</span>
<span id="cb65-3037"><a href="#cb65-3037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3038"><a href="#cb65-3038" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
<span id="cb65-3039"><a href="#cb65-3039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3040"><a href="#cb65-3040" aria-hidden="true" tabindex="-1"></a><span class="co">## 7. Scientific Visualization and Spectral Analysis</span></span>
<span id="cb65-3041"><a href="#cb65-3041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3042"><a href="#cb65-3042" aria-hidden="true" tabindex="-1"></a><span class="ex">:::{.callout-tip}</span> </span>
<span id="cb65-3043"><a href="#cb65-3043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3044"><a href="#cb65-3044" aria-hidden="true" tabindex="-1"></a><span class="co">#### Learning Objectives</span></span>
<span id="cb65-3045"><a href="#cb65-3045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3046"><a href="#cb65-3046" aria-hidden="true" tabindex="-1"></a><span class="ex">By</span> the end of this section, you will be able to design publication-quality visualizations for satellite data analysis, understand the importance of perceptually uniform colormaps in scientific visualization, create informative multi-panel displays with appropriate context and interpretation, and calculate as well as visualize spectral indices for environmental monitoring.</span>
<span id="cb65-3047"><a href="#cb65-3047" aria-hidden="true" tabindex="-1"></a><span class="ex">:::</span></span>
<span id="cb65-3048"><a href="#cb65-3048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3049"><a href="#cb65-3049" aria-hidden="true" tabindex="-1"></a><span class="co">### 7.1 Principles of Scientific Visualization for Remote Sensing</span></span>
<span id="cb65-3050"><a href="#cb65-3050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3051"><a href="#cb65-3051" aria-hidden="true" tabindex="-1"></a><span class="ex">Effective</span> satellite data visualization requires attention to perceptual accuracy, ensuring that colors accurately represent data relationships. It is important to maximize information density to provide insight with minimal cognitive load, while also preserving spatial and temporal context. Additionally, visualizations should be accessible and interpretable by a wide range of audiences.</span>
<span id="cb65-3052"><a href="#cb65-3052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3053"><a href="#cb65-3053" aria-hidden="true" tabindex="-1"></a><span class="co">### 7.2 Advanced Color Composite Creation</span></span>
<span id="cb65-3054"><a href="#cb65-3054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3057"><a href="#cb65-3057" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-3058"><a href="#cb65-3058" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">band_data</span> and all<span class="er">(</span><span class="ex">k</span> in band_data for k in [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>]<span class="kw">)</span><span class="bu">:</span></span>
<span id="cb65-3059"><a href="#cb65-3059" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create true color RGB composite using our helper function</span></span>
<span id="cb65-3060"><a href="#cb65-3060" aria-hidden="true" tabindex="-1"></a>    <span class="ex">rgb_composite</span> = create_rgb_composite<span class="er">(</span></span>
<span id="cb65-3061"><a href="#cb65-3061" aria-hidden="true" tabindex="-1"></a>        <span class="va">red</span><span class="op">=</span>band_data<span class="pp">[</span><span class="st">'B04'</span><span class="pp">]</span>,</span>
<span id="cb65-3062"><a href="#cb65-3062" aria-hidden="true" tabindex="-1"></a>        <span class="va">green</span><span class="op">=</span>band_data<span class="pp">[</span><span class="st">'B03'</span><span class="pp">]</span>,</span>
<span id="cb65-3063"><a href="#cb65-3063" aria-hidden="true" tabindex="-1"></a>        <span class="va">blue</span><span class="op">=</span>band_data<span class="pp">[</span><span class="st">'B02'</span><span class="pp">]</span>,</span>
<span id="cb65-3064"><a href="#cb65-3064" aria-hidden="true" tabindex="-1"></a>        <span class="va">enhance</span><span class="op">=</span>True  <span class="co"># Apply contrast enhancement</span></span>
<span id="cb65-3065"><a href="#cb65-3065" aria-hidden="true" tabindex="-1"></a>    <span class="kw">)</span></span>
<span id="cb65-3066"><a href="#cb65-3066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3067"><a href="#cb65-3067" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"   RGB composite shape: {rgb_composite.shape}"</span><span class="kw">)</span></span>
<span id="cb65-3068"><a href="#cb65-3068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3069"><a href="#cb65-3069" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create false color composite if NIR band is available</span></span>
<span id="cb65-3070"><a href="#cb65-3070" aria-hidden="true" tabindex="-1"></a>    <span class="ex">false_color_composite</span> = None</span>
<span id="cb65-3071"><a href="#cb65-3071" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'B08'</span> in band_data:</span>
<span id="cb65-3072"><a href="#cb65-3072" aria-hidden="true" tabindex="-1"></a>        <span class="ex">false_color_composite</span> = create_rgb_composite<span class="er">(</span></span>
<span id="cb65-3073"><a href="#cb65-3073" aria-hidden="true" tabindex="-1"></a>            <span class="va">red</span><span class="op">=</span>band_data<span class="pp">[</span><span class="st">'B08'</span><span class="pp">]</span>,   <span class="co"># NIR in red channel</span></span>
<span id="cb65-3074"><a href="#cb65-3074" aria-hidden="true" tabindex="-1"></a>            <span class="va">green</span><span class="op">=</span>band_data<span class="pp">[</span><span class="st">'B04'</span><span class="pp">]</span>,  <span class="co"># Red in green channel</span></span>
<span id="cb65-3075"><a href="#cb65-3075" aria-hidden="true" tabindex="-1"></a>            <span class="va">blue</span><span class="op">=</span>band_data<span class="pp">[</span><span class="st">'B03'</span><span class="pp">]</span>,   <span class="co"># Green in blue channel</span></span>
<span id="cb65-3076"><a href="#cb65-3076" aria-hidden="true" tabindex="-1"></a>            <span class="va">enhance</span><span class="op">=</span>True</span>
<span id="cb65-3077"><a href="#cb65-3077" aria-hidden="true" tabindex="-1"></a>        <span class="kw">)</span></span>
<span id="cb65-3078"><a href="#cb65-3078" aria-hidden="true" tabindex="-1"></a>        <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"   False color composite created"</span><span class="kw">)</span></span>
<span id="cb65-3079"><a href="#cb65-3079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3080"><a href="#cb65-3080" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualize the composites</span></span>
<span id="cb65-3081"><a href="#cb65-3081" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'B08'</span> in band_data:</span>
<span id="cb65-3082"><a href="#cb65-3082" aria-hidden="true" tabindex="-1"></a>        <span class="ex">fig,</span> <span class="er">(</span><span class="ex">ax1,</span> ax2<span class="kw">)</span> <span class="ex">=</span> plt.subplots<span class="er">(</span><span class="ex">1,</span> 2, figsize=<span class="er">(</span><span class="ex">14,</span> 6<span class="kw">))</span></span>
<span id="cb65-3083"><a href="#cb65-3083" aria-hidden="true" tabindex="-1"></a>    <span class="ex">else:</span></span>
<span id="cb65-3084"><a href="#cb65-3084" aria-hidden="true" tabindex="-1"></a>        <span class="ex">fig,</span> ax1 = plt.subplots<span class="er">(</span><span class="ex">1,</span> 1, figsize=<span class="er">(</span><span class="ex">8,</span> 6<span class="kw">))</span></span>
<span id="cb65-3085"><a href="#cb65-3085" aria-hidden="true" tabindex="-1"></a>        <span class="ex">ax2</span> = None</span>
<span id="cb65-3086"><a href="#cb65-3086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3087"><a href="#cb65-3087" aria-hidden="true" tabindex="-1"></a>    <span class="co"># True color</span></span>
<span id="cb65-3088"><a href="#cb65-3088" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ax1.imshow</span><span class="er">(</span><span class="ex">rgb_composite</span><span class="kw">)</span></span>
<span id="cb65-3089"><a href="#cb65-3089" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ax1.set_title</span><span class="er">(</span><span class="st">'True Color (RGB)'</span><span class="ex">,</span> fontsize=12, fontweight=<span class="st">'bold'</span><span class="kw">)</span></span>
<span id="cb65-3090"><a href="#cb65-3090" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ax1.axis</span><span class="er">(</span><span class="st">'off'</span><span class="kw">)</span></span>
<span id="cb65-3091"><a href="#cb65-3091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3092"><a href="#cb65-3092" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add scale bar</span></span>
<span id="cb65-3093"><a href="#cb65-3093" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'transform'</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="ex">and</span> transform:</span>
<span id="cb65-3094"><a href="#cb65-3094" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate pixel size in meters (approximate)</span></span>
<span id="cb65-3095"><a href="#cb65-3095" aria-hidden="true" tabindex="-1"></a>        <span class="ex">pixel_size</span> = abs<span class="er">(</span><span class="ex">transform.a</span><span class="kw">)</span>  <span class="co"># Assuming square pixels</span></span>
<span id="cb65-3096"><a href="#cb65-3096" aria-hidden="true" tabindex="-1"></a>        <span class="ex">scalebar_pixels</span> = int<span class="er">(</span><span class="ex">1000</span> / pixel_size<span class="kw">)</span>  <span class="co"># 1km scale bar</span></span>
<span id="cb65-3097"><a href="#cb65-3097" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="ex">scalebar_pixels</span> <span class="op">&lt;</span> rgb_composite.shape<span class="pp">[</span><span class="ss">1</span><span class="pp">]</span> / 4:</span>
<span id="cb65-3098"><a href="#cb65-3098" aria-hidden="true" tabindex="-1"></a>            <span class="ex">ax1.plot</span><span class="er">(</span><span class="ex">[10,</span> 10 + scalebar_pixels],</span>
<span id="cb65-3099"><a href="#cb65-3099" aria-hidden="true" tabindex="-1"></a>                    <span class="ex">[rgb_composite.shape[0]</span> <span class="at">-</span> 20, rgb_composite.shape<span class="pp">[</span><span class="ss">0</span><span class="pp">]</span> <span class="at">-</span> 20],</span>
<span id="cb65-3100"><a href="#cb65-3100" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'w-'</span><span class="ex">,</span> linewidth=3<span class="kw">)</span></span>
<span id="cb65-3101"><a href="#cb65-3101" aria-hidden="true" tabindex="-1"></a>            <span class="ex">ax1.text</span><span class="er">(</span><span class="ex">10</span> + scalebar_pixels/2, rgb_composite.shape<span class="pp">[</span><span class="ss">0</span><span class="pp">]</span> <span class="at">-</span> 30,</span>
<span id="cb65-3102"><a href="#cb65-3102" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'1 km'</span><span class="ex">,</span> color=<span class="st">'white'</span>, ha=<span class="st">'center'</span>, fontweight=<span class="st">'bold'</span><span class="kw">)</span></span>
<span id="cb65-3103"><a href="#cb65-3103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3104"><a href="#cb65-3104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># False color if available</span></span>
<span id="cb65-3105"><a href="#cb65-3105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="ex">ax2</span> and false_color_composite is not None:</span>
<span id="cb65-3106"><a href="#cb65-3106" aria-hidden="true" tabindex="-1"></a>        <span class="ex">ax2.imshow</span><span class="er">(</span><span class="ex">false_color_composite</span><span class="kw">)</span></span>
<span id="cb65-3107"><a href="#cb65-3107" aria-hidden="true" tabindex="-1"></a>        <span class="ex">ax2.set_title</span><span class="er">(</span><span class="st">'False Color (NIR-R-G)'</span><span class="ex">,</span> fontsize=12, fontweight=<span class="st">'bold'</span><span class="kw">)</span></span>
<span id="cb65-3108"><a href="#cb65-3108" aria-hidden="true" tabindex="-1"></a>        <span class="ex">ax2.axis</span><span class="er">(</span><span class="st">'off'</span><span class="kw">)</span></span>
<span id="cb65-3109"><a href="#cb65-3109" aria-hidden="true" tabindex="-1"></a>        <span class="ex">ax2.text</span><span class="er">(</span><span class="ex">0.02,</span> 0.98, <span class="st">'Vegetation appears red'</span>,</span>
<span id="cb65-3110"><a href="#cb65-3110" aria-hidden="true" tabindex="-1"></a>                <span class="va">transform</span><span class="op">=</span>ax2.transAxes, <span class="va">color</span><span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb65-3111"><a href="#cb65-3111" aria-hidden="true" tabindex="-1"></a>                <span class="va">fontsize</span><span class="op">=</span>10, <span class="va">va</span><span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb65-3112"><a href="#cb65-3112" aria-hidden="true" tabindex="-1"></a>                <span class="va">bbox</span><span class="op">=</span>dict<span class="kw">(</span><span class="va">boxstyle</span><span class="op">=</span><span class="st">'round'</span>, <span class="va">facecolor</span><span class="op">=</span><span class="st">'black'</span>, <span class="va">alpha</span><span class="op">=</span>0.5<span class="kw">))</span></span>
<span id="cb65-3113"><a href="#cb65-3113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3114"><a href="#cb65-3114" aria-hidden="true" tabindex="-1"></a>    <span class="ex">plt.suptitle</span><span class="er">(</span><span class="st">'Sentinel-2 Composites'</span><span class="ex">,</span> fontsize=14, fontweight=<span class="st">'bold'</span>, y=1.02<span class="kw">)</span></span>
<span id="cb65-3115"><a href="#cb65-3115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt.tight_layout()</span></span>
<span id="cb65-3116"><a href="#cb65-3116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt.show()</span></span>
<span id="cb65-3117"><a href="#cb65-3117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3118"><a href="#cb65-3118" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="st">"RGB composites created successfully"</span><span class="kw">)</span></span>
<span id="cb65-3119"><a href="#cb65-3119" aria-hidden="true" tabindex="-1"></a><span class="ex">else:</span></span>
<span id="cb65-3120"><a href="#cb65-3120" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.warning</span><span class="er">(</span><span class="st">"Insufficient bands for RGB composite"</span><span class="kw">)</span></span>
<span id="cb65-3121"><a href="#cb65-3121" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-3122"><a href="#cb65-3122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3123"><a href="#cb65-3123" aria-hidden="true" tabindex="-1"></a><span class="co">### 7.3 Calculate Vegetation Indices</span></span>
<span id="cb65-3124"><a href="#cb65-3124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3127"><a href="#cb65-3127" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-3128"><a href="#cb65-3128" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">band_data</span> and <span class="st">'B08'</span> in band_data and <span class="st">'B04'</span> in band_data:</span>
<span id="cb65-3129"><a href="#cb65-3129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate NDVI using our helper function</span></span>
<span id="cb65-3130"><a href="#cb65-3130" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ndvi</span> = calculate_ndvi<span class="er">(</span></span>
<span id="cb65-3131"><a href="#cb65-3131" aria-hidden="true" tabindex="-1"></a>        <span class="va">nir</span><span class="op">=</span>band_data<span class="pp">[</span><span class="st">'B08'</span><span class="pp">]</span>,</span>
<span id="cb65-3132"><a href="#cb65-3132" aria-hidden="true" tabindex="-1"></a>        <span class="va">red</span><span class="op">=</span>band_data<span class="pp">[</span><span class="st">'B04'</span><span class="pp">]</span></span>
<span id="cb65-3133"><a href="#cb65-3133" aria-hidden="true" tabindex="-1"></a>    <span class="kw">)</span></span>
<span id="cb65-3134"><a href="#cb65-3134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3135"><a href="#cb65-3135" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get NDVI statistics</span></span>
<span id="cb65-3136"><a href="#cb65-3136" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ndvi_stats</span> = calculate_band_statistics<span class="er">(</span><span class="ex">ndvi,</span> <span class="st">"NDVI"</span><span class="kw">)</span></span>
<span id="cb65-3137"><a href="#cb65-3137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3138"><a href="#cb65-3138" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI statistics</span></span>
<span id="cb65-3139"><a href="#cb65-3139" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"NDVI stats - Range: [{ndvi_stats['min']:.3f}, {ndvi_stats['max']:.3f}], Mean: {ndvi_stats['mean']:.3f}"</span><span class="kw">)</span></span>
<span id="cb65-3140"><a href="#cb65-3140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3141"><a href="#cb65-3141" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Interpret NDVI values</span></span>
<span id="cb65-3142"><a href="#cb65-3142" aria-hidden="true" tabindex="-1"></a>    <span class="ex">vegetation_pixels</span> = np.sum<span class="er">(</span><span class="ex">ndvi</span> <span class="op">&gt;</span> 0.3<span class="kw">)</span></span>
<span id="cb65-3143"><a href="#cb65-3143" aria-hidden="true" tabindex="-1"></a>    <span class="ex">water_pixels</span> = np.sum<span class="er">(</span><span class="ex">ndvi</span> <span class="op">&lt;</span> 0<span class="kw">)</span></span>
<span id="cb65-3144"><a href="#cb65-3144" aria-hidden="true" tabindex="-1"></a>    <span class="ex">urban_pixels</span> = np.sum<span class="er">(</span><span class="kw">(</span><span class="ex">ndvi</span> <span class="op">&gt;</span>= 0<span class="kw">)</span> <span class="kw">&amp;</span> <span class="kw">(</span><span class="ex">ndvi</span> <span class="op">&lt;</span>= 0.2<span class="kw">))</span></span>
<span id="cb65-3145"><a href="#cb65-3145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3146"><a href="#cb65-3146" aria-hidden="true" tabindex="-1"></a>    <span class="ex">total_valid</span> = ndvi_stats<span class="pp">[</span><span class="st">'valid_pixels'</span><span class="pp">]</span></span>
<span id="cb65-3147"><a href="#cb65-3147" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Land cover interpretation</span></span>
<span id="cb65-3148"><a href="#cb65-3148" aria-hidden="true" tabindex="-1"></a>    <span class="ex">veg_pct</span> = vegetation_pixels/total_valid<span class="pp">*</span>100</span>
<span id="cb65-3149"><a href="#cb65-3149" aria-hidden="true" tabindex="-1"></a>    <span class="ex">urban_pct</span> = urban_pixels/total_valid<span class="pp">*</span>100</span>
<span id="cb65-3150"><a href="#cb65-3150" aria-hidden="true" tabindex="-1"></a>    <span class="ex">water_pct</span> = water_pixels/total_valid<span class="pp">*</span>100</span>
<span id="cb65-3151"><a href="#cb65-3151" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Land cover - Vegetation: {veg_pct:.1f}%, Urban: {urban_pct:.1f}%, Water: {water_pct:.1f}%"</span><span class="kw">)</span></span>
<span id="cb65-3152"><a href="#cb65-3152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3153"><a href="#cb65-3153" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a detailed NDVI visualization</span></span>
<span id="cb65-3154"><a href="#cb65-3154" aria-hidden="true" tabindex="-1"></a>    <span class="ex">fig,</span> <span class="er">(</span><span class="ex">ax1,</span> ax2<span class="kw">)</span> <span class="ex">=</span> plt.subplots<span class="er">(</span><span class="ex">1,</span> 2, figsize=<span class="er">(</span><span class="ex">14,</span> 6<span class="kw">))</span></span>
<span id="cb65-3155"><a href="#cb65-3155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3156"><a href="#cb65-3156" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI map</span></span>
<span id="cb65-3157"><a href="#cb65-3157" aria-hidden="true" tabindex="-1"></a>    <span class="ex">im</span> = ax1.imshow<span class="er">(</span><span class="ex">ndvi,</span> cmap=<span class="st">'RdYlGn'</span>, vmin=-0.5, vmax=1.0<span class="kw">)</span></span>
<span id="cb65-3158"><a href="#cb65-3158" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ax1.set_title</span><span class="er">(</span><span class="st">'NDVI (Normalized Difference Vegetation Index)'</span><span class="ex">,</span> fontweight=<span class="st">'bold'</span><span class="kw">)</span></span>
<span id="cb65-3159"><a href="#cb65-3159" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ax1.axis</span><span class="er">(</span><span class="st">'off'</span><span class="kw">)</span></span>
<span id="cb65-3160"><a href="#cb65-3160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3161"><a href="#cb65-3161" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add colorbar</span></span>
<span id="cb65-3162"><a href="#cb65-3162" aria-hidden="true" tabindex="-1"></a>    <span class="ex">cbar</span> = plt.colorbar<span class="er">(</span><span class="ex">im,</span> ax=ax1, shrink=0.8, pad=0.02<span class="kw">)</span></span>
<span id="cb65-3163"><a href="#cb65-3163" aria-hidden="true" tabindex="-1"></a>    <span class="ex">cbar.set_label</span><span class="er">(</span><span class="st">'NDVI Value'</span><span class="ex">,</span> rotation=270, labelpad=15<span class="kw">)</span></span>
<span id="cb65-3164"><a href="#cb65-3164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3165"><a href="#cb65-3165" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add interpretation labels to colorbar</span></span>
<span id="cb65-3166"><a href="#cb65-3166" aria-hidden="true" tabindex="-1"></a>    <span class="ex">cbar.ax.text</span><span class="er">(</span><span class="ex">1.3,</span> 0.8, <span class="st">'Dense vegetation'</span>, transform=cbar.ax.transAxes, fontsize=9<span class="kw">)</span></span>
<span id="cb65-3167"><a href="#cb65-3167" aria-hidden="true" tabindex="-1"></a>    <span class="ex">cbar.ax.text</span><span class="er">(</span><span class="ex">1.3,</span> 0.5, <span class="st">'Sparse vegetation'</span>, transform=cbar.ax.transAxes, fontsize=9<span class="kw">)</span></span>
<span id="cb65-3168"><a href="#cb65-3168" aria-hidden="true" tabindex="-1"></a>    <span class="ex">cbar.ax.text</span><span class="er">(</span><span class="ex">1.3,</span> 0.2, <span class="st">'Bare soil/Urban'</span>, transform=cbar.ax.transAxes, fontsize=9<span class="kw">)</span></span>
<span id="cb65-3169"><a href="#cb65-3169" aria-hidden="true" tabindex="-1"></a>    <span class="ex">cbar.ax.text</span><span class="er">(</span><span class="ex">1.3,</span> 0.0, <span class="st">'Water/Clouds'</span>, transform=cbar.ax.transAxes, fontsize=9<span class="kw">)</span></span>
<span id="cb65-3170"><a href="#cb65-3170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3171"><a href="#cb65-3171" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI histogram</span></span>
<span id="cb65-3172"><a href="#cb65-3172" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ax2.hist</span><span class="er">(</span><span class="fu">ndvi.flatten()</span><span class="ex">,</span> bins=100, color=<span class="st">'green'</span>, alpha=0.7, edgecolor=<span class="st">'black'</span><span class="kw">)</span></span>
<span id="cb65-3173"><a href="#cb65-3173" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ax2.axvline</span><span class="er">(</span><span class="ex">0,</span> color=<span class="st">'blue'</span>, linestyle=<span class="st">'--'</span>, alpha=0.5, label=<span class="st">'Water threshold'</span><span class="kw">)</span></span>
<span id="cb65-3174"><a href="#cb65-3174" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ax2.axvline</span><span class="er">(</span><span class="ex">0.3,</span> color=<span class="st">'green'</span>, linestyle=<span class="st">'--'</span>, alpha=0.5, label=<span class="st">'Vegetation threshold'</span><span class="kw">)</span></span>
<span id="cb65-3175"><a href="#cb65-3175" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ax2.set_xlabel</span><span class="er">(</span><span class="st">'NDVI Value'</span><span class="kw">)</span></span>
<span id="cb65-3176"><a href="#cb65-3176" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ax2.set_ylabel</span><span class="er">(</span><span class="st">'Pixel Count'</span><span class="kw">)</span></span>
<span id="cb65-3177"><a href="#cb65-3177" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ax2.set_title</span><span class="er">(</span><span class="st">'NDVI Distribution'</span><span class="ex">,</span> fontweight=<span class="st">'bold'</span><span class="kw">)</span></span>
<span id="cb65-3178"><a href="#cb65-3178" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ax2.legend()</span></span>
<span id="cb65-3179"><a href="#cb65-3179" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ax2.grid</span><span class="er">(</span><span class="ex">True,</span> alpha=0.3<span class="kw">)</span></span>
<span id="cb65-3180"><a href="#cb65-3180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3181"><a href="#cb65-3181" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt.tight_layout()</span></span>
<span id="cb65-3182"><a href="#cb65-3182" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt.show()</span></span>
<span id="cb65-3183"><a href="#cb65-3183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3184"><a href="#cb65-3184" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="st">"NDVI analysis complete"</span><span class="kw">)</span></span>
<span id="cb65-3185"><a href="#cb65-3185" aria-hidden="true" tabindex="-1"></a><span class="ex">else:</span></span>
<span id="cb65-3186"><a href="#cb65-3186" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.warning</span><span class="er">(</span><span class="st">"NIR and Red bands required for NDVI calculation"</span><span class="kw">)</span></span>
<span id="cb65-3187"><a href="#cb65-3187" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-3188"><a href="#cb65-3188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3189"><a href="#cb65-3189" aria-hidden="true" tabindex="-1"></a><span class="co">## Understanding NDVI Values</span></span>
<span id="cb65-3190"><a href="#cb65-3190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3191"><a href="#cb65-3191" aria-hidden="true" tabindex="-1"></a><span class="ex">NDVI</span> values range from <span class="at">-1</span> to 1, and different intervals correspond to various land cover types. Values from <span class="at">-1</span> to 0 typically indicate water bodies, clouds, snow, or shadows. Values between 0 and 0.2 are characteristic of bare soil, rock, urban areas, or beaches. NDVI values from 0.2 to 0.4 suggest sparse vegetation, such as grasslands or agricultural areas. Moderate vegetation, including shrublands and crops, is usually found in the 0.4 to 0.6 range. Dense vegetation, such as forests and healthy crops, is represented by NDVI values between 0.6 and 1.0.</span>
<span id="cb65-3192"><a href="#cb65-3192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3193"><a href="#cb65-3193" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> common practice in environmental studies is to use NDVI values greater than 0.3 as a mask to identify vegetated areas.</span>
<span id="cb65-3194"><a href="#cb65-3194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3195"><a href="#cb65-3195" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
<span id="cb65-3196"><a href="#cb65-3196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3197"><a href="#cb65-3197" aria-hidden="true" tabindex="-1"></a><span class="co">## 8. Band Analysis</span></span>
<span id="cb65-3198"><a href="#cb65-3198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3199"><a href="#cb65-3199" aria-hidden="true" tabindex="-1"></a><span class="co">### 8.1 Comprehensive Multi-band Analysis</span></span>
<span id="cb65-3200"><a href="#cb65-3200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3203"><a href="#cb65-3203" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-3204"><a href="#cb65-3204" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">band_data</span> and <span class="st">'rgb_composite'</span> in locals<span class="er">(</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb65-3205"><a href="#cb65-3205" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use our helper function for visualization</span></span>
<span id="cb65-3206"><a href="#cb65-3206" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out None values from bands dictionary</span></span>
<span id="cb65-3207"><a href="#cb65-3207" aria-hidden="true" tabindex="-1"></a>    <span class="ex">valid_bands</span> = {k: v for k, v in {<span class="st">'B04'</span>: band_data.get<span class="er">(</span><span class="st">'B04'</span><span class="kw">)</span><span class="ex">,</span> <span class="st">'B08'</span>: band_data.get<span class="er">(</span><span class="st">'B08'</span><span class="kw">)</span><span class="er">}</span><span class="fu">.items()</span> <span class="cf">if</span> <span class="ex">v</span> is not None and isinstance<span class="er">(</span><span class="ex">v,</span> np.ndarray<span class="kw">)</span><span class="er">}</span></span>
<span id="cb65-3208"><a href="#cb65-3208" aria-hidden="true" tabindex="-1"></a>    <span class="ex">plot_band_comparison</span><span class="er">(</span></span>
<span id="cb65-3209"><a href="#cb65-3209" aria-hidden="true" tabindex="-1"></a>        <span class="va">bands</span><span class="op">=</span>valid_bands,</span>
<span id="cb65-3210"><a href="#cb65-3210" aria-hidden="true" tabindex="-1"></a>        <span class="va">rgb</span><span class="op">=</span>rgb_composite <span class="cf">if</span> <span class="st">'rgb_composite'</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="cf">else</span> <span class="ex">None,</span></span>
<span id="cb65-3211"><a href="#cb65-3211" aria-hidden="true" tabindex="-1"></a>        <span class="va">ndvi</span><span class="op">=</span>ndvi <span class="cf">if</span> <span class="st">'ndvi'</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="cf">else</span> <span class="ex">None,</span></span>
<span id="cb65-3212"><a href="#cb65-3212" aria-hidden="true" tabindex="-1"></a>        <span class="va">title</span><span class="op">=</span><span class="st">"Sentinel-2 Multi-band Analysis"</span></span>
<span id="cb65-3213"><a href="#cb65-3213" aria-hidden="true" tabindex="-1"></a>    <span class="kw">)</span></span>
<span id="cb65-3214"><a href="#cb65-3214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3215"><a href="#cb65-3215" aria-hidden="true" tabindex="-1"></a>    <span class="ex">logger.info</span><span class="er">(</span><span class="st">"Multi-band comparison complete"</span><span class="kw">)</span></span>
<span id="cb65-3216"><a href="#cb65-3216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3217"><a href="#cb65-3217" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional analysis: Band correlations</span></span>
<span id="cb65-3218"><a href="#cb65-3218" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">band_data</span> and len<span class="er">(</span><span class="ex">band_data</span><span class="kw">)</span> <span class="op">&gt;</span> 2:</span>
<span id="cb65-3219"><a href="#cb65-3219" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate band correlations</span></span>
<span id="cb65-3220"><a href="#cb65-3220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3221"><a href="#cb65-3221" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create correlation matrix</span></span>
<span id="cb65-3222"><a href="#cb65-3222" aria-hidden="true" tabindex="-1"></a>    <span class="ex">band_names</span> = [k for k in [<span class="st">'B02'</span>, <span class="st">'B03'</span>, <span class="st">'B04'</span>, <span class="st">'B08'</span>] if k in band_data]</span>
<span id="cb65-3223"><a href="#cb65-3223" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="ex">len</span><span class="er">(</span><span class="ex">band_names</span><span class="kw">)</span> <span class="op">&gt;</span>= <span class="ex">2:</span></span>
<span id="cb65-3224"><a href="#cb65-3224" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Flatten bands and create DataFrame</span></span>
<span id="cb65-3225"><a href="#cb65-3225" aria-hidden="true" tabindex="-1"></a>        <span class="ex">band_df</span> = pd.DataFrame<span class="er">(</span><span class="kw">)</span></span>
<span id="cb65-3226"><a href="#cb65-3226" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> band_name <span class="kw">in</span> band_names:</span>
<span id="cb65-3227"><a href="#cb65-3227" aria-hidden="true" tabindex="-1"></a>            <span class="va">band_df</span><span class="op">[</span>band_name<span class="op">]</span> <span class="ex">=</span> band_data<span class="pp">[</span><span class="ss">band_name</span><span class="pp">]</span>.flatten<span class="er">(</span><span class="kw">)</span></span>
<span id="cb65-3228"><a href="#cb65-3228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3229"><a href="#cb65-3229" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate correlations</span></span>
<span id="cb65-3230"><a href="#cb65-3230" aria-hidden="true" tabindex="-1"></a>        <span class="ex">correlations</span> = band_df.corr<span class="er">(</span><span class="kw">)</span></span>
<span id="cb65-3231"><a href="#cb65-3231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3232"><a href="#cb65-3232" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot correlation matrix</span></span>
<span id="cb65-3233"><a href="#cb65-3233" aria-hidden="true" tabindex="-1"></a>        <span class="ex">plt.figure</span><span class="er">(</span><span class="va">figsize</span><span class="op">=</span><span class="va">(</span>8, 6<span class="va">)</span><span class="kw">)</span></span>
<span id="cb65-3234"><a href="#cb65-3234" aria-hidden="true" tabindex="-1"></a>        <span class="ex">im</span> = plt.imshow<span class="er">(</span><span class="ex">correlations,</span> cmap=<span class="st">'coolwarm'</span>, vmin=-1, vmax=1<span class="kw">)</span></span>
<span id="cb65-3235"><a href="#cb65-3235" aria-hidden="true" tabindex="-1"></a>        <span class="ex">plt.colorbar</span><span class="er">(</span><span class="ex">im,</span> label=<span class="st">'Correlation'</span><span class="kw">)</span></span>
<span id="cb65-3236"><a href="#cb65-3236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3237"><a href="#cb65-3237" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add labels</span></span>
<span id="cb65-3238"><a href="#cb65-3238" aria-hidden="true" tabindex="-1"></a>        <span class="ex">plt.xticks</span><span class="er">(</span><span class="ex">range</span><span class="er">(</span><span class="ex">len</span><span class="er">(</span><span class="ex">band_names</span><span class="kw">))</span><span class="ex">,</span> band_names<span class="kw">)</span></span>
<span id="cb65-3239"><a href="#cb65-3239" aria-hidden="true" tabindex="-1"></a>        <span class="ex">plt.yticks</span><span class="er">(</span><span class="ex">range</span><span class="er">(</span><span class="ex">len</span><span class="er">(</span><span class="ex">band_names</span><span class="kw">))</span><span class="ex">,</span> band_names<span class="kw">)</span></span>
<span id="cb65-3240"><a href="#cb65-3240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3241"><a href="#cb65-3241" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add correlation values</span></span>
<span id="cb65-3242"><a href="#cb65-3242" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> range<span class="er">(</span><span class="ex">len</span><span class="er">(</span><span class="ex">band_names</span><span class="kw">))</span><span class="bu">:</span></span>
<span id="cb65-3243"><a href="#cb65-3243" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> range<span class="er">(</span><span class="ex">len</span><span class="er">(</span><span class="ex">band_names</span><span class="kw">))</span><span class="bu">:</span></span>
<span id="cb65-3244"><a href="#cb65-3244" aria-hidden="true" tabindex="-1"></a>                <span class="ex">plt.text</span><span class="er">(</span><span class="ex">j,</span> i, f<span class="st">'{correlations.iloc[i, j]:.2f}'</span>,</span>
<span id="cb65-3245"><a href="#cb65-3245" aria-hidden="true" tabindex="-1"></a>                        <span class="va">ha</span><span class="op">=</span><span class="st">'center'</span>, <span class="va">va</span><span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb65-3246"><a href="#cb65-3246" aria-hidden="true" tabindex="-1"></a>                        <span class="va">color</span><span class="op">=</span><span class="st">'white'</span> <span class="cf">if</span> <span class="ex">abs</span><span class="er">(</span><span class="ex">correlations.iloc[i,</span> j]<span class="kw">)</span> <span class="op">&gt;</span> 0.5 <span class="cf">else</span> <span class="st">'black'</span><span class="kw">)</span></span>
<span id="cb65-3247"><a href="#cb65-3247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3248"><a href="#cb65-3248" aria-hidden="true" tabindex="-1"></a>        <span class="ex">plt.title</span><span class="er">(</span><span class="st">'Band Correlation Matrix'</span><span class="ex">,</span> fontweight=<span class="st">'bold'</span><span class="kw">)</span></span>
<span id="cb65-3249"><a href="#cb65-3249" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plt.tight_layout()</span></span>
<span id="cb65-3250"><a href="#cb65-3250" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plt.show()</span></span>
<span id="cb65-3251"><a href="#cb65-3251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3252"><a href="#cb65-3252" aria-hidden="true" tabindex="-1"></a>        <span class="ex">logger.info</span><span class="er">(</span><span class="st">"Band correlation analysis complete"</span><span class="kw">)</span></span>
<span id="cb65-3253"><a href="#cb65-3253" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'B03'</span> in band_names and <span class="st">'B04'</span> in band_names:</span>
<span id="cb65-3254"><a href="#cb65-3254" aria-hidden="true" tabindex="-1"></a>            <span class="ex">logger.info</span><span class="er">(</span><span class="ex">f</span><span class="st">"Highest correlation: B03-B04 = {correlations.loc['B03', 'B04']:.3f}"</span><span class="kw">)</span></span>
<span id="cb65-3255"><a href="#cb65-3255" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-3256"><a href="#cb65-3256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3257"><a href="#cb65-3257" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
<span id="cb65-3258"><a href="#cb65-3258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3259"><a href="#cb65-3259" aria-hidden="true" tabindex="-1"></a><span class="co">## 9. Data Export and Caching</span></span>
<span id="cb65-3260"><a href="#cb65-3260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3261"><a href="#cb65-3261" aria-hidden="true" tabindex="-1"></a><span class="ex">Let</span><span class="st">'s save our processed data for future use and create a reusable cache.</span></span>
<span id="cb65-3262"><a href="#cb65-3262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3263"><a href="#cb65-3263" aria-hidden="true" tabindex="-1"></a><span class="st">### 9.1 Export Processed Data Using Helper Functions</span></span>
<span id="cb65-3264"><a href="#cb65-3264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3265"><a href="#cb65-3265" aria-hidden="true" tabindex="-1"></a><span class="st">The next function in the code block is `export_analysis_results`. This function is designed to export the results of geospatial data analysis to a structured output directory. It takes several optional parameters, including arrays for NDVI and RGB composites, a dictionary of band data, geospatial transform and CRS information, scene metadata, NDVI statistics, and bounding boxes for the area of interest and any subset. The function creates the necessary output and cache directories, and then (as seen in the partial code) proceeds to export the NDVI data as a GeoTIFF file if the relevant data and metadata are provided. The function is intended to help organize and cache analysis outputs for future use or reproducibility.</span></span>
<span id="cb65-3266"><a href="#cb65-3266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3267"><a href="#cb65-3267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3270"><a href="#cb65-3270" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-3271"><a href="#cb65-3271" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-3272"><a href="#cb65-3272" aria-hidden="true" tabindex="-1"></a><span class="st"># | tangle-append: true</span></span>
<span id="cb65-3273"><a href="#cb65-3273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3274"><a href="#cb65-3274" aria-hidden="true" tabindex="-1"></a><span class="st">from typing import Any</span></span>
<span id="cb65-3275"><a href="#cb65-3275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3276"><a href="#cb65-3276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3277"><a href="#cb65-3277" aria-hidden="true" tabindex="-1"></a><span class="st">def export_analysis_results(</span></span>
<span id="cb65-3278"><a href="#cb65-3278" aria-hidden="true" tabindex="-1"></a><span class="st">    output_dir: str = "week1_output",</span></span>
<span id="cb65-3279"><a href="#cb65-3279" aria-hidden="true" tabindex="-1"></a><span class="st">    ndvi: Optional[np.ndarray] = None,</span></span>
<span id="cb65-3280"><a href="#cb65-3280" aria-hidden="true" tabindex="-1"></a><span class="st">    rgb_composite: Optional[np.ndarray] = None,</span></span>
<span id="cb65-3281"><a href="#cb65-3281" aria-hidden="true" tabindex="-1"></a><span class="st">    band_data: Optional[Dict[str, np.ndarray]] = None,</span></span>
<span id="cb65-3282"><a href="#cb65-3282" aria-hidden="true" tabindex="-1"></a><span class="st">    transform: Optional[Any] = None,</span></span>
<span id="cb65-3283"><a href="#cb65-3283" aria-hidden="true" tabindex="-1"></a><span class="st">    crs: Optional[Any] = None,</span></span>
<span id="cb65-3284"><a href="#cb65-3284" aria-hidden="true" tabindex="-1"></a><span class="st">    scene_metadata: Optional[Dict] = None,</span></span>
<span id="cb65-3285"><a href="#cb65-3285" aria-hidden="true" tabindex="-1"></a><span class="st">    ndvi_stats: Optional[Dict] = None,</span></span>
<span id="cb65-3286"><a href="#cb65-3286" aria-hidden="true" tabindex="-1"></a><span class="st">    aoi_bbox: Optional[List[float]] = None,</span></span>
<span id="cb65-3287"><a href="#cb65-3287" aria-hidden="true" tabindex="-1"></a><span class="st">    subset_bbox: Optional[List[float]] = None,</span></span>
<span id="cb65-3288"><a href="#cb65-3288" aria-hidden="true" tabindex="-1"></a><span class="st">) -&gt; Path:</span></span>
<span id="cb65-3289"><a href="#cb65-3289" aria-hidden="true" tabindex="-1"></a><span class="st">    """Export analysis results to structured output directory.</span></span>
<span id="cb65-3290"><a href="#cb65-3290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3291"><a href="#cb65-3291" aria-hidden="true" tabindex="-1"></a><span class="st">    Args:</span></span>
<span id="cb65-3292"><a href="#cb65-3292" aria-hidden="true" tabindex="-1"></a><span class="st">        output_dir: Output directory path</span></span>
<span id="cb65-3293"><a href="#cb65-3293" aria-hidden="true" tabindex="-1"></a><span class="st">        ndvi: NDVI array to export</span></span>
<span id="cb65-3294"><a href="#cb65-3294" aria-hidden="true" tabindex="-1"></a><span class="st">        rgb_composite: RGB composite array to export</span></span>
<span id="cb65-3295"><a href="#cb65-3295" aria-hidden="true" tabindex="-1"></a><span class="st">        band_data: Dictionary of band arrays to cache</span></span>
<span id="cb65-3296"><a href="#cb65-3296" aria-hidden="true" tabindex="-1"></a><span class="st">        transform: Geospatial transform</span></span>
<span id="cb65-3297"><a href="#cb65-3297" aria-hidden="true" tabindex="-1"></a><span class="st">        crs: Coordinate reference system</span></span>
<span id="cb65-3298"><a href="#cb65-3298" aria-hidden="true" tabindex="-1"></a><span class="st">        scene_metadata: Scene metadata dictionary</span></span>
<span id="cb65-3299"><a href="#cb65-3299" aria-hidden="true" tabindex="-1"></a><span class="st">        ndvi_stats: NDVI statistics dictionary</span></span>
<span id="cb65-3300"><a href="#cb65-3300" aria-hidden="true" tabindex="-1"></a><span class="st">        aoi_bbox: Area of interest bounding box</span></span>
<span id="cb65-3301"><a href="#cb65-3301" aria-hidden="true" tabindex="-1"></a><span class="st">        subset_bbox: Subset bounding box</span></span>
<span id="cb65-3302"><a href="#cb65-3302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3303"><a href="#cb65-3303" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns:</span></span>
<span id="cb65-3304"><a href="#cb65-3304" aria-hidden="true" tabindex="-1"></a><span class="st">        Path to output directory</span></span>
<span id="cb65-3305"><a href="#cb65-3305" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-3306"><a href="#cb65-3306" aria-hidden="true" tabindex="-1"></a><span class="st">    from pathlib import Path</span></span>
<span id="cb65-3307"><a href="#cb65-3307" aria-hidden="true" tabindex="-1"></a><span class="st">    import json</span></span>
<span id="cb65-3308"><a href="#cb65-3308" aria-hidden="true" tabindex="-1"></a><span class="st">    from datetime import datetime</span></span>
<span id="cb65-3309"><a href="#cb65-3309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3310"><a href="#cb65-3310" aria-hidden="true" tabindex="-1"></a><span class="st">    output_path = Path(output_dir)</span></span>
<span id="cb65-3311"><a href="#cb65-3311" aria-hidden="true" tabindex="-1"></a><span class="st">    output_path.mkdir(exist_ok=True)</span></span>
<span id="cb65-3312"><a href="#cb65-3312" aria-hidden="true" tabindex="-1"></a><span class="st">    cache_dir = output_path / "cache"</span></span>
<span id="cb65-3313"><a href="#cb65-3313" aria-hidden="true" tabindex="-1"></a><span class="st">    cache_dir.mkdir(exist_ok=True)</span></span>
<span id="cb65-3314"><a href="#cb65-3314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3315"><a href="#cb65-3315" aria-hidden="true" tabindex="-1"></a><span class="st">    # Export NDVI if available</span></span>
<span id="cb65-3316"><a href="#cb65-3316" aria-hidden="true" tabindex="-1"></a><span class="st">    if ndvi is not None and transform is not None and crs is not None:</span></span>
<span id="cb65-3317"><a href="#cb65-3317" aria-hidden="true" tabindex="-1"></a><span class="st">        ndvi_path = output_path / "ndvi.tif"</span></span>
<span id="cb65-3318"><a href="#cb65-3318" aria-hidden="true" tabindex="-1"></a><span class="st">        save_geotiff(</span></span>
<span id="cb65-3319"><a href="#cb65-3319" aria-hidden="true" tabindex="-1"></a><span class="st">            data=ndvi,</span></span>
<span id="cb65-3320"><a href="#cb65-3320" aria-hidden="true" tabindex="-1"></a><span class="st">            output_path=ndvi_path,</span></span>
<span id="cb65-3321"><a href="#cb65-3321" aria-hidden="true" tabindex="-1"></a><span class="st">            transform=transform,</span></span>
<span id="cb65-3322"><a href="#cb65-3322" aria-hidden="true" tabindex="-1"></a><span class="st">            crs=crs,</span></span>
<span id="cb65-3323"><a href="#cb65-3323" aria-hidden="true" tabindex="-1"></a><span class="st">            band_names=["NDVI"],</span></span>
<span id="cb65-3324"><a href="#cb65-3324" aria-hidden="true" tabindex="-1"></a><span class="st">        )</span></span>
<span id="cb65-3325"><a href="#cb65-3325" aria-hidden="true" tabindex="-1"></a><span class="st">        logger.debug(f"Exported NDVI to {ndvi_path.name}")</span></span>
<span id="cb65-3326"><a href="#cb65-3326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3327"><a href="#cb65-3327" aria-hidden="true" tabindex="-1"></a><span class="st">    # Export RGB composite if available</span></span>
<span id="cb65-3328"><a href="#cb65-3328" aria-hidden="true" tabindex="-1"></a><span class="st">    if rgb_composite is not None and transform is not None and crs is not None:</span></span>
<span id="cb65-3329"><a href="#cb65-3329" aria-hidden="true" tabindex="-1"></a><span class="st">        rgb_bands = np.transpose(rgb_composite, (2, 0, 1))  # HWC to CHW</span></span>
<span id="cb65-3330"><a href="#cb65-3330" aria-hidden="true" tabindex="-1"></a><span class="st">        rgb_path = output_path / "rgb_composite.tif"</span></span>
<span id="cb65-3331"><a href="#cb65-3331" aria-hidden="true" tabindex="-1"></a><span class="st">        save_geotiff(</span></span>
<span id="cb65-3332"><a href="#cb65-3332" aria-hidden="true" tabindex="-1"></a><span class="st">            data=rgb_bands,</span></span>
<span id="cb65-3333"><a href="#cb65-3333" aria-hidden="true" tabindex="-1"></a><span class="st">            output_path=rgb_path,</span></span>
<span id="cb65-3334"><a href="#cb65-3334" aria-hidden="true" tabindex="-1"></a><span class="st">            transform=transform,</span></span>
<span id="cb65-3335"><a href="#cb65-3335" aria-hidden="true" tabindex="-1"></a><span class="st">            crs=crs,</span></span>
<span id="cb65-3336"><a href="#cb65-3336" aria-hidden="true" tabindex="-1"></a><span class="st">            band_names=["Red", "Green", "Blue"],</span></span>
<span id="cb65-3337"><a href="#cb65-3337" aria-hidden="true" tabindex="-1"></a><span class="st">        )</span></span>
<span id="cb65-3338"><a href="#cb65-3338" aria-hidden="true" tabindex="-1"></a><span class="st">        logger.debug(f"Exported RGB composite to {rgb_path.name}")</span></span>
<span id="cb65-3339"><a href="#cb65-3339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3340"><a href="#cb65-3340" aria-hidden="true" tabindex="-1"></a><span class="st">    # Cache individual bands</span></span>
<span id="cb65-3341"><a href="#cb65-3341" aria-hidden="true" tabindex="-1"></a><span class="st">    if band_data:</span></span>
<span id="cb65-3342"><a href="#cb65-3342" aria-hidden="true" tabindex="-1"></a><span class="st">        cached_bands = []</span></span>
<span id="cb65-3343"><a href="#cb65-3343" aria-hidden="true" tabindex="-1"></a><span class="st">        for band_name, band_array in band_data.items():</span></span>
<span id="cb65-3344"><a href="#cb65-3344" aria-hidden="true" tabindex="-1"></a><span class="st">            if band_name.startswith("B") and isinstance(band_array, np.ndarray):</span></span>
<span id="cb65-3345"><a href="#cb65-3345" aria-hidden="true" tabindex="-1"></a><span class="st">                band_path = cache_dir / f"{band_name}.npy"</span></span>
<span id="cb65-3346"><a href="#cb65-3346" aria-hidden="true" tabindex="-1"></a><span class="st">                np.save(band_path, band_array)</span></span>
<span id="cb65-3347"><a href="#cb65-3347" aria-hidden="true" tabindex="-1"></a><span class="st">                cached_bands.append(band_name)</span></span>
<span id="cb65-3348"><a href="#cb65-3348" aria-hidden="true" tabindex="-1"></a><span class="st">        logger.debug(f"Cached {len(cached_bands)} bands: {cached_bands}")</span></span>
<span id="cb65-3349"><a href="#cb65-3349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3350"><a href="#cb65-3350" aria-hidden="true" tabindex="-1"></a><span class="st">    # Create metadata</span></span>
<span id="cb65-3351"><a href="#cb65-3351" aria-hidden="true" tabindex="-1"></a><span class="st">    metadata = {</span></span>
<span id="cb65-3352"><a href="#cb65-3352" aria-hidden="true" tabindex="-1"></a><span class="st">        "processing_date": datetime.now().isoformat(),</span></span>
<span id="cb65-3353"><a href="#cb65-3353" aria-hidden="true" tabindex="-1"></a><span class="st">        "aoi_bbox": aoi_bbox,</span></span>
<span id="cb65-3354"><a href="#cb65-3354" aria-hidden="true" tabindex="-1"></a><span class="st">        "subset_bbox": subset_bbox,</span></span>
<span id="cb65-3355"><a href="#cb65-3355" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb65-3356"><a href="#cb65-3356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3357"><a href="#cb65-3357" aria-hidden="true" tabindex="-1"></a><span class="st">    if scene_metadata:</span></span>
<span id="cb65-3358"><a href="#cb65-3358" aria-hidden="true" tabindex="-1"></a><span class="st">        metadata["scene"] = scene_metadata</span></span>
<span id="cb65-3359"><a href="#cb65-3359" aria-hidden="true" tabindex="-1"></a><span class="st">    if ndvi_stats:</span></span>
<span id="cb65-3360"><a href="#cb65-3360" aria-hidden="true" tabindex="-1"></a><span class="st">        metadata["ndvi_statistics"] = ndvi_stats</span></span>
<span id="cb65-3361"><a href="#cb65-3361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3362"><a href="#cb65-3362" aria-hidden="true" tabindex="-1"></a><span class="st">    # Save metadata</span></span>
<span id="cb65-3363"><a href="#cb65-3363" aria-hidden="true" tabindex="-1"></a><span class="st">    metadata_path = output_path / "metadata.json"</span></span>
<span id="cb65-3364"><a href="#cb65-3364" aria-hidden="true" tabindex="-1"></a><span class="st">    with open(metadata_path, "w") as f:</span></span>
<span id="cb65-3365"><a href="#cb65-3365" aria-hidden="true" tabindex="-1"></a><span class="st">        json.dump(metadata, f, indent=2, default=str)</span></span>
<span id="cb65-3366"><a href="#cb65-3366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3367"><a href="#cb65-3367" aria-hidden="true" tabindex="-1"></a><span class="st">    logger.info(f"Analysis results exported to: {output_path.absolute()}")</span></span>
<span id="cb65-3368"><a href="#cb65-3368" aria-hidden="true" tabindex="-1"></a><span class="st">    return output_path</span></span>
<span id="cb65-3369"><a href="#cb65-3369" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb65-3370"><a href="#cb65-3370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3371"><a href="#cb65-3371" aria-hidden="true" tabindex="-1"></a><span class="st">### 9.2 Reloading Data</span></span>
<span id="cb65-3372"><a href="#cb65-3372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3373"><a href="#cb65-3373" aria-hidden="true" tabindex="-1"></a><span class="st">To reload your processed data, you can use the `load_week1_data` function provided below. This function reads the exported metadata, NDVI raster, and any cached bands from the specified output directory. Here'</span><span class="ex">s</span> how you can use it:</span>
<span id="cb65-3374"><a href="#cb65-3374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3375"><a href="#cb65-3375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3378"><a href="#cb65-3378" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-3379"><a href="#cb65-3379" aria-hidden="true" tabindex="-1"></a><span class="co"># | tangle: geogfm/c01.py</span></span>
<span id="cb65-3380"><a href="#cb65-3380" aria-hidden="true" tabindex="-1"></a><span class="co"># | tangle-append: true</span></span>
<span id="cb65-3381"><a href="#cb65-3381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3382"><a href="#cb65-3382" aria-hidden="true" tabindex="-1"></a><span class="ex">def</span> load_week1_data<span class="er">(</span><span class="ex">output_dir:</span> str = <span class="st">"week1_output"</span><span class="kw">)</span> <span class="ex">-</span><span class="op">&gt;</span> Dict[str, Any]:</span>
<span id="cb65-3383"><a href="#cb65-3383" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""Load processed data from Week 1."""</span></span>
<span id="cb65-3384"><a href="#cb65-3384" aria-hidden="true" tabindex="-1"></a>    <span class="ex">from</span> pathlib import Path</span>
<span id="cb65-3385"><a href="#cb65-3385" aria-hidden="true" tabindex="-1"></a>    <span class="ex">import</span> json</span>
<span id="cb65-3386"><a href="#cb65-3386" aria-hidden="true" tabindex="-1"></a>    <span class="ex">import</span> numpy as np</span>
<span id="cb65-3387"><a href="#cb65-3387" aria-hidden="true" tabindex="-1"></a>    <span class="ex">import</span> rasterio</span>
<span id="cb65-3388"><a href="#cb65-3388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3389"><a href="#cb65-3389" aria-hidden="true" tabindex="-1"></a>    <span class="ex">output_path</span> = Path<span class="er">(</span><span class="ex">output_dir</span><span class="kw">)</span></span>
<span id="cb65-3390"><a href="#cb65-3390" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="ex">not</span> output_path.exists<span class="er">(</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb65-3391"><a href="#cb65-3391" aria-hidden="true" tabindex="-1"></a>        <span class="ex">raise</span> FileNotFoundError<span class="er">(</span><span class="ex">f</span><span class="st">"Directory not found: {output_path}"</span><span class="kw">)</span></span>
<span id="cb65-3392"><a href="#cb65-3392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3393"><a href="#cb65-3393" aria-hidden="true" tabindex="-1"></a>    <span class="ex">data</span> = {}</span>
<span id="cb65-3394"><a href="#cb65-3394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3395"><a href="#cb65-3395" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load metadata</span></span>
<span id="cb65-3396"><a href="#cb65-3396" aria-hidden="true" tabindex="-1"></a>    <span class="ex">metadata_path</span> = output_path / <span class="st">"metadata.json"</span></span>
<span id="cb65-3397"><a href="#cb65-3397" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">metadata_path.exists()</span><span class="bu">:</span></span>
<span id="cb65-3398"><a href="#cb65-3398" aria-hidden="true" tabindex="-1"></a>        <span class="ex">with</span> open<span class="er">(</span><span class="ex">metadata_path</span><span class="kw">)</span> <span class="fu">as</span> f:</span>
<span id="cb65-3399"><a href="#cb65-3399" aria-hidden="true" tabindex="-1"></a>            <span class="va">data</span><span class="op">[</span><span class="st">"metadata"</span><span class="op">]</span> <span class="ex">=</span> json.load<span class="er">(</span><span class="ex">f</span><span class="kw">)</span></span>
<span id="cb65-3400"><a href="#cb65-3400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3401"><a href="#cb65-3401" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load NDVI</span></span>
<span id="cb65-3402"><a href="#cb65-3402" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ndvi_path</span> = output_path / <span class="st">"ndvi.tif"</span></span>
<span id="cb65-3403"><a href="#cb65-3403" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">ndvi_path.exists()</span><span class="bu">:</span></span>
<span id="cb65-3404"><a href="#cb65-3404" aria-hidden="true" tabindex="-1"></a>        <span class="ex">with</span> rasterio.open<span class="er">(</span><span class="ex">ndvi_path</span><span class="kw">)</span> <span class="fu">as</span> src:</span>
<span id="cb65-3405"><a href="#cb65-3405" aria-hidden="true" tabindex="-1"></a>            <span class="va">data</span><span class="op">[</span><span class="st">"ndvi"</span><span class="op">]</span> <span class="ex">=</span> src.read<span class="er">(</span><span class="ex">1</span><span class="kw">)</span></span>
<span id="cb65-3406"><a href="#cb65-3406" aria-hidden="true" tabindex="-1"></a>            <span class="va">data</span><span class="op">[</span><span class="st">"transform"</span><span class="op">]</span> <span class="ex">=</span> src.transform</span>
<span id="cb65-3407"><a href="#cb65-3407" aria-hidden="true" tabindex="-1"></a>            <span class="va">data</span><span class="op">[</span><span class="st">"crs"</span><span class="op">]</span> <span class="ex">=</span> src.crs</span>
<span id="cb65-3408"><a href="#cb65-3408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3409"><a href="#cb65-3409" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load cached bands</span></span>
<span id="cb65-3410"><a href="#cb65-3410" aria-hidden="true" tabindex="-1"></a>    <span class="ex">cache_dir</span> = output_path / <span class="st">"cache"</span></span>
<span id="cb65-3411"><a href="#cb65-3411" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">cache_dir.exists()</span><span class="bu">:</span></span>
<span id="cb65-3412"><a href="#cb65-3412" aria-hidden="true" tabindex="-1"></a>        <span class="va">data</span><span class="op">[</span><span class="st">"bands"</span><span class="op">]</span> <span class="ex">=</span> {}</span>
<span id="cb65-3413"><a href="#cb65-3413" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> band_file <span class="kw">in</span> cache_dir.glob<span class="er">(</span><span class="st">"*.npy"</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb65-3414"><a href="#cb65-3414" aria-hidden="true" tabindex="-1"></a>            <span class="ex">band_name</span> = band_file.stem</span>
<span id="cb65-3415"><a href="#cb65-3415" aria-hidden="true" tabindex="-1"></a>            <span class="va">data</span><span class="op">[</span><span class="st">"bands"</span><span class="op">][</span>band_name<span class="op">]</span> <span class="ex">=</span> np.load<span class="er">(</span><span class="ex">band_file</span><span class="kw">)</span></span>
<span id="cb65-3416"><a href="#cb65-3416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3417"><a href="#cb65-3417" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ex">data</span></span>
<span id="cb65-3418"><a href="#cb65-3418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3419"><a href="#cb65-3419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3420"><a href="#cb65-3420" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the analysis results</span></span>
<span id="cb65-3421"><a href="#cb65-3421" aria-hidden="true" tabindex="-1"></a><span class="ex">scene_meta</span> = None</span>
<span id="cb65-3422"><a href="#cb65-3422" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"best_scene"</span> in locals<span class="er">(</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb65-3423"><a href="#cb65-3423" aria-hidden="true" tabindex="-1"></a>    <span class="ex">scene_meta</span> = {</span>
<span id="cb65-3424"><a href="#cb65-3424" aria-hidden="true" tabindex="-1"></a>        <span class="st">"id"</span><span class="ex">:</span> best_scene.id,</span>
<span id="cb65-3425"><a href="#cb65-3425" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span><span class="ex">:</span> best_scene.properties<span class="pp">[</span><span class="st">"datetime"</span><span class="pp">]</span>,</span>
<span id="cb65-3426"><a href="#cb65-3426" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_cover"</span><span class="ex">:</span> best_scene.properties<span class="pp">[</span><span class="st">"eo:cloud_cover"</span><span class="pp">]</span>,</span>
<span id="cb65-3427"><a href="#cb65-3427" aria-hidden="true" tabindex="-1"></a>        <span class="st">"platform"</span><span class="ex">:</span> best_scene.properties.get<span class="er">(</span><span class="st">"platform"</span><span class="ex">,</span> <span class="st">"Unknown"</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-3428"><a href="#cb65-3428" aria-hidden="true" tabindex="-1"></a>    <span class="er">}</span></span>
<span id="cb65-3429"><a href="#cb65-3429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3430"><a href="#cb65-3430" aria-hidden="true" tabindex="-1"></a><span class="ex">output_dir</span> = export_analysis_results<span class="er">(</span></span>
<span id="cb65-3431"><a href="#cb65-3431" aria-hidden="true" tabindex="-1"></a>    <span class="va">ndvi</span><span class="op">=</span>ndvi <span class="cf">if</span> <span class="st">"ndvi"</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="cf">else</span> <span class="ex">None,</span></span>
<span id="cb65-3432"><a href="#cb65-3432" aria-hidden="true" tabindex="-1"></a>    <span class="va">rgb_composite</span><span class="op">=</span>rgb_composite <span class="cf">if</span> <span class="st">"rgb_composite"</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="cf">else</span> <span class="ex">None,</span></span>
<span id="cb65-3433"><a href="#cb65-3433" aria-hidden="true" tabindex="-1"></a>    <span class="va">band_data</span><span class="op">=</span>band_data <span class="cf">if</span> <span class="st">"band_data"</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="cf">else</span> <span class="ex">None,</span></span>
<span id="cb65-3434"><a href="#cb65-3434" aria-hidden="true" tabindex="-1"></a>    <span class="va">transform</span><span class="op">=</span>transform <span class="cf">if</span> <span class="st">"transform"</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="cf">else</span> <span class="ex">None,</span></span>
<span id="cb65-3435"><a href="#cb65-3435" aria-hidden="true" tabindex="-1"></a>    <span class="va">crs</span><span class="op">=</span>crs <span class="cf">if</span> <span class="st">"crs"</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="cf">else</span> <span class="ex">None,</span></span>
<span id="cb65-3436"><a href="#cb65-3436" aria-hidden="true" tabindex="-1"></a>    <span class="va">scene_metadata</span><span class="op">=</span>scene_meta,</span>
<span id="cb65-3437"><a href="#cb65-3437" aria-hidden="true" tabindex="-1"></a>    <span class="va">ndvi_stats</span><span class="op">=</span>ndvi_stats <span class="cf">if</span> <span class="st">"ndvi_stats"</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="cf">else</span> <span class="ex">None,</span></span>
<span id="cb65-3438"><a href="#cb65-3438" aria-hidden="true" tabindex="-1"></a>    <span class="va">aoi_bbox</span><span class="op">=</span>santa_barbara_bbox <span class="cf">if</span> <span class="st">"santa_barbara_bbox"</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="cf">else</span> <span class="ex">None,</span></span>
<span id="cb65-3439"><a href="#cb65-3439" aria-hidden="true" tabindex="-1"></a>    <span class="va">subset_bbox</span><span class="op">=</span>subset_bbox <span class="cf">if</span> <span class="st">"subset_bbox"</span> in locals<span class="er">(</span><span class="kw">)</span> <span class="cf">else</span> <span class="ex">None,</span></span>
<span id="cb65-3440"><a href="#cb65-3440" aria-hidden="true" tabindex="-1"></a><span class="kw">)</span></span>
<span id="cb65-3441"><a href="#cb65-3441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3442"><a href="#cb65-3442" aria-hidden="true" tabindex="-1"></a><span class="ex">logger.info</span><span class="er">(</span><span class="st">"Data exported - use load_week1_data() to reload"</span><span class="kw">)</span></span>
<span id="cb65-3443"><a href="#cb65-3443" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb65-3444"><a href="#cb65-3444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3445"><a href="#cb65-3445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3446"><a href="#cb65-3446" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
<span id="cb65-3447"><a href="#cb65-3447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3448"><a href="#cb65-3448" aria-hidden="true" tabindex="-1"></a><span class="co">## 10. Conclusion: From Foundations to Frontiers</span></span>
<span id="cb65-3449"><a href="#cb65-3449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3450"><a href="#cb65-3450" aria-hidden="true" tabindex="-1"></a><span class="ex">:::{.callout-tip}</span></span>
<span id="cb65-3451"><a href="#cb65-3451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3452"><a href="#cb65-3452" aria-hidden="true" tabindex="-1"></a><span class="co">##### What You've Accomplished</span></span>
<span id="cb65-3453"><a href="#cb65-3453" aria-hidden="true" tabindex="-1"></a><span class="ex">You</span><span class="st">'ve successfully built a **production-ready geospatial AI toolkit** that demonstrates both technical excellence and software engineering best practices. This foundation will serve you throughout your career in geospatial AI.</span></span>
<span id="cb65-3454"><a href="#cb65-3454" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb65-3455"><a href="#cb65-3455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3456"><a href="#cb65-3456" aria-hidden="true" tabindex="-1"></a><span class="st">🎉 **Outstanding Achievement!** You'</span><span class="ex">ve</span> progressed from basic satellite data access to building a sophisticated, enterprise-grade geospatial analysis system.</span>
<span id="cb65-3457"><a href="#cb65-3457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3458"><a href="#cb65-3458" aria-hidden="true" tabindex="-1"></a><span class="co">### 10.1 Core Competencies Developed</span></span>
<span id="cb65-3459"><a href="#cb65-3459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3460"><a href="#cb65-3460" aria-hidden="true" tabindex="-1"></a><span class="ex">**Technical</span> Mastery:<span class="pp">**</span></span>
<span id="cb65-3461"><a href="#cb65-3461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3462"><a href="#cb65-3462" aria-hidden="true" tabindex="-1"></a><span class="ex">1.</span> <span class="pp">**</span>🛠️ Enterprise-Grade Toolkit<span class="pp">**</span>: Built 13+ production-ready functions for geospatial AI workflows</span>
<span id="cb65-3463"><a href="#cb65-3463" aria-hidden="true" tabindex="-1"></a><span class="ex">2.</span> <span class="pp">**</span>🔐 Security-First Architecture<span class="pp">**</span>: Implemented robust authentication and error handling patterns</span>
<span id="cb65-3464"><a href="#cb65-3464" aria-hidden="true" tabindex="-1"></a><span class="ex">2.</span> <span class="pp">**</span>🌍 Mastered STAC APIs<span class="pp">**</span>: Connected to planetary-scale satellite data with proper authentication</span>
<span id="cb65-3465"><a href="#cb65-3465" aria-hidden="true" tabindex="-1"></a><span class="ex">3.</span> <span class="pp">**</span>📡 Loaded Real Satellite Data<span class="pp">**</span>: Worked with actual Sentinel-2 imagery, not just sample data</span>
<span id="cb65-3466"><a href="#cb65-3466" aria-hidden="true" tabindex="-1"></a><span class="ex">4.</span> <span class="pp">**</span>🎨 Created Publication-Quality Visuals<span class="pp">**</span>: RGB composites, NDVI maps, and interactive visualizations</span>
<span id="cb65-3467"><a href="#cb65-3467" aria-hidden="true" tabindex="-1"></a><span class="ex">5.</span> <span class="pp">**</span>📊 Performed Multi-band Analysis<span class="pp">**</span>: Calculated vegetation indices and band correlations</span>
<span id="cb65-3468"><a href="#cb65-3468" aria-hidden="true" tabindex="-1"></a><span class="ex">6.</span> <span class="pp">**</span>🗺️ Built Interactive Maps<span class="pp">**</span>: Folium maps with measurement tools and multiple basemaps</span>
<span id="cb65-3469"><a href="#cb65-3469" aria-hidden="true" tabindex="-1"></a><span class="ex">7.</span> <span class="pp">**</span>💾 Established Data Workflows<span class="pp">**</span>: Export functions and caching for reproducible analysis</span>
<span id="cb65-3470"><a href="#cb65-3470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3471"><a href="#cb65-3471" aria-hidden="true" tabindex="-1"></a><span class="ex">**Key</span> Technical Skills Gained:<span class="pp">**</span></span>
<span id="cb65-3472"><a href="#cb65-3472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3473"><a href="#cb65-3473" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Authentication<span class="pp">**</span>: Planetary Computer API tokens for enterprise-level data access</span>
<span id="cb65-3474"><a href="#cb65-3474" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Error Handling<span class="pp">**</span>: Robust functions with retry logic and fallback options</span>
<span id="cb65-3475"><a href="#cb65-3475" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Memory Management<span class="pp">**</span>: Subsetting and efficient loading of large raster datasets</span>
<span id="cb65-3476"><a href="#cb65-3476" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Geospatial Standards<span class="pp">**</span>: Working with CRS transformations and GeoTIFF exports</span>
<span id="cb65-3477"><a href="#cb65-3477" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="pp">**</span>Code Documentation<span class="pp">**</span>: Well-documented functions with examples and type hints</span>
<span id="cb65-3478"><a href="#cb65-3478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3479"><a href="#cb65-3479" aria-hidden="true" tabindex="-1"></a><span class="co">### 10.2 Real-World Applications</span></span>
<span id="cb65-3480"><a href="#cb65-3480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3481"><a href="#cb65-3481" aria-hidden="true" tabindex="-1"></a><span class="ex">Your</span> helper functions are now ready for:</span>
<span id="cb65-3482"><a href="#cb65-3482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3483"><a href="#cb65-3483" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 🌱 <span class="pp">**</span>Environmental Monitoring<span class="pp">**</span>: Track deforestation, urban growth, crop health</span>
<span id="cb65-3484"><a href="#cb65-3484" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 🌊 <span class="pp">**</span>Disaster Response<span class="pp">**</span>: Flood mapping, wildfire damage assessment</span>
<span id="cb65-3485"><a href="#cb65-3485" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 📊 <span class="pp">**</span>Research Projects<span class="pp">**</span>: Time series analysis, change detection studies</span>
<span id="cb65-3486"><a href="#cb65-3486" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 🏢 <span class="pp">**</span>Commercial Applications<span class="pp">**</span>: Agricultural monitoring, real estate analysis</span>
<span id="cb65-3487"><a href="#cb65-3487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3488"><a href="#cb65-3488" aria-hidden="true" tabindex="-1"></a><span class="co">### 10.3 Week 2 Preview: Rapid Preprocessing Pipelines</span></span>
<span id="cb65-3489"><a href="#cb65-3489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3490"><a href="#cb65-3490" aria-hidden="true" tabindex="-1"></a><span class="ex">Next</span> week, we<span class="st">'ll scale up using your new toolkit:</span></span>
<span id="cb65-3491"><a href="#cb65-3491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3492"><a href="#cb65-3492" aria-hidden="true" tabindex="-1"></a><span class="st">- **Batch Processing**: Handle multiple scenes and time series</span></span>
<span id="cb65-3493"><a href="#cb65-3493" aria-hidden="true" tabindex="-1"></a><span class="st">- **Cloud Masking**: Automatically filter cloudy pixels</span></span>
<span id="cb65-3494"><a href="#cb65-3494" aria-hidden="true" tabindex="-1"></a><span class="st">- **Mosaicking**: Combine scenes into seamless regional datasets</span></span>
<span id="cb65-3495"><a href="#cb65-3495" aria-hidden="true" tabindex="-1"></a><span class="st">- **Analysis-Ready Data**: Create standardized data cubes for ML</span></span>
<span id="cb65-3496"><a href="#cb65-3496" aria-hidden="true" tabindex="-1"></a><span class="st">- **Performance Optimization**: Parallel processing and dask integration</span></span>
<span id="cb65-3497"><a href="#cb65-3497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3498"><a href="#cb65-3498" aria-hidden="true" tabindex="-1"></a><span class="st">**Steps to try**:</span></span>
<span id="cb65-3499"><a href="#cb65-3499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3500"><a href="#cb65-3500" aria-hidden="true" tabindex="-1"></a><span class="st">1. Modify the `santa_barbara_bbox` to your area of interest</span></span>
<span id="cb65-3501"><a href="#cb65-3501" aria-hidden="true" tabindex="-1"></a><span class="st">2. Use `search_sentinel2_scenes()` to find recent imagery</span></span>
<span id="cb65-3502"><a href="#cb65-3502" aria-hidden="true" tabindex="-1"></a><span class="st">3. Run the complete analysis pipeline</span></span>
<span id="cb65-3503"><a href="#cb65-3503" aria-hidden="true" tabindex="-1"></a><span class="st">4. Export your results and compare seasonal changes</span></span>
<span id="cb65-3504"><a href="#cb65-3504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3505"><a href="#cb65-3505" aria-hidden="true" tabindex="-1"></a><span class="st">### 10.4 Essential Resources</span></span>
<span id="cb65-3506"><a href="#cb65-3506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3507"><a href="#cb65-3507" aria-hidden="true" tabindex="-1"></a><span class="st">**Data Sources:**</span></span>
<span id="cb65-3508"><a href="#cb65-3508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3509"><a href="#cb65-3509" aria-hidden="true" tabindex="-1"></a><span class="st">- [Microsoft Planetary Computer Catalog](https://planetarycomputer.microsoft.com/catalog) - Free satellite data</span></span>
<span id="cb65-3510"><a href="#cb65-3510" aria-hidden="true" tabindex="-1"></a><span class="st">- [STAC Browser](https://radiantearth.github.io/stac-browser/) - Explore STAC catalogs</span></span>
<span id="cb65-3511"><a href="#cb65-3511" aria-hidden="true" tabindex="-1"></a><span class="st">- [Earth Engine Data Catalog](https://developers.google.com/earth-engine/datasets) - Alternative data source</span></span>
<span id="cb65-3512"><a href="#cb65-3512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3513"><a href="#cb65-3513" aria-hidden="true" tabindex="-1"></a><span class="st">**Technical Documentation:**</span></span>
<span id="cb65-3514"><a href="#cb65-3514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3515"><a href="#cb65-3515" aria-hidden="true" tabindex="-1"></a><span class="st">- [Rasterio Documentation](https://rasterio.readthedocs.io/) - Geospatial I/O</span></span>
<span id="cb65-3516"><a href="#cb65-3516" aria-hidden="true" tabindex="-1"></a><span class="st">- [Xarray Tutorial](https://docs.xarray.dev/en/stable/tutorials-and-videos.html) - Multi-dimensional arrays</span></span>
<span id="cb65-3517"><a href="#cb65-3517" aria-hidden="true" tabindex="-1"></a><span class="st">- [STAC Specification](https://stacspec.org/) - Metadata standards</span></span>
<span id="cb65-3518"><a href="#cb65-3518" aria-hidden="true" tabindex="-1"></a><span class="st">- [Folium Examples](https://python-visualization.github.io/folium/) - Interactive mapping</span></span>
<span id="cb65-3519"><a href="#cb65-3519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3520"><a href="#cb65-3520" aria-hidden="true" tabindex="-1"></a><span class="st">**Community:**</span></span>
<span id="cb65-3521"><a href="#cb65-3521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3522"><a href="#cb65-3522" aria-hidden="true" tabindex="-1"></a><span class="st">- [Pangeo Community](https://pangeo.io/) - Open source geoscience</span></span>
<span id="cb65-3523"><a href="#cb65-3523" aria-hidden="true" tabindex="-1"></a><span class="st">- [STAC Discord](https://discord.gg/stac) - STAC community support</span></span>
<span id="cb65-3524"><a href="#cb65-3524" aria-hidden="true" tabindex="-1"></a><span class="st">- [PyData Geospatial](https://github.com/pydata/pydata-book) - Python geospatial ecosystem</span></span>
<span id="cb65-3525"><a href="#cb65-3525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3526"><a href="#cb65-3526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3527"><a href="#cb65-3527" aria-hidden="true" tabindex="-1"></a><span class="st">**Remember**: Your helper functions are now your superpower! 🦸 Use them to explore any area on Earth with just a few lines of code.</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/geog-logo.png" class="img-fluid figure-img" width="250"></p>
<figcaption>Department of Geography logo</figcaption>
</figure>
</div>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This website is built with <a href="https://github.com/kcaylor/GEOG-288KC-geospatial-foundation-models"><i class="fa-brands fa-github" title="the github octocat logo" aria-label="github"></i></a> and <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>