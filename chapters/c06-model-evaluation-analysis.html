<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 6: Spatiotemporal Modeling &amp; Projects</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">GEOG 288KC</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">üè† home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Syllabus.html"> 
<span class="menu-text">üìã syllabus</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-weekly-sessions" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">üíª weekly sessions</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-weekly-sessions">    
        <li>
    <a class="dropdown-item" href="../chapters/c01-geospatial-data-foundations.html">
 <span class="dropdown-text">Week 1 - üöÄ Core Tools and Data Access</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c02-spatial-temporal-attention-mechanisms.html">
 <span class="dropdown-text">Week 2 - ‚ö° Rapid Remote Sensing Preprocessing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c03-complete-gfm-architecture.html">
 <span class="dropdown-text">Week 3 - ü§ñ Machine Learning on Remote Sensing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c04-pretraining-implementation.html">
 <span class="dropdown-text">Week 4 - üèóÔ∏è Foundation Models in Practice</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c05-training-loop-optimization.html">
 <span class="dropdown-text">Week 5 - üîß Fine-Tuning &amp; Transfer Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c06-model-evaluation-analysis.html">
 <span class="dropdown-text">Week 6 - ‚è∞ Spatiotemporal Modeling &amp; Projects</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cheatsheets" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">üëÄ Cheatsheets</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-cheatsheets">    
        <li class="dropdown-header">üèóÔ∏è Foundation Models &amp; AI</li>
        <li>
    <a class="dropdown-item" href="../chapters/c00a-foundation_model_architectures.html">
 <span class="dropdown-text">Foundation Model Architectures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/gfm_architecture.html">
 <span class="dropdown-text">GFM Architecture Cheatsheet</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/finetuning_basics.html">
 <span class="dropdown-text">Fine-tuning Basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/multimodal_learning.html">
 <span class="dropdown-text">Multi-modal Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/model_evaluation_validation.html">
 <span class="dropdown-text">Model Evaluation &amp; Validation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/loading_models.html">
 <span class="dropdown-text">Loading Pre-trained Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/model_inference.html">
 <span class="dropdown-text">Model Inference &amp; Feature Extraction</span></a>
  </li>  
        <li class="dropdown-header">üó∫Ô∏è Geospatial Data &amp; Remote Sensing</li>
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/geospatial_data_remote_sensing.html">
 <span class="dropdown-text">Geospatial Data &amp; Remote Sensing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/geobench_datasets.html">
 <span class="dropdown-text">GEO-Bench Datasets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/stac_apis.html">
 <span class="dropdown-text">STAC APIs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/rasterio_basics.html">
 <span class="dropdown-text">Rasterio Basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/xarray_basics.html">
 <span class="dropdown-text">Xarray for Multi-dimensional Data</span></a>
  </li>  
        <li class="dropdown-header">üî• PyTorch &amp; Deep Learning</li>
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/pytorch_tensors.html">
 <span class="dropdown-text">PyTorch Tensors</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/torchgeo_basics.html">
 <span class="dropdown-text">TorchGeo Datasets &amp; Transforms</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/dataloader_satellite.html">
 <span class="dropdown-text">Data Loading for Satellite Imagery</span></a>
  </li>  
        <li class="dropdown-header">üìä Visualization &amp; Analysis</li>
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/plotting_satellite.html">
 <span class="dropdown-text">Plotting Satellite Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/folium_basics.html">
 <span class="dropdown-text">Interactive Maps with Folium</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/matplotlib_geospatial.html">
 <span class="dropdown-text">Geospatial Plotting with Matplotlib</span></a>
  </li>  
        <li class="dropdown-header">‚òÅÔ∏è Deployment &amp; Scaling</li>
        <li>
    <a class="dropdown-item" href="../extras/cheatsheets/cloud_scalable_computing.html">
 <span class="dropdown-text">Cloud &amp; Scalable Computing</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-extras" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">üìñ extras</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-extras">    
        <li>
    <a class="dropdown-item" href="../extras/resources/course_resources.html">
 <span class="dropdown-text">üìö Reference Materials</span></a>
  </li>  
        <li class="dropdown-header">üéØ Practical Examples</li>
        <li>
    <a class="dropdown-item" href="../extras/examples/normalization_comparison.html">
 <span class="dropdown-text">Normalization Comparison</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/examples/resnet.html">
 <span class="dropdown-text">ResNet Implementation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/examples/text_encoder.html">
 <span class="dropdown-text">Text Encoder</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/examples/tiling-and-patches.html">
 <span class="dropdown-text">Tiling and Patches</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/examples/terratorch_workflows.html">
 <span class="dropdown-text">TerraTorch Workflows</span></a>
  </li>  
        <li class="dropdown-header">üìÅ Project Templates</li>
        <li>
    <a class="dropdown-item" href="../extras/projects/project-proposal-template.html">
 <span class="dropdown-text">Project Proposal Template</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/projects/mvp-template.html">
 <span class="dropdown-text">Project Results Template</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kcaylor/GEOG-288KC-geospatial-foundation-models" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <div class="quarto-title-block"><div><h1 class="title">Week 6: Spatiotemporal Modeling &amp; Projects</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
            <p class="subtitle lead">Advanced temporal analysis and independent project implementation</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives">Learning Objectives</a></li>
  <li><a href="#spatiotemporal-data-fundamentals" id="toc-spatiotemporal-data-fundamentals" class="nav-link" data-scroll-target="#spatiotemporal-data-fundamentals">Spatiotemporal Data Fundamentals</a>
  <ul class="collapse">
  <li><a href="#understanding-temporal-patterns" id="toc-understanding-temporal-patterns" class="nav-link" data-scroll-target="#understanding-temporal-patterns">Understanding Temporal Patterns</a></li>
  </ul></li>
  <li><a href="#temporal-foundation-models" id="toc-temporal-foundation-models" class="nav-link" data-scroll-target="#temporal-foundation-models">Temporal Foundation Models</a>
  <ul class="collapse">
  <li><a href="#lstm-based-temporal-processing" id="toc-lstm-based-temporal-processing" class="nav-link" data-scroll-target="#lstm-based-temporal-processing">LSTM-based Temporal Processing</a></li>
  <li><a href="#transformer-based-temporal-processing" id="toc-transformer-based-temporal-processing" class="nav-link" data-scroll-target="#transformer-based-temporal-processing">Transformer-based Temporal Processing</a></li>
  </ul></li>
  <li><a href="#change-detection-applications" id="toc-change-detection-applications" class="nav-link" data-scroll-target="#change-detection-applications">Change Detection Applications</a>
  <ul class="collapse">
  <li><a href="#temporal-change-detection" id="toc-temporal-change-detection" class="nav-link" data-scroll-target="#temporal-change-detection">Temporal Change Detection</a></li>
  <li><a href="#training-change-detection-model" id="toc-training-change-detection-model" class="nav-link" data-scroll-target="#training-change-detection-model">Training Change Detection Model</a></li>
  </ul></li>
  <li><a href="#foundation-model-integration" id="toc-foundation-model-integration" class="nav-link" data-scroll-target="#foundation-model-integration">Foundation Model Integration</a>
  <ul class="collapse">
  <li><a href="#adapting-pretrained-models-for-temporal-analysis" id="toc-adapting-pretrained-models-for-temporal-analysis" class="nav-link" data-scroll-target="#adapting-pretrained-models-for-temporal-analysis">Adapting Pretrained Models for Temporal Analysis</a></li>
  </ul></li>
  <li><a href="#project-implementation-framework" id="toc-project-implementation-framework" class="nav-link" data-scroll-target="#project-implementation-framework">Project Implementation Framework</a>
  <ul class="collapse">
  <li><a href="#project-structure-template" id="toc-project-structure-template" class="nav-link" data-scroll-target="#project-structure-template">Project Structure Template</a></li>
  </ul></li>
  <li><a href="#evaluation-metrics-for-spatiotemporal-models" id="toc-evaluation-metrics-for-spatiotemporal-models" class="nav-link" data-scroll-target="#evaluation-metrics-for-spatiotemporal-models">Evaluation Metrics for Spatiotemporal Models</a>
  <ul class="collapse">
  <li><a href="#temporal-aware-metrics" id="toc-temporal-aware-metrics" class="nav-link" data-scroll-target="#temporal-aware-metrics">Temporal-Aware Metrics</a></li>
  </ul></li>
  <li><a href="#week-6-project-workshop" id="toc-week-6-project-workshop" class="nav-link" data-scroll-target="#week-6-project-workshop">Week 6 Project Workshop</a>
  <ul class="collapse">
  <li><a href="#project-checklist" id="toc-project-checklist" class="nav-link" data-scroll-target="#project-checklist">Project Checklist</a></li>
  </ul></li>
  <li><a href="#assignment-project-implementation" id="toc-assignment-project-implementation" class="nav-link" data-scroll-target="#assignment-project-implementation">Assignment: Project Implementation</a>
  <ul class="collapse">
  <li><a href="#next-week-preview" id="toc-next-week-preview" class="nav-link" data-scroll-target="#next-week-preview">Next Week Preview</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h2>
<p>By the end of this session, you will be able to:</p>
<ul>
<li>Implement spatiotemporal analysis techniques for multi-temporal satellite imagery</li>
<li>Build time series models for change detection and trend analysis</li>
<li>Apply foundation models to temporal sequences of geospatial data</li>
<li>Design and begin executing your independent project</li>
<li>Evaluate model performance using appropriate spatiotemporal metrics</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prerequisites
</div>
</div>
<div class="callout-body-container callout-body">
<p>This session builds on all previous weeks, particularly Week 5‚Äôs fine-tuning techniques. You should have defined your project proposal and be ready to begin implementation.</p>
</div>
</div>
</section>
<section id="spatiotemporal-data-fundamentals" class="level2">
<h2 class="anchored" data-anchor-id="spatiotemporal-data-fundamentals">Spatiotemporal Data Fundamentals</h2>
<p>Spatiotemporal analysis combines spatial patterns with temporal dynamics to understand how geographic phenomena change over time. This is crucial for applications like:</p>
<ul>
<li><strong>Land cover change detection</strong>: Deforestation, urban expansion</li>
<li><strong>Crop monitoring</strong>: Growth stages, yield prediction</li>
<li><strong>Climate impact assessment</strong>: Drought progression, flood mapping</li>
<li><strong>Environmental monitoring</strong>: Water quality changes, vegetation health</li>
</ul>
<section id="understanding-temporal-patterns" class="level3">
<h3 class="anchored" data-anchor-id="understanding-temporal-patterns">Understanding Temporal Patterns</h3>
<div id="e1ac2142" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> Dataset, DataLoader</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up reproducible results</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">42</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TemporalDataset(Dataset):</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Dataset for multi-temporal satellite imagery"""</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n_samples<span class="op">=</span><span class="dv">500</span>, sequence_length<span class="op">=</span><span class="dv">12</span>, image_size<span class="op">=</span><span class="dv">64</span>):</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n_samples <span class="op">=</span> n_samples</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sequence_length <span class="op">=</span> sequence_length</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.image_size <span class="op">=</span> image_size</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simulate monthly time series data</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data <span class="op">=</span> <span class="va">self</span>._generate_synthetic_timeseries()</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _generate_synthetic_timeseries(<span class="va">self</span>):</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Generate synthetic time series with seasonal patterns"""</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> []</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n_samples):</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create base landscape with some spatial structure</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>            base_landscape <span class="op">=</span> <span class="va">self</span>._create_landscape()</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generate temporal sequence with seasonal variation</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>            sequence <span class="op">=</span> []</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.sequence_length):</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Seasonal factor (NDVI-like pattern)</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                seasonal_factor <span class="op">=</span> <span class="fl">0.3</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> np.sin(<span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> t <span class="op">/</span> <span class="dv">12</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Add some random change events</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>                change_factor <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> np.random.random() <span class="op">&lt;</span> <span class="fl">0.1</span>:  <span class="co"># 10% chance of change</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>                    change_factor <span class="op">=</span> np.random.uniform(<span class="fl">0.5</span>, <span class="fl">1.5</span>)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Combine factors</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>                image <span class="op">=</span> base_landscape <span class="op">*</span> seasonal_factor <span class="op">*</span> change_factor</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Add noise</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>                noise <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.05</span>, image.shape)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>                image <span class="op">=</span> np.clip(image <span class="op">+</span> noise, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>                sequence.append(torch.FloatTensor(image))</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>            data.append(torch.stack(sequence))  <span class="co"># Shape: (T, C, H, W)</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_landscape(<span class="va">self</span>):</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Create a realistic base landscape"""</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Start with random field</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        landscape <span class="op">=</span> np.random.random((<span class="dv">3</span>, <span class="va">self</span>.image_size, <span class="va">self</span>.image_size))</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add some spatial structure (vegetation patches)</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> np.meshgrid(np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="va">self</span>.image_size),</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>                          np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="va">self</span>.image_size))</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create vegetation patches</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>        vegetation <span class="op">=</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> np.sin(<span class="dv">4</span> <span class="op">*</span> np.pi <span class="op">*</span> x) <span class="op">*</span> np.cos(<span class="dv">4</span> <span class="op">*</span> np.pi <span class="op">*</span> y)</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        vegetation <span class="op">=</span> np.clip(vegetation, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply to NDVI-like band</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>        landscape[<span class="dv">1</span>] <span class="op">=</span> vegetation</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> landscape</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.n_samples</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, idx):</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.data[idx]</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Create temporal dataset</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>temporal_dataset <span class="op">=</span> TemporalDataset(n_samples<span class="op">=</span><span class="dv">200</span>, sequence_length<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>temporal_loader <span class="op">=</span> DataLoader(temporal_dataset, batch_size<span class="op">=</span><span class="dv">8</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dataset size: </span><span class="sc">{</span><span class="bu">len</span>(temporal_dataset)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data shape: </span><span class="sc">{</span>temporal_dataset[<span class="dv">0</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (T, C, H, W)</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize a sample time series</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>sample_ts <span class="op">=</span> temporal_dataset[<span class="dv">0</span>]</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">6</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>):</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>    row <span class="op">=</span> i <span class="op">//</span> <span class="dv">6</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> i <span class="op">%</span> <span class="dv">6</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    axes[row, col].imshow(sample_ts[i, <span class="dv">1</span>], cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    axes[row, col].set_title(<span class="ss">f'Month </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>    axes[row, col].axis(<span class="st">'off'</span>)</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Monthly NDVI-like Time Series'</span>)</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset size: 200
Data shape: torch.Size([12, 3, 64, 64])</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="c06-model-evaluation-analysis_files/figure-html/cell-2-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="temporal-foundation-models" class="level2">
<h2 class="anchored" data-anchor-id="temporal-foundation-models">Temporal Foundation Models</h2>
<section id="lstm-based-temporal-processing" class="level3">
<h3 class="anchored" data-anchor-id="lstm-based-temporal-processing">LSTM-based Temporal Processing</h3>
<div id="465351fe" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TemporalLSTM(nn.Module):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""LSTM-based model for temporal sequence processing"""</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_dim, hidden_dim<span class="op">=</span><span class="dv">128</span>, num_layers<span class="op">=</span><span class="dv">2</span>, output_dim<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.input_dim <span class="op">=</span> input_dim</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.hidden_dim <span class="op">=</span> hidden_dim</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.num_layers <span class="op">=</span> num_layers</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dim <span class="op">=</span> output_dim <span class="kw">or</span> input_dim</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Spatial feature extractor</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.spatial_encoder <span class="op">=</span> nn.Sequential(</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">3</span>, <span class="dv">32</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>            nn.MaxPool2d(<span class="dv">2</span>),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>            nn.AdaptiveAvgPool2d(<span class="dv">8</span>),</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>            nn.Flatten(),</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">64</span> <span class="op">*</span> <span class="dv">8</span> <span class="op">*</span> <span class="dv">8</span>, input_dim)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Temporal LSTM</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.lstm <span class="op">=</span> nn.LSTM(input_dim, hidden_dim, num_layers,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>                           batch_first<span class="op">=</span><span class="va">True</span>, dropout<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Output projection</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_head <span class="op">=</span> nn.Sequential(</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>            nn.Linear(hidden_dim, hidden_dim),</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>            nn.Dropout(<span class="fl">0.1</span>),</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>            nn.Linear(hidden_dim, <span class="va">self</span>.output_dim)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># x: (B, T, C, H, W)</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        batch_size, seq_len, c, h, w <span class="op">=</span> x.shape</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process each timestep through spatial encoder</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>        x_flat <span class="op">=</span> x.view(batch_size <span class="op">*</span> seq_len, c, h, w)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>        spatial_features <span class="op">=</span> <span class="va">self</span>.spatial_encoder(x_flat)  <span class="co"># (B*T, input_dim)</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        spatial_features <span class="op">=</span> spatial_features.view(batch_size, seq_len, <span class="op">-</span><span class="dv">1</span>)  <span class="co"># (B, T, input_dim)</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process temporal sequence</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        lstm_out, (hidden, cell) <span class="op">=</span> <span class="va">self</span>.lstm(spatial_features)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use final hidden state for prediction</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="va">self</span>.output_head(lstm_out[:, <span class="op">-</span><span class="dv">1</span>])  <span class="co"># (B, output_dim)</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>            <span class="st">'prediction'</span>: output,</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>            <span class="st">'temporal_features'</span>: lstm_out,</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">'spatial_features'</span>: spatial_features</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize model</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> TemporalLSTM(input_dim<span class="op">=</span><span class="dv">256</span>, hidden_dim<span class="op">=</span><span class="dv">128</span>)</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Model parameters: </span><span class="sc">{</span><span class="bu">sum</span>(p.numel() <span class="cf">for</span> p <span class="kw">in</span> model.parameters())<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Test forward pass</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>sample_batch <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(temporal_loader))</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Input shape: </span><span class="sc">{</span>sample_batch<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> model(sample_batch)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Prediction shape: </span><span class="sc">{</span>output[<span class="st">'prediction'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Temporal features shape: </span><span class="sc">{</span>output[<span class="st">'temporal_features'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model parameters: 1,447,488
Input shape: torch.Size([8, 12, 3, 64, 64])
Prediction shape: torch.Size([8, 256])
Temporal features shape: torch.Size([8, 12, 128])</code></pre>
</div>
</div>
</section>
<section id="transformer-based-temporal-processing" class="level3">
<h3 class="anchored" data-anchor-id="transformer-based-temporal-processing">Transformer-based Temporal Processing</h3>
<div id="085f52a7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TemporalTransformer(nn.Module):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Transformer-based model for temporal sequence processing"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_dim<span class="op">=</span><span class="dv">256</span>, d_model<span class="op">=</span><span class="dv">256</span>, nhead<span class="op">=</span><span class="dv">8</span>, num_layers<span class="op">=</span><span class="dv">4</span>, output_dim<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.input_dim <span class="op">=</span> input_dim</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.d_model <span class="op">=</span> d_model</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dim <span class="op">=</span> output_dim <span class="kw">or</span> input_dim</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Spatial feature extractor (same as LSTM version)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.spatial_encoder <span class="op">=</span> nn.Sequential(</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">3</span>, <span class="dv">32</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            nn.MaxPool2d(<span class="dv">2</span>),</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>            nn.AdaptiveAvgPool2d(<span class="dv">8</span>),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            nn.Flatten(),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">64</span> <span class="op">*</span> <span class="dv">8</span> <span class="op">*</span> <span class="dv">8</span>, input_dim)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Project to model dimension</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.input_projection <span class="op">=</span> nn.Linear(input_dim, d_model)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Positional encoding for temporal positions</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.pos_encoding <span class="op">=</span> nn.Parameter(torch.randn(<span class="dv">100</span>, d_model))  <span class="co"># Max 100 timesteps</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Transformer encoder</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        encoder_layer <span class="op">=</span> nn.TransformerEncoderLayer(</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>            d_model<span class="op">=</span>d_model,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>            nhead<span class="op">=</span>nhead,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>            dim_feedforward<span class="op">=</span>d_model <span class="op">*</span> <span class="dv">4</span>,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>            dropout<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>            batch_first<span class="op">=</span><span class="va">True</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.transformer <span class="op">=</span> nn.TransformerEncoder(encoder_layer, num_layers)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Output head</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_head <span class="op">=</span> nn.Sequential(</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>            nn.LayerNorm(d_model),</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>            nn.Linear(d_model, d_model),</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>            nn.Dropout(<span class="fl">0.1</span>),</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>            nn.Linear(d_model, <span class="va">self</span>.output_dim)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># x: (B, T, C, H, W)</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>        batch_size, seq_len, c, h, w <span class="op">=</span> x.shape</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process spatial features</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>        x_flat <span class="op">=</span> x.view(batch_size <span class="op">*</span> seq_len, c, h, w)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>        spatial_features <span class="op">=</span> <span class="va">self</span>.spatial_encoder(x_flat)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        spatial_features <span class="op">=</span> spatial_features.view(batch_size, seq_len, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Project to model dimension</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>        features <span class="op">=</span> <span class="va">self</span>.input_projection(spatial_features)  <span class="co"># (B, T, d_model)</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add positional encoding</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>        features <span class="op">=</span> features <span class="op">+</span> <span class="va">self</span>.pos_encoding[:seq_len].unsqueeze(<span class="dv">0</span>)</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply transformer</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>        transformer_out <span class="op">=</span> <span class="va">self</span>.transformer(features)  <span class="co"># (B, T, d_model)</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Global average pooling across time</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>        pooled <span class="op">=</span> transformer_out.mean(dim<span class="op">=</span><span class="dv">1</span>)  <span class="co"># (B, d_model)</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Output prediction</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="va">self</span>.output_head(pooled)</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">'prediction'</span>: output,</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>            <span class="st">'temporal_features'</span>: transformer_out,</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>            <span class="st">'spatial_features'</span>: spatial_features</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize transformer model</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>transformer_model <span class="op">=</span> TemporalTransformer(input_dim<span class="op">=</span><span class="dv">256</span>, d_model<span class="op">=</span><span class="dv">256</span>)</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Transformer parameters: </span><span class="sc">{</span><span class="bu">sum</span>(p.numel() <span class="cf">for</span> p <span class="kw">in</span> transformer_model.parameters())<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Test forward pass</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>    transformer_output <span class="op">=</span> transformer_model(sample_batch)</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Transformer prediction shape: </span><span class="sc">{</span>transformer_output[<span class="st">'prediction'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Transformer parameters: 4,450,752
Transformer prediction shape: torch.Size([8, 256])</code></pre>
</div>
</div>
</section>
</section>
<section id="change-detection-applications" class="level2">
<h2 class="anchored" data-anchor-id="change-detection-applications">Change Detection Applications</h2>
<section id="temporal-change-detection" class="level3">
<h3 class="anchored" data-anchor-id="temporal-change-detection">Temporal Change Detection</h3>
<div id="c013851e" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ChangeDetector(nn.Module):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Model for detecting changes in temporal sequences"""</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, backbone_model, num_classes<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.backbone <span class="op">=</span> backbone_model</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.num_classes <span class="op">=</span> num_classes  <span class="co"># No change, Gradual change, Abrupt change</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get the output dimension from backbone</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        output_dim <span class="op">=</span> backbone_model.output_dim</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Change classification head</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.change_classifier <span class="op">=</span> nn.Sequential(</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            nn.Linear(output_dim, <span class="dv">128</span>),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>            nn.Dropout(<span class="fl">0.2</span>),</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">128</span>, num_classes)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Change magnitude regression</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.magnitude_regressor <span class="op">=</span> nn.Sequential(</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            nn.Linear(output_dim, <span class="dv">64</span>),</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">64</span>, <span class="dv">1</span>),</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>            nn.Sigmoid()  <span class="co"># Output between 0 and 1</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get features from backbone</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        backbone_out <span class="op">=</span> <span class="va">self</span>.backbone(x)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        features <span class="op">=</span> backbone_out[<span class="st">'prediction'</span>]</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Classify change type</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        change_type <span class="op">=</span> <span class="va">self</span>.change_classifier(features)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict change magnitude</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        change_magnitude <span class="op">=</span> <span class="va">self</span>.magnitude_regressor(features)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">'change_type'</span>: change_type,</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">'change_magnitude'</span>: change_magnitude,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">'features'</span>: features,</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">'backbone_output'</span>: backbone_out</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create change detection model</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>change_detector <span class="op">=</span> ChangeDetector(transformer_model, num_classes<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Create training data with change labels</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_change_labels(temporal_data):</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create synthetic change labels for training"""</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    batch_size, seq_len, c, h, w <span class="op">=</span> temporal_data.shape</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    change_types <span class="op">=</span> []</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    change_magnitudes <span class="op">=</span> []</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(batch_size):</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Analyze temporal progression</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>        sequence <span class="op">=</span> temporal_data[i, :, <span class="dv">1</span>]  <span class="co"># Use vegetation band</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate temporal variance as proxy for change</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>        temporal_var <span class="op">=</span> torch.var(sequence.flatten(<span class="dv">1</span>), dim<span class="op">=</span><span class="dv">1</span>).mean()</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Classify change type based on variance</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temporal_var <span class="op">&lt;</span> <span class="fl">0.01</span>:</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>            change_type <span class="op">=</span> <span class="dv">0</span>  <span class="co"># No change</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>            magnitude <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temporal_var <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>            change_type <span class="op">=</span> <span class="dv">1</span>  <span class="co"># Gradual change</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>            magnitude <span class="op">=</span> <span class="bu">float</span>(temporal_var <span class="op">/</span> <span class="fl">0.05</span>)</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>            change_type <span class="op">=</span> <span class="dv">2</span>  <span class="co"># Abrupt change</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>            magnitude <span class="op">=</span> <span class="bu">min</span>(<span class="fl">1.0</span>, <span class="bu">float</span>(temporal_var <span class="op">/</span> <span class="fl">0.1</span>))</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>        change_types.append(change_type)</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>        change_magnitudes.append(magnitude)</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> torch.LongTensor(change_types), torch.FloatTensor(change_magnitudes).unsqueeze(<span class="dv">1</span>)</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Test change detection</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>    change_output <span class="op">=</span> change_detector(sample_batch)</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>    change_types, change_mags <span class="op">=</span> create_change_labels(sample_batch)</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Change type predictions: </span><span class="sc">{</span>change_output[<span class="st">'change_type'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Change magnitude predictions: </span><span class="sc">{</span>change_output[<span class="st">'change_magnitude'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Sample change types: </span><span class="sc">{</span>change_types[:<span class="dv">5</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Sample change magnitudes: </span><span class="sc">{</span>change_mags[:<span class="dv">5</span>, <span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Change type predictions: torch.Size([8, 3])
Change magnitude predictions: torch.Size([8, 1])
Sample change types: tensor([0, 0, 0, 0, 0])
Sample change magnitudes: tensor([0., 0., 0., 0., 0.])</code></pre>
</div>
</div>
</section>
<section id="training-change-detection-model" class="level3">
<h3 class="anchored" data-anchor-id="training-change-detection-model">Training Change Detection Model</h3>
<div id="7cfa1e53" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.nn <span class="im">import</span> CrossEntropyLoss, MSELoss</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ChangeDetectionTrainer:</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Trainer for change detection models"""</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, model, device<span class="op">=</span><span class="st">'cpu'</span>):</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> model.to(device)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.device <span class="op">=</span> device</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Loss functions</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.classification_loss <span class="op">=</span> CrossEntropyLoss()</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.regression_loss <span class="op">=</span> MSELoss()</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Optimizer</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.optimizer <span class="op">=</span> optim.AdamW(model.parameters(), lr<span class="op">=</span><span class="fl">1e-4</span>, weight_decay<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Training history</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.history <span class="op">=</span> {</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'train_loss'</span>: [],</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'val_loss'</span>: [],</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'classification_acc'</span>: [],</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'regression_mae'</span>: []</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> train_epoch(<span class="va">self</span>, dataloader):</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Train for one epoch"""</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model.train()</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        total_loss <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        correct_classifications <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        total_samples <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        total_mae <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> batch_idx, data <span class="kw">in</span> <span class="bu">enumerate</span>(dataloader):</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> data.to(<span class="va">self</span>.device)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generate labels</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>            change_types, change_mags <span class="op">=</span> create_change_labels(data)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>            change_types <span class="op">=</span> change_types.to(<span class="va">self</span>.device)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>            change_mags <span class="op">=</span> change_mags.to(<span class="va">self</span>.device)</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Forward pass</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>            output <span class="op">=</span> <span class="va">self</span>.model(data)</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate losses</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>            class_loss <span class="op">=</span> <span class="va">self</span>.classification_loss(output[<span class="st">'change_type'</span>], change_types)</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>            reg_loss <span class="op">=</span> <span class="va">self</span>.regression_loss(output[<span class="st">'change_magnitude'</span>], change_mags)</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Combined loss</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>            total_batch_loss <span class="op">=</span> class_loss <span class="op">+</span> reg_loss</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Backward pass</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.optimizer.zero_grad()</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>            total_batch_loss.backward()</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.optimizer.step()</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Statistics</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>            total_loss <span class="op">+=</span> total_batch_loss.item()</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>            pred_classes <span class="op">=</span> output[<span class="st">'change_type'</span>].argmax(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>            correct_classifications <span class="op">+=</span> (pred_classes <span class="op">==</span> change_types).<span class="bu">sum</span>().item()</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>            total_samples <span class="op">+=</span> change_types.size(<span class="dv">0</span>)</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>            <span class="co"># MAE for regression</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>            mae <span class="op">=</span> torch.<span class="bu">abs</span>(output[<span class="st">'change_magnitude'</span>] <span class="op">-</span> change_mags).mean().item()</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>            total_mae <span class="op">+=</span> mae</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>        avg_loss <span class="op">=</span> total_loss <span class="op">/</span> <span class="bu">len</span>(dataloader)</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>        classification_acc <span class="op">=</span> correct_classifications <span class="op">/</span> total_samples</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>        avg_mae <span class="op">=</span> total_mae <span class="op">/</span> <span class="bu">len</span>(dataloader)</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> avg_loss, classification_acc, avg_mae</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, train_loader, val_loader<span class="op">=</span><span class="va">None</span>, epochs<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Complete training procedure"""</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Training change detection model..."</span>)</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Train</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>            train_loss, train_acc, train_mae <span class="op">=</span> <span class="va">self</span>.train_epoch(train_loader)</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Validate (using training data for demo)</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>            val_loss, val_acc, val_mae <span class="op">=</span> train_loss, train_acc, train_mae</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Store history</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.history[<span class="st">'train_loss'</span>].append(train_loss)</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.history[<span class="st">'val_loss'</span>].append(val_loss)</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.history[<span class="st">'classification_acc'</span>].append(train_acc)</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.history[<span class="st">'regression_mae'</span>].append(train_mae)</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Epoch </span><span class="sc">{</span>epoch<span class="op">+</span><span class="dv">1</span><span class="sc">:2d}</span><span class="ss">/</span><span class="sc">{</span>epochs<span class="sc">}</span><span class="ss"> | "</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"Loss: </span><span class="sc">{</span>train_loss<span class="sc">:.4f}</span><span class="ss"> | "</span></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"Acc: </span><span class="sc">{</span>train_acc<span class="sc">:.3f}</span><span class="ss"> | "</span></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"MAE: </span><span class="sc">{</span>train_mae<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.history</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>trainer <span class="op">=</span> ChangeDetectionTrainer(change_detector)</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> trainer.fit(temporal_loader, epochs<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot training curves</span></span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2, ax3) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">4</span>))</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>ax1.plot(history[<span class="st">'train_loss'</span>], label<span class="op">=</span><span class="st">'Train Loss'</span>)</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Training Loss'</span>)</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>ax2.plot(history[<span class="st">'classification_acc'</span>], label<span class="op">=</span><span class="st">'Classification Accuracy'</span>)</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Classification Accuracy'</span>)</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>ax3.plot(history[<span class="st">'regression_mae'</span>], label<span class="op">=</span><span class="st">'Regression MAE'</span>)</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'Magnitude Prediction MAE'</span>)</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>ax3.set_xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>ax3.legend()</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>ax3.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training change detection model...
Epoch  1/5 | Loss: 0.5245 | Acc: 0.995 | MAE: 0.3425
Epoch  2/5 | Loss: 0.0317 | Acc: 1.000 | MAE: 0.0920
Epoch  3/5 | Loss: 0.0036 | Acc: 1.000 | MAE: 0.0294
Epoch  4/5 | Loss: 0.0012 | Acc: 1.000 | MAE: 0.0174
Epoch  5/5 | Loss: 0.0006 | Acc: 1.000 | MAE: 0.0115</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="c06-model-evaluation-analysis_files/figure-html/cell-6-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="foundation-model-integration" class="level2">
<h2 class="anchored" data-anchor-id="foundation-model-integration">Foundation Model Integration</h2>
<section id="adapting-pretrained-models-for-temporal-analysis" class="level3">
<h3 class="anchored" data-anchor-id="adapting-pretrained-models-for-temporal-analysis">Adapting Pretrained Models for Temporal Analysis</h3>
<div id="5626beed" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FoundationModelTemporal(nn.Module):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Adapter for using foundation models with temporal data"""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, foundation_model, temporal_fusion<span class="op">=</span><span class="st">'attention'</span>):</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.foundation_model <span class="op">=</span> foundation_model</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.temporal_fusion <span class="op">=</span> temporal_fusion</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Assume foundation model outputs 768-dim features</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.feature_dim <span class="op">=</span> <span class="dv">768</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temporal_fusion <span class="op">==</span> <span class="st">'attention'</span>:</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.temporal_attention <span class="op">=</span> nn.MultiheadAttention(</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                embed_dim<span class="op">=</span><span class="va">self</span>.feature_dim,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                num_heads<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                batch_first<span class="op">=</span><span class="va">True</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temporal_fusion <span class="op">==</span> <span class="st">'lstm'</span>:</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.temporal_lstm <span class="op">=</span> nn.LSTM(</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                input_size<span class="op">=</span><span class="va">self</span>.feature_dim,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                hidden_size<span class="op">=</span><span class="va">self</span>.feature_dim,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>                num_layers<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>                batch_first<span class="op">=</span><span class="va">True</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temporal_fusion <span class="op">==</span> <span class="st">'transformer'</span>:</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>            encoder_layer <span class="op">=</span> nn.TransformerEncoderLayer(</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>                d_model<span class="op">=</span><span class="va">self</span>.feature_dim,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>                nhead<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>                batch_first<span class="op">=</span><span class="va">True</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.temporal_transformer <span class="op">=</span> nn.TransformerEncoder(encoder_layer, num_layers<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Final classification/regression heads</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.classifier <span class="op">=</span> nn.Linear(<span class="va">self</span>.feature_dim, <span class="dv">10</span>)  <span class="co"># 10 land cover classes</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># x: (B, T, C, H, W)</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        batch_size, seq_len, c, h, w <span class="op">=</span> x.shape</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process each timestep through foundation model</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>        temporal_features <span class="op">=</span> []</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(seq_len):</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract features for timestep t</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> torch.no_grad():  <span class="co"># Foundation model frozen</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>                feat <span class="op">=</span> <span class="va">self</span>.foundation_model(x[:, t])  <span class="co"># (B, feature_dim)</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>            temporal_features.append(feat)</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Stack temporal features</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>        temporal_features <span class="op">=</span> torch.stack(temporal_features, dim<span class="op">=</span><span class="dv">1</span>)  <span class="co"># (B, T, feature_dim)</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply temporal fusion</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.temporal_fusion <span class="op">==</span> <span class="st">'attention'</span>:</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>            fused_features, _ <span class="op">=</span> <span class="va">self</span>.temporal_attention(</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>                temporal_features, temporal_features, temporal_features</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Use last timestep</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>            output_features <span class="op">=</span> fused_features[:, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.temporal_fusion <span class="op">==</span> <span class="st">'lstm'</span>:</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>            lstm_out, _ <span class="op">=</span> <span class="va">self</span>.temporal_lstm(temporal_features)</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>            output_features <span class="op">=</span> lstm_out[:, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.temporal_fusion <span class="op">==</span> <span class="st">'transformer'</span>:</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>            transformer_out <span class="op">=</span> <span class="va">self</span>.temporal_transformer(temporal_features)</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>            output_features <span class="op">=</span> transformer_out.mean(dim<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Global average pooling</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:  <span class="co"># Simple averaging</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>            output_features <span class="op">=</span> temporal_features.mean(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Final prediction</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>        prediction <span class="op">=</span> <span class="va">self</span>.classifier(output_features)</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>            <span class="st">'prediction'</span>: prediction,</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>            <span class="st">'temporal_features'</span>: temporal_features,</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>            <span class="st">'fused_features'</span>: output_features</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Mock foundation model for demonstration</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MockFoundationModel(nn.Module):</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.backbone <span class="op">=</span> nn.Sequential(</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">3</span>, <span class="dv">64</span>, <span class="dv">7</span>, stride<span class="op">=</span><span class="dv">2</span>, padding<span class="op">=</span><span class="dv">3</span>),</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>            nn.AdaptiveAvgPool2d(<span class="dv">1</span>),</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>            nn.Flatten(),</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">64</span>, <span class="dv">768</span>)</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.backbone(x)</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Create foundation model with temporal adaptation</span></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>foundation_base <span class="op">=</span> MockFoundationModel()</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>temporal_foundation <span class="op">=</span> FoundationModelTemporal(foundation_base, temporal_fusion<span class="op">=</span><span class="st">'attention'</span>)</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Temporal foundation model parameters: </span><span class="sc">{</span><span class="bu">sum</span>(p.numel() <span class="cf">for</span> p <span class="kw">in</span> temporal_foundation.parameters())<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Test with temporal data</span></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>    foundation_output <span class="op">=</span> temporal_foundation(sample_batch)</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Foundation model output shape: </span><span class="sc">{</span>foundation_output[<span class="st">'prediction'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Temporal features shape: </span><span class="sc">{</span>foundation_output[<span class="st">'temporal_features'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temporal foundation model parameters: 2,429,450
Foundation model output shape: torch.Size([8, 10])
Temporal features shape: torch.Size([8, 12, 768])</code></pre>
</div>
</div>
</section>
</section>
<section id="project-implementation-framework" class="level2">
<h2 class="anchored" data-anchor-id="project-implementation-framework">Project Implementation Framework</h2>
<section id="project-structure-template" class="level3">
<h3 class="anchored" data-anchor-id="project-structure-template">Project Structure Template</h3>
<div id="53bb6100" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ProjectFramework:</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Framework for implementing independent projects"""</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, project_config):</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.config <span class="op">=</span> project_config</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_loader <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.trainer <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> setup_data(<span class="va">self</span>):</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Setup project-specific data pipeline"""</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Setting up data for: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config[<span class="st">'title'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This would be customized for each project</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.config[<span class="st">'data_type'</span>] <span class="op">==</span> <span class="st">'time_series'</span>:</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.data_loader <span class="op">=</span> <span class="va">self</span>._setup_temporal_data()</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.config[<span class="st">'data_type'</span>] <span class="op">==</span> <span class="st">'static'</span>:</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.data_loader <span class="op">=</span> <span class="va">self</span>._setup_static_data()</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Unknown data type: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config[<span class="st">'data_type'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.data_loader</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _setup_temporal_data(<span class="va">self</span>):</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Setup temporal data pipeline"""</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For demonstration, use our temporal dataset</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> DataLoader(temporal_dataset, batch_size<span class="op">=</span><span class="va">self</span>.config[<span class="st">'batch_size'</span>], shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _setup_static_data(<span class="va">self</span>):</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Setup static data pipeline"""</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Placeholder for static image data</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> setup_model(<span class="va">self</span>):</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Setup project-specific model"""</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Setting up model for: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config[<span class="st">'model_type'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.config[<span class="st">'model_type'</span>] <span class="op">==</span> <span class="st">'temporal_transformer'</span>:</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.model <span class="op">=</span> TemporalTransformer(<span class="op">**</span><span class="va">self</span>.config[<span class="st">'model_params'</span>])</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.config[<span class="st">'model_type'</span>] <span class="op">==</span> <span class="st">'temporal_lstm'</span>:</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.model <span class="op">=</span> TemporalLSTM(<span class="op">**</span><span class="va">self</span>.config[<span class="st">'model_params'</span>])</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.config[<span class="st">'model_type'</span>] <span class="op">==</span> <span class="st">'foundation_temporal'</span>:</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>            base_model <span class="op">=</span> MockFoundationModel()</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.model <span class="op">=</span> FoundationModelTemporal(base_model, <span class="op">**</span><span class="va">self</span>.config[<span class="st">'model_params'</span>])</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Unknown model type: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config[<span class="st">'model_type'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.model</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> setup_training(<span class="va">self</span>):</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Setup training procedure"""</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.config[<span class="st">'task_type'</span>] <span class="op">==</span> <span class="st">'change_detection'</span>:</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Wrap the base model in a ChangeDetector</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>            change_detection_model <span class="op">=</span> ChangeDetector(<span class="va">self</span>.model, num_classes<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.trainer <span class="op">=</span> ChangeDetectionTrainer(change_detection_model)</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generic trainer (would be implemented)</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.trainer <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.trainer</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run_experiment(<span class="va">self</span>):</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Run the complete experiment"""</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\\</span><span class="ss">nRunning experiment: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config[<span class="st">'title'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Setup components</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>        data_loader <span class="op">=</span> <span class="va">self</span>.setup_data()</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> <span class="va">self</span>.setup_model()</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>        trainer <span class="op">=</span> <span class="va">self</span>.setup_training()</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Run training if trainer available</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> trainer:</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>            history <span class="op">=</span> trainer.fit(data_loader, epochs<span class="op">=</span><span class="va">self</span>.config[<span class="st">'epochs'</span>])</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> history</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"No trainer available - would implement project-specific training"</span>)</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Example project configurations</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>project_configs <span class="op">=</span> {</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">'crop_monitoring'</span>: {</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>        <span class="st">'title'</span>: <span class="st">'Crop Growth Monitoring'</span>,</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data_type'</span>: <span class="st">'time_series'</span>,</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">'model_type'</span>: <span class="st">'temporal_transformer'</span>,</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>        <span class="st">'task_type'</span>: <span class="st">'change_detection'</span>,</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>        <span class="st">'batch_size'</span>: <span class="dv">8</span>,</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>        <span class="st">'epochs'</span>: <span class="dv">5</span>,</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>        <span class="st">'model_params'</span>: {</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>            <span class="st">'input_dim'</span>: <span class="dv">256</span>,</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>            <span class="st">'d_model'</span>: <span class="dv">256</span>,</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>            <span class="st">'nhead'</span>: <span class="dv">8</span>,</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>            <span class="st">'num_layers'</span>: <span class="dv">4</span></span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>    <span class="st">'deforestation_detection'</span>: {</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">'title'</span>: <span class="st">'Deforestation Detection'</span>,</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data_type'</span>: <span class="st">'time_series'</span>,</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">'model_type'</span>: <span class="st">'foundation_temporal'</span>,</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">'task_type'</span>: <span class="st">'change_detection'</span>,</span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>        <span class="st">'batch_size'</span>: <span class="dv">4</span>,</span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>        <span class="st">'epochs'</span>: <span class="dv">3</span>,</span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">'model_params'</span>: {</span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>            <span class="st">'temporal_fusion'</span>: <span class="st">'attention'</span></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate project framework</span></span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>project <span class="op">=</span> ProjectFramework(project_configs[<span class="st">'crop_monitoring'</span>])</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> project.run_experiment()</span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> history:</span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">nTraining completed successfully!"</span>)</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Final accuracy: </span><span class="sc">{</span>history[<span class="st">'classification_acc'</span>][<span class="op">-</span><span class="dv">1</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>\nRunning experiment: Crop Growth Monitoring
==================================================
Setting up data for: Crop Growth Monitoring
Setting up model for: temporal_transformer
Training change detection model...
Epoch  1/5 | Loss: 0.5918 | Acc: 0.960 | MAE: 0.4003
Epoch  2/5 | Loss: 0.0536 | Acc: 1.000 | MAE: 0.1634
Epoch  3/5 | Loss: 0.0059 | Acc: 1.000 | MAE: 0.0531
Epoch  4/5 | Loss: 0.0017 | Acc: 1.000 | MAE: 0.0278
Epoch  5/5 | Loss: 0.0009 | Acc: 1.000 | MAE: 0.0201
\nTraining completed successfully!
Final accuracy: 1.000</code></pre>
</div>
</div>
</section>
</section>
<section id="evaluation-metrics-for-spatiotemporal-models" class="level2">
<h2 class="anchored" data-anchor-id="evaluation-metrics-for-spatiotemporal-models">Evaluation Metrics for Spatiotemporal Models</h2>
<section id="temporal-aware-metrics" class="level3">
<h3 class="anchored" data-anchor-id="temporal-aware-metrics">Temporal-Aware Metrics</h3>
<div id="15eca188" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SpatiotemporalMetrics:</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Comprehensive metrics for spatiotemporal model evaluation"""</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> temporal_consistency(predictions, ground_truth):</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Measure temporal consistency of predictions"""</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># predictions, ground_truth: (B, T, ...)</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate temporal gradients</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        pred_gradients <span class="op">=</span> torch.diff(predictions, dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        gt_gradients <span class="op">=</span> torch.diff(ground_truth, dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Consistency score</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        consistency <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> torch.mean(torch.<span class="bu">abs</span>(pred_gradients <span class="op">-</span> gt_gradients))</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> consistency.item()</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> change_detection_metrics(pred_change_type, pred_change_mag,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                               true_change_type, true_change_mag):</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Metrics specific to change detection"""</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Classification metrics</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        correct_classifications <span class="op">=</span> (pred_change_type <span class="op">==</span> true_change_type).<span class="bu">float</span>()</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        classification_accuracy <span class="op">=</span> correct_classifications.mean().item()</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Regression metrics for magnitude</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>        mae <span class="op">=</span> torch.mean(torch.<span class="bu">abs</span>(pred_change_mag <span class="op">-</span> true_change_mag)).item()</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>        rmse <span class="op">=</span> torch.sqrt(torch.mean((pred_change_mag <span class="op">-</span> true_change_mag) <span class="op">**</span> <span class="dv">2</span>)).item()</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">'classification_accuracy'</span>: classification_accuracy,</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">'magnitude_mae'</span>: mae,</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">'magnitude_rmse'</span>: rmse</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> spatial_autocorrelation(predictions, ground_truth):</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Measure spatial autocorrelation preservation"""</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simplified version - would use proper spatial statistics in practice</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> moran_i_approx(data):</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>            <span class="co">"""Approximate Moran's I calculation"""</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># This is a simplified version</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>            mean_val <span class="op">=</span> torch.mean(data)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>            numerator <span class="op">=</span> torch.<span class="bu">sum</span>((data <span class="op">-</span> mean_val) <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> numerator <span class="op">/</span> (data.numel() <span class="op">*</span> torch.var(data))</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>        pred_moran <span class="op">=</span> moran_i_approx(predictions)</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>        gt_moran <span class="op">=</span> moran_i_approx(ground_truth)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How well do we preserve spatial structure?</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>        preservation <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> torch.<span class="bu">abs</span>(pred_moran <span class="op">-</span> gt_moran)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> preservation.item()</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate evaluation metrics</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate some test predictions</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    test_batch <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(temporal_loader))</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>    change_output <span class="op">=</span> change_detector(test_batch)</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    true_types, true_mags <span class="op">=</span> create_change_labels(test_batch)</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>    pred_types <span class="op">=</span> change_output[<span class="st">'change_type'</span>].argmax(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>    pred_mags <span class="op">=</span> change_output[<span class="st">'change_magnitude'</span>]</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate metrics</span></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>    metrics <span class="op">=</span> SpatiotemporalMetrics()</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>    change_metrics <span class="op">=</span> metrics.change_detection_metrics(</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>        pred_types, pred_mags, true_types, true_mags</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">n=== Spatiotemporal Evaluation Metrics ==="</span>)</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Classification Accuracy: </span><span class="sc">{</span>change_metrics[<span class="st">'classification_accuracy'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Magnitude MAE: </span><span class="sc">{</span>change_metrics[<span class="st">'magnitude_mae'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Magnitude RMSE: </span><span class="sc">{</span>change_metrics[<span class="st">'magnitude_rmse'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Temporal consistency (using synthetic data)</span></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>    temp_consistency <span class="op">=</span> metrics.temporal_consistency(test_batch[:, :<span class="op">-</span><span class="dv">1</span>], test_batch[:, <span class="dv">1</span>:])</span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Temporal Consistency: </span><span class="sc">{</span>temp_consistency<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>\n=== Spatiotemporal Evaluation Metrics ===
Classification Accuracy: 1.000
Magnitude MAE: 0.0087
Magnitude RMSE: 0.0089
Temporal Consistency: 0.909</code></pre>
</div>
</div>
</section>
</section>
<section id="week-6-project-workshop" class="level2">
<h2 class="anchored" data-anchor-id="week-6-project-workshop">Week 6 Project Workshop</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Project Implementation Phase
</div>
</div>
<div class="callout-body-container callout-body">
<p>This week marks the beginning of your independent project implementation. Use the frameworks and techniques demonstrated above to:</p>
<ol type="1">
<li><strong>Implement your data pipeline</strong> using the temporal processing techniques</li>
<li><strong>Adapt foundation models</strong> to your specific spatiotemporal task</li>
<li><strong>Design evaluation metrics</strong> appropriate for your problem</li>
<li><strong>Begin training and iteration</strong> on your project</li>
</ol>
</div>
</div>
<section id="project-checklist" class="level3">
<h3 class="anchored" data-anchor-id="project-checklist">Project Checklist</h3>
<div id="8bcecf90" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ProjectChecklist:</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Checklist for Week 6 project implementation"""</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.checklist <span class="op">=</span> {</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'data_pipeline'</span>: [</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Data access and loading implemented'</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Temporal sequences properly formatted'</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Data augmentation strategy defined'</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Train/validation split established'</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'model_architecture'</span>: [</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Base model architecture selected'</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Temporal processing method chosen'</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Model adaptations for project implemented'</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Parameter count and computational requirements assessed'</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'training_setup'</span>: [</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Loss functions appropriate for task defined'</span>,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Optimization strategy established'</span>,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Training loop implemented'</span>,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Checkpointing and model saving set up'</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'evaluation'</span>: [</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Evaluation metrics selected and implemented'</span>,</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Baseline comparisons planned'</span>,</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Visualization strategy for results defined'</span>,</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Success criteria clearly established'</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> display_checklist(<span class="va">self</span>):</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Display the project checklist"""</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">n=== Week 6 Project Implementation Checklist ==="</span>)</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, items <span class="kw">in</span> <span class="va">self</span>.checklist.items():</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\\</span><span class="ss">n</span><span class="sc">{</span>category<span class="sc">.</span>upper()<span class="sc">.</span>replace(<span class="st">'_'</span>, <span class="st">' '</span>)<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> items:</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"  ‚ñ° </span><span class="sc">{</span>item<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> mark_completed(<span class="va">self</span>, category, item_index):</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Mark an item as completed"""</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> category <span class="kw">in</span> <span class="va">self</span>.checklist:</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> item_index <span class="op">&lt;</span> <span class="bu">len</span>(<span class="va">self</span>.checklist[category]):</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>                item <span class="op">=</span> <span class="va">self</span>.checklist[category][item_index]</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.checklist[category][item_index] <span class="op">=</span> <span class="ss">f"‚úì </span><span class="sc">{</span>item[<span class="dv">2</span>:]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Display project checklist</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>checklist <span class="op">=</span> ProjectChecklist()</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>checklist.display_checklist()</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">n=== Implementation Tips ==="</span>)</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>tips <span class="op">=</span> [</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Start with simple temporal models before moving to complex architectures"</span>,</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Use synthetic data to validate your pipeline before applying to real data"</span>,</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Implement thorough logging and visualization for debugging"</span>,</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Consider computational constraints when designing temporal sequences"</span>,</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Plan for iterative development - start simple and add complexity gradually"</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, tip <span class="kw">in</span> <span class="bu">enumerate</span>(tips, <span class="dv">1</span>):</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>tip<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>\n=== Week 6 Project Implementation Checklist ===
\nDATA PIPELINE:
  ‚ñ° Data access and loading implemented
  ‚ñ° Temporal sequences properly formatted
  ‚ñ° Data augmentation strategy defined
  ‚ñ° Train/validation split established
\nMODEL ARCHITECTURE:
  ‚ñ° Base model architecture selected
  ‚ñ° Temporal processing method chosen
  ‚ñ° Model adaptations for project implemented
  ‚ñ° Parameter count and computational requirements assessed
\nTRAINING SETUP:
  ‚ñ° Loss functions appropriate for task defined
  ‚ñ° Optimization strategy established
  ‚ñ° Training loop implemented
  ‚ñ° Checkpointing and model saving set up
\nEVALUATION:
  ‚ñ° Evaluation metrics selected and implemented
  ‚ñ° Baseline comparisons planned
  ‚ñ° Visualization strategy for results defined
  ‚ñ° Success criteria clearly established
\n=== Implementation Tips ===
1. Start with simple temporal models before moving to complex architectures
2. Use synthetic data to validate your pipeline before applying to real data
3. Implement thorough logging and visualization for debugging
4. Consider computational constraints when designing temporal sequences
5. Plan for iterative development - start simple and add complexity gradually</code></pre>
</div>
</div>
</section>
</section>
<section id="assignment-project-implementation" class="level2">
<h2 class="anchored" data-anchor-id="assignment-project-implementation">Assignment: Project Implementation</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Week 6 Deliverable
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this week, have a working implementation of your project including:</p>
<ol type="1">
<li><strong>Data Pipeline</strong>: Complete data loading and preprocessing</li>
<li><strong>Model Implementation</strong>: Working model architecture for your task</li>
<li><strong>Training Loop</strong>: Basic training procedure with loss tracking</li>
<li><strong>Initial Results</strong>: Preliminary results and visualizations</li>
<li><strong>Next Steps Plan</strong>: Clear plan for Week 7 optimization and scaling</li>
</ol>
<p>Document your progress and any challenges encountered.</p>
</div>
</div>
<section id="next-week-preview" class="level3">
<h3 class="anchored" data-anchor-id="next-week-preview">Next Week Preview</h3>
<ul>
<li><strong>Week 7</strong>: Scale up your analysis using cloud platforms and advanced optimization</li>
<li><strong>Week 8</strong>: Build deployment pipelines and comprehensive evaluation</li>
<li><strong>Week 9</strong>: Final analysis, model comparison, and presentation preparation</li>
<li><strong>Week 10</strong>: Final project presentations</li>
</ul>
<p>The spatiotemporal modeling techniques and project framework from this week provide the foundation for implementing sophisticated geospatial AI applications that can handle the temporal dynamics crucial for real-world environmental monitoring and analysis.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/kcaylor\.github\.io\/GEOG-288KC-geospatial-foundation-models");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb19" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Week 6: Spatiotemporal Modeling &amp; Projects"</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Advanced temporal analysis and independent project implementation"</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> geoai</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>By the end of this session, you will be able to:</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Implement spatiotemporal analysis techniques for multi-temporal satellite imagery</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Build time series models for change detection and trend analysis</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Apply foundation models to temporal sequences of geospatial data</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Design and begin executing your independent project</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Evaluate model performance using appropriate spatiotemporal metrics</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prerequisites</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>This session builds on all previous weeks, particularly Week 5's fine-tuning techniques. You should have defined your project proposal and be ready to begin implementation.</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="fu">## Spatiotemporal Data Fundamentals</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>Spatiotemporal analysis combines spatial patterns with temporal dynamics to understand how geographic phenomena change over time. This is crucial for applications like:</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Land cover change detection**: Deforestation, urban expansion</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Crop monitoring**: Growth stages, yield prediction</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Climate impact assessment**: Drought progression, flood mapping</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Environmental monitoring**: Water quality changes, vegetation health</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding Temporal Patterns</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> Dataset, DataLoader</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up reproducible results</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">42</span>)</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TemporalDataset(Dataset):</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Dataset for multi-temporal satellite imagery"""</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n_samples<span class="op">=</span><span class="dv">500</span>, sequence_length<span class="op">=</span><span class="dv">12</span>, image_size<span class="op">=</span><span class="dv">64</span>):</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n_samples <span class="op">=</span> n_samples</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sequence_length <span class="op">=</span> sequence_length</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.image_size <span class="op">=</span> image_size</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simulate monthly time series data</span></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data <span class="op">=</span> <span class="va">self</span>._generate_synthetic_timeseries()</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _generate_synthetic_timeseries(<span class="va">self</span>):</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Generate synthetic time series with seasonal patterns"""</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> []</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n_samples):</span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create base landscape with some spatial structure</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>            base_landscape <span class="op">=</span> <span class="va">self</span>._create_landscape()</span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generate temporal sequence with seasonal variation</span></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>            sequence <span class="op">=</span> []</span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.sequence_length):</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Seasonal factor (NDVI-like pattern)</span></span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>                seasonal_factor <span class="op">=</span> <span class="fl">0.3</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> np.sin(<span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> t <span class="op">/</span> <span class="dv">12</span>)</span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Add some random change events</span></span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>                change_factor <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> np.random.random() <span class="op">&lt;</span> <span class="fl">0.1</span>:  <span class="co"># 10% chance of change</span></span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>                    change_factor <span class="op">=</span> np.random.uniform(<span class="fl">0.5</span>, <span class="fl">1.5</span>)</span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Combine factors</span></span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>                image <span class="op">=</span> base_landscape <span class="op">*</span> seasonal_factor <span class="op">*</span> change_factor</span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Add noise</span></span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>                noise <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.05</span>, image.shape)</span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>                image <span class="op">=</span> np.clip(image <span class="op">+</span> noise, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a>                sequence.append(torch.FloatTensor(image))</span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>            data.append(torch.stack(sequence))  <span class="co"># Shape: (T, C, H, W)</span></span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data</span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_landscape(<span class="va">self</span>):</span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Create a realistic base landscape"""</span></span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Start with random field</span></span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a>        landscape <span class="op">=</span> np.random.random((<span class="dv">3</span>, <span class="va">self</span>.image_size, <span class="va">self</span>.image_size))</span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add some spatial structure (vegetation patches)</span></span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> np.meshgrid(np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="va">self</span>.image_size),</span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a>                          np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="va">self</span>.image_size))</span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create vegetation patches</span></span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a>        vegetation <span class="op">=</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> np.sin(<span class="dv">4</span> <span class="op">*</span> np.pi <span class="op">*</span> x) <span class="op">*</span> np.cos(<span class="dv">4</span> <span class="op">*</span> np.pi <span class="op">*</span> y)</span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a>        vegetation <span class="op">=</span> np.clip(vegetation, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply to NDVI-like band</span></span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a>        landscape[<span class="dv">1</span>] <span class="op">=</span> vegetation</span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> landscape</span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.n_samples</span>
<span id="cb19-121"><a href="#cb19-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-122"><a href="#cb19-122" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, idx):</span>
<span id="cb19-123"><a href="#cb19-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.data[idx]</span>
<span id="cb19-124"><a href="#cb19-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-125"><a href="#cb19-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Create temporal dataset</span></span>
<span id="cb19-126"><a href="#cb19-126" aria-hidden="true" tabindex="-1"></a>temporal_dataset <span class="op">=</span> TemporalDataset(n_samples<span class="op">=</span><span class="dv">200</span>, sequence_length<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb19-127"><a href="#cb19-127" aria-hidden="true" tabindex="-1"></a>temporal_loader <span class="op">=</span> DataLoader(temporal_dataset, batch_size<span class="op">=</span><span class="dv">8</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-128"><a href="#cb19-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-129"><a href="#cb19-129" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dataset size: </span><span class="sc">{</span><span class="bu">len</span>(temporal_dataset)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-130"><a href="#cb19-130" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data shape: </span><span class="sc">{</span>temporal_dataset[<span class="dv">0</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (T, C, H, W)</span></span>
<span id="cb19-131"><a href="#cb19-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-132"><a href="#cb19-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize a sample time series</span></span>
<span id="cb19-133"><a href="#cb19-133" aria-hidden="true" tabindex="-1"></a>sample_ts <span class="op">=</span> temporal_dataset[<span class="dv">0</span>]</span>
<span id="cb19-134"><a href="#cb19-134" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">6</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb19-135"><a href="#cb19-135" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>):</span>
<span id="cb19-136"><a href="#cb19-136" aria-hidden="true" tabindex="-1"></a>    row <span class="op">=</span> i <span class="op">//</span> <span class="dv">6</span></span>
<span id="cb19-137"><a href="#cb19-137" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> i <span class="op">%</span> <span class="dv">6</span></span>
<span id="cb19-138"><a href="#cb19-138" aria-hidden="true" tabindex="-1"></a>    axes[row, col].imshow(sample_ts[i, <span class="dv">1</span>], cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-139"><a href="#cb19-139" aria-hidden="true" tabindex="-1"></a>    axes[row, col].set_title(<span class="ss">f'Month </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb19-140"><a href="#cb19-140" aria-hidden="true" tabindex="-1"></a>    axes[row, col].axis(<span class="st">'off'</span>)</span>
<span id="cb19-141"><a href="#cb19-141" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Monthly NDVI-like Time Series'</span>)</span>
<span id="cb19-142"><a href="#cb19-142" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb19-143"><a href="#cb19-143" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb19-144"><a href="#cb19-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-145"><a href="#cb19-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-146"><a href="#cb19-146" aria-hidden="true" tabindex="-1"></a><span class="fu">## Temporal Foundation Models</span></span>
<span id="cb19-147"><a href="#cb19-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-148"><a href="#cb19-148" aria-hidden="true" tabindex="-1"></a><span class="fu">### LSTM-based Temporal Processing</span></span>
<span id="cb19-149"><a href="#cb19-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-152"><a href="#cb19-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb19-153"><a href="#cb19-153" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TemporalLSTM(nn.Module):</span>
<span id="cb19-154"><a href="#cb19-154" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""LSTM-based model for temporal sequence processing"""</span></span>
<span id="cb19-155"><a href="#cb19-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-156"><a href="#cb19-156" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_dim, hidden_dim<span class="op">=</span><span class="dv">128</span>, num_layers<span class="op">=</span><span class="dv">2</span>, output_dim<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb19-157"><a href="#cb19-157" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb19-158"><a href="#cb19-158" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.input_dim <span class="op">=</span> input_dim</span>
<span id="cb19-159"><a href="#cb19-159" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.hidden_dim <span class="op">=</span> hidden_dim</span>
<span id="cb19-160"><a href="#cb19-160" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.num_layers <span class="op">=</span> num_layers</span>
<span id="cb19-161"><a href="#cb19-161" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dim <span class="op">=</span> output_dim <span class="kw">or</span> input_dim</span>
<span id="cb19-162"><a href="#cb19-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-163"><a href="#cb19-163" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Spatial feature extractor</span></span>
<span id="cb19-164"><a href="#cb19-164" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.spatial_encoder <span class="op">=</span> nn.Sequential(</span>
<span id="cb19-165"><a href="#cb19-165" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">3</span>, <span class="dv">32</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb19-166"><a href="#cb19-166" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb19-167"><a href="#cb19-167" aria-hidden="true" tabindex="-1"></a>            nn.MaxPool2d(<span class="dv">2</span>),</span>
<span id="cb19-168"><a href="#cb19-168" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb19-169"><a href="#cb19-169" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb19-170"><a href="#cb19-170" aria-hidden="true" tabindex="-1"></a>            nn.AdaptiveAvgPool2d(<span class="dv">8</span>),</span>
<span id="cb19-171"><a href="#cb19-171" aria-hidden="true" tabindex="-1"></a>            nn.Flatten(),</span>
<span id="cb19-172"><a href="#cb19-172" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">64</span> <span class="op">*</span> <span class="dv">8</span> <span class="op">*</span> <span class="dv">8</span>, input_dim)</span>
<span id="cb19-173"><a href="#cb19-173" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb19-174"><a href="#cb19-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-175"><a href="#cb19-175" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Temporal LSTM</span></span>
<span id="cb19-176"><a href="#cb19-176" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.lstm <span class="op">=</span> nn.LSTM(input_dim, hidden_dim, num_layers,</span>
<span id="cb19-177"><a href="#cb19-177" aria-hidden="true" tabindex="-1"></a>                           batch_first<span class="op">=</span><span class="va">True</span>, dropout<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb19-178"><a href="#cb19-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-179"><a href="#cb19-179" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Output projection</span></span>
<span id="cb19-180"><a href="#cb19-180" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_head <span class="op">=</span> nn.Sequential(</span>
<span id="cb19-181"><a href="#cb19-181" aria-hidden="true" tabindex="-1"></a>            nn.Linear(hidden_dim, hidden_dim),</span>
<span id="cb19-182"><a href="#cb19-182" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb19-183"><a href="#cb19-183" aria-hidden="true" tabindex="-1"></a>            nn.Dropout(<span class="fl">0.1</span>),</span>
<span id="cb19-184"><a href="#cb19-184" aria-hidden="true" tabindex="-1"></a>            nn.Linear(hidden_dim, <span class="va">self</span>.output_dim)</span>
<span id="cb19-185"><a href="#cb19-185" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb19-186"><a href="#cb19-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-187"><a href="#cb19-187" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb19-188"><a href="#cb19-188" aria-hidden="true" tabindex="-1"></a>        <span class="co"># x: (B, T, C, H, W)</span></span>
<span id="cb19-189"><a href="#cb19-189" aria-hidden="true" tabindex="-1"></a>        batch_size, seq_len, c, h, w <span class="op">=</span> x.shape</span>
<span id="cb19-190"><a href="#cb19-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-191"><a href="#cb19-191" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process each timestep through spatial encoder</span></span>
<span id="cb19-192"><a href="#cb19-192" aria-hidden="true" tabindex="-1"></a>        x_flat <span class="op">=</span> x.view(batch_size <span class="op">*</span> seq_len, c, h, w)</span>
<span id="cb19-193"><a href="#cb19-193" aria-hidden="true" tabindex="-1"></a>        spatial_features <span class="op">=</span> <span class="va">self</span>.spatial_encoder(x_flat)  <span class="co"># (B*T, input_dim)</span></span>
<span id="cb19-194"><a href="#cb19-194" aria-hidden="true" tabindex="-1"></a>        spatial_features <span class="op">=</span> spatial_features.view(batch_size, seq_len, <span class="op">-</span><span class="dv">1</span>)  <span class="co"># (B, T, input_dim)</span></span>
<span id="cb19-195"><a href="#cb19-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-196"><a href="#cb19-196" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process temporal sequence</span></span>
<span id="cb19-197"><a href="#cb19-197" aria-hidden="true" tabindex="-1"></a>        lstm_out, (hidden, cell) <span class="op">=</span> <span class="va">self</span>.lstm(spatial_features)</span>
<span id="cb19-198"><a href="#cb19-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-199"><a href="#cb19-199" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use final hidden state for prediction</span></span>
<span id="cb19-200"><a href="#cb19-200" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="va">self</span>.output_head(lstm_out[:, <span class="op">-</span><span class="dv">1</span>])  <span class="co"># (B, output_dim)</span></span>
<span id="cb19-201"><a href="#cb19-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-202"><a href="#cb19-202" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb19-203"><a href="#cb19-203" aria-hidden="true" tabindex="-1"></a>            <span class="st">'prediction'</span>: output,</span>
<span id="cb19-204"><a href="#cb19-204" aria-hidden="true" tabindex="-1"></a>            <span class="st">'temporal_features'</span>: lstm_out,</span>
<span id="cb19-205"><a href="#cb19-205" aria-hidden="true" tabindex="-1"></a>            <span class="st">'spatial_features'</span>: spatial_features</span>
<span id="cb19-206"><a href="#cb19-206" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-207"><a href="#cb19-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-208"><a href="#cb19-208" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize model</span></span>
<span id="cb19-209"><a href="#cb19-209" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> TemporalLSTM(input_dim<span class="op">=</span><span class="dv">256</span>, hidden_dim<span class="op">=</span><span class="dv">128</span>)</span>
<span id="cb19-210"><a href="#cb19-210" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Model parameters: </span><span class="sc">{</span><span class="bu">sum</span>(p.numel() <span class="cf">for</span> p <span class="kw">in</span> model.parameters())<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb19-211"><a href="#cb19-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-212"><a href="#cb19-212" aria-hidden="true" tabindex="-1"></a><span class="co"># Test forward pass</span></span>
<span id="cb19-213"><a href="#cb19-213" aria-hidden="true" tabindex="-1"></a>sample_batch <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(temporal_loader))</span>
<span id="cb19-214"><a href="#cb19-214" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Input shape: </span><span class="sc">{</span>sample_batch<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-215"><a href="#cb19-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-216"><a href="#cb19-216" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb19-217"><a href="#cb19-217" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> model(sample_batch)</span>
<span id="cb19-218"><a href="#cb19-218" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Prediction shape: </span><span class="sc">{</span>output[<span class="st">'prediction'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-219"><a href="#cb19-219" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Temporal features shape: </span><span class="sc">{</span>output[<span class="st">'temporal_features'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-220"><a href="#cb19-220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-221"><a href="#cb19-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-222"><a href="#cb19-222" aria-hidden="true" tabindex="-1"></a><span class="fu">### Transformer-based Temporal Processing</span></span>
<span id="cb19-223"><a href="#cb19-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-226"><a href="#cb19-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb19-227"><a href="#cb19-227" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TemporalTransformer(nn.Module):</span>
<span id="cb19-228"><a href="#cb19-228" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Transformer-based model for temporal sequence processing"""</span></span>
<span id="cb19-229"><a href="#cb19-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-230"><a href="#cb19-230" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_dim<span class="op">=</span><span class="dv">256</span>, d_model<span class="op">=</span><span class="dv">256</span>, nhead<span class="op">=</span><span class="dv">8</span>, num_layers<span class="op">=</span><span class="dv">4</span>, output_dim<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb19-231"><a href="#cb19-231" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb19-232"><a href="#cb19-232" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.input_dim <span class="op">=</span> input_dim</span>
<span id="cb19-233"><a href="#cb19-233" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.d_model <span class="op">=</span> d_model</span>
<span id="cb19-234"><a href="#cb19-234" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dim <span class="op">=</span> output_dim <span class="kw">or</span> input_dim</span>
<span id="cb19-235"><a href="#cb19-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-236"><a href="#cb19-236" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Spatial feature extractor (same as LSTM version)</span></span>
<span id="cb19-237"><a href="#cb19-237" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.spatial_encoder <span class="op">=</span> nn.Sequential(</span>
<span id="cb19-238"><a href="#cb19-238" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">3</span>, <span class="dv">32</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb19-239"><a href="#cb19-239" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb19-240"><a href="#cb19-240" aria-hidden="true" tabindex="-1"></a>            nn.MaxPool2d(<span class="dv">2</span>),</span>
<span id="cb19-241"><a href="#cb19-241" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb19-242"><a href="#cb19-242" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb19-243"><a href="#cb19-243" aria-hidden="true" tabindex="-1"></a>            nn.AdaptiveAvgPool2d(<span class="dv">8</span>),</span>
<span id="cb19-244"><a href="#cb19-244" aria-hidden="true" tabindex="-1"></a>            nn.Flatten(),</span>
<span id="cb19-245"><a href="#cb19-245" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">64</span> <span class="op">*</span> <span class="dv">8</span> <span class="op">*</span> <span class="dv">8</span>, input_dim)</span>
<span id="cb19-246"><a href="#cb19-246" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb19-247"><a href="#cb19-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-248"><a href="#cb19-248" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Project to model dimension</span></span>
<span id="cb19-249"><a href="#cb19-249" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.input_projection <span class="op">=</span> nn.Linear(input_dim, d_model)</span>
<span id="cb19-250"><a href="#cb19-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-251"><a href="#cb19-251" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Positional encoding for temporal positions</span></span>
<span id="cb19-252"><a href="#cb19-252" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.pos_encoding <span class="op">=</span> nn.Parameter(torch.randn(<span class="dv">100</span>, d_model))  <span class="co"># Max 100 timesteps</span></span>
<span id="cb19-253"><a href="#cb19-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-254"><a href="#cb19-254" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Transformer encoder</span></span>
<span id="cb19-255"><a href="#cb19-255" aria-hidden="true" tabindex="-1"></a>        encoder_layer <span class="op">=</span> nn.TransformerEncoderLayer(</span>
<span id="cb19-256"><a href="#cb19-256" aria-hidden="true" tabindex="-1"></a>            d_model<span class="op">=</span>d_model,</span>
<span id="cb19-257"><a href="#cb19-257" aria-hidden="true" tabindex="-1"></a>            nhead<span class="op">=</span>nhead,</span>
<span id="cb19-258"><a href="#cb19-258" aria-hidden="true" tabindex="-1"></a>            dim_feedforward<span class="op">=</span>d_model <span class="op">*</span> <span class="dv">4</span>,</span>
<span id="cb19-259"><a href="#cb19-259" aria-hidden="true" tabindex="-1"></a>            dropout<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb19-260"><a href="#cb19-260" aria-hidden="true" tabindex="-1"></a>            batch_first<span class="op">=</span><span class="va">True</span></span>
<span id="cb19-261"><a href="#cb19-261" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb19-262"><a href="#cb19-262" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.transformer <span class="op">=</span> nn.TransformerEncoder(encoder_layer, num_layers)</span>
<span id="cb19-263"><a href="#cb19-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-264"><a href="#cb19-264" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Output head</span></span>
<span id="cb19-265"><a href="#cb19-265" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_head <span class="op">=</span> nn.Sequential(</span>
<span id="cb19-266"><a href="#cb19-266" aria-hidden="true" tabindex="-1"></a>            nn.LayerNorm(d_model),</span>
<span id="cb19-267"><a href="#cb19-267" aria-hidden="true" tabindex="-1"></a>            nn.Linear(d_model, d_model),</span>
<span id="cb19-268"><a href="#cb19-268" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb19-269"><a href="#cb19-269" aria-hidden="true" tabindex="-1"></a>            nn.Dropout(<span class="fl">0.1</span>),</span>
<span id="cb19-270"><a href="#cb19-270" aria-hidden="true" tabindex="-1"></a>            nn.Linear(d_model, <span class="va">self</span>.output_dim)</span>
<span id="cb19-271"><a href="#cb19-271" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb19-272"><a href="#cb19-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-273"><a href="#cb19-273" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb19-274"><a href="#cb19-274" aria-hidden="true" tabindex="-1"></a>        <span class="co"># x: (B, T, C, H, W)</span></span>
<span id="cb19-275"><a href="#cb19-275" aria-hidden="true" tabindex="-1"></a>        batch_size, seq_len, c, h, w <span class="op">=</span> x.shape</span>
<span id="cb19-276"><a href="#cb19-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-277"><a href="#cb19-277" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process spatial features</span></span>
<span id="cb19-278"><a href="#cb19-278" aria-hidden="true" tabindex="-1"></a>        x_flat <span class="op">=</span> x.view(batch_size <span class="op">*</span> seq_len, c, h, w)</span>
<span id="cb19-279"><a href="#cb19-279" aria-hidden="true" tabindex="-1"></a>        spatial_features <span class="op">=</span> <span class="va">self</span>.spatial_encoder(x_flat)</span>
<span id="cb19-280"><a href="#cb19-280" aria-hidden="true" tabindex="-1"></a>        spatial_features <span class="op">=</span> spatial_features.view(batch_size, seq_len, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb19-281"><a href="#cb19-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-282"><a href="#cb19-282" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Project to model dimension</span></span>
<span id="cb19-283"><a href="#cb19-283" aria-hidden="true" tabindex="-1"></a>        features <span class="op">=</span> <span class="va">self</span>.input_projection(spatial_features)  <span class="co"># (B, T, d_model)</span></span>
<span id="cb19-284"><a href="#cb19-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-285"><a href="#cb19-285" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add positional encoding</span></span>
<span id="cb19-286"><a href="#cb19-286" aria-hidden="true" tabindex="-1"></a>        features <span class="op">=</span> features <span class="op">+</span> <span class="va">self</span>.pos_encoding[:seq_len].unsqueeze(<span class="dv">0</span>)</span>
<span id="cb19-287"><a href="#cb19-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-288"><a href="#cb19-288" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply transformer</span></span>
<span id="cb19-289"><a href="#cb19-289" aria-hidden="true" tabindex="-1"></a>        transformer_out <span class="op">=</span> <span class="va">self</span>.transformer(features)  <span class="co"># (B, T, d_model)</span></span>
<span id="cb19-290"><a href="#cb19-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-291"><a href="#cb19-291" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Global average pooling across time</span></span>
<span id="cb19-292"><a href="#cb19-292" aria-hidden="true" tabindex="-1"></a>        pooled <span class="op">=</span> transformer_out.mean(dim<span class="op">=</span><span class="dv">1</span>)  <span class="co"># (B, d_model)</span></span>
<span id="cb19-293"><a href="#cb19-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-294"><a href="#cb19-294" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Output prediction</span></span>
<span id="cb19-295"><a href="#cb19-295" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="va">self</span>.output_head(pooled)</span>
<span id="cb19-296"><a href="#cb19-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-297"><a href="#cb19-297" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb19-298"><a href="#cb19-298" aria-hidden="true" tabindex="-1"></a>            <span class="st">'prediction'</span>: output,</span>
<span id="cb19-299"><a href="#cb19-299" aria-hidden="true" tabindex="-1"></a>            <span class="st">'temporal_features'</span>: transformer_out,</span>
<span id="cb19-300"><a href="#cb19-300" aria-hidden="true" tabindex="-1"></a>            <span class="st">'spatial_features'</span>: spatial_features</span>
<span id="cb19-301"><a href="#cb19-301" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-302"><a href="#cb19-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-303"><a href="#cb19-303" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize transformer model</span></span>
<span id="cb19-304"><a href="#cb19-304" aria-hidden="true" tabindex="-1"></a>transformer_model <span class="op">=</span> TemporalTransformer(input_dim<span class="op">=</span><span class="dv">256</span>, d_model<span class="op">=</span><span class="dv">256</span>)</span>
<span id="cb19-305"><a href="#cb19-305" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Transformer parameters: </span><span class="sc">{</span><span class="bu">sum</span>(p.numel() <span class="cf">for</span> p <span class="kw">in</span> transformer_model.parameters())<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb19-306"><a href="#cb19-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-307"><a href="#cb19-307" aria-hidden="true" tabindex="-1"></a><span class="co"># Test forward pass</span></span>
<span id="cb19-308"><a href="#cb19-308" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb19-309"><a href="#cb19-309" aria-hidden="true" tabindex="-1"></a>    transformer_output <span class="op">=</span> transformer_model(sample_batch)</span>
<span id="cb19-310"><a href="#cb19-310" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Transformer prediction shape: </span><span class="sc">{</span>transformer_output[<span class="st">'prediction'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-311"><a href="#cb19-311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-312"><a href="#cb19-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-313"><a href="#cb19-313" aria-hidden="true" tabindex="-1"></a><span class="fu">## Change Detection Applications</span></span>
<span id="cb19-314"><a href="#cb19-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-315"><a href="#cb19-315" aria-hidden="true" tabindex="-1"></a><span class="fu">### Temporal Change Detection</span></span>
<span id="cb19-316"><a href="#cb19-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-319"><a href="#cb19-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb19-320"><a href="#cb19-320" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ChangeDetector(nn.Module):</span>
<span id="cb19-321"><a href="#cb19-321" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Model for detecting changes in temporal sequences"""</span></span>
<span id="cb19-322"><a href="#cb19-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-323"><a href="#cb19-323" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, backbone_model, num_classes<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb19-324"><a href="#cb19-324" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb19-325"><a href="#cb19-325" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.backbone <span class="op">=</span> backbone_model</span>
<span id="cb19-326"><a href="#cb19-326" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.num_classes <span class="op">=</span> num_classes  <span class="co"># No change, Gradual change, Abrupt change</span></span>
<span id="cb19-327"><a href="#cb19-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-328"><a href="#cb19-328" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get the output dimension from backbone</span></span>
<span id="cb19-329"><a href="#cb19-329" aria-hidden="true" tabindex="-1"></a>        output_dim <span class="op">=</span> backbone_model.output_dim</span>
<span id="cb19-330"><a href="#cb19-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-331"><a href="#cb19-331" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Change classification head</span></span>
<span id="cb19-332"><a href="#cb19-332" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.change_classifier <span class="op">=</span> nn.Sequential(</span>
<span id="cb19-333"><a href="#cb19-333" aria-hidden="true" tabindex="-1"></a>            nn.Linear(output_dim, <span class="dv">128</span>),</span>
<span id="cb19-334"><a href="#cb19-334" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb19-335"><a href="#cb19-335" aria-hidden="true" tabindex="-1"></a>            nn.Dropout(<span class="fl">0.2</span>),</span>
<span id="cb19-336"><a href="#cb19-336" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">128</span>, num_classes)</span>
<span id="cb19-337"><a href="#cb19-337" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb19-338"><a href="#cb19-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-339"><a href="#cb19-339" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Change magnitude regression</span></span>
<span id="cb19-340"><a href="#cb19-340" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.magnitude_regressor <span class="op">=</span> nn.Sequential(</span>
<span id="cb19-341"><a href="#cb19-341" aria-hidden="true" tabindex="-1"></a>            nn.Linear(output_dim, <span class="dv">64</span>),</span>
<span id="cb19-342"><a href="#cb19-342" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb19-343"><a href="#cb19-343" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">64</span>, <span class="dv">1</span>),</span>
<span id="cb19-344"><a href="#cb19-344" aria-hidden="true" tabindex="-1"></a>            nn.Sigmoid()  <span class="co"># Output between 0 and 1</span></span>
<span id="cb19-345"><a href="#cb19-345" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb19-346"><a href="#cb19-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-347"><a href="#cb19-347" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb19-348"><a href="#cb19-348" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get features from backbone</span></span>
<span id="cb19-349"><a href="#cb19-349" aria-hidden="true" tabindex="-1"></a>        backbone_out <span class="op">=</span> <span class="va">self</span>.backbone(x)</span>
<span id="cb19-350"><a href="#cb19-350" aria-hidden="true" tabindex="-1"></a>        features <span class="op">=</span> backbone_out[<span class="st">'prediction'</span>]</span>
<span id="cb19-351"><a href="#cb19-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-352"><a href="#cb19-352" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Classify change type</span></span>
<span id="cb19-353"><a href="#cb19-353" aria-hidden="true" tabindex="-1"></a>        change_type <span class="op">=</span> <span class="va">self</span>.change_classifier(features)</span>
<span id="cb19-354"><a href="#cb19-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-355"><a href="#cb19-355" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict change magnitude</span></span>
<span id="cb19-356"><a href="#cb19-356" aria-hidden="true" tabindex="-1"></a>        change_magnitude <span class="op">=</span> <span class="va">self</span>.magnitude_regressor(features)</span>
<span id="cb19-357"><a href="#cb19-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-358"><a href="#cb19-358" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb19-359"><a href="#cb19-359" aria-hidden="true" tabindex="-1"></a>            <span class="st">'change_type'</span>: change_type,</span>
<span id="cb19-360"><a href="#cb19-360" aria-hidden="true" tabindex="-1"></a>            <span class="st">'change_magnitude'</span>: change_magnitude,</span>
<span id="cb19-361"><a href="#cb19-361" aria-hidden="true" tabindex="-1"></a>            <span class="st">'features'</span>: features,</span>
<span id="cb19-362"><a href="#cb19-362" aria-hidden="true" tabindex="-1"></a>            <span class="st">'backbone_output'</span>: backbone_out</span>
<span id="cb19-363"><a href="#cb19-363" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-364"><a href="#cb19-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-365"><a href="#cb19-365" aria-hidden="true" tabindex="-1"></a><span class="co"># Create change detection model</span></span>
<span id="cb19-366"><a href="#cb19-366" aria-hidden="true" tabindex="-1"></a>change_detector <span class="op">=</span> ChangeDetector(transformer_model, num_classes<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb19-367"><a href="#cb19-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-368"><a href="#cb19-368" aria-hidden="true" tabindex="-1"></a><span class="co"># Create training data with change labels</span></span>
<span id="cb19-369"><a href="#cb19-369" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_change_labels(temporal_data):</span>
<span id="cb19-370"><a href="#cb19-370" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create synthetic change labels for training"""</span></span>
<span id="cb19-371"><a href="#cb19-371" aria-hidden="true" tabindex="-1"></a>    batch_size, seq_len, c, h, w <span class="op">=</span> temporal_data.shape</span>
<span id="cb19-372"><a href="#cb19-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-373"><a href="#cb19-373" aria-hidden="true" tabindex="-1"></a>    change_types <span class="op">=</span> []</span>
<span id="cb19-374"><a href="#cb19-374" aria-hidden="true" tabindex="-1"></a>    change_magnitudes <span class="op">=</span> []</span>
<span id="cb19-375"><a href="#cb19-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-376"><a href="#cb19-376" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(batch_size):</span>
<span id="cb19-377"><a href="#cb19-377" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Analyze temporal progression</span></span>
<span id="cb19-378"><a href="#cb19-378" aria-hidden="true" tabindex="-1"></a>        sequence <span class="op">=</span> temporal_data[i, :, <span class="dv">1</span>]  <span class="co"># Use vegetation band</span></span>
<span id="cb19-379"><a href="#cb19-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-380"><a href="#cb19-380" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate temporal variance as proxy for change</span></span>
<span id="cb19-381"><a href="#cb19-381" aria-hidden="true" tabindex="-1"></a>        temporal_var <span class="op">=</span> torch.var(sequence.flatten(<span class="dv">1</span>), dim<span class="op">=</span><span class="dv">1</span>).mean()</span>
<span id="cb19-382"><a href="#cb19-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-383"><a href="#cb19-383" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Classify change type based on variance</span></span>
<span id="cb19-384"><a href="#cb19-384" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temporal_var <span class="op">&lt;</span> <span class="fl">0.01</span>:</span>
<span id="cb19-385"><a href="#cb19-385" aria-hidden="true" tabindex="-1"></a>            change_type <span class="op">=</span> <span class="dv">0</span>  <span class="co"># No change</span></span>
<span id="cb19-386"><a href="#cb19-386" aria-hidden="true" tabindex="-1"></a>            magnitude <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb19-387"><a href="#cb19-387" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temporal_var <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb19-388"><a href="#cb19-388" aria-hidden="true" tabindex="-1"></a>            change_type <span class="op">=</span> <span class="dv">1</span>  <span class="co"># Gradual change</span></span>
<span id="cb19-389"><a href="#cb19-389" aria-hidden="true" tabindex="-1"></a>            magnitude <span class="op">=</span> <span class="bu">float</span>(temporal_var <span class="op">/</span> <span class="fl">0.05</span>)</span>
<span id="cb19-390"><a href="#cb19-390" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb19-391"><a href="#cb19-391" aria-hidden="true" tabindex="-1"></a>            change_type <span class="op">=</span> <span class="dv">2</span>  <span class="co"># Abrupt change</span></span>
<span id="cb19-392"><a href="#cb19-392" aria-hidden="true" tabindex="-1"></a>            magnitude <span class="op">=</span> <span class="bu">min</span>(<span class="fl">1.0</span>, <span class="bu">float</span>(temporal_var <span class="op">/</span> <span class="fl">0.1</span>))</span>
<span id="cb19-393"><a href="#cb19-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-394"><a href="#cb19-394" aria-hidden="true" tabindex="-1"></a>        change_types.append(change_type)</span>
<span id="cb19-395"><a href="#cb19-395" aria-hidden="true" tabindex="-1"></a>        change_magnitudes.append(magnitude)</span>
<span id="cb19-396"><a href="#cb19-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-397"><a href="#cb19-397" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> torch.LongTensor(change_types), torch.FloatTensor(change_magnitudes).unsqueeze(<span class="dv">1</span>)</span>
<span id="cb19-398"><a href="#cb19-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-399"><a href="#cb19-399" aria-hidden="true" tabindex="-1"></a><span class="co"># Test change detection</span></span>
<span id="cb19-400"><a href="#cb19-400" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb19-401"><a href="#cb19-401" aria-hidden="true" tabindex="-1"></a>    change_output <span class="op">=</span> change_detector(sample_batch)</span>
<span id="cb19-402"><a href="#cb19-402" aria-hidden="true" tabindex="-1"></a>    change_types, change_mags <span class="op">=</span> create_change_labels(sample_batch)</span>
<span id="cb19-403"><a href="#cb19-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-404"><a href="#cb19-404" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Change type predictions: </span><span class="sc">{</span>change_output[<span class="st">'change_type'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-405"><a href="#cb19-405" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Change magnitude predictions: </span><span class="sc">{</span>change_output[<span class="st">'change_magnitude'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-406"><a href="#cb19-406" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Sample change types: </span><span class="sc">{</span>change_types[:<span class="dv">5</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-407"><a href="#cb19-407" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Sample change magnitudes: </span><span class="sc">{</span>change_mags[:<span class="dv">5</span>, <span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-408"><a href="#cb19-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-409"><a href="#cb19-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-410"><a href="#cb19-410" aria-hidden="true" tabindex="-1"></a><span class="fu">### Training Change Detection Model</span></span>
<span id="cb19-411"><a href="#cb19-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-414"><a href="#cb19-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb19-415"><a href="#cb19-415" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb19-416"><a href="#cb19-416" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.nn <span class="im">import</span> CrossEntropyLoss, MSELoss</span>
<span id="cb19-417"><a href="#cb19-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-418"><a href="#cb19-418" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ChangeDetectionTrainer:</span>
<span id="cb19-419"><a href="#cb19-419" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Trainer for change detection models"""</span></span>
<span id="cb19-420"><a href="#cb19-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-421"><a href="#cb19-421" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, model, device<span class="op">=</span><span class="st">'cpu'</span>):</span>
<span id="cb19-422"><a href="#cb19-422" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> model.to(device)</span>
<span id="cb19-423"><a href="#cb19-423" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.device <span class="op">=</span> device</span>
<span id="cb19-424"><a href="#cb19-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-425"><a href="#cb19-425" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Loss functions</span></span>
<span id="cb19-426"><a href="#cb19-426" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.classification_loss <span class="op">=</span> CrossEntropyLoss()</span>
<span id="cb19-427"><a href="#cb19-427" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.regression_loss <span class="op">=</span> MSELoss()</span>
<span id="cb19-428"><a href="#cb19-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-429"><a href="#cb19-429" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Optimizer</span></span>
<span id="cb19-430"><a href="#cb19-430" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.optimizer <span class="op">=</span> optim.AdamW(model.parameters(), lr<span class="op">=</span><span class="fl">1e-4</span>, weight_decay<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb19-431"><a href="#cb19-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-432"><a href="#cb19-432" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Training history</span></span>
<span id="cb19-433"><a href="#cb19-433" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.history <span class="op">=</span> {</span>
<span id="cb19-434"><a href="#cb19-434" aria-hidden="true" tabindex="-1"></a>            <span class="st">'train_loss'</span>: [],</span>
<span id="cb19-435"><a href="#cb19-435" aria-hidden="true" tabindex="-1"></a>            <span class="st">'val_loss'</span>: [],</span>
<span id="cb19-436"><a href="#cb19-436" aria-hidden="true" tabindex="-1"></a>            <span class="st">'classification_acc'</span>: [],</span>
<span id="cb19-437"><a href="#cb19-437" aria-hidden="true" tabindex="-1"></a>            <span class="st">'regression_mae'</span>: []</span>
<span id="cb19-438"><a href="#cb19-438" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-439"><a href="#cb19-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-440"><a href="#cb19-440" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> train_epoch(<span class="va">self</span>, dataloader):</span>
<span id="cb19-441"><a href="#cb19-441" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Train for one epoch"""</span></span>
<span id="cb19-442"><a href="#cb19-442" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model.train()</span>
<span id="cb19-443"><a href="#cb19-443" aria-hidden="true" tabindex="-1"></a>        total_loss <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-444"><a href="#cb19-444" aria-hidden="true" tabindex="-1"></a>        correct_classifications <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-445"><a href="#cb19-445" aria-hidden="true" tabindex="-1"></a>        total_samples <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-446"><a href="#cb19-446" aria-hidden="true" tabindex="-1"></a>        total_mae <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-447"><a href="#cb19-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-448"><a href="#cb19-448" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> batch_idx, data <span class="kw">in</span> <span class="bu">enumerate</span>(dataloader):</span>
<span id="cb19-449"><a href="#cb19-449" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> data.to(<span class="va">self</span>.device)</span>
<span id="cb19-450"><a href="#cb19-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-451"><a href="#cb19-451" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generate labels</span></span>
<span id="cb19-452"><a href="#cb19-452" aria-hidden="true" tabindex="-1"></a>            change_types, change_mags <span class="op">=</span> create_change_labels(data)</span>
<span id="cb19-453"><a href="#cb19-453" aria-hidden="true" tabindex="-1"></a>            change_types <span class="op">=</span> change_types.to(<span class="va">self</span>.device)</span>
<span id="cb19-454"><a href="#cb19-454" aria-hidden="true" tabindex="-1"></a>            change_mags <span class="op">=</span> change_mags.to(<span class="va">self</span>.device)</span>
<span id="cb19-455"><a href="#cb19-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-456"><a href="#cb19-456" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Forward pass</span></span>
<span id="cb19-457"><a href="#cb19-457" aria-hidden="true" tabindex="-1"></a>            output <span class="op">=</span> <span class="va">self</span>.model(data)</span>
<span id="cb19-458"><a href="#cb19-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-459"><a href="#cb19-459" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate losses</span></span>
<span id="cb19-460"><a href="#cb19-460" aria-hidden="true" tabindex="-1"></a>            class_loss <span class="op">=</span> <span class="va">self</span>.classification_loss(output[<span class="st">'change_type'</span>], change_types)</span>
<span id="cb19-461"><a href="#cb19-461" aria-hidden="true" tabindex="-1"></a>            reg_loss <span class="op">=</span> <span class="va">self</span>.regression_loss(output[<span class="st">'change_magnitude'</span>], change_mags)</span>
<span id="cb19-462"><a href="#cb19-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-463"><a href="#cb19-463" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Combined loss</span></span>
<span id="cb19-464"><a href="#cb19-464" aria-hidden="true" tabindex="-1"></a>            total_batch_loss <span class="op">=</span> class_loss <span class="op">+</span> reg_loss</span>
<span id="cb19-465"><a href="#cb19-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-466"><a href="#cb19-466" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Backward pass</span></span>
<span id="cb19-467"><a href="#cb19-467" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.optimizer.zero_grad()</span>
<span id="cb19-468"><a href="#cb19-468" aria-hidden="true" tabindex="-1"></a>            total_batch_loss.backward()</span>
<span id="cb19-469"><a href="#cb19-469" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.optimizer.step()</span>
<span id="cb19-470"><a href="#cb19-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-471"><a href="#cb19-471" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Statistics</span></span>
<span id="cb19-472"><a href="#cb19-472" aria-hidden="true" tabindex="-1"></a>            total_loss <span class="op">+=</span> total_batch_loss.item()</span>
<span id="cb19-473"><a href="#cb19-473" aria-hidden="true" tabindex="-1"></a>            pred_classes <span class="op">=</span> output[<span class="st">'change_type'</span>].argmax(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-474"><a href="#cb19-474" aria-hidden="true" tabindex="-1"></a>            correct_classifications <span class="op">+=</span> (pred_classes <span class="op">==</span> change_types).<span class="bu">sum</span>().item()</span>
<span id="cb19-475"><a href="#cb19-475" aria-hidden="true" tabindex="-1"></a>            total_samples <span class="op">+=</span> change_types.size(<span class="dv">0</span>)</span>
<span id="cb19-476"><a href="#cb19-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-477"><a href="#cb19-477" aria-hidden="true" tabindex="-1"></a>            <span class="co"># MAE for regression</span></span>
<span id="cb19-478"><a href="#cb19-478" aria-hidden="true" tabindex="-1"></a>            mae <span class="op">=</span> torch.<span class="bu">abs</span>(output[<span class="st">'change_magnitude'</span>] <span class="op">-</span> change_mags).mean().item()</span>
<span id="cb19-479"><a href="#cb19-479" aria-hidden="true" tabindex="-1"></a>            total_mae <span class="op">+=</span> mae</span>
<span id="cb19-480"><a href="#cb19-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-481"><a href="#cb19-481" aria-hidden="true" tabindex="-1"></a>        avg_loss <span class="op">=</span> total_loss <span class="op">/</span> <span class="bu">len</span>(dataloader)</span>
<span id="cb19-482"><a href="#cb19-482" aria-hidden="true" tabindex="-1"></a>        classification_acc <span class="op">=</span> correct_classifications <span class="op">/</span> total_samples</span>
<span id="cb19-483"><a href="#cb19-483" aria-hidden="true" tabindex="-1"></a>        avg_mae <span class="op">=</span> total_mae <span class="op">/</span> <span class="bu">len</span>(dataloader)</span>
<span id="cb19-484"><a href="#cb19-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-485"><a href="#cb19-485" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> avg_loss, classification_acc, avg_mae</span>
<span id="cb19-486"><a href="#cb19-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-487"><a href="#cb19-487" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, train_loader, val_loader<span class="op">=</span><span class="va">None</span>, epochs<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb19-488"><a href="#cb19-488" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Complete training procedure"""</span></span>
<span id="cb19-489"><a href="#cb19-489" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Training change detection model..."</span>)</span>
<span id="cb19-490"><a href="#cb19-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-491"><a href="#cb19-491" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb19-492"><a href="#cb19-492" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Train</span></span>
<span id="cb19-493"><a href="#cb19-493" aria-hidden="true" tabindex="-1"></a>            train_loss, train_acc, train_mae <span class="op">=</span> <span class="va">self</span>.train_epoch(train_loader)</span>
<span id="cb19-494"><a href="#cb19-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-495"><a href="#cb19-495" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Validate (using training data for demo)</span></span>
<span id="cb19-496"><a href="#cb19-496" aria-hidden="true" tabindex="-1"></a>            val_loss, val_acc, val_mae <span class="op">=</span> train_loss, train_acc, train_mae</span>
<span id="cb19-497"><a href="#cb19-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-498"><a href="#cb19-498" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Store history</span></span>
<span id="cb19-499"><a href="#cb19-499" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.history[<span class="st">'train_loss'</span>].append(train_loss)</span>
<span id="cb19-500"><a href="#cb19-500" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.history[<span class="st">'val_loss'</span>].append(val_loss)</span>
<span id="cb19-501"><a href="#cb19-501" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.history[<span class="st">'classification_acc'</span>].append(train_acc)</span>
<span id="cb19-502"><a href="#cb19-502" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.history[<span class="st">'regression_mae'</span>].append(train_mae)</span>
<span id="cb19-503"><a href="#cb19-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-504"><a href="#cb19-504" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Epoch </span><span class="sc">{</span>epoch<span class="op">+</span><span class="dv">1</span><span class="sc">:2d}</span><span class="ss">/</span><span class="sc">{</span>epochs<span class="sc">}</span><span class="ss"> | "</span></span>
<span id="cb19-505"><a href="#cb19-505" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"Loss: </span><span class="sc">{</span>train_loss<span class="sc">:.4f}</span><span class="ss"> | "</span></span>
<span id="cb19-506"><a href="#cb19-506" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"Acc: </span><span class="sc">{</span>train_acc<span class="sc">:.3f}</span><span class="ss"> | "</span></span>
<span id="cb19-507"><a href="#cb19-507" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"MAE: </span><span class="sc">{</span>train_mae<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb19-508"><a href="#cb19-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-509"><a href="#cb19-509" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.history</span>
<span id="cb19-510"><a href="#cb19-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-511"><a href="#cb19-511" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb19-512"><a href="#cb19-512" aria-hidden="true" tabindex="-1"></a>trainer <span class="op">=</span> ChangeDetectionTrainer(change_detector)</span>
<span id="cb19-513"><a href="#cb19-513" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> trainer.fit(temporal_loader, epochs<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb19-514"><a href="#cb19-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-515"><a href="#cb19-515" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot training curves</span></span>
<span id="cb19-516"><a href="#cb19-516" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2, ax3) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">4</span>))</span>
<span id="cb19-517"><a href="#cb19-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-518"><a href="#cb19-518" aria-hidden="true" tabindex="-1"></a>ax1.plot(history[<span class="st">'train_loss'</span>], label<span class="op">=</span><span class="st">'Train Loss'</span>)</span>
<span id="cb19-519"><a href="#cb19-519" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Training Loss'</span>)</span>
<span id="cb19-520"><a href="#cb19-520" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb19-521"><a href="#cb19-521" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb19-522"><a href="#cb19-522" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb19-523"><a href="#cb19-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-524"><a href="#cb19-524" aria-hidden="true" tabindex="-1"></a>ax2.plot(history[<span class="st">'classification_acc'</span>], label<span class="op">=</span><span class="st">'Classification Accuracy'</span>)</span>
<span id="cb19-525"><a href="#cb19-525" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Classification Accuracy'</span>)</span>
<span id="cb19-526"><a href="#cb19-526" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb19-527"><a href="#cb19-527" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb19-528"><a href="#cb19-528" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb19-529"><a href="#cb19-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-530"><a href="#cb19-530" aria-hidden="true" tabindex="-1"></a>ax3.plot(history[<span class="st">'regression_mae'</span>], label<span class="op">=</span><span class="st">'Regression MAE'</span>)</span>
<span id="cb19-531"><a href="#cb19-531" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'Magnitude Prediction MAE'</span>)</span>
<span id="cb19-532"><a href="#cb19-532" aria-hidden="true" tabindex="-1"></a>ax3.set_xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb19-533"><a href="#cb19-533" aria-hidden="true" tabindex="-1"></a>ax3.legend()</span>
<span id="cb19-534"><a href="#cb19-534" aria-hidden="true" tabindex="-1"></a>ax3.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb19-535"><a href="#cb19-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-536"><a href="#cb19-536" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb19-537"><a href="#cb19-537" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb19-538"><a href="#cb19-538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-539"><a href="#cb19-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-540"><a href="#cb19-540" aria-hidden="true" tabindex="-1"></a><span class="fu">## Foundation Model Integration</span></span>
<span id="cb19-541"><a href="#cb19-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-542"><a href="#cb19-542" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adapting Pretrained Models for Temporal Analysis</span></span>
<span id="cb19-543"><a href="#cb19-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-546"><a href="#cb19-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb19-547"><a href="#cb19-547" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FoundationModelTemporal(nn.Module):</span>
<span id="cb19-548"><a href="#cb19-548" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Adapter for using foundation models with temporal data"""</span></span>
<span id="cb19-549"><a href="#cb19-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-550"><a href="#cb19-550" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, foundation_model, temporal_fusion<span class="op">=</span><span class="st">'attention'</span>):</span>
<span id="cb19-551"><a href="#cb19-551" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb19-552"><a href="#cb19-552" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.foundation_model <span class="op">=</span> foundation_model</span>
<span id="cb19-553"><a href="#cb19-553" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.temporal_fusion <span class="op">=</span> temporal_fusion</span>
<span id="cb19-554"><a href="#cb19-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-555"><a href="#cb19-555" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Assume foundation model outputs 768-dim features</span></span>
<span id="cb19-556"><a href="#cb19-556" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.feature_dim <span class="op">=</span> <span class="dv">768</span></span>
<span id="cb19-557"><a href="#cb19-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-558"><a href="#cb19-558" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temporal_fusion <span class="op">==</span> <span class="st">'attention'</span>:</span>
<span id="cb19-559"><a href="#cb19-559" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.temporal_attention <span class="op">=</span> nn.MultiheadAttention(</span>
<span id="cb19-560"><a href="#cb19-560" aria-hidden="true" tabindex="-1"></a>                embed_dim<span class="op">=</span><span class="va">self</span>.feature_dim,</span>
<span id="cb19-561"><a href="#cb19-561" aria-hidden="true" tabindex="-1"></a>                num_heads<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb19-562"><a href="#cb19-562" aria-hidden="true" tabindex="-1"></a>                batch_first<span class="op">=</span><span class="va">True</span></span>
<span id="cb19-563"><a href="#cb19-563" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb19-564"><a href="#cb19-564" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temporal_fusion <span class="op">==</span> <span class="st">'lstm'</span>:</span>
<span id="cb19-565"><a href="#cb19-565" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.temporal_lstm <span class="op">=</span> nn.LSTM(</span>
<span id="cb19-566"><a href="#cb19-566" aria-hidden="true" tabindex="-1"></a>                input_size<span class="op">=</span><span class="va">self</span>.feature_dim,</span>
<span id="cb19-567"><a href="#cb19-567" aria-hidden="true" tabindex="-1"></a>                hidden_size<span class="op">=</span><span class="va">self</span>.feature_dim,</span>
<span id="cb19-568"><a href="#cb19-568" aria-hidden="true" tabindex="-1"></a>                num_layers<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb19-569"><a href="#cb19-569" aria-hidden="true" tabindex="-1"></a>                batch_first<span class="op">=</span><span class="va">True</span></span>
<span id="cb19-570"><a href="#cb19-570" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb19-571"><a href="#cb19-571" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temporal_fusion <span class="op">==</span> <span class="st">'transformer'</span>:</span>
<span id="cb19-572"><a href="#cb19-572" aria-hidden="true" tabindex="-1"></a>            encoder_layer <span class="op">=</span> nn.TransformerEncoderLayer(</span>
<span id="cb19-573"><a href="#cb19-573" aria-hidden="true" tabindex="-1"></a>                d_model<span class="op">=</span><span class="va">self</span>.feature_dim,</span>
<span id="cb19-574"><a href="#cb19-574" aria-hidden="true" tabindex="-1"></a>                nhead<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb19-575"><a href="#cb19-575" aria-hidden="true" tabindex="-1"></a>                batch_first<span class="op">=</span><span class="va">True</span></span>
<span id="cb19-576"><a href="#cb19-576" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb19-577"><a href="#cb19-577" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.temporal_transformer <span class="op">=</span> nn.TransformerEncoder(encoder_layer, num_layers<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb19-578"><a href="#cb19-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-579"><a href="#cb19-579" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Final classification/regression heads</span></span>
<span id="cb19-580"><a href="#cb19-580" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.classifier <span class="op">=</span> nn.Linear(<span class="va">self</span>.feature_dim, <span class="dv">10</span>)  <span class="co"># 10 land cover classes</span></span>
<span id="cb19-581"><a href="#cb19-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-582"><a href="#cb19-582" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb19-583"><a href="#cb19-583" aria-hidden="true" tabindex="-1"></a>        <span class="co"># x: (B, T, C, H, W)</span></span>
<span id="cb19-584"><a href="#cb19-584" aria-hidden="true" tabindex="-1"></a>        batch_size, seq_len, c, h, w <span class="op">=</span> x.shape</span>
<span id="cb19-585"><a href="#cb19-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-586"><a href="#cb19-586" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process each timestep through foundation model</span></span>
<span id="cb19-587"><a href="#cb19-587" aria-hidden="true" tabindex="-1"></a>        temporal_features <span class="op">=</span> []</span>
<span id="cb19-588"><a href="#cb19-588" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(seq_len):</span>
<span id="cb19-589"><a href="#cb19-589" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract features for timestep t</span></span>
<span id="cb19-590"><a href="#cb19-590" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> torch.no_grad():  <span class="co"># Foundation model frozen</span></span>
<span id="cb19-591"><a href="#cb19-591" aria-hidden="true" tabindex="-1"></a>                feat <span class="op">=</span> <span class="va">self</span>.foundation_model(x[:, t])  <span class="co"># (B, feature_dim)</span></span>
<span id="cb19-592"><a href="#cb19-592" aria-hidden="true" tabindex="-1"></a>            temporal_features.append(feat)</span>
<span id="cb19-593"><a href="#cb19-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-594"><a href="#cb19-594" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Stack temporal features</span></span>
<span id="cb19-595"><a href="#cb19-595" aria-hidden="true" tabindex="-1"></a>        temporal_features <span class="op">=</span> torch.stack(temporal_features, dim<span class="op">=</span><span class="dv">1</span>)  <span class="co"># (B, T, feature_dim)</span></span>
<span id="cb19-596"><a href="#cb19-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-597"><a href="#cb19-597" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply temporal fusion</span></span>
<span id="cb19-598"><a href="#cb19-598" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.temporal_fusion <span class="op">==</span> <span class="st">'attention'</span>:</span>
<span id="cb19-599"><a href="#cb19-599" aria-hidden="true" tabindex="-1"></a>            fused_features, _ <span class="op">=</span> <span class="va">self</span>.temporal_attention(</span>
<span id="cb19-600"><a href="#cb19-600" aria-hidden="true" tabindex="-1"></a>                temporal_features, temporal_features, temporal_features</span>
<span id="cb19-601"><a href="#cb19-601" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb19-602"><a href="#cb19-602" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Use last timestep</span></span>
<span id="cb19-603"><a href="#cb19-603" aria-hidden="true" tabindex="-1"></a>            output_features <span class="op">=</span> fused_features[:, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb19-604"><a href="#cb19-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-605"><a href="#cb19-605" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.temporal_fusion <span class="op">==</span> <span class="st">'lstm'</span>:</span>
<span id="cb19-606"><a href="#cb19-606" aria-hidden="true" tabindex="-1"></a>            lstm_out, _ <span class="op">=</span> <span class="va">self</span>.temporal_lstm(temporal_features)</span>
<span id="cb19-607"><a href="#cb19-607" aria-hidden="true" tabindex="-1"></a>            output_features <span class="op">=</span> lstm_out[:, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb19-608"><a href="#cb19-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-609"><a href="#cb19-609" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.temporal_fusion <span class="op">==</span> <span class="st">'transformer'</span>:</span>
<span id="cb19-610"><a href="#cb19-610" aria-hidden="true" tabindex="-1"></a>            transformer_out <span class="op">=</span> <span class="va">self</span>.temporal_transformer(temporal_features)</span>
<span id="cb19-611"><a href="#cb19-611" aria-hidden="true" tabindex="-1"></a>            output_features <span class="op">=</span> transformer_out.mean(dim<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Global average pooling</span></span>
<span id="cb19-612"><a href="#cb19-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-613"><a href="#cb19-613" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:  <span class="co"># Simple averaging</span></span>
<span id="cb19-614"><a href="#cb19-614" aria-hidden="true" tabindex="-1"></a>            output_features <span class="op">=</span> temporal_features.mean(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-615"><a href="#cb19-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-616"><a href="#cb19-616" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Final prediction</span></span>
<span id="cb19-617"><a href="#cb19-617" aria-hidden="true" tabindex="-1"></a>        prediction <span class="op">=</span> <span class="va">self</span>.classifier(output_features)</span>
<span id="cb19-618"><a href="#cb19-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-619"><a href="#cb19-619" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb19-620"><a href="#cb19-620" aria-hidden="true" tabindex="-1"></a>            <span class="st">'prediction'</span>: prediction,</span>
<span id="cb19-621"><a href="#cb19-621" aria-hidden="true" tabindex="-1"></a>            <span class="st">'temporal_features'</span>: temporal_features,</span>
<span id="cb19-622"><a href="#cb19-622" aria-hidden="true" tabindex="-1"></a>            <span class="st">'fused_features'</span>: output_features</span>
<span id="cb19-623"><a href="#cb19-623" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-624"><a href="#cb19-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-625"><a href="#cb19-625" aria-hidden="true" tabindex="-1"></a><span class="co"># Mock foundation model for demonstration</span></span>
<span id="cb19-626"><a href="#cb19-626" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MockFoundationModel(nn.Module):</span>
<span id="cb19-627"><a href="#cb19-627" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb19-628"><a href="#cb19-628" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb19-629"><a href="#cb19-629" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.backbone <span class="op">=</span> nn.Sequential(</span>
<span id="cb19-630"><a href="#cb19-630" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">3</span>, <span class="dv">64</span>, <span class="dv">7</span>, stride<span class="op">=</span><span class="dv">2</span>, padding<span class="op">=</span><span class="dv">3</span>),</span>
<span id="cb19-631"><a href="#cb19-631" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb19-632"><a href="#cb19-632" aria-hidden="true" tabindex="-1"></a>            nn.AdaptiveAvgPool2d(<span class="dv">1</span>),</span>
<span id="cb19-633"><a href="#cb19-633" aria-hidden="true" tabindex="-1"></a>            nn.Flatten(),</span>
<span id="cb19-634"><a href="#cb19-634" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">64</span>, <span class="dv">768</span>)</span>
<span id="cb19-635"><a href="#cb19-635" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb19-636"><a href="#cb19-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-637"><a href="#cb19-637" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb19-638"><a href="#cb19-638" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.backbone(x)</span>
<span id="cb19-639"><a href="#cb19-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-640"><a href="#cb19-640" aria-hidden="true" tabindex="-1"></a><span class="co"># Create foundation model with temporal adaptation</span></span>
<span id="cb19-641"><a href="#cb19-641" aria-hidden="true" tabindex="-1"></a>foundation_base <span class="op">=</span> MockFoundationModel()</span>
<span id="cb19-642"><a href="#cb19-642" aria-hidden="true" tabindex="-1"></a>temporal_foundation <span class="op">=</span> FoundationModelTemporal(foundation_base, temporal_fusion<span class="op">=</span><span class="st">'attention'</span>)</span>
<span id="cb19-643"><a href="#cb19-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-644"><a href="#cb19-644" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Temporal foundation model parameters: </span><span class="sc">{</span><span class="bu">sum</span>(p.numel() <span class="cf">for</span> p <span class="kw">in</span> temporal_foundation.parameters())<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb19-645"><a href="#cb19-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-646"><a href="#cb19-646" aria-hidden="true" tabindex="-1"></a><span class="co"># Test with temporal data</span></span>
<span id="cb19-647"><a href="#cb19-647" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb19-648"><a href="#cb19-648" aria-hidden="true" tabindex="-1"></a>    foundation_output <span class="op">=</span> temporal_foundation(sample_batch)</span>
<span id="cb19-649"><a href="#cb19-649" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Foundation model output shape: </span><span class="sc">{</span>foundation_output[<span class="st">'prediction'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-650"><a href="#cb19-650" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Temporal features shape: </span><span class="sc">{</span>foundation_output[<span class="st">'temporal_features'</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-651"><a href="#cb19-651" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-652"><a href="#cb19-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-653"><a href="#cb19-653" aria-hidden="true" tabindex="-1"></a><span class="fu">## Project Implementation Framework</span></span>
<span id="cb19-654"><a href="#cb19-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-655"><a href="#cb19-655" aria-hidden="true" tabindex="-1"></a><span class="fu">### Project Structure Template</span></span>
<span id="cb19-656"><a href="#cb19-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-659"><a href="#cb19-659" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb19-660"><a href="#cb19-660" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ProjectFramework:</span>
<span id="cb19-661"><a href="#cb19-661" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Framework for implementing independent projects"""</span></span>
<span id="cb19-662"><a href="#cb19-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-663"><a href="#cb19-663" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, project_config):</span>
<span id="cb19-664"><a href="#cb19-664" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.config <span class="op">=</span> project_config</span>
<span id="cb19-665"><a href="#cb19-665" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> <span class="va">None</span></span>
<span id="cb19-666"><a href="#cb19-666" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_loader <span class="op">=</span> <span class="va">None</span></span>
<span id="cb19-667"><a href="#cb19-667" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.trainer <span class="op">=</span> <span class="va">None</span></span>
<span id="cb19-668"><a href="#cb19-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-669"><a href="#cb19-669" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> setup_data(<span class="va">self</span>):</span>
<span id="cb19-670"><a href="#cb19-670" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Setup project-specific data pipeline"""</span></span>
<span id="cb19-671"><a href="#cb19-671" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Setting up data for: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config[<span class="st">'title'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-672"><a href="#cb19-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-673"><a href="#cb19-673" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This would be customized for each project</span></span>
<span id="cb19-674"><a href="#cb19-674" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.config[<span class="st">'data_type'</span>] <span class="op">==</span> <span class="st">'time_series'</span>:</span>
<span id="cb19-675"><a href="#cb19-675" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.data_loader <span class="op">=</span> <span class="va">self</span>._setup_temporal_data()</span>
<span id="cb19-676"><a href="#cb19-676" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.config[<span class="st">'data_type'</span>] <span class="op">==</span> <span class="st">'static'</span>:</span>
<span id="cb19-677"><a href="#cb19-677" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.data_loader <span class="op">=</span> <span class="va">self</span>._setup_static_data()</span>
<span id="cb19-678"><a href="#cb19-678" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb19-679"><a href="#cb19-679" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Unknown data type: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config[<span class="st">'data_type'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-680"><a href="#cb19-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-681"><a href="#cb19-681" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.data_loader</span>
<span id="cb19-682"><a href="#cb19-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-683"><a href="#cb19-683" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _setup_temporal_data(<span class="va">self</span>):</span>
<span id="cb19-684"><a href="#cb19-684" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Setup temporal data pipeline"""</span></span>
<span id="cb19-685"><a href="#cb19-685" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For demonstration, use our temporal dataset</span></span>
<span id="cb19-686"><a href="#cb19-686" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> DataLoader(temporal_dataset, batch_size<span class="op">=</span><span class="va">self</span>.config[<span class="st">'batch_size'</span>], shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-687"><a href="#cb19-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-688"><a href="#cb19-688" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _setup_static_data(<span class="va">self</span>):</span>
<span id="cb19-689"><a href="#cb19-689" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Setup static data pipeline"""</span></span>
<span id="cb19-690"><a href="#cb19-690" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Placeholder for static image data</span></span>
<span id="cb19-691"><a href="#cb19-691" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb19-692"><a href="#cb19-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-693"><a href="#cb19-693" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> setup_model(<span class="va">self</span>):</span>
<span id="cb19-694"><a href="#cb19-694" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Setup project-specific model"""</span></span>
<span id="cb19-695"><a href="#cb19-695" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Setting up model for: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config[<span class="st">'model_type'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-696"><a href="#cb19-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-697"><a href="#cb19-697" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.config[<span class="st">'model_type'</span>] <span class="op">==</span> <span class="st">'temporal_transformer'</span>:</span>
<span id="cb19-698"><a href="#cb19-698" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.model <span class="op">=</span> TemporalTransformer(<span class="op">**</span><span class="va">self</span>.config[<span class="st">'model_params'</span>])</span>
<span id="cb19-699"><a href="#cb19-699" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.config[<span class="st">'model_type'</span>] <span class="op">==</span> <span class="st">'temporal_lstm'</span>:</span>
<span id="cb19-700"><a href="#cb19-700" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.model <span class="op">=</span> TemporalLSTM(<span class="op">**</span><span class="va">self</span>.config[<span class="st">'model_params'</span>])</span>
<span id="cb19-701"><a href="#cb19-701" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.config[<span class="st">'model_type'</span>] <span class="op">==</span> <span class="st">'foundation_temporal'</span>:</span>
<span id="cb19-702"><a href="#cb19-702" aria-hidden="true" tabindex="-1"></a>            base_model <span class="op">=</span> MockFoundationModel()</span>
<span id="cb19-703"><a href="#cb19-703" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.model <span class="op">=</span> FoundationModelTemporal(base_model, <span class="op">**</span><span class="va">self</span>.config[<span class="st">'model_params'</span>])</span>
<span id="cb19-704"><a href="#cb19-704" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb19-705"><a href="#cb19-705" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Unknown model type: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config[<span class="st">'model_type'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-706"><a href="#cb19-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-707"><a href="#cb19-707" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.model</span>
<span id="cb19-708"><a href="#cb19-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-709"><a href="#cb19-709" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> setup_training(<span class="va">self</span>):</span>
<span id="cb19-710"><a href="#cb19-710" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Setup training procedure"""</span></span>
<span id="cb19-711"><a href="#cb19-711" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.config[<span class="st">'task_type'</span>] <span class="op">==</span> <span class="st">'change_detection'</span>:</span>
<span id="cb19-712"><a href="#cb19-712" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Wrap the base model in a ChangeDetector</span></span>
<span id="cb19-713"><a href="#cb19-713" aria-hidden="true" tabindex="-1"></a>            change_detection_model <span class="op">=</span> ChangeDetector(<span class="va">self</span>.model, num_classes<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb19-714"><a href="#cb19-714" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.trainer <span class="op">=</span> ChangeDetectionTrainer(change_detection_model)</span>
<span id="cb19-715"><a href="#cb19-715" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb19-716"><a href="#cb19-716" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generic trainer (would be implemented)</span></span>
<span id="cb19-717"><a href="#cb19-717" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.trainer <span class="op">=</span> <span class="va">None</span></span>
<span id="cb19-718"><a href="#cb19-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-719"><a href="#cb19-719" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.trainer</span>
<span id="cb19-720"><a href="#cb19-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-721"><a href="#cb19-721" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run_experiment(<span class="va">self</span>):</span>
<span id="cb19-722"><a href="#cb19-722" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Run the complete experiment"""</span></span>
<span id="cb19-723"><a href="#cb19-723" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\\</span><span class="ss">nRunning experiment: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config[<span class="st">'title'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-724"><a href="#cb19-724" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb19-725"><a href="#cb19-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-726"><a href="#cb19-726" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Setup components</span></span>
<span id="cb19-727"><a href="#cb19-727" aria-hidden="true" tabindex="-1"></a>        data_loader <span class="op">=</span> <span class="va">self</span>.setup_data()</span>
<span id="cb19-728"><a href="#cb19-728" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> <span class="va">self</span>.setup_model()</span>
<span id="cb19-729"><a href="#cb19-729" aria-hidden="true" tabindex="-1"></a>        trainer <span class="op">=</span> <span class="va">self</span>.setup_training()</span>
<span id="cb19-730"><a href="#cb19-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-731"><a href="#cb19-731" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Run training if trainer available</span></span>
<span id="cb19-732"><a href="#cb19-732" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> trainer:</span>
<span id="cb19-733"><a href="#cb19-733" aria-hidden="true" tabindex="-1"></a>            history <span class="op">=</span> trainer.fit(data_loader, epochs<span class="op">=</span><span class="va">self</span>.config[<span class="st">'epochs'</span>])</span>
<span id="cb19-734"><a href="#cb19-734" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> history</span>
<span id="cb19-735"><a href="#cb19-735" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb19-736"><a href="#cb19-736" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"No trainer available - would implement project-specific training"</span>)</span>
<span id="cb19-737"><a href="#cb19-737" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb19-738"><a href="#cb19-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-739"><a href="#cb19-739" aria-hidden="true" tabindex="-1"></a><span class="co"># Example project configurations</span></span>
<span id="cb19-740"><a href="#cb19-740" aria-hidden="true" tabindex="-1"></a>project_configs <span class="op">=</span> {</span>
<span id="cb19-741"><a href="#cb19-741" aria-hidden="true" tabindex="-1"></a>    <span class="st">'crop_monitoring'</span>: {</span>
<span id="cb19-742"><a href="#cb19-742" aria-hidden="true" tabindex="-1"></a>        <span class="st">'title'</span>: <span class="st">'Crop Growth Monitoring'</span>,</span>
<span id="cb19-743"><a href="#cb19-743" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data_type'</span>: <span class="st">'time_series'</span>,</span>
<span id="cb19-744"><a href="#cb19-744" aria-hidden="true" tabindex="-1"></a>        <span class="st">'model_type'</span>: <span class="st">'temporal_transformer'</span>,</span>
<span id="cb19-745"><a href="#cb19-745" aria-hidden="true" tabindex="-1"></a>        <span class="st">'task_type'</span>: <span class="st">'change_detection'</span>,</span>
<span id="cb19-746"><a href="#cb19-746" aria-hidden="true" tabindex="-1"></a>        <span class="st">'batch_size'</span>: <span class="dv">8</span>,</span>
<span id="cb19-747"><a href="#cb19-747" aria-hidden="true" tabindex="-1"></a>        <span class="st">'epochs'</span>: <span class="dv">5</span>,</span>
<span id="cb19-748"><a href="#cb19-748" aria-hidden="true" tabindex="-1"></a>        <span class="st">'model_params'</span>: {</span>
<span id="cb19-749"><a href="#cb19-749" aria-hidden="true" tabindex="-1"></a>            <span class="st">'input_dim'</span>: <span class="dv">256</span>,</span>
<span id="cb19-750"><a href="#cb19-750" aria-hidden="true" tabindex="-1"></a>            <span class="st">'d_model'</span>: <span class="dv">256</span>,</span>
<span id="cb19-751"><a href="#cb19-751" aria-hidden="true" tabindex="-1"></a>            <span class="st">'nhead'</span>: <span class="dv">8</span>,</span>
<span id="cb19-752"><a href="#cb19-752" aria-hidden="true" tabindex="-1"></a>            <span class="st">'num_layers'</span>: <span class="dv">4</span></span>
<span id="cb19-753"><a href="#cb19-753" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-754"><a href="#cb19-754" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb19-755"><a href="#cb19-755" aria-hidden="true" tabindex="-1"></a>    <span class="st">'deforestation_detection'</span>: {</span>
<span id="cb19-756"><a href="#cb19-756" aria-hidden="true" tabindex="-1"></a>        <span class="st">'title'</span>: <span class="st">'Deforestation Detection'</span>,</span>
<span id="cb19-757"><a href="#cb19-757" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data_type'</span>: <span class="st">'time_series'</span>,</span>
<span id="cb19-758"><a href="#cb19-758" aria-hidden="true" tabindex="-1"></a>        <span class="st">'model_type'</span>: <span class="st">'foundation_temporal'</span>,</span>
<span id="cb19-759"><a href="#cb19-759" aria-hidden="true" tabindex="-1"></a>        <span class="st">'task_type'</span>: <span class="st">'change_detection'</span>,</span>
<span id="cb19-760"><a href="#cb19-760" aria-hidden="true" tabindex="-1"></a>        <span class="st">'batch_size'</span>: <span class="dv">4</span>,</span>
<span id="cb19-761"><a href="#cb19-761" aria-hidden="true" tabindex="-1"></a>        <span class="st">'epochs'</span>: <span class="dv">3</span>,</span>
<span id="cb19-762"><a href="#cb19-762" aria-hidden="true" tabindex="-1"></a>        <span class="st">'model_params'</span>: {</span>
<span id="cb19-763"><a href="#cb19-763" aria-hidden="true" tabindex="-1"></a>            <span class="st">'temporal_fusion'</span>: <span class="st">'attention'</span></span>
<span id="cb19-764"><a href="#cb19-764" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-765"><a href="#cb19-765" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-766"><a href="#cb19-766" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-767"><a href="#cb19-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-768"><a href="#cb19-768" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate project framework</span></span>
<span id="cb19-769"><a href="#cb19-769" aria-hidden="true" tabindex="-1"></a>project <span class="op">=</span> ProjectFramework(project_configs[<span class="st">'crop_monitoring'</span>])</span>
<span id="cb19-770"><a href="#cb19-770" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> project.run_experiment()</span>
<span id="cb19-771"><a href="#cb19-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-772"><a href="#cb19-772" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> history:</span>
<span id="cb19-773"><a href="#cb19-773" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">nTraining completed successfully!"</span>)</span>
<span id="cb19-774"><a href="#cb19-774" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Final accuracy: </span><span class="sc">{</span>history[<span class="st">'classification_acc'</span>][<span class="op">-</span><span class="dv">1</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb19-775"><a href="#cb19-775" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-776"><a href="#cb19-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-777"><a href="#cb19-777" aria-hidden="true" tabindex="-1"></a><span class="fu">## Evaluation Metrics for Spatiotemporal Models</span></span>
<span id="cb19-778"><a href="#cb19-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-779"><a href="#cb19-779" aria-hidden="true" tabindex="-1"></a><span class="fu">### Temporal-Aware Metrics</span></span>
<span id="cb19-780"><a href="#cb19-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-783"><a href="#cb19-783" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb19-784"><a href="#cb19-784" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SpatiotemporalMetrics:</span>
<span id="cb19-785"><a href="#cb19-785" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Comprehensive metrics for spatiotemporal model evaluation"""</span></span>
<span id="cb19-786"><a href="#cb19-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-787"><a href="#cb19-787" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb19-788"><a href="#cb19-788" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> temporal_consistency(predictions, ground_truth):</span>
<span id="cb19-789"><a href="#cb19-789" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Measure temporal consistency of predictions"""</span></span>
<span id="cb19-790"><a href="#cb19-790" aria-hidden="true" tabindex="-1"></a>        <span class="co"># predictions, ground_truth: (B, T, ...)</span></span>
<span id="cb19-791"><a href="#cb19-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-792"><a href="#cb19-792" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate temporal gradients</span></span>
<span id="cb19-793"><a href="#cb19-793" aria-hidden="true" tabindex="-1"></a>        pred_gradients <span class="op">=</span> torch.diff(predictions, dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-794"><a href="#cb19-794" aria-hidden="true" tabindex="-1"></a>        gt_gradients <span class="op">=</span> torch.diff(ground_truth, dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-795"><a href="#cb19-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-796"><a href="#cb19-796" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Consistency score</span></span>
<span id="cb19-797"><a href="#cb19-797" aria-hidden="true" tabindex="-1"></a>        consistency <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> torch.mean(torch.<span class="bu">abs</span>(pred_gradients <span class="op">-</span> gt_gradients))</span>
<span id="cb19-798"><a href="#cb19-798" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> consistency.item()</span>
<span id="cb19-799"><a href="#cb19-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-800"><a href="#cb19-800" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb19-801"><a href="#cb19-801" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> change_detection_metrics(pred_change_type, pred_change_mag,</span>
<span id="cb19-802"><a href="#cb19-802" aria-hidden="true" tabindex="-1"></a>                               true_change_type, true_change_mag):</span>
<span id="cb19-803"><a href="#cb19-803" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Metrics specific to change detection"""</span></span>
<span id="cb19-804"><a href="#cb19-804" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Classification metrics</span></span>
<span id="cb19-805"><a href="#cb19-805" aria-hidden="true" tabindex="-1"></a>        correct_classifications <span class="op">=</span> (pred_change_type <span class="op">==</span> true_change_type).<span class="bu">float</span>()</span>
<span id="cb19-806"><a href="#cb19-806" aria-hidden="true" tabindex="-1"></a>        classification_accuracy <span class="op">=</span> correct_classifications.mean().item()</span>
<span id="cb19-807"><a href="#cb19-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-808"><a href="#cb19-808" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Regression metrics for magnitude</span></span>
<span id="cb19-809"><a href="#cb19-809" aria-hidden="true" tabindex="-1"></a>        mae <span class="op">=</span> torch.mean(torch.<span class="bu">abs</span>(pred_change_mag <span class="op">-</span> true_change_mag)).item()</span>
<span id="cb19-810"><a href="#cb19-810" aria-hidden="true" tabindex="-1"></a>        rmse <span class="op">=</span> torch.sqrt(torch.mean((pred_change_mag <span class="op">-</span> true_change_mag) <span class="op">**</span> <span class="dv">2</span>)).item()</span>
<span id="cb19-811"><a href="#cb19-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-812"><a href="#cb19-812" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb19-813"><a href="#cb19-813" aria-hidden="true" tabindex="-1"></a>            <span class="st">'classification_accuracy'</span>: classification_accuracy,</span>
<span id="cb19-814"><a href="#cb19-814" aria-hidden="true" tabindex="-1"></a>            <span class="st">'magnitude_mae'</span>: mae,</span>
<span id="cb19-815"><a href="#cb19-815" aria-hidden="true" tabindex="-1"></a>            <span class="st">'magnitude_rmse'</span>: rmse</span>
<span id="cb19-816"><a href="#cb19-816" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-817"><a href="#cb19-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-818"><a href="#cb19-818" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb19-819"><a href="#cb19-819" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> spatial_autocorrelation(predictions, ground_truth):</span>
<span id="cb19-820"><a href="#cb19-820" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Measure spatial autocorrelation preservation"""</span></span>
<span id="cb19-821"><a href="#cb19-821" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simplified version - would use proper spatial statistics in practice</span></span>
<span id="cb19-822"><a href="#cb19-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-823"><a href="#cb19-823" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> moran_i_approx(data):</span>
<span id="cb19-824"><a href="#cb19-824" aria-hidden="true" tabindex="-1"></a>            <span class="co">"""Approximate Moran's I calculation"""</span></span>
<span id="cb19-825"><a href="#cb19-825" aria-hidden="true" tabindex="-1"></a>            <span class="co"># This is a simplified version</span></span>
<span id="cb19-826"><a href="#cb19-826" aria-hidden="true" tabindex="-1"></a>            mean_val <span class="op">=</span> torch.mean(data)</span>
<span id="cb19-827"><a href="#cb19-827" aria-hidden="true" tabindex="-1"></a>            numerator <span class="op">=</span> torch.<span class="bu">sum</span>((data <span class="op">-</span> mean_val) <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb19-828"><a href="#cb19-828" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> numerator <span class="op">/</span> (data.numel() <span class="op">*</span> torch.var(data))</span>
<span id="cb19-829"><a href="#cb19-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-830"><a href="#cb19-830" aria-hidden="true" tabindex="-1"></a>        pred_moran <span class="op">=</span> moran_i_approx(predictions)</span>
<span id="cb19-831"><a href="#cb19-831" aria-hidden="true" tabindex="-1"></a>        gt_moran <span class="op">=</span> moran_i_approx(ground_truth)</span>
<span id="cb19-832"><a href="#cb19-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-833"><a href="#cb19-833" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How well do we preserve spatial structure?</span></span>
<span id="cb19-834"><a href="#cb19-834" aria-hidden="true" tabindex="-1"></a>        preservation <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> torch.<span class="bu">abs</span>(pred_moran <span class="op">-</span> gt_moran)</span>
<span id="cb19-835"><a href="#cb19-835" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> preservation.item()</span>
<span id="cb19-836"><a href="#cb19-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-837"><a href="#cb19-837" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate evaluation metrics</span></span>
<span id="cb19-838"><a href="#cb19-838" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb19-839"><a href="#cb19-839" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate some test predictions</span></span>
<span id="cb19-840"><a href="#cb19-840" aria-hidden="true" tabindex="-1"></a>    test_batch <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(temporal_loader))</span>
<span id="cb19-841"><a href="#cb19-841" aria-hidden="true" tabindex="-1"></a>    change_output <span class="op">=</span> change_detector(test_batch)</span>
<span id="cb19-842"><a href="#cb19-842" aria-hidden="true" tabindex="-1"></a>    true_types, true_mags <span class="op">=</span> create_change_labels(test_batch)</span>
<span id="cb19-843"><a href="#cb19-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-844"><a href="#cb19-844" aria-hidden="true" tabindex="-1"></a>    pred_types <span class="op">=</span> change_output[<span class="st">'change_type'</span>].argmax(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-845"><a href="#cb19-845" aria-hidden="true" tabindex="-1"></a>    pred_mags <span class="op">=</span> change_output[<span class="st">'change_magnitude'</span>]</span>
<span id="cb19-846"><a href="#cb19-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-847"><a href="#cb19-847" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate metrics</span></span>
<span id="cb19-848"><a href="#cb19-848" aria-hidden="true" tabindex="-1"></a>    metrics <span class="op">=</span> SpatiotemporalMetrics()</span>
<span id="cb19-849"><a href="#cb19-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-850"><a href="#cb19-850" aria-hidden="true" tabindex="-1"></a>    change_metrics <span class="op">=</span> metrics.change_detection_metrics(</span>
<span id="cb19-851"><a href="#cb19-851" aria-hidden="true" tabindex="-1"></a>        pred_types, pred_mags, true_types, true_mags</span>
<span id="cb19-852"><a href="#cb19-852" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-853"><a href="#cb19-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-854"><a href="#cb19-854" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">n=== Spatiotemporal Evaluation Metrics ==="</span>)</span>
<span id="cb19-855"><a href="#cb19-855" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Classification Accuracy: </span><span class="sc">{</span>change_metrics[<span class="st">'classification_accuracy'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb19-856"><a href="#cb19-856" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Magnitude MAE: </span><span class="sc">{</span>change_metrics[<span class="st">'magnitude_mae'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb19-857"><a href="#cb19-857" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Magnitude RMSE: </span><span class="sc">{</span>change_metrics[<span class="st">'magnitude_rmse'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb19-858"><a href="#cb19-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-859"><a href="#cb19-859" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Temporal consistency (using synthetic data)</span></span>
<span id="cb19-860"><a href="#cb19-860" aria-hidden="true" tabindex="-1"></a>    temp_consistency <span class="op">=</span> metrics.temporal_consistency(test_batch[:, :<span class="op">-</span><span class="dv">1</span>], test_batch[:, <span class="dv">1</span>:])</span>
<span id="cb19-861"><a href="#cb19-861" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Temporal Consistency: </span><span class="sc">{</span>temp_consistency<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb19-862"><a href="#cb19-862" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-863"><a href="#cb19-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-864"><a href="#cb19-864" aria-hidden="true" tabindex="-1"></a><span class="fu">## Week 6 Project Workshop</span></span>
<span id="cb19-865"><a href="#cb19-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-866"><a href="#cb19-866" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb19-867"><a href="#cb19-867" aria-hidden="true" tabindex="-1"></a><span class="fu">## Project Implementation Phase</span></span>
<span id="cb19-868"><a href="#cb19-868" aria-hidden="true" tabindex="-1"></a>This week marks the beginning of your independent project implementation. Use the frameworks and techniques demonstrated above to:</span>
<span id="cb19-869"><a href="#cb19-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-870"><a href="#cb19-870" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Implement your data pipeline** using the temporal processing techniques</span>
<span id="cb19-871"><a href="#cb19-871" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Adapt foundation models** to your specific spatiotemporal task</span>
<span id="cb19-872"><a href="#cb19-872" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Design evaluation metrics** appropriate for your problem</span>
<span id="cb19-873"><a href="#cb19-873" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Begin training and iteration** on your project</span>
<span id="cb19-874"><a href="#cb19-874" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb19-875"><a href="#cb19-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-876"><a href="#cb19-876" aria-hidden="true" tabindex="-1"></a><span class="fu">### Project Checklist</span></span>
<span id="cb19-877"><a href="#cb19-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-880"><a href="#cb19-880" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb19-881"><a href="#cb19-881" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ProjectChecklist:</span>
<span id="cb19-882"><a href="#cb19-882" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Checklist for Week 6 project implementation"""</span></span>
<span id="cb19-883"><a href="#cb19-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-884"><a href="#cb19-884" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb19-885"><a href="#cb19-885" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.checklist <span class="op">=</span> {</span>
<span id="cb19-886"><a href="#cb19-886" aria-hidden="true" tabindex="-1"></a>            <span class="st">'data_pipeline'</span>: [</span>
<span id="cb19-887"><a href="#cb19-887" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Data access and loading implemented'</span>,</span>
<span id="cb19-888"><a href="#cb19-888" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Temporal sequences properly formatted'</span>,</span>
<span id="cb19-889"><a href="#cb19-889" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Data augmentation strategy defined'</span>,</span>
<span id="cb19-890"><a href="#cb19-890" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Train/validation split established'</span></span>
<span id="cb19-891"><a href="#cb19-891" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb19-892"><a href="#cb19-892" aria-hidden="true" tabindex="-1"></a>            <span class="st">'model_architecture'</span>: [</span>
<span id="cb19-893"><a href="#cb19-893" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Base model architecture selected'</span>,</span>
<span id="cb19-894"><a href="#cb19-894" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Temporal processing method chosen'</span>,</span>
<span id="cb19-895"><a href="#cb19-895" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Model adaptations for project implemented'</span>,</span>
<span id="cb19-896"><a href="#cb19-896" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Parameter count and computational requirements assessed'</span></span>
<span id="cb19-897"><a href="#cb19-897" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb19-898"><a href="#cb19-898" aria-hidden="true" tabindex="-1"></a>            <span class="st">'training_setup'</span>: [</span>
<span id="cb19-899"><a href="#cb19-899" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Loss functions appropriate for task defined'</span>,</span>
<span id="cb19-900"><a href="#cb19-900" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Optimization strategy established'</span>,</span>
<span id="cb19-901"><a href="#cb19-901" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Training loop implemented'</span>,</span>
<span id="cb19-902"><a href="#cb19-902" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Checkpointing and model saving set up'</span></span>
<span id="cb19-903"><a href="#cb19-903" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb19-904"><a href="#cb19-904" aria-hidden="true" tabindex="-1"></a>            <span class="st">'evaluation'</span>: [</span>
<span id="cb19-905"><a href="#cb19-905" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Evaluation metrics selected and implemented'</span>,</span>
<span id="cb19-906"><a href="#cb19-906" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Baseline comparisons planned'</span>,</span>
<span id="cb19-907"><a href="#cb19-907" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Visualization strategy for results defined'</span>,</span>
<span id="cb19-908"><a href="#cb19-908" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Success criteria clearly established'</span></span>
<span id="cb19-909"><a href="#cb19-909" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb19-910"><a href="#cb19-910" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-911"><a href="#cb19-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-912"><a href="#cb19-912" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> display_checklist(<span class="va">self</span>):</span>
<span id="cb19-913"><a href="#cb19-913" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Display the project checklist"""</span></span>
<span id="cb19-914"><a href="#cb19-914" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">n=== Week 6 Project Implementation Checklist ==="</span>)</span>
<span id="cb19-915"><a href="#cb19-915" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, items <span class="kw">in</span> <span class="va">self</span>.checklist.items():</span>
<span id="cb19-916"><a href="#cb19-916" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\\</span><span class="ss">n</span><span class="sc">{</span>category<span class="sc">.</span>upper()<span class="sc">.</span>replace(<span class="st">'_'</span>, <span class="st">' '</span>)<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb19-917"><a href="#cb19-917" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> items:</span>
<span id="cb19-918"><a href="#cb19-918" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"  ‚ñ° </span><span class="sc">{</span>item<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-919"><a href="#cb19-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-920"><a href="#cb19-920" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> mark_completed(<span class="va">self</span>, category, item_index):</span>
<span id="cb19-921"><a href="#cb19-921" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Mark an item as completed"""</span></span>
<span id="cb19-922"><a href="#cb19-922" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> category <span class="kw">in</span> <span class="va">self</span>.checklist:</span>
<span id="cb19-923"><a href="#cb19-923" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> item_index <span class="op">&lt;</span> <span class="bu">len</span>(<span class="va">self</span>.checklist[category]):</span>
<span id="cb19-924"><a href="#cb19-924" aria-hidden="true" tabindex="-1"></a>                item <span class="op">=</span> <span class="va">self</span>.checklist[category][item_index]</span>
<span id="cb19-925"><a href="#cb19-925" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.checklist[category][item_index] <span class="op">=</span> <span class="ss">f"‚úì </span><span class="sc">{</span>item[<span class="dv">2</span>:]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb19-926"><a href="#cb19-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-927"><a href="#cb19-927" aria-hidden="true" tabindex="-1"></a><span class="co"># Display project checklist</span></span>
<span id="cb19-928"><a href="#cb19-928" aria-hidden="true" tabindex="-1"></a>checklist <span class="op">=</span> ProjectChecklist()</span>
<span id="cb19-929"><a href="#cb19-929" aria-hidden="true" tabindex="-1"></a>checklist.display_checklist()</span>
<span id="cb19-930"><a href="#cb19-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-931"><a href="#cb19-931" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">n=== Implementation Tips ==="</span>)</span>
<span id="cb19-932"><a href="#cb19-932" aria-hidden="true" tabindex="-1"></a>tips <span class="op">=</span> [</span>
<span id="cb19-933"><a href="#cb19-933" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Start with simple temporal models before moving to complex architectures"</span>,</span>
<span id="cb19-934"><a href="#cb19-934" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Use synthetic data to validate your pipeline before applying to real data"</span>,</span>
<span id="cb19-935"><a href="#cb19-935" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Implement thorough logging and visualization for debugging"</span>,</span>
<span id="cb19-936"><a href="#cb19-936" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Consider computational constraints when designing temporal sequences"</span>,</span>
<span id="cb19-937"><a href="#cb19-937" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Plan for iterative development - start simple and add complexity gradually"</span></span>
<span id="cb19-938"><a href="#cb19-938" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb19-939"><a href="#cb19-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-940"><a href="#cb19-940" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, tip <span class="kw">in</span> <span class="bu">enumerate</span>(tips, <span class="dv">1</span>):</span>
<span id="cb19-941"><a href="#cb19-941" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>tip<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-942"><a href="#cb19-942" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-943"><a href="#cb19-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-944"><a href="#cb19-944" aria-hidden="true" tabindex="-1"></a><span class="fu">## Assignment: Project Implementation</span></span>
<span id="cb19-945"><a href="#cb19-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-946"><a href="#cb19-946" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb19-947"><a href="#cb19-947" aria-hidden="true" tabindex="-1"></a><span class="fu">## Week 6 Deliverable</span></span>
<span id="cb19-948"><a href="#cb19-948" aria-hidden="true" tabindex="-1"></a>By the end of this week, have a working implementation of your project including:</span>
<span id="cb19-949"><a href="#cb19-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-950"><a href="#cb19-950" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Data Pipeline**: Complete data loading and preprocessing</span>
<span id="cb19-951"><a href="#cb19-951" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Model Implementation**: Working model architecture for your task</span>
<span id="cb19-952"><a href="#cb19-952" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Training Loop**: Basic training procedure with loss tracking</span>
<span id="cb19-953"><a href="#cb19-953" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Initial Results**: Preliminary results and visualizations</span>
<span id="cb19-954"><a href="#cb19-954" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Next Steps Plan**: Clear plan for Week 7 optimization and scaling</span>
<span id="cb19-955"><a href="#cb19-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-956"><a href="#cb19-956" aria-hidden="true" tabindex="-1"></a>Document your progress and any challenges encountered.</span>
<span id="cb19-957"><a href="#cb19-957" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb19-958"><a href="#cb19-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-959"><a href="#cb19-959" aria-hidden="true" tabindex="-1"></a><span class="fu">### Next Week Preview</span></span>
<span id="cb19-960"><a href="#cb19-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-961"><a href="#cb19-961" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Week 7**: Scale up your analysis using cloud platforms and advanced optimization</span>
<span id="cb19-962"><a href="#cb19-962" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Week 8**: Build deployment pipelines and comprehensive evaluation</span>
<span id="cb19-963"><a href="#cb19-963" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Week 9**: Final analysis, model comparison, and presentation preparation</span>
<span id="cb19-964"><a href="#cb19-964" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Week 10**: Final project presentations</span>
<span id="cb19-965"><a href="#cb19-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-966"><a href="#cb19-966" aria-hidden="true" tabindex="-1"></a>The spatiotemporal modeling techniques and project framework from this week provide the foundation for implementing sophisticated geospatial AI applications that can handle the temporal dynamics crucial for real-world environmental monitoring and analysis.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/geog-logo.png" class="img-fluid figure-img" width="250"></p>
<figcaption>Department of Geography logo</figcaption>
</figure>
</div>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This website is built with <a href="https://github.com/kcaylor/GEOG-288KC-geospatial-foundation-models"><i class="fa-brands fa-github" title="the github octocat logo" aria-label="github"></i></a> and <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>